(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();/*! @license DOMPurify 3.0.8 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.0.8/LICENSE */const{entries:U0,setPrototypeOf:ym,isFrozen:fT,getPrototypeOf:pT,getOwnPropertyDescriptor:g_}=Object;let{freeze:Jn,seal:di,create:L0}=Object,{apply:up,construct:cp}=typeof Reflect<"u"&&Reflect;Jn||(Jn=function(t){return t});di||(di=function(t){return t});up||(up=function(t,e,r){return t.apply(e,r)});cp||(cp=function(t,e){return new t(...e)});const bl=Br(Array.prototype.forEach),Em=Br(Array.prototype.pop),ku=Br(Array.prototype.push),ud=Br(String.prototype.toLowerCase),jh=Br(String.prototype.toString),_T=Br(String.prototype.match),Ou=Br(String.prototype.replace),mT=Br(String.prototype.indexOf),vT=Br(String.prototype.trim),hr=Br(RegExp.prototype.test),Mu=gT(TypeError);function Br(n){return function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return up(n,t,r)}}function gT(n){return function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return cp(n,e)}}function Ke(n,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ud;ym&&ym(n,null);let r=t.length;for(;r--;){let i=t[r];if(typeof i=="string"){const s=e(i);s!==i&&(fT(t)||(t[r]=s),i=s)}n[i]=!0}return n}function yT(n){for(let t=0;t<n.length;t++)g_(n,t)===void 0&&(n[t]=null);return n}function Pa(n){const t=L0(null);for(const[e,r]of U0(n))g_(n,e)!==void 0&&(Array.isArray(r)?t[e]=yT(r):r&&typeof r=="object"&&r.constructor===Object?t[e]=Pa(r):t[e]=r);return t}function Tl(n,t){for(;n!==null;){const r=g_(n,t);if(r){if(r.get)return Br(r.get);if(typeof r.value=="function")return Br(r.value)}n=pT(n)}function e(r){return console.warn("fallback value for",r),null}return e}const bm=Jn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Kh=Jn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Qh=Jn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),ET=Jn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Wh=Jn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),bT=Jn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Tm=Jn(["#text"]),wm=Jn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),Yh=Jn(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Im=Jn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),wl=Jn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),TT=di(/\{\{[\w\W]*|[\w\W]*\}\}/gm),wT=di(/<%[\w\W]*|[\w\W]*%>/gm),IT=di(/\${[\w\W]*}/gm),ST=di(/^data-[\-\w.\u00B7-\uFFFF]/),CT=di(/^aria-[\-\w]+$/),P0=di(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),NT=di(/^(?:\w+script|data):/i),AT=di(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),x0=di(/^html$/i);var Sm=Object.freeze({__proto__:null,MUSTACHE_EXPR:TT,ERB_EXPR:wT,TMPLIT_EXPR:IT,DATA_ATTR:ST,ARIA_ATTR:CT,IS_ALLOWED_URI:P0,IS_SCRIPT_OR_DATA:NT,ATTR_WHITESPACE:AT,DOCTYPE_NAME:x0});const kT=function(){return typeof window>"u"?null:window},OT=function(t,e){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";e&&e.hasAttribute(i)&&(r=e.getAttribute(i));const s="dompurify"+(r?"#"+r:"");try{return t.createPolicy(s,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}};function F0(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:kT();const t=Ee=>F0(Ee);if(t.version="3.0.8",t.removed=[],!n||!n.document||n.document.nodeType!==9)return t.isSupported=!1,t;let{document:e}=n;const r=e,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:a,Node:o,Element:u,NodeFilter:c,NamedNodeMap:l=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:d,DOMParser:h,trustedTypes:f}=n,p=u.prototype,_=Tl(p,"cloneNode"),m=Tl(p,"nextSibling"),b=Tl(p,"childNodes"),y=Tl(p,"parentNode");if(typeof a=="function"){const Ee=e.createElement("template");Ee.content&&Ee.content.ownerDocument&&(e=Ee.content.ownerDocument)}let E,T="";const{implementation:N,createNodeIterator:C,createDocumentFragment:L,getElementsByTagName:k}=e,{importNode:O}=r;let x={};t.isSupported=typeof U0=="function"&&typeof y=="function"&&N&&N.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Q,ERB_EXPR:we,TMPLIT_EXPR:Ie,DATA_ATTR:ze,ARIA_ATTR:$t,IS_SCRIPT_OR_DATA:Gt,ATTR_WHITESPACE:cr}=Sm;let{IS_ALLOWED_URI:qs}=Sm,Ze=null;const $s=Ke({},[...bm,...Kh,...Qh,...Wh,...Tm]);let ot=null;const Yi=Ke({},[...wm,...Yh,...Im,...wl]);let ht=Object.seal(L0(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Xn=null,er=null,Or=!0,Zi=!0,Ji=!1,Hs=!0,zn=!1,bn=!1,Zr=!1,Jr=!1,lr=!1,Xr=!1,Et=!1,Mr=!0,Tu=!1;const Be="user-content-";let Dn=!0,Ei=!1,Xi={},es=null;const ko=Ke({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ia=null;const Rt=Ke({},["audio","video","img","source","image","track"]);let Sa=null;const Ca=Ke({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ts="http://www.w3.org/1998/Math/MathML",zs="http://www.w3.org/2000/svg",dr="http://www.w3.org/1999/xhtml";let bi=dr,ns=!1,Na=null;const wu=Ke({},[ts,zs,dr],jh);let ei=null;const Gs=["application/xhtml+xml","text/html"],tr="text/html";let Ut=null,rs=null;const Iu=e.createElement("form"),Vs=function(q){return q instanceof RegExp||q instanceof Function},Ti=function(){let q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(rs&&rs===q)){if((!q||typeof q!="object")&&(q={}),q=Pa(q),ei=Gs.indexOf(q.PARSER_MEDIA_TYPE)===-1?tr:q.PARSER_MEDIA_TYPE,Ut=ei==="application/xhtml+xml"?jh:ud,Ze="ALLOWED_TAGS"in q?Ke({},q.ALLOWED_TAGS,Ut):$s,ot="ALLOWED_ATTR"in q?Ke({},q.ALLOWED_ATTR,Ut):Yi,Na="ALLOWED_NAMESPACES"in q?Ke({},q.ALLOWED_NAMESPACES,jh):wu,Sa="ADD_URI_SAFE_ATTR"in q?Ke(Pa(Ca),q.ADD_URI_SAFE_ATTR,Ut):Ca,Ia="ADD_DATA_URI_TAGS"in q?Ke(Pa(Rt),q.ADD_DATA_URI_TAGS,Ut):Rt,es="FORBID_CONTENTS"in q?Ke({},q.FORBID_CONTENTS,Ut):ko,Xn="FORBID_TAGS"in q?Ke({},q.FORBID_TAGS,Ut):{},er="FORBID_ATTR"in q?Ke({},q.FORBID_ATTR,Ut):{},Xi="USE_PROFILES"in q?q.USE_PROFILES:!1,Or=q.ALLOW_ARIA_ATTR!==!1,Zi=q.ALLOW_DATA_ATTR!==!1,Ji=q.ALLOW_UNKNOWN_PROTOCOLS||!1,Hs=q.ALLOW_SELF_CLOSE_IN_ATTR!==!1,zn=q.SAFE_FOR_TEMPLATES||!1,bn=q.WHOLE_DOCUMENT||!1,lr=q.RETURN_DOM||!1,Xr=q.RETURN_DOM_FRAGMENT||!1,Et=q.RETURN_TRUSTED_TYPE||!1,Jr=q.FORCE_BODY||!1,Mr=q.SANITIZE_DOM!==!1,Tu=q.SANITIZE_NAMED_PROPS||!1,Dn=q.KEEP_CONTENT!==!1,Ei=q.IN_PLACE||!1,qs=q.ALLOWED_URI_REGEXP||P0,bi=q.NAMESPACE||dr,ht=q.CUSTOM_ELEMENT_HANDLING||{},q.CUSTOM_ELEMENT_HANDLING&&Vs(q.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ht.tagNameCheck=q.CUSTOM_ELEMENT_HANDLING.tagNameCheck),q.CUSTOM_ELEMENT_HANDLING&&Vs(q.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ht.attributeNameCheck=q.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),q.CUSTOM_ELEMENT_HANDLING&&typeof q.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ht.allowCustomizedBuiltInElements=q.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),zn&&(Zi=!1),Xr&&(lr=!0),Xi&&(Ze=Ke({},Tm),ot=[],Xi.html===!0&&(Ke(Ze,bm),Ke(ot,wm)),Xi.svg===!0&&(Ke(Ze,Kh),Ke(ot,Yh),Ke(ot,wl)),Xi.svgFilters===!0&&(Ke(Ze,Qh),Ke(ot,Yh),Ke(ot,wl)),Xi.mathMl===!0&&(Ke(Ze,Wh),Ke(ot,Im),Ke(ot,wl))),q.ADD_TAGS&&(Ze===$s&&(Ze=Pa(Ze)),Ke(Ze,q.ADD_TAGS,Ut)),q.ADD_ATTR&&(ot===Yi&&(ot=Pa(ot)),Ke(ot,q.ADD_ATTR,Ut)),q.ADD_URI_SAFE_ATTR&&Ke(Sa,q.ADD_URI_SAFE_ATTR,Ut),q.FORBID_CONTENTS&&(es===ko&&(es=Pa(es)),Ke(es,q.FORBID_CONTENTS,Ut)),Dn&&(Ze["#text"]=!0),bn&&Ke(Ze,["html","head","body"]),Ze.table&&(Ke(Ze,["tbody"]),delete Xn.tbody),q.TRUSTED_TYPES_POLICY){if(typeof q.TRUSTED_TYPES_POLICY.createHTML!="function")throw Mu('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof q.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Mu('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');E=q.TRUSTED_TYPES_POLICY,T=E.createHTML("")}else E===void 0&&(E=OT(f,i)),E!==null&&typeof T=="string"&&(T=E.createHTML(""));Jn&&Jn(q),rs=q}},Oo=Ke({},["mi","mo","mn","ms","mtext"]),Rn=Ke({},["foreignobject","desc","title","annotation-xml"]),Aa=Ke({},["title","style","font","a","script"]),Dr=Ke({},[...Kh,...Qh,...ET]),ti=Ke({},[...Wh,...bT]),hl=function(q){let te=y(q);(!te||!te.tagName)&&(te={namespaceURI:bi,tagName:"template"});const pe=ud(q.tagName),et=ud(te.tagName);return Na[q.namespaceURI]?q.namespaceURI===zs?te.namespaceURI===dr?pe==="svg":te.namespaceURI===ts?pe==="svg"&&(et==="annotation-xml"||Oo[et]):!!Dr[pe]:q.namespaceURI===ts?te.namespaceURI===dr?pe==="math":te.namespaceURI===zs?pe==="math"&&Rn[et]:!!ti[pe]:q.namespaceURI===dr?te.namespaceURI===zs&&!Rn[et]||te.namespaceURI===ts&&!Oo[et]?!1:!ti[pe]&&(Aa[pe]||!Dr[pe]):!!(ei==="application/xhtml+xml"&&Na[q.namespaceURI]):!1},Rr=function(q){ku(t.removed,{element:q});try{q.parentNode.removeChild(q)}catch{q.remove()}},Bs=function(q,te){try{ku(t.removed,{attribute:te.getAttributeNode(q),from:te})}catch{ku(t.removed,{attribute:null,from:te})}if(te.removeAttribute(q),q==="is"&&!ot[q])if(lr||Xr)try{Rr(te)}catch{}else try{te.setAttribute(q,"")}catch{}},Mo=function(q){let te=null,pe=null;if(Jr)q="<remove></remove>"+q;else{const Ht=_T(q,/^[\r\n\t ]+/);pe=Ht&&Ht[0]}ei==="application/xhtml+xml"&&bi===dr&&(q='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+q+"</body></html>");const et=E?E.createHTML(q):q;if(bi===dr)try{te=new h().parseFromString(et,ei)}catch{}if(!te||!te.documentElement){te=N.createDocument(bi,"template",null);try{te.documentElement.innerHTML=ns?T:et}catch{}}const Vt=te.body||te.documentElement;return q&&pe&&Vt.insertBefore(e.createTextNode(pe),Vt.childNodes[0]||null),bi===dr?k.call(te,bn?"html":"body")[0]:bn?te.documentElement:Vt},Su=function(q){return C.call(q.ownerDocument||q,q,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT,null)},is=function(q){return q instanceof d&&(typeof q.nodeName!="string"||typeof q.textContent!="string"||typeof q.removeChild!="function"||!(q.attributes instanceof l)||typeof q.removeAttribute!="function"||typeof q.setAttribute!="function"||typeof q.namespaceURI!="string"||typeof q.insertBefore!="function"||typeof q.hasChildNodes!="function")},ss=function(q){return typeof o=="function"&&q instanceof o},Un=function(q,te,pe){x[q]&&bl(x[q],et=>{et.call(t,te,pe,rs)})},js=function(q){let te=null;if(Un("beforeSanitizeElements",q,null),is(q))return Rr(q),!0;const pe=Ut(q.nodeName);if(Un("uponSanitizeElement",q,{tagName:pe,allowedTags:Ze}),q.hasChildNodes()&&!ss(q.firstElementChild)&&hr(/<[/\w]/g,q.innerHTML)&&hr(/<[/\w]/g,q.textContent))return Rr(q),!0;if(!Ze[pe]||Xn[pe]){if(!Xn[pe]&&Ur(pe)&&(ht.tagNameCheck instanceof RegExp&&hr(ht.tagNameCheck,pe)||ht.tagNameCheck instanceof Function&&ht.tagNameCheck(pe)))return!1;if(Dn&&!es[pe]){const et=y(q)||q.parentNode,Vt=b(q)||q.childNodes;if(Vt&&et){const Ht=Vt.length;for(let rn=Ht-1;rn>=0;--rn)et.insertBefore(_(Vt[rn],!0),m(q))}}return Rr(q),!0}return q instanceof u&&!hl(q)||(pe==="noscript"||pe==="noembed"||pe==="noframes")&&hr(/<\/no(script|embed|frames)/i,q.innerHTML)?(Rr(q),!0):(zn&&q.nodeType===3&&(te=q.textContent,bl([Q,we,Ie],et=>{te=Ou(te,et," ")}),q.textContent!==te&&(ku(t.removed,{element:q.cloneNode()}),q.textContent=te)),Un("afterSanitizeElements",q,null),!1)},as=function(q,te,pe){if(Mr&&(te==="id"||te==="name")&&(pe in e||pe in Iu))return!1;if(!(Zi&&!er[te]&&hr(ze,te))){if(!(Or&&hr($t,te))){if(!ot[te]||er[te]){if(!(Ur(q)&&(ht.tagNameCheck instanceof RegExp&&hr(ht.tagNameCheck,q)||ht.tagNameCheck instanceof Function&&ht.tagNameCheck(q))&&(ht.attributeNameCheck instanceof RegExp&&hr(ht.attributeNameCheck,te)||ht.attributeNameCheck instanceof Function&&ht.attributeNameCheck(te))||te==="is"&&ht.allowCustomizedBuiltInElements&&(ht.tagNameCheck instanceof RegExp&&hr(ht.tagNameCheck,pe)||ht.tagNameCheck instanceof Function&&ht.tagNameCheck(pe))))return!1}else if(!Sa[te]){if(!hr(qs,Ou(pe,cr,""))){if(!((te==="src"||te==="xlink:href"||te==="href")&&q!=="script"&&mT(pe,"data:")===0&&Ia[q])){if(!(Ji&&!hr(Gt,Ou(pe,cr,"")))){if(pe)return!1}}}}}}return!0},Ur=function(q){return q.indexOf("-")>0},ka=function(q){Un("beforeSanitizeAttributes",q,null);const{attributes:te}=q;if(!te)return;const pe={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ot};let et=te.length;for(;et--;){const Vt=te[et],{name:Ht,namespaceURI:rn,value:ni}=Vt,os=Ut(Ht);let cn=Ht==="value"?ni:vT(ni);if(pe.attrName=os,pe.attrValue=cn,pe.keepAttr=!0,pe.forceKeepAttr=void 0,Un("uponSanitizeAttribute",q,pe),cn=pe.attrValue,pe.forceKeepAttr||(Bs(Ht,q),!pe.keepAttr))continue;if(!Hs&&hr(/\/>/i,cn)){Bs(Ht,q);continue}zn&&bl([Q,we,Ie],Uo=>{cn=Ou(cn,Uo," ")});const Ro=Ut(q.nodeName);if(as(Ro,os,cn)){if(Tu&&(os==="id"||os==="name")&&(Bs(Ht,q),cn=Be+cn),E&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!rn)switch(f.getAttributeType(Ro,os)){case"TrustedHTML":{cn=E.createHTML(cn);break}case"TrustedScriptURL":{cn=E.createScriptURL(cn);break}}try{rn?q.setAttributeNS(rn,Ht,cn):q.setAttribute(Ht,cn),Em(t.removed)}catch{}}}Un("afterSanitizeAttributes",q,null)},Do=function Ee(q){let te=null;const pe=Su(q);for(Un("beforeSanitizeShadowDOM",q,null);te=pe.nextNode();)Un("uponSanitizeShadowNode",te,null),!js(te)&&(te.content instanceof s&&Ee(te.content),ka(te));Un("afterSanitizeShadowDOM",q,null)};return t.sanitize=function(Ee){let q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},te=null,pe=null,et=null,Vt=null;if(ns=!Ee,ns&&(Ee="<!-->"),typeof Ee!="string"&&!ss(Ee))if(typeof Ee.toString=="function"){if(Ee=Ee.toString(),typeof Ee!="string")throw Mu("dirty is not a string, aborting")}else throw Mu("toString is not a function");if(!t.isSupported)return Ee;if(Zr||Ti(q),t.removed=[],typeof Ee=="string"&&(Ei=!1),Ei){if(Ee.nodeName){const ni=Ut(Ee.nodeName);if(!Ze[ni]||Xn[ni])throw Mu("root node is forbidden and cannot be sanitized in-place")}}else if(Ee instanceof o)te=Mo("<!---->"),pe=te.ownerDocument.importNode(Ee,!0),pe.nodeType===1&&pe.nodeName==="BODY"||pe.nodeName==="HTML"?te=pe:te.appendChild(pe);else{if(!lr&&!zn&&!bn&&Ee.indexOf("<")===-1)return E&&Et?E.createHTML(Ee):Ee;if(te=Mo(Ee),!te)return lr?null:Et?T:""}te&&Jr&&Rr(te.firstChild);const Ht=Su(Ei?Ee:te);for(;et=Ht.nextNode();)js(et)||(et.content instanceof s&&Do(et.content),ka(et));if(Ei)return Ee;if(lr){if(Xr)for(Vt=L.call(te.ownerDocument);te.firstChild;)Vt.appendChild(te.firstChild);else Vt=te;return(ot.shadowroot||ot.shadowrootmode)&&(Vt=O.call(r,Vt,!0)),Vt}let rn=bn?te.outerHTML:te.innerHTML;return bn&&Ze["!doctype"]&&te.ownerDocument&&te.ownerDocument.doctype&&te.ownerDocument.doctype.name&&hr(x0,te.ownerDocument.doctype.name)&&(rn="<!DOCTYPE "+te.ownerDocument.doctype.name+`>
`+rn),zn&&bl([Q,we,Ie],ni=>{rn=Ou(rn,ni," ")}),E&&Et?E.createHTML(rn):rn},t.setConfig=function(){let Ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ti(Ee),Zr=!0},t.clearConfig=function(){rs=null,Zr=!1},t.isValidAttribute=function(Ee,q,te){rs||Ti({});const pe=Ut(Ee),et=Ut(q);return as(pe,et,te)},t.addHook=function(Ee,q){typeof q=="function"&&(x[Ee]=x[Ee]||[],ku(x[Ee],q))},t.removeHook=function(Ee){if(x[Ee])return Em(x[Ee])},t.removeHooks=function(Ee){x[Ee]&&(x[Ee]=[])},t.removeAllHooks=function(){x={}},t}var q0=F0();const he=n=>{let t=e=>{e.html=r=>{if(r!==void 0){const i=q0.sanitize(r);e.innerHTML=i}return e.innerHTML},e.attr=(r,i)=>(i!==void 0&&(i?e.setAttribute(r,i):e.removeAttribute(r)),e.getAttribute(r)),e.val=r=>(r!==void 0&&(e.value=r),e.value),e.simplifiedChildren=()=>{let r=[];for(let i=0;i<e.children.length;i++)r.push(he(e.children[i]));return r},e.removeAll=r=>{if(r){let i=[],s=e.simplifiedChildren();for(let a in s)s[a].hasClass(r)&&i.push(s[a]);for(let a in i)e.removeChild(i[a])}else e.innerHTML=""},e.show=r=>(r?e.style.display=r:e.style.display="",e),e.hide=()=>(e.style.display="none",e),e.fadeIn=(r=300,i)=>{e.style.opacity=0,e.style.display="inline-block";let s=0;const a=10,o=setInterval(()=>{e.style.opacity=Math.min(s/r,1),s+=a,s>r&&(clearInterval(o),i&&i())},a)},e.fadeOut=(r=300,i)=>{e.style.opacity=1;let s=0;const a=10,o=setInterval(()=>{e.style.opacity=1-Math.min(s/r,1),s+=a,s>r&&(clearInterval(o),i&&i())},a)},e.hasClass=r=>e.classList?e.classList.contains(r):new RegExp("(^| )"+r+"( |$)","gi").test(e.className),e.addClass=r=>(Array.isArray(r)||(r=r?[r]:[]),r.forEach(i=>{e.classList?i in e.classList||e.classList.add(i):e.className.indexOf(i)<0&&(e.className+=" "+i)}),e),e.removeClass=r=>(e.classList?e.classList.remove(r):e.className=e.className.replace(new RegExp("(^|\\b)"+r.split(" ").join("|")+"(\\b|$)","gi"),""),e),e.toggleClass=r=>{e.hasClass(r)?e.removeClass(r):e.addClass(r)},e.on=(r,i)=>{e.addEventListener(r,i)},e.off=(r,i)=>{e.removeEventListener(r,i)}};if(n instanceof NodeList&&(n=Array.from(n)),Array.isArray(n))for(let e in n)t(n[e]);else n instanceof HTMLElement&&t(n);return n},ya=n=>{var t=document.createElement("div");let e=q0.sanitize(n);return t.innerHTML=e.trim(),t=he(t.firstChild),t.parentNode&&t.parentNode.removeChild(t),t},Ii={};let MT=0;const DT=()=>MT++;class Rc{constructor(t,e){this._sid=DT(),this.event=t,this.callback=e}static send(t,e){if(t instanceof Array)for(let r in t)Rc.send(t[r],e);else if(Ii[t])for(let r in Ii[t])Ii[t][r].callback(e)}static subscribe(t,e){const r=new Rc(t,e);return Ii[t]||(Ii[t]=[]),Ii[t].push(r),r}static unsubscribe(t){const e=t.event;if(Ii[e]){for(let r in Ii[e])if(Ii[e][r]._sid===t._sid){Ii[e].splice(r,1);break}}}}const RT="modulepreload",UT=function(n){return"/"+n},Cm={},Yu=function(t,e,r){if(!e||e.length===0)return t();const i=document.getElementsByTagName("link");return Promise.all(e.map(s=>{if(s=UT(s),s in Cm)return;Cm[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!r)for(let l=i.length-1;l>=0;l--){const d=i[l];if(d.href===s&&(!a||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":RT,a||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),a)return new Promise((l,d)=>{c.addEventListener("load",l),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})};var lp=function(n,t){return lp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},lp(n,t)};function w(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=n}lp(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var A=function(){return A=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},A.apply(this,arguments)};function LT(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]])}return e}function g(n,t,e,r){return new(e||(e=Promise))(function(i,s){function a(c){try{u(r.next(c))}catch(l){s(l)}}function o(c){try{u(r.throw(c))}catch(l){s(l)}}function u(c){var l;c.done?i(c.value):(l=c.value,l instanceof e?l:new e(function(d){d(l)})).then(a,o)}u((r=r.apply(n,t||[])).next())})}function v(n,t){var e,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(e=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!((i=i.length>0&&i[i.length-1])||l[0]!==6&&l[0]!==2)){a=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(l[0]===6&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(n,a)}catch(d){l=[6,d],r=0}finally{e=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}function Z(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ie(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r,i,s=e.call(n),a=[];try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(o){i={error:o}}finally{try{r&&!r.done&&(e=s.return)&&e.call(s)}finally{if(i)throw i.error}}return a}function ce(n,t,e){if(e||arguments.length===2)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))}var ae,$0="4.10.8",oa=function(){function n(){}return Object.defineProperty(n,"OS_VERSION",{get:function(){return typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(n,"SDK_VERSION",{get:function(){return $0},enumerable:!1,configurable:!0}),Object.defineProperty(n,"SDK_MAJOR_VERSION",{get:function(){return n.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(n,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),n}();(function(n){n[n.NON_AUTHORIZED=400108]="NON_AUTHORIZED",n[n.INVALID_TOKEN=400111]="INVALID_TOKEN",n[n.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",n[n.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",n[n.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",n[n.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",n[n.APPLICATION_NOT_FOUND=400304]="APPLICATION_NOT_FOUND",n[n.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",n[n.SESSION_REVOKED=400310]="SESSION_REVOKED",n[n.INVALID_SESSION_TYPE=400312]="INVALID_SESSION_TYPE",n[n.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",n[n.NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE=400940]="NOT_SUPPORTED_PINNED_MESSAGE_IN_REVIEW_MESSAGE",n[n.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",n[n.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",n[n.INVALID_FORM_KEY=400111]="INVALID_FORM_KEY",n[n.INVALID_REQUIRED_FORM_VALUE=400105]="INVALID_REQUIRED_FORM_VALUE",n[n.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",n[n.NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE=901500]="NOT_SUPPORTED_FEATURE_IN_IN_REVIEW_MESSAGE",n[n.ERR_DUPLICATED_DATA=400202]="ERR_DUPLICATED_DATA",n[n.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",n[n.LOST_INSTANCE=700100]="LOST_INSTANCE",n[n.CONNECTION_RENEW=700102]="CONNECTION_RENEW",n[n.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",n[n.INVALID_COMMAND=700700]="INVALID_COMMAND",n[n.XMLHTTPREQUEST_NOT_SUPPORTED=700800]="XMLHTTPREQUEST_NOT_SUPPORTED",n[n.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",n[n.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",n[n.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",n[n.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",n[n.INVALID_PARAMETER=800110]="INVALID_PARAMETER",n[n.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",n[n.NETWORK_ERROR=800120]="NETWORK_ERROR",n[n.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",n[n.MALFORMED_DATA=800130]="MALFORMED_DATA",n[n.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",n[n.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",n[n.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",n[n.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",n[n.ACK_TIMEOUT=800180]="ACK_TIMEOUT",n[n.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",n[n.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",n[n.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",n[n.REQUEST_FAILED=800220]="REQUEST_FAILED",n[n.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",n[n.REQUEST_CANCELED=800240]="REQUEST_CANCELED",n[n.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",n[n.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",n[n.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",n[n.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",n[n.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",n[n.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",n[n.DATABASE_ERROR=800700]="DATABASE_ERROR"})(ae||(ae={}));var Ln,Ka,Yt,dp,Zu,ar=function(n){return!(n instanceof U&&!n.shouldThrowOutside)},U=function(n){function t(e){var r=e.code,i=r===void 0?0:r,s=e.message,a=s===void 0?"":s,o=n.call(this,a)||this;return o.shouldThrowOutside=!1,o._detail="",o.name="SendbirdError",o.code=i,Object.setPrototypeOf(o,t.prototype),o}return w(t,n),Object.defineProperty(t.prototype,"detail",{get:function(){return this._detail},enumerable:!1,configurable:!0}),t.prototype.setDetail=function(e){this._detail=e},Object.defineProperty(t.prototype,"isInvalidTokenError",{get:function(){return this.code===ae.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionExpiredError",{get:function(){return this.isSessionTokenExpiredError||this.isSessionKeyExpiredError},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===ae.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===ae.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionInvalidatedError",{get:function(){return this.isSessionRevokedError||this.isUserAuthDeactivedError||this.isUserAuthDeletedOrNotFoundError},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionRevokedError",{get:function(){return this.code===ae.SESSION_REVOKED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUserAuthDeactivedError",{get:function(){return this.code===ae.USER_AUTH_DEACTIVATED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUserAuthDeletedOrNotFoundError",{get:function(){return this.code===ae.USER_AUTH_DELETED_OR_NOT_FOUND},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isNetworkError",{get:function(){return this.code===ae.NETWORK_ERROR||this.code===ae.NETWORK_ROUTING_ERROR},enumerable:!1,configurable:!0}),Object.defineProperty(t,"debugModeRequired",{get:function(){return new t({code:ae.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"lostInstance",{get:function(){return new t({code:ae.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidCommand",{get:function(){return new t({code:ae.INVALID_COMMAND,message:"Cannot send invalid command."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"unknown",{get:function(){return new t({code:ae.UNKNOWN_ERROR,message:"Unknown error occurred."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRenew",{get:function(){return new t({code:ae.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidConnectionStateTransition",{get:function(){return new t({code:ae.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"xmlHttpRequestNotSupported",{get:function(){return new t({code:ae.XMLHTTPREQUEST_NOT_SUPPORTED,message:"Cannot upload file. XMLHttpRequest is not defined in this environment."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRequired",{get:function(){return new t({code:ae.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionCanceled",{get:function(){return new t({code:ae.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidParameters",{get:function(){return new t({code:ae.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"notSupportedError",{get:function(){return new t({code:ae.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"channelTypeNotSupportedError",{get:function(){return new t({code:ae.NOT_SUPPORTED_ERROR,message:"Called method is not supported in the current channel's channel type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"networkError",{get:function(){return new t({code:ae.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"markAsReadAllRateLimitExceeded",{get:function(){return new t({code:ae.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"queryInProgress",{get:function(){return new t({code:ae.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"noAckTimeout",{get:function(){return new t({code:ae.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"loginTimeout",{get:function(){return new t({code:ae.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionClosed",{get:function(){return new t({code:ae.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestFailed",{get:function(){return new t({code:ae.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"alreadyConnectedAsAnotherUser",{get:function(){return new t({code:ae.REQUEST_FAILED,message:"Already logged in as a different user. Call disconnect() first."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileUploadCanceled",{get:function(){return new t({code:ae.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestCanceled",{get:function(){return new t({code:ae.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRefreshFailed",{get:function(){return new t({code:ae.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRequestFailed",{get:function(){return new t({code:ae.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseError",{get:function(){return new t({code:ae.DATABASE_ERROR,message:"Database error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileSizeLimitExceededError",{get:function(){return new t({code:ae.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})},enumerable:!1,configurable:!0}),t.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},t}(Error),PT=[ae.CONNECTION_REQUIRED,ae.NETWORK_ERROR,ae.ACK_TIMEOUT,ae.WEBSOCKET_CONNECTION_CLOSED,ae.WEBSOCKET_CONNECTION_FAILED,ae.FILE_UPLOAD_CANCEL_FAILED,ae.REQUEST_CANCELED,ae.INTERNAL_SERVER_ERROR,ae.RATE_LIMIT_EXCEEDED,ae.UNKNOWN_SERVER_ERROR],xT=[ae.WEBSOCKET_CONNECTION_CLOSED,ae.WEBSOCKET_CONNECTION_FAILED,ae.CONNECTION_REQUIRED],H0=function(n,t){if(n!==t){var e=A({},n),r=A({},t);return(!e.hasOwnProperty("messageId")||!r.hasOwnProperty("messageId")||e.messageId===r.messageId)&&(!e.hasOwnProperty("reqId")||!r.hasOwnProperty("reqId")||e.reqId===r.reqId)&&(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(e)===JSON.stringify(r))}return!0},R=function(n,t,e){return e===void 0&&(e=!1),!(!e||!Jc(t))||(typeof n!="string"?typeof n=="object"?be(n,t):FT(n,t):typeof t===n)},be=function(n,t,e){return e===void 0&&(e=!1),!(!e||!Jc(t))||Object.values(n).includes(t)},FT=function(n,t){return t instanceof n},Ae=function(n,t,e){return e===void 0&&(e=!1),!(!e||!Jc(t))||Array.isArray(t)&&t.every(function(r){return R(n,r)})},Nm=function(n,t){return t===void 0&&(t=!1),!(!t||!Jc(n))||typeof n=="number"&&n.toString().length===13},qT=function(n){return n>0&&PT.indexOf(n)>=0},Nd=function(n){return n>0&&xT.indexOf(n)>=0},On=function(n,t){if(t===void 0&&(t=!1),t&&Jc(n))return!0;var e=typeof n=="object"&&n!==null&&n.hasOwnProperty("name")&&typeof n.name=="string"&&n.hasOwnProperty("uri")&&typeof n.uri=="string"&&n.hasOwnProperty("type")&&typeof n.type=="string";if(!e){if(typeof Blob<"u")return n instanceof Blob;if(typeof File<"u")return n instanceof File}return e},$T=function(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(var e=ce([],ie(n),!1).sort(),r=ce([],ie(t),!1).sort(),i=0;i<e.length;++i)if(e[i]!==r[i])return!1;return!0},Jc=function(n){return n==null},z0=function(){function n(t){var e=t===void 0?{}:t,r=e.useMemberInfoInMessage,i=r===void 0||r,s=e.typingIndicatorInvalidateTime,a=s===void 0?1e4:s,o=e.typingIndicatorThrottle,u=o===void 0?1e3:o,c=e.websocketResponseTimeout,l=c===void 0?1e4:c,d=e.websocketPayloadDecompression,h=d===void 0||d,f=e.sessionTokenRefreshTimeout,p=f===void 0?60:f;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=i,this._typingIndicatorInvalidateTime=a,this._typingIndicatorThrottle=u,this._websocketResponseTimeout=l,this._sessionTokenRefreshTimeout=p,this.websocketPayloadDecompression=h}return Object.defineProperty(n.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(t){R("boolean",t)&&(this._useMemberInfoInMessage=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(t){R("number",t)&&(this._typingIndicatorInvalidateTime=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(t){R("number",t)&&t>=1e3&&t<=9e3&&(this._typingIndicatorThrottle=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(t){R("number",t)&&t>=5e3&&t<=3e4&&(this._websocketResponseTimeout=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sessionTokenRefreshTimeout",{get:function(){return this._sessionTokenRefreshTimeout},set:function(t){R("number",t)&&(t<60?t=60:t>1800&&(t=1800),this._sessionTokenRefreshTimeout=t)},enumerable:!1,configurable:!0}),n}(),G0={encrypt:function(n){return n},decrypt:function(n){return n}},Am=function(){function n(t){var e=t.store;this._preference=new Map,this._store=e}return n.prototype._savePreferenceKeys=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this._store.set({key:this._keysAddress,value:ce([],ie(this._preference.keys()),!1)})];case 1:return t.sent(),[2]}})})},n.prototype.init=function(t,e){var r;return e===void 0&&(e=1),g(this,void 0,void 0,function(){var i,s,a,o,u,c,l,d,h,f;return v(this,function(p){switch(p.label){case 0:return this._version=e,this._keysAddress=t,i="".concat(t,".metadata.version"),[4,this._store.get(i)];case 1:return s=p.sent(),[4,this._store.get(t)];case 2:return a=(r=p.sent())!==null&&r!==void 0?r:[],!s||s.version<this._version?[4,this._resetPreferenceData(a,i)]:[3,4];case 3:return p.sent(),[3,11];case 4:p.trys.push([4,9,10,11]),o=Z(a),u=o.next(),p.label=5;case 5:return u.done?[3,8]:(c=u.value,[4,this._store.get(c)]);case 6:(l=p.sent())&&this._preference.set(c,l),p.label=7;case 7:return u=o.next(),[3,5];case 8:return[3,11];case 9:return d=p.sent(),h={error:d},[3,11];case 10:try{u&&!u.done&&(f=o.return)&&f.call(o)}finally{if(h)throw h.error}return[7];case 11:return[2]}})})},n.prototype._resetPreferenceData=function(t,e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this._preference=new Map,[4,this._store.removeMany(t)];case 1:return r.sent(),[4,this._store.set({key:e,value:{version:this._version}})];case 2:return r.sent(),[2]}})})},n.prototype.get=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return[2,this._preference.get(t)]})})},n.prototype.set=function(t,e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=!this._preference.has(t),[4,this._store.set({key:t,value:e})];case 1:return i.sent(),this._preference.set(t,e),r?[4,this._savePreferenceKeys()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},n.prototype.remove=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this._store.remove(t)];case 1:return e.sent(),this._preference.delete(t),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},n.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this._store.removeMany(ce([],ie(this._preference.keys()),!1))];case 1:return t.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}})})},n}(),HT=function(){function n(t){var e=t.encryption,r=t.store,i=t.localCacheEnabled,s=t.localCacheConfig;this.store=r,this.preference=new Am({store:r}),this.encryption=e??G0,this.localCacheEnabled=i,this.localCacheConfig=s}return n.prototype.replaceStore=function(t){this.store=t,this.preference=new Am({store:t})},n}();(function(n){n.SUCCESS="success",n.PENDING="pending",n.ERROR="error"})(Ln||(Ln={})),function(n){n.DEFAULT="default",n.ALL="all",n.MENTION_ONLY="mention_only",n.OFF="off"}(Ka||(Ka={})),function(n){n.FCM="gcm",n.APNS="apns",n.UNKNOWN="unknown"}(Yt||(Yt={})),function(n){n.ALTERNATIVE="alternative",n.DEFAULT="default"}(dp||(dp={})),function(n){n.CUSTOM="custom",n.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at"}(Zu||(Zu={}));var Ds,zT=function(){function n(t){var e=t.channel,r=t.cachedMessageCount;this._cachedMessageCount=0,this._channel=e,this._cachedMessageCount=r}return Object.defineProperty(n.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cachedMessageCount",{get:function(){return this._cachedMessageCount},enumerable:!1,configurable:!0}),n}(),V0=function(){function n(t){var e=t===void 0?{}:t,r=e.maxSize,i=r===void 0?256:r,s=e.clearOrder,a=s===void 0?Zu.MESSAGE_COLLECTION_ACCESSED_AT:s,o=e.customClearOrderComparator,u=e.enableAutoResend,c=u===void 0||u;this._clearOrderComparatorUseMessageCollectionAccessedAt=function(l,d){return l.channel.messageCollectionLastAccessedAt===d.channel.messageCollectionLastAccessedAt?l.channel.lastMessage&&!d.channel.lastMessage?1:!l.channel.lastMessage&&d.channel.lastMessage?-1:l.channel.lastMessage||d.channel.lastMessage?l.channel.lastMessage.createdAt-d.channel.lastMessage.createdAt:0:l.channel.messageCollectionLastAccessedAt>d.channel.messageCollectionLastAccessedAt?1:-1},this._maxSize=Math.max(i,64),o?(this._clearOrder=a,this._customClearOrderComparator=o):this._clearOrder=Zu.MESSAGE_COLLECTION_ACCESSED_AT,this._enableAutoResend=c}return Object.defineProperty(n.prototype,"maxSize",{get:function(){return this._maxSize},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"clearOrder",{get:function(){return this._clearOrder},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"clearOrderComparator",{get:function(){var t;return this._clearOrder===Zu.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:(t=this._customClearOrderComparator)!==null&&t!==void 0?t:this._clearOrderComparatorUseMessageCollectionAccessedAt},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"enableAutoResend",{get:function(){return this._enableAutoResend},enumerable:!1,configurable:!0}),n}();(function(n){n.FEED="feed",n.CHAT="chat"})(Ds||(Ds={}));var xe,Gr,Ri,gt,mn,tu,gn,vn,hi,tt,km,GT=function(){function n(){this.isRefreshing=!1}return Object.defineProperty(n.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),n.prototype.clear=function(){this.authToken=void 0,this.sessionKey=void 0,this.services=[]},n.prototype.hasLessServiceScopeThan=function(t){var e;return!this.sessionKey||!(!((e=this.services)===null||e===void 0)&&e.includes(Ds.CHAT))||t.includes(Ds.CHAT)},n}(),Rs=function(){var n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(t==="x"?e:3&e|8).toString(16)})},Om=function(){function n(t){var e=t.container;this._container={},this._container=e,this.key=Rs()}return n.prototype._register=function(t,e,r){var i;return t in this._container||(this._container[t]=new Map),(i=this._container[t])===null||i===void 0||i.set(this.key,{occurence:e,handler:r}),this},n.prototype.on=function(t,e){return this._register(t,-1,e)},n.prototype.once=function(t,e){return this._register(t,1,e)},n.prototype.close=function(){var t;for(var e in this._container)(t=this._container[e])===null||t===void 0||t.delete(this.key)},n}(),bo=function(){function n(){this._container={}}return n.prototype.on=function(t,e){return new Om({container:this._container}).on(t,e)},n.prototype.once=function(t,e){return new Om({container:this._container}).once(t,e)},n.prototype.dispatch=function(t,e){var r,i,s=this._container[t];if(s){var a=[];try{for(var o=Z(s.keys()),u=o.next();!u.done;u=o.next()){var c=u.value,l=s.get(c);l.handler(e),l.occurence>0&&(l.occurence--,l.occurence===0&&a.push(c))}}catch(d){r={error:d}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}a.forEach(function(d){return s.delete(d)})}},n}(),VT=function(){function n(){this._dispatcher=new bo}return n.prototype.on=function(t){return this._dispatcher.on("event",t)},n.prototype.once=function(t){return this._dispatcher.once("event",t)},n.prototype.dispatch=function(t){this._dispatcher.dispatch("event",t)},n}(),rt=function(){},re=function(n){var t={};return n&&Object.keys(n).forEach(function(e){n[e]===void 0||Number.isNaN(n[e])||n[e]===null||(t[e]=n[e])}),t},oe=function(n){if(n!=null){if(typeof n=="object"){if(Array.isArray(n)){var t=ce([],ie(n),!1);for(var e in t)t[e]=oe(t[e]);return t}for(var r in n)n[r]===null&&delete n[r];return n}return n}};(function(n){n.BASE="base",n.GROUP="group",n.OPEN="open",n.FEED="feed"})(xe||(xe={})),function(n){n.OPERATOR="operator",n.NONE="none"}(Gr||(Gr={})),function(n){n.MUTED="muted",n.UNMUTED="unmuted"}(Ri||(Ri={})),function(n){n.BASE="base",n.USER="user",n.FILE="file",n.ADMIN="admin"}(gt||(gt={})),function(n){n.ALL="",n.USER="MESG",n.FILE="FILE",n.ADMIN="ADMM"}(mn||(mn={})),function(n){n.USER="MESG",n.FILE="FILE",n.ADMIN="ADMM"}(tu||(tu={})),function(n){n.USERS="users",n.CHANNEL="channel"}(gn||(gn={})),function(n){n.ALL="all",n.NONE="none",n.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(vn||(vn={})),function(n){n.DEFAULT="default",n.SUPPRESS="suppress"}(hi||(hi={})),function(n){n.PENDING="pending",n.SCHEDULED="scheduled",n.SUCCEEDED="succeeded",n.FAILED="failed",n.CANCELED="canceled"}(tt||(tt={})),function(n){n.INREVIEW="InReview",n.APPROVED="Approved"}(km||(km={}));var j,ur="v3",Ue="/".concat(ur,"/users"),BT="/".concat(ur,"/storage/file"),Mn="/".concat(ur,"/group_channels"),jT="/".concat(ur,"/sdk/group_channels"),KT="/".concat(ur,"/open_channels"),QT="/".concat(ur,"/search"),hp="/".concat(ur,"/report"),WT="/".concat(ur,"/emojis"),B0="/".concat(ur,"/emoji_categories"),_i="/".concat(ur,"/polls"),j0="/".concat(ur,"/scheduled_messages"),YT="/".concat(ur,"/sdk/ui_kit/configuration"),ZT="/".concat(ur,"/sdk/statistics"),JT=function(n,t){return"/".concat(ur,"/group_channels/").concat(n,"/messages/").concat(t,"/submit_forms")},Le=function(n){switch(n){case xe.FEED:case xe.GROUP:return Mn;case xe.OPEN:return KT;default:return null}},K0=function(n){switch(n){case xe.GROUP:return"".concat(hp,"/group_channels");case xe.OPEN:return"".concat(hp,"/open_channels");default:return null}},nu=function(n,t,e){var r,i;switch(n){case gn.CHANNEL:return!0;case gn.USERS:if(t)try{for(var s=Z(t),a=s.next();!a.done;a=s.next())if(a.value===e)return!0}catch(o){r={error:o}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},y_=function(n,t,e){var r,i,s,a,o=nu((r=n.mentionType)!==null&&r!==void 0?r:null,(i=n.mentionedUserIds)!==null&&i!==void 0?i:[],e),u=nu((s=t.mentionType)!==null&&s!==void 0?s:null,(a=t.mentionedUserIds)!==null&&a!==void 0?a:[],e);return!o&&u?1:o&&!u?-1:0},Q0=function(n,t,e){var r,i=t||new FormData;for(var s in n)if(n.hasOwnProperty(s)){var a=n[s],o=e?"".concat(e,"[").concat(s,"]"):s;On(a)?i.append(o,a,(r=a.name)!==null&&r!==void 0?r:"filename"):typeof a!="object"||a===null||Array.isArray(a)||a instanceof Blob?i.append(o,String(a)):i=Q0(a,i,o)}return i};(function(n){n.GET="GET",n.POST="POST",n.PUT="PUT",n.DELETE="DELETE"})(j||(j={}));var lt,K=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=Rs(),e}return w(t,n),t.prototype.encodeParams=function(e){var r=this;return e==null||e===""?encodeURIComponent(""):Array.isArray(e)?e.map(function(i){return r.encodeParams(i)}).join(","):encodeURIComponent(typeof e=="object"?JSON.stringify(e):String(e))},Object.defineProperty(t.prototype,"query",{get:function(){var e=this,r=re(this.params);return"?".concat(Object.keys(r).map(function(i){return"".concat(encodeURIComponent(i),"=").concat(e.encodeParams(r[i]))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){var e=re(this.params);return Object.keys(e).some(function(r){return On(e[r])})?Q0(e):JSON.stringify(e)},enumerable:!1,configurable:!0}),t}(rt),W=function(n){function t(e,r){var i=n.call(this)||this;return i._iid=e,i._payload=r,i}return w(t,n),Object.defineProperty(t.prototype,"payload",{get:function(){return A({},this._payload)},enumerable:!1,configurable:!0}),t.prototype.as=function(e){return new e(this._iid,this.payload)},t}(rt),XT=function(n){function t(e){var r=n.call(this)||this;return r.requestId=e,r}return w(t,n),t}(rt),ru=function(n){function t(e){var r=e.expires_in,i=e.reason,s=i===void 0?ae.SESSION_KEY_EXPIRED:i,a=n.call(this)||this;switch(a.expiresIn=r??0,s){case ae.SESSION_KEY_EXPIRED:case ae.SESSION_TOKEN_EXPIRED:case ae.SESSION_REVOKED:case ae.USER_AUTH_DEACTIVATED:case ae.USER_AUTH_DELETED_OR_NOT_FOUND:a.error=new U({code:s})}return a}return w(t,n),Object.defineProperty(t.prototype,"invalidateSessionToken",{get:function(){var e;return!!(!((e=this.error)===null||e===void 0)&&e.isSessionTokenExpiredError)},enumerable:!1,configurable:!0}),t}(rt),it=function(n){function t(e,r,i,s){s===void 0&&(s="");var a,o=this;return(o=n.call(this)||this)._iid=e,o.code=r,o.payload=i,o.requestId=(a=i.req_id)!==null&&a!==void 0?a:s,o}return w(t,n),t.createFromRawMessage=function(e,r){var i=r.substring(0,4),s={};try{s=JSON.parse(r.substring(4))}catch{i="NOOP"}finally{return new t(e,i,s)}},t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),`
`)},t.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},t}(rt),Yn=function(n){function t(e){var r,i=e.code,s=e.ackRequired,a=e.payload,o=a===void 0?{}:a,u=this;return(u=n.call(this)||this).code=i,u.payload=o,u.requestId=(r=u.payload.req_id)!==null&&r!==void 0?r:Rs(),u.ackRequired=s,u.payload.req_id=u.requestId,u}return w(t,n),t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),`
`)},t}(rt),E_=function(n){function t(e){var r=e.userId,i=e.authToken,s=e.services,a=s===void 0?[Ds.CHAT]:s,o=e.expiringSession,u=o===void 0||o,c=n.call(this)||this;return c.path="".concat(Ue,"/").concat(r,"/session_key"),c.method=j.POST,c.params=re({token:i,services:a,expiring_session:!!u}),c.requireAuth=!1,c}return w(t,n),t}(K),ew=function(n){function t(e){var r=e.authToken,i=e.expiringSession,s=i===void 0||i,a=e.requestId,o=a===void 0?void 0:a;return n.call(this,{code:"LOGI",payload:{token:r,expiring_session:s?1:0,req_id:o},ackRequired:!0})||this}return w(t,n),t}(Yn),tw=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.key,a=r.expires_at,o=r.services;return i.key=s,i.expiresAt=a,i.services=o,i}return w(t,n),t}(W),nw=function(n){function t(e,r,i){var s,a=this;return(a=n.call(this,e,"LOGI",i)||this).error=null,a.newKey=null,a.newKey=(s=i.new_key)!==null&&s!==void 0?s:null,a.error=i.error?new U(i):null,a}return w(t,n),t}(it),b_=function(n){function t(e){var r=n.call(this)||this;return r.statLog=e,r}return w(t,n),t}(rt),W0=function(n){function t(e){var r=e.request,i=e.deferred,s=e.error,a=s===void 0?U.requestFailed:s,o=n.call(this)||this;return o.request=r,o.deferred=i,o.error=a,o}return w(t,n),t}(rt);(function(n){n.FEATURE_LOCALCACHE="feature:local_cache",n.FEATURE_LOCALCACHE_EVENT="feature:local_cache_event",n.NOTIFICATION="noti:stats",n.WEBSOCKET_CONNECT="ws:connect",n.API_RESULT="api:result"})(lt||(lt={}));var Mm,Ad,Dm,dn=function(){function n(t){var e=t.type,r=t.data,i=t.ts,s=i===void 0?Date.now():i;this.type=e,this.createdAt=s,this.data=r}return n.payloadify=function(t){return re({stat_type:t.type,ts:t.createdAt,data:re(t.data)})},n}(),fp=function(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product=="ReactNative"},Rm=function(){return!(typeof navigator>"u"||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent))};(function(n){n.CHAT="chat",n.CALLS="calls",n.DESK="desk",n.LIVE="live",n.UIKIT_CHAT="uikit-chat",n.UIKIT_LIVE="uikit-live"})(Mm||(Mm={})),function(n){n.ANDROID="android",n.IOS="ios",n.JS="js",n.UNREAL="unreal",n.UNITY="unity",n.REACT_NATIVE="react-native",n.FLUTTER="flutter"}(Ad||(Ad={})),function(n){n.ANDROID="android",n.IOS="ios",n.WEB="web",n.MOBILE_WEB="mobile_web",n.WINDOWS="windows"}(Dm||(Dm={}));var rw="^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",kd=function(){function n(){}return n.sendbirdSdkUserAgentWithExtension=function(t){var e=fp()?Ad.REACT_NATIVE:Ad.JS,r={main_sdk_info:"chat/".concat(e,"/").concat(oa.SDK_VERSION),device_os_platform:Rm()?"mobile-web":"web",os_version:oa.OS_VERSION};if(t){var i=t.sendbirdExtensions,s=t.deviceOS,a=t.customData,o=a===void 0?{}:a;s.version&&(r.os_version=s.version),s.platform&&(r.device_os_platform=s.platform),i.length>0&&(r.extension_sdk_info=i.map(function(u){var c=u.product,l=u.platform,d=u.version;return"".concat(c,"/").concat(l,"/").concat(d)}).join(",")),Object.keys(r).forEach(function(u){return delete o[u]}),Object.keys(o).length>0&&(r=A(A({},r),o))}return Object.entries(r).map(function(u){var c=ie(u,2),l=c[0],d=c[1];return"".concat(l,"=").concat(d)}).join("&")},n.userAgentWithExtension=function(t){var e=fp()?"reactnative":"JS",r=t.sb_syncmanager?"s".concat(t.sb_syncmanager):"",i=t.sb_uikit?"u".concat(t.sb_uikit):"",s=t["device-os-platform"]?"o".concat(t["device-os-platform"]):Rm()?"omobile-web":"oweb";return"".concat(e,"/c").concat(oa.SDK_VERSION,"/").concat(r,"/").concat(i,"/").concat(s)},n}(),Fn=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=function(r){e(r)}})},Od=function(n){function t(e){var r=n.call(this)||this;return r.requestId=e.requestId,r}return w(t,n),t}(rt),iw=function(){function n(t,e){var r=e.session,i=e.sdkState,s=e.dispatcher,a=e.logger,o=e.useFetchCompat,u=o!==void 0&&o,c=this;this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=t,this._session=r,this._sdkState=i,this._dispatcher=s,this._dispatcher.on(function(l){l instanceof XT&&c.cancel(l.requestId)}),this._logger=a,this._shouldImportFetchCompat=u}return n.prototype._createHeader=function(t,e){var r=this._sdkState,i=r.appId,s=r.appVersion,a=r.sendbirdRuntimeEnvironment,o=A(A({},t.headers),{SendBird:"JS,".concat(oa.OS_VERSION,",").concat(oa.SDK_VERSION,",").concat(i).concat(s?",".concat(s):""),"SB-User-Agent":kd.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":kd.sendbirdSdkUserAgentWithExtension(a)});return e||(o["Content-Type"]="application/json; charset=utf-8"),t.requireAuth&&this._session.hasSession&&(o["Session-Key"]=this._session.sessionKey),this._session&&this._session.authToken&&(o["App-Id"]=i,o["Access-Token"]=this._session.authToken),o},n.prototype._statLogApiResult=function(t,e,r){this._dispatcher.dispatch(new b_(new dn({type:lt.API_RESULT,data:{endpoint:t.path,method:t.method,success:!r,latency:Date.now()-e,error_code:r==null?void 0:r.code,error_description:r==null?void 0:r.message}})))},n.prototype.send=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N;return v(this,function(C){switch(C.label){case 0:e=t.path,r=t.method,i=t.uploadProgressHandler,s=![j.GET,j.DELETE].includes(r),a=this._sdkState.api,o="".concat(a.host).concat(e).concat(s?"":t.query),u=s?t.payload:null,c=this._createHeader(t,u instanceof FormData?u:void 0),l=new AbortController,d=l.signal,this._abortControl.set(t.requestId,l),h=Date.now(),C.label=1;case 1:return C.trys.push([1,13,,14]),i?[4,Yu(()=>import("./__bundle-7085bddf-5f395ad0.js"),[])]:[3,6];case 2:f=C.sent().xmlHttpRequest,C.label=3;case 3:return C.trys.push([3,5,,6]),[4,f(this._iid,{requestId:t.requestId,method:t.method,url:o,headers:c,data:u??void 0,uploadProgressHandler:i})];case 4:return p=C.sent(),this._logger.debug("receive api response",t.requestId),this._statLogApiResult(t,h),[2,p];case 5:if(!((_=C.sent())instanceof U&&_.code===ae.XMLHTTPREQUEST_NOT_SUPPORTED))throw _;return this._logger.debug("XMLHttpRequest is not available in this environment. progressHandler is ignored."),[3,6];case 6:return this._shouldImportFetchCompat&&(this._shouldImportFetchCompat=!1,(typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{fetch:null}).fetch=null),typeof AbortController<"u"?[3,8]:[4,Yu(()=>import("./__bundle-2aa1a987-6d477eff.js").then(L=>L._),["assets/__bundle-2aa1a987-6d477eff.js","assets/_commonjsHelpers-28e086c5.js"])];case 7:C.sent(),C.label=8;case 8:return typeof fetch=="function"?[3,10]:[4,Yu(()=>import("./__bundle-cd03baa7-25716759.js").then(L=>L._),["assets/__bundle-cd03baa7-25716759.js","assets/_commonjsHelpers-28e086c5.js"])];case 9:C.sent(),C.label=10;case 10:return[4,fetch(o,{method:r,body:u,headers:c,signal:d})];case 11:return[4,(m=C.sent()).json()];case 12:if(b=C.sent(),m.ok||m.redirected)return this._logger.debug("receive api response",t.requestId),this._statLogApiResult(t,h),[2,new W(this._iid,b)];if(b){if((y=new U(b)).isSessionExpiredError){if(this._dispatcher.dispatch(new ru({reason:y.code})),!(t instanceof E_))return E=new Fn,this._dispatcher.dispatch(new W0({request:t,deferred:E,error:y})),[2,E.promise];throw y}throw y.isSessionInvalidatedError&&this._dispatcher.dispatch(new ru({reason:y.code})),y}throw U.requestFailed;case 13:throw T=C.sent(),this._statLogApiResult(t,h,T),T instanceof U?(this._logger.debug("fail api request",T),T):(T==null?void 0:T.name)==="AbortError"?U.requestCanceled:(N=U.networkError,this._logger.debug("fail api request",N),N);case 14:return[2]}})})},n.prototype.cancel=function(t){this._abortControl.has(t)&&(this._abortControl.get(t).abort(),this._abortControl.delete(t)),this._dispatcher.dispatch(new Od({requestId:t}))},n.prototype.cancelAll=function(){var t,e;try{for(var r=Z(this._abortControl.values()),i=r.next();!i.done;i=r.next())i.value.abort()}catch(s){t={error:s}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this._abortControl.clear(),this._dispatcher.dispatch(new Od({}))},n}(),Se=function(){};function du(n){let t=n.length;for(;--t>=0;)n[t]=0}const T_=256,Y0=286,Ju=30,Xu=15,pp=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),cd=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),sw=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Um=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),fs=new Array(576);du(fs);const ec=new Array(60);du(ec);const Uc=new Array(512);du(Uc);const tc=new Array(256);du(tc);const w_=new Array(29);du(w_);const Md=new Array(Ju);function Zh(n,t,e,r,i){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=r,this.max_length=i,this.has_stree=n&&n.length}let Lm,Pm,xm;function Jh(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}du(Md);const Z0=n=>n<256?Uc[n]:Uc[256+(n>>>7)],Lc=(n,t)=>{n.pending_buf[n.pending++]=255&t,n.pending_buf[n.pending++]=t>>>8&255},ir=(n,t,e)=>{n.bi_valid>16-e?(n.bi_buf|=t<<n.bi_valid&65535,Lc(n,n.bi_buf),n.bi_buf=t>>16-n.bi_valid,n.bi_valid+=e-16):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},Ui=(n,t,e)=>{ir(n,e[2*t],e[2*t+1])},J0=(n,t)=>{let e=0;do e|=1&n,n>>>=1,e<<=1;while(--t>0);return e>>>1},X0=(n,t,e)=>{const r=new Array(16);let i,s,a=0;for(i=1;i<=Xu;i++)a=a+e[i-1]<<1,r[i]=a;for(s=0;s<=t;s++){let o=n[2*s+1];o!==0&&(n[2*s]=J0(r[o]++,o))}},ey=n=>{let t;for(t=0;t<Y0;t++)n.dyn_ltree[2*t]=0;for(t=0;t<Ju;t++)n.dyn_dtree[2*t]=0;for(t=0;t<19;t++)n.bl_tree[2*t]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},ty=n=>{n.bi_valid>8?Lc(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},Fm=(n,t,e,r)=>{const i=2*t,s=2*e;return n[i]<n[s]||n[i]===n[s]&&r[t]<=r[e]},Xh=(n,t,e)=>{const r=n.heap[e];let i=e<<1;for(;i<=n.heap_len&&(i<n.heap_len&&Fm(t,n.heap[i+1],n.heap[i],n.depth)&&i++,!Fm(t,r,n.heap[i],n.depth));)n.heap[e]=n.heap[i],e=i,i<<=1;n.heap[e]=r},qm=(n,t,e)=>{let r,i,s,a,o=0;if(n.sym_next!==0)do r=255&n.pending_buf[n.sym_buf+o++],r+=(255&n.pending_buf[n.sym_buf+o++])<<8,i=n.pending_buf[n.sym_buf+o++],r===0?Ui(n,i,t):(s=tc[i],Ui(n,s+T_+1,t),a=pp[s],a!==0&&(i-=w_[s],ir(n,i,a)),r--,s=Z0(r),Ui(n,s,e),a=cd[s],a!==0&&(r-=Md[s],ir(n,r,a)));while(o<n.sym_next);Ui(n,256,t)},ef=(n,t)=>{const e=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let a,o,u,c=-1;for(n.heap_len=0,n.heap_max=573,a=0;a<s;a++)e[2*a]!==0?(n.heap[++n.heap_len]=c=a,n.depth[a]=0):e[2*a+1]=0;for(;n.heap_len<2;)u=n.heap[++n.heap_len]=c<2?++c:0,e[2*u]=1,n.depth[u]=0,n.opt_len--,i&&(n.static_len-=r[2*u+1]);for(t.max_code=c,a=n.heap_len>>1;a>=1;a--)Xh(n,e,a);u=s;do a=n.heap[1],n.heap[1]=n.heap[n.heap_len--],Xh(n,e,1),o=n.heap[1],n.heap[--n.heap_max]=a,n.heap[--n.heap_max]=o,e[2*u]=e[2*a]+e[2*o],n.depth[u]=(n.depth[a]>=n.depth[o]?n.depth[a]:n.depth[o])+1,e[2*a+1]=e[2*o+1]=u,n.heap[1]=u++,Xh(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((l,d)=>{const h=d.dyn_tree,f=d.max_code,p=d.stat_desc.static_tree,_=d.stat_desc.has_stree,m=d.stat_desc.extra_bits,b=d.stat_desc.extra_base,y=d.stat_desc.max_length;let E,T,N,C,L,k,O=0;for(C=0;C<=Xu;C++)l.bl_count[C]=0;for(h[2*l.heap[l.heap_max]+1]=0,E=l.heap_max+1;E<573;E++)T=l.heap[E],C=h[2*h[2*T+1]+1]+1,C>y&&(C=y,O++),h[2*T+1]=C,T>f||(l.bl_count[C]++,L=0,T>=b&&(L=m[T-b]),k=h[2*T],l.opt_len+=k*(C+L),_&&(l.static_len+=k*(p[2*T+1]+L)));if(O!==0){do{for(C=y-1;l.bl_count[C]===0;)C--;l.bl_count[C]--,l.bl_count[C+1]+=2,l.bl_count[y]--,O-=2}while(O>0);for(C=y;C!==0;C--)for(T=l.bl_count[C];T!==0;)N=l.heap[--E],N>f||(h[2*N+1]!==C&&(l.opt_len+=(C-h[2*N+1])*h[2*N],h[2*N+1]=C),T--)}})(n,t),X0(e,c,n.bl_count)},$m=(n,t,e)=>{let r,i,s=-1,a=t[1],o=0,u=7,c=4;for(a===0&&(u=138,c=3),t[2*(e+1)+1]=65535,r=0;r<=e;r++)i=a,a=t[2*(r+1)+1],++o<u&&i===a||(o<c?n.bl_tree[2*i]+=o:i!==0?(i!==s&&n.bl_tree[2*i]++,n.bl_tree[32]++):o<=10?n.bl_tree[34]++:n.bl_tree[36]++,o=0,s=i,a===0?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4))},Hm=(n,t,e)=>{let r,i,s=-1,a=t[1],o=0,u=7,c=4;for(a===0&&(u=138,c=3),r=0;r<=e;r++)if(i=a,a=t[2*(r+1)+1],!(++o<u&&i===a)){if(o<c)do Ui(n,i,n.bl_tree);while(--o!=0);else i!==0?(i!==s&&(Ui(n,i,n.bl_tree),o--),Ui(n,16,n.bl_tree),ir(n,o-3,2)):o<=10?(Ui(n,17,n.bl_tree),ir(n,o-3,3)):(Ui(n,18,n.bl_tree),ir(n,o-11,7));o=0,s=i,a===0?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4)}};let zm=!1;const ny=(n,t,e,r)=>{ir(n,0+(r?1:0),3),ty(n),Lc(n,e),Lc(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e};var aw=(n,t,e,r)=>{let i,s,a=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(o=>{let u,c=4093624447;for(u=0;u<=31;u++,c>>>=1)if(1&c&&o.dyn_ltree[2*u]!==0)return 0;if(o.dyn_ltree[18]!==0||o.dyn_ltree[20]!==0||o.dyn_ltree[26]!==0)return 1;for(u=32;u<T_;u++)if(o.dyn_ltree[2*u]!==0)return 1;return 0})(n)),ef(n,n.l_desc),ef(n,n.d_desc),a=(o=>{let u;for($m(o,o.dyn_ltree,o.l_desc.max_code),$m(o,o.dyn_dtree,o.d_desc.max_code),ef(o,o.bl_desc),u=18;u>=3&&o.bl_tree[2*Um[u]+1]===0;u--);return o.opt_len+=3*(u+1)+5+5+4,u})(n),i=n.opt_len+3+7>>>3,s=n.static_len+3+7>>>3,s<=i&&(i=s)):i=s=e+5,e+4<=i&&t!==-1?ny(n,t,e,r):n.strategy===4||s===i?(ir(n,2+(r?1:0),3),qm(n,fs,ec)):(ir(n,4+(r?1:0),3),((o,u,c,l)=>{let d;for(ir(o,u-257,5),ir(o,c-1,5),ir(o,l-4,4),d=0;d<l;d++)ir(o,o.bl_tree[2*Um[d]+1],3);Hm(o,o.dyn_ltree,u-1),Hm(o,o.dyn_dtree,c-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,a+1),qm(n,n.dyn_ltree,n.dyn_dtree)),ey(n),r&&ty(n)},ow={_tr_init:n=>{zm||((()=>{let t,e,r,i,s;const a=new Array(16);for(r=0,i=0;i<28;i++)for(w_[i]=r,t=0;t<1<<pp[i];t++)tc[r++]=i;for(tc[r-1]=i,s=0,i=0;i<16;i++)for(Md[i]=s,t=0;t<1<<cd[i];t++)Uc[s++]=i;for(s>>=7;i<Ju;i++)for(Md[i]=s<<7,t=0;t<1<<cd[i]-7;t++)Uc[256+s++]=i;for(e=0;e<=Xu;e++)a[e]=0;for(t=0;t<=143;)fs[2*t+1]=8,t++,a[8]++;for(;t<=255;)fs[2*t+1]=9,t++,a[9]++;for(;t<=279;)fs[2*t+1]=7,t++,a[7]++;for(;t<=287;)fs[2*t+1]=8,t++,a[8]++;for(X0(fs,287,a),t=0;t<Ju;t++)ec[2*t+1]=5,ec[2*t]=J0(t,5);Lm=new Zh(fs,pp,257,Y0,Xu),Pm=new Zh(ec,cd,0,Ju,Xu),xm=new Zh(new Array(0),sw,0,19,7)})(),zm=!0),n.l_desc=new Jh(n.dyn_ltree,Lm),n.d_desc=new Jh(n.dyn_dtree,Pm),n.bl_desc=new Jh(n.bl_tree,xm),n.bi_buf=0,n.bi_valid=0,ey(n)},_tr_stored_block:ny,_tr_flush_block:aw,_tr_tally:(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[2*e]++:(n.matches++,t--,n.dyn_ltree[2*(tc[e]+T_+1)]++,n.dyn_dtree[2*Z0(t)]++),n.sym_next===n.sym_end),_tr_align:n=>{ir(n,2,3),Ui(n,256,fs),(t=>{t.bi_valid===16?(Lc(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(n)}},nc=(n,t,e,r)=>{let i=65535&n|0,s=n>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do i=i+t[r++]|0,s=s+i|0;while(--a);i%=65521,s%=65521}return i|s<<16|0};const uw=new Uint32Array((()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var r=0;r<8;r++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t})());var hn=(n,t,e,r)=>{const i=uw,s=r+e;n^=-1;for(let a=r;a<s;a++)n=n>>>8^i[255&(n^t[a])];return-1^n},po={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},To={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:cw,_tr_stored_block:_p,_tr_flush_block:lw,_tr_tally:ua,_tr_align:dw}=ow,{Z_NO_FLUSH:ca,Z_PARTIAL_FLUSH:hw,Z_FULL_FLUSH:fw,Z_FINISH:qr,Z_BLOCK:Gm,Z_OK:Tn,Z_STREAM_END:Vm,Z_STREAM_ERROR:Ai,Z_DATA_ERROR:pw,Z_BUF_ERROR:tf,Z_DEFAULT_COMPRESSION:_w,Z_FILTERED:mw,Z_HUFFMAN_ONLY:Il,Z_RLE:vw,Z_FIXED:gw,Z_DEFAULT_STRATEGY:yw,Z_UNKNOWN:Ew,Z_DEFLATED:Dd}=To,Qa=258,Hi=262,Qo=42,qa=113,Hu=666,$a=(n,t)=>(n.msg=po[t],t),Bm=n=>2*n-(n>4?9:0),ta=n=>{let t=n.length;for(;--t>=0;)n[t]=0},bw=n=>{let t,e,r,i=n.w_size;t=n.hash_size,r=t;do e=n.head[--r],n.head[r]=e>=i?e-i:0;while(--t);t=i,r=t;do e=n.prev[--r],n.prev[r]=e>=i?e-i:0;while(--t)};let la=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask;const pr=n=>{const t=n.state;let e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},yr=(n,t)=>{lw(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,pr(n.strm)},ut=(n,t)=>{n.pending_buf[n.pending++]=t},Du=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=255&t},mp=(n,t,e,r)=>{let i=n.avail_in;return i>r&&(i=r),i===0?0:(n.avail_in-=i,t.set(n.input.subarray(n.next_in,n.next_in+i),e),n.state.wrap===1?n.adler=nc(n.adler,t,i,e):n.state.wrap===2&&(n.adler=hn(n.adler,t,i,e)),n.next_in+=i,n.total_in+=i,i)},ry=(n,t)=>{let e,r,i=n.max_chain_length,s=n.strstart,a=n.prev_length,o=n.nice_match;const u=n.strstart>n.w_size-Hi?n.strstart-(n.w_size-Hi):0,c=n.window,l=n.w_mask,d=n.prev,h=n.strstart+Qa;let f=c[s+a-1],p=c[s+a];n.prev_length>=n.good_match&&(i>>=2),o>n.lookahead&&(o=n.lookahead);do if(e=t,c[e+a]===p&&c[e+a-1]===f&&c[e]===c[s]&&c[++e]===c[s+1]){s+=2,e++;do;while(c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&s<h);if(r=Qa-(h-s),s=h-Qa,r>a){if(n.match_start=t,a=r,r>=o)break;f=c[s+a-1],p=c[s+a]}}while((t=d[t&l])>u&&--i!=0);return a<=n.lookahead?a:n.lookahead},zo=n=>{const t=n.w_size;let e,r,i;do{if(r=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-Hi)&&(n.window.set(n.window.subarray(t,t+t-r),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),bw(n),r+=t),n.strm.avail_in===0)break;if(e=mp(n.strm,n.window,n.strstart+n.lookahead,r),n.lookahead+=e,n.lookahead+n.insert>=3)for(i=n.strstart-n.insert,n.ins_h=n.window[i],n.ins_h=la(n,n.ins_h,n.window[i+1]);n.insert&&(n.ins_h=la(n,n.ins_h,n.window[i+3-1]),n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<Hi&&n.strm.avail_in!==0)},iy=(n,t)=>{let e,r,i,s=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,a=0,o=n.strm.avail_in;do{if(e=65535,i=n.bi_valid+42>>3,n.strm.avail_out<i||(i=n.strm.avail_out-i,r=n.strstart-n.block_start,e>r+n.strm.avail_in&&(e=r+n.strm.avail_in),e>i&&(e=i),e<s&&(e===0&&t!==qr||t===ca||e!==r+n.strm.avail_in)))break;a=t===qr&&e===r+n.strm.avail_in?1:0,_p(n,0,0,a),n.pending_buf[n.pending-4]=e,n.pending_buf[n.pending-3]=e>>8,n.pending_buf[n.pending-2]=~e,n.pending_buf[n.pending-1]=~e>>8,pr(n.strm),r&&(r>e&&(r=e),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+r),n.strm.next_out),n.strm.next_out+=r,n.strm.avail_out-=r,n.strm.total_out+=r,n.block_start+=r,e-=r),e&&(mp(n.strm,n.strm.output,n.strm.next_out,e),n.strm.next_out+=e,n.strm.avail_out-=e,n.strm.total_out+=e)}while(a===0);return o-=n.strm.avail_in,o&&(o>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=o&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-o,n.strm.next_in),n.strstart),n.strstart+=o,n.insert+=o>n.w_size-n.insert?n.w_size-n.insert:o),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),a?4:t!==ca&&t!==qr&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(i=n.window_size-n.strstart,n.strm.avail_in>i&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,i+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),i>n.strm.avail_in&&(i=n.strm.avail_in),i&&(mp(n.strm,n.window,n.strstart,i),n.strstart+=i,n.insert+=i>n.w_size-n.insert?n.w_size-n.insert:i),n.high_water<n.strstart&&(n.high_water=n.strstart),i=n.bi_valid+42>>3,i=n.pending_buf_size-i>65535?65535:n.pending_buf_size-i,s=i>n.w_size?n.w_size:i,r=n.strstart-n.block_start,(r>=s||(r||t===qr)&&t!==ca&&n.strm.avail_in===0&&r<=i)&&(e=r>i?i:r,a=t===qr&&n.strm.avail_in===0&&e===r?1:0,_p(n,n.block_start,e,a),n.block_start+=e,pr(n.strm)),a?3:1)},nf=(n,t)=>{let e,r;for(;;){if(n.lookahead<Hi){if(zo(n),n.lookahead<Hi&&t===ca)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=la(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-Hi&&(n.match_length=ry(n,e)),n.match_length>=3)if(r=ua(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=la(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=la(n,n.ins_h,n.window[n.strstart+1]);else r=ua(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(r&&(yr(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,t===qr?(yr(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(yr(n,!1),n.strm.avail_out===0)?1:2},Lo=(n,t)=>{let e,r,i;for(;;){if(n.lookahead<Hi){if(zo(n),n.lookahead<Hi&&t===ca)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=la(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-Hi&&(n.match_length=ry(n,e),n.match_length<=5&&(n.strategy===mw||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){i=n.strstart+n.lookahead-3,r=ua(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=i&&(n.ins_h=la(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,r&&(yr(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(r=ua(n,0,n.window[n.strstart-1]),r&&yr(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(r=ua(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,t===qr?(yr(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(yr(n,!1),n.strm.avail_out===0)?1:2};function Si(n,t,e,r,i){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=r,this.func=i}const zu=[new Si(0,0,0,0,iy),new Si(4,4,8,4,nf),new Si(4,5,16,8,nf),new Si(4,6,32,32,nf),new Si(4,4,16,16,Lo),new Si(8,16,32,32,Lo),new Si(8,16,128,128,Lo),new Si(8,32,128,256,Lo),new Si(32,128,258,1024,Lo),new Si(32,258,258,4096,Lo)];function Tw(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Dd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ta(this.dyn_ltree),ta(this.dyn_dtree),ta(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ta(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ta(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Gu=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.status!==Qo&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==qa&&t.status!==Hu?1:0},sy=n=>{if(Gu(n))return $a(n,Ai);n.total_in=n.total_out=0,n.data_type=Ew;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Qo:qa,n.adler=t.wrap===2?0:1,t.last_flush=-2,cw(t),Tn},ay=n=>{const t=sy(n);var e;return t===Tn&&((e=n.state).window_size=2*e.w_size,ta(e.head),e.max_lazy_match=zu[e.level].max_lazy,e.good_match=zu[e.level].good_length,e.nice_match=zu[e.level].nice_length,e.max_chain_length=zu[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},jm=(n,t,e,r,i,s)=>{if(!n)return Ai;let a=1;if(t===_w&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||e!==Dd||r<8||r>15||t<0||t>9||s<0||s>gw||r===8&&a!==1)return $a(n,Ai);r===8&&(r=9);const o=new Tw;return n.state=o,o.strm=n,o.status=Qo,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=s,o.method=e,ay(n)};var rc={deflateInit:(n,t)=>jm(n,t,Dd,15,8,yw),deflateInit2:jm,deflateReset:ay,deflateResetKeep:sy,deflateSetHeader:(n,t)=>Gu(n)||n.state.wrap!==2?Ai:(n.state.gzhead=t,Tn),deflate:(n,t)=>{if(Gu(n)||t>Gm||t<0)return n?$a(n,Ai):Ai;const e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===Hu&&t!==qr)return $a(n,n.avail_out===0?tf:Ai);const r=e.last_flush;if(e.last_flush=t,e.pending!==0){if(pr(n),n.avail_out===0)return e.last_flush=-1,Tn}else if(n.avail_in===0&&Bm(t)<=Bm(r)&&t!==qr)return $a(n,tf);if(e.status===Hu&&n.avail_in!==0)return $a(n,tf);if(e.status===Qo&&e.wrap===0&&(e.status=qa),e.status===Qo){let i=Dd+(e.w_bits-8<<4)<<8,s=-1;if(s=e.strategy>=Il||e.level<2?0:e.level<6?1:e.level===6?2:3,i|=s<<6,e.strstart!==0&&(i|=32),i+=31-i%31,Du(e,i),e.strstart!==0&&(Du(e,n.adler>>>16),Du(e,65535&n.adler)),n.adler=1,e.status=qa,pr(n),e.pending!==0)return e.last_flush=-1,Tn}if(e.status===57){if(n.adler=0,ut(e,31),ut(e,139),ut(e,8),e.gzhead)ut(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),ut(e,255&e.gzhead.time),ut(e,e.gzhead.time>>8&255),ut(e,e.gzhead.time>>16&255),ut(e,e.gzhead.time>>24&255),ut(e,e.level===9?2:e.strategy>=Il||e.level<2?4:0),ut(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(ut(e,255&e.gzhead.extra.length),ut(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=hn(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(ut(e,0),ut(e,0),ut(e,0),ut(e,0),ut(e,0),ut(e,e.level===9?2:e.strategy>=Il||e.level<2?4:0),ut(e,3),e.status=qa,pr(n),e.pending!==0)return e.last_flush=-1,Tn}if(e.status===69){if(e.gzhead.extra){let i=e.pending,s=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+s>e.pending_buf_size;){let o=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>i&&(n.adler=hn(n.adler,e.pending_buf,e.pending-i,i)),e.gzindex+=o,pr(n),e.pending!==0)return e.last_flush=-1,Tn;i=0,s-=o}let a=new Uint8Array(e.gzhead.extra);e.pending_buf.set(a.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending+=s,e.gzhead.hcrc&&e.pending>i&&(n.adler=hn(n.adler,e.pending_buf,e.pending-i,i)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let i,s=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(n.adler=hn(n.adler,e.pending_buf,e.pending-s,s)),pr(n),e.pending!==0)return e.last_flush=-1,Tn;s=0}i=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,ut(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>s&&(n.adler=hn(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let i,s=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(n.adler=hn(n.adler,e.pending_buf,e.pending-s,s)),pr(n),e.pending!==0)return e.last_flush=-1,Tn;s=0}i=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,ut(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>s&&(n.adler=hn(n.adler,e.pending_buf,e.pending-s,s))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(pr(n),e.pending!==0))return e.last_flush=-1,Tn;ut(e,255&n.adler),ut(e,n.adler>>8&255),n.adler=0}if(e.status=qa,pr(n),e.pending!==0)return e.last_flush=-1,Tn}if(n.avail_in!==0||e.lookahead!==0||t!==ca&&e.status!==Hu){let i=e.level===0?iy(e,t):e.strategy===Il?((s,a)=>{let o;for(;;){if(s.lookahead===0&&(zo(s),s.lookahead===0)){if(a===ca)return 1;break}if(s.match_length=0,o=ua(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,o&&(yr(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,a===qr?(yr(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(yr(s,!1),s.strm.avail_out===0)?1:2})(e,t):e.strategy===vw?((s,a)=>{let o,u,c,l;const d=s.window;for(;;){if(s.lookahead<=Qa){if(zo(s),s.lookahead<=Qa&&a===ca)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(c=s.strstart-1,u=d[c],u===d[++c]&&u===d[++c]&&u===d[++c])){l=s.strstart+Qa;do;while(u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&c<l);s.match_length=Qa-(l-c),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(o=ua(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(o=ua(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),o&&(yr(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,a===qr?(yr(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(yr(s,!1),s.strm.avail_out===0)?1:2})(e,t):zu[e.level].func(e,t);if(i!==3&&i!==4||(e.status=Hu),i===1||i===3)return n.avail_out===0&&(e.last_flush=-1),Tn;if(i===2&&(t===hw?dw(e):t!==Gm&&(_p(e,0,0,!1),t===fw&&(ta(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),pr(n),n.avail_out===0))return e.last_flush=-1,Tn}return t!==qr?Tn:e.wrap<=0?Vm:(e.wrap===2?(ut(e,255&n.adler),ut(e,n.adler>>8&255),ut(e,n.adler>>16&255),ut(e,n.adler>>24&255),ut(e,255&n.total_in),ut(e,n.total_in>>8&255),ut(e,n.total_in>>16&255),ut(e,n.total_in>>24&255)):(Du(e,n.adler>>>16),Du(e,65535&n.adler)),pr(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Tn:Vm)},deflateEnd:n=>{if(Gu(n))return Ai;const t=n.state.status;return n.state=null,t===qa?$a(n,pw):Tn},deflateSetDictionary:(n,t)=>{let e=t.length;if(Gu(n))return Ai;const r=n.state,i=r.wrap;if(i===2||i===1&&r.status!==Qo||r.lookahead)return Ai;if(i===1&&(n.adler=nc(n.adler,t,e,0)),r.wrap=0,e>=r.w_size){i===0&&(ta(r.head),r.strstart=0,r.block_start=0,r.insert=0);let u=new Uint8Array(r.w_size);u.set(t.subarray(e-r.w_size,e),0),t=u,e=r.w_size}const s=n.avail_in,a=n.next_in,o=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,zo(r);r.lookahead>=3;){let u=r.strstart,c=r.lookahead-2;do r.ins_h=la(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++;while(--c);r.strstart=u,r.lookahead=2,zo(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,n.next_in=a,n.input=o,n.avail_in=s,r.wrap=i,Tn},deflateInfo:"pako deflate (from Nodeca project)"};const ww=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var uh={assign:function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const r in e)ww(e,r)&&(n[r]=e[r])}}return n},flattenChunks:n=>{let t=0;for(let r=0,i=n.length;r<i;r++)t+=n[r].length;const e=new Uint8Array(t);for(let r=0,i=0,s=n.length;r<s;r++){let a=n[r];e.set(a,i),i+=a.length}return e}};let oy=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{oy=!1}const Pc=new Uint8Array(256);for(let n=0;n<256;n++)Pc[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Pc[254]=Pc[254]=1;var xc={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,r,i,s,a=n.length,o=0;for(i=0;i<a;i++)e=n.charCodeAt(i),(64512&e)==55296&&i+1<a&&(r=n.charCodeAt(i+1),(64512&r)==56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(o),s=0,i=0;s<o;i++)e=n.charCodeAt(i),(64512&e)==55296&&i+1<a&&(r=n.charCodeAt(i+1),(64512&r)==56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),e<128?t[s++]=e:e<2048?(t[s++]=192|e>>>6,t[s++]=128|63&e):e<65536?(t[s++]=224|e>>>12,t[s++]=128|e>>>6&63,t[s++]=128|63&e):(t[s++]=240|e>>>18,t[s++]=128|e>>>12&63,t[s++]=128|e>>>6&63,t[s++]=128|63&e);return t},buf2string:(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let r,i;const s=new Array(2*e);for(i=0,r=0;r<e;){let a=n[r++];if(a<128){s[i++]=a;continue}let o=Pc[a];if(o>4)s[i++]=65533,r+=o-1;else{for(a&=o===2?31:o===3?15:7;o>1&&r<e;)a=a<<6|63&n[r++],o--;o>1?s[i++]=65533:a<65536?s[i++]=a:(a-=65536,s[i++]=55296|a>>10&1023,s[i++]=56320|1023&a)}}return((a,o)=>{if(o<65534&&a.subarray&&oy)return String.fromCharCode.apply(null,a.length===o?a:a.subarray(0,o));let u="";for(let c=0;c<o;c++)u+=String.fromCharCode(a[c]);return u})(s,i)},utf8border:(n,t)=>{(t=t||n.length)>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(192&n[e])==128;)e--;return e<0||e===0?t:e+Pc[n[e]]>t?e:t}},uy=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const cy=Object.prototype.toString,{Z_NO_FLUSH:Iw,Z_SYNC_FLUSH:Sw,Z_FULL_FLUSH:Cw,Z_FINISH:Nw,Z_OK:Rd,Z_STREAM_END:Aw,Z_DEFAULT_COMPRESSION:kw,Z_DEFAULT_STRATEGY:Ow,Z_DEFLATED:Mw}=To;function ic(n){this.options=uh.assign({level:kw,method:Mw,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ow},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new uy,this.strm.avail_out=0;let e=rc.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Rd)throw new Error(po[e]);if(t.header&&rc.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?xc.string2buf(t.dictionary):cy.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,e=rc.deflateSetDictionary(this.strm,r),e!==Rd)throw new Error(po[e]);this._dict_set=!0}}function rf(n,t){const e=new ic(t);if(e.push(n,!0),e.err)throw e.msg||po[e.err];return e.result}ic.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?Nw:Iw,typeof n=="string"?e.input=xc.string2buf(n):cy.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),(s===Sw||s===Cw)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(i=rc.deflate(e,s),i===Aw)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),i=rc.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Rd;if(e.avail_out!==0){if(s>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},ic.prototype.onData=function(n){this.chunks.push(n)},ic.prototype.onEnd=function(n){n===Rd&&(this.result=uh.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var Dw={Deflate:ic,deflate:rf,deflateRaw:function(n,t){return(t=t||{}).raw=!0,rf(n,t)},gzip:function(n,t){return(t=t||{}).gzip=!0,rf(n,t)},constants:To};const Sl=16209;var Rw=function(n,t){let e,r,i,s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k,O;const x=n.state;e=n.next_in,k=n.input,r=e+(n.avail_in-5),i=n.next_out,O=n.output,s=i-(t-n.avail_out),a=i+(n.avail_out-257),o=x.dmax,u=x.wsize,c=x.whave,l=x.wnext,d=x.window,h=x.hold,f=x.bits,p=x.lencode,_=x.distcode,m=(1<<x.lenbits)-1,b=(1<<x.distbits)-1;e:do{f<15&&(h+=k[e++]<<f,f+=8,h+=k[e++]<<f,f+=8),y=p[h&m];t:for(;;){if(E=y>>>24,h>>>=E,f-=E,E=y>>>16&255,E===0)O[i++]=65535&y;else{if(!(16&E)){if(!(64&E)){y=p[(65535&y)+(h&(1<<E)-1)];continue t}if(32&E){x.mode=16191;break e}n.msg="invalid literal/length code",x.mode=Sl;break e}T=65535&y,E&=15,E&&(f<E&&(h+=k[e++]<<f,f+=8),T+=h&(1<<E)-1,h>>>=E,f-=E),f<15&&(h+=k[e++]<<f,f+=8,h+=k[e++]<<f,f+=8),y=_[h&b];n:for(;;){if(E=y>>>24,h>>>=E,f-=E,E=y>>>16&255,!(16&E)){if(!(64&E)){y=_[(65535&y)+(h&(1<<E)-1)];continue n}n.msg="invalid distance code",x.mode=Sl;break e}if(N=65535&y,E&=15,f<E&&(h+=k[e++]<<f,f+=8,f<E&&(h+=k[e++]<<f,f+=8)),N+=h&(1<<E)-1,N>o){n.msg="invalid distance too far back",x.mode=Sl;break e}if(h>>>=E,f-=E,E=i-s,N>E){if(E=N-E,E>c&&x.sane){n.msg="invalid distance too far back",x.mode=Sl;break e}if(C=0,L=d,l===0){if(C+=u-E,E<T){T-=E;do O[i++]=d[C++];while(--E);C=i-N,L=O}}else if(l<E){if(C+=u+l-E,E-=l,E<T){T-=E;do O[i++]=d[C++];while(--E);if(C=0,l<T){E=l,T-=E;do O[i++]=d[C++];while(--E);C=i-N,L=O}}}else if(C+=l-E,E<T){T-=E;do O[i++]=d[C++];while(--E);C=i-N,L=O}for(;T>2;)O[i++]=L[C++],O[i++]=L[C++],O[i++]=L[C++],T-=3;T&&(O[i++]=L[C++],T>1&&(O[i++]=L[C++]))}else{C=i-N;do O[i++]=O[C++],O[i++]=O[C++],O[i++]=O[C++],T-=3;while(T>2);T&&(O[i++]=O[C++],T>1&&(O[i++]=O[C++]))}break}}break}}while(e<r&&i<a);T=f>>3,e-=T,f-=T<<3,h&=(1<<f)-1,n.next_in=e,n.next_out=i,n.avail_in=e<r?r-e+5:5-(e-r),n.avail_out=i<a?a-i+257:257-(i-a),x.hold=h,x.bits=f};const Cl=15,Uw=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Lw=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Pw=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),xw=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var sc=(n,t,e,r,i,s,a,o)=>{const u=o.bits;let c,l,d,h,f,p,_=0,m=0,b=0,y=0,E=0,T=0,N=0,C=0,L=0,k=0,O=null;const x=new Uint16Array(16),Q=new Uint16Array(16);let we,Ie,ze,$t=null;for(_=0;_<=Cl;_++)x[_]=0;for(m=0;m<r;m++)x[t[e+m]]++;for(E=u,y=Cl;y>=1&&x[y]===0;y--);if(E>y&&(E=y),y===0)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(b=1;b<y&&x[b]===0;b++);for(E<b&&(E=b),C=1,_=1;_<=Cl;_++)if(C<<=1,C-=x[_],C<0)return-1;if(C>0&&(n===0||y!==1))return-1;for(Q[1]=0,_=1;_<Cl;_++)Q[_+1]=Q[_]+x[_];for(m=0;m<r;m++)t[e+m]!==0&&(a[Q[t[e+m]]++]=m);if(n===0?(O=$t=a,p=20):n===1?(O=Uw,$t=Lw,p=257):(O=Pw,$t=xw,p=0),k=0,m=0,_=b,f=s,T=E,N=0,d=-1,L=1<<E,h=L-1,n===1&&L>852||n===2&&L>592)return 1;for(;;){we=_-N,a[m]+1<p?(Ie=0,ze=a[m]):a[m]>=p?(Ie=$t[a[m]-p],ze=O[a[m]-p]):(Ie=96,ze=0),c=1<<_-N,l=1<<T,b=l;do l-=c,i[f+(k>>N)+l]=we<<24|Ie<<16|ze|0;while(l!==0);for(c=1<<_-1;k&c;)c>>=1;if(c!==0?(k&=c-1,k+=c):k=0,m++,--x[_]==0){if(_===y)break;_=t[e+a[m]]}if(_>E&&(k&h)!==d){for(N===0&&(N=E),f+=b,T=_-N,C=1<<T;T+N<y&&(C-=x[T+N],!(C<=0));)T++,C<<=1;if(L+=1<<T,n===1&&L>852||n===2&&L>592)return 1;d=k&h,i[d]=E<<24|T<<16|f-s|0}}return k!==0&&(i[f+k]=_-N<<24|64<<16|0),o.bits=E,0};const{Z_FINISH:Km,Z_BLOCK:Fw,Z_TREES:Nl,Z_OK:Ha,Z_STREAM_END:qw,Z_NEED_DICT:$w,Z_STREAM_ERROR:Pr,Z_DATA_ERROR:Qm,Z_MEM_ERROR:Wm,Z_BUF_ERROR:Hw,Z_DEFLATED:Ym}=To,ch=16180,Al=16190,us=16191,sf=16192,af=16194,kl=16199,Ol=16200,of=16206,Lt=16209,Zm=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function zw(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Wa=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<ch||t.mode>16211?1:0},ly=n=>{if(Wa(n))return Pr;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=1&t.wrap),t.mode=ch,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ha},dy=n=>{if(Wa(n))return Pr;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,ly(n)},hy=(n,t)=>{let e;if(Wa(n))return Pr;const r=n.state;return t<0?(e=0,t=-t):(e=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Pr:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=e,r.wbits=t,dy(n))},Jm=(n,t)=>{if(!n)return Pr;const e=new zw;n.state=e,e.strm=n,e.window=null,e.mode=ch;const r=hy(n,t);return r!==Ha&&(n.state=null),r};let uf,cf,Xm=!0;const Gw=n=>{if(Xm){uf=new Int32Array(512),cf=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(sc(1,n.lens,0,288,uf,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;sc(2,n.lens,0,32,cf,0,n.work,{bits:5}),Xm=!1}n.lencode=uf,n.lenbits=9,n.distcode=cf,n.distbits=5},ev=(n,t,e,r)=>{let i;const s=n.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(e-r,e-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(e-r,e),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var ys={inflateReset:dy,inflateReset2:hy,inflateResetKeep:ly,inflateInit:n=>Jm(n,15),inflateInit2:Jm,inflate:(n,t)=>{let e,r,i,s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k=0;const O=new Uint8Array(4);let x,Q;const we=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Wa(n)||!n.output||!n.input&&n.avail_in!==0)return Pr;e=n.state,e.mode===us&&(e.mode=sf),a=n.next_out,i=n.output,u=n.avail_out,s=n.next_in,r=n.input,o=n.avail_in,c=e.hold,l=e.bits,d=o,h=u,L=Ha;e:for(;;)switch(e.mode){case ch:if(e.wrap===0){e.mode=sf;break}for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(2&e.wrap&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,O[0]=255&c,O[1]=c>>>8&255,e.check=hn(e.check,O,2,0),c=0,l=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&c)<<8)+(c>>8))%31){n.msg="incorrect header check",e.mode=Lt;break}if((15&c)!==Ym){n.msg="unknown compression method",e.mode=Lt;break}if(c>>>=4,l-=4,C=8+(15&c),e.wbits===0&&(e.wbits=C),C>15||C>e.wbits){n.msg="invalid window size",e.mode=Lt;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=512&c?16189:us,c=0,l=0;break;case 16181:for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(e.flags=c,(255&e.flags)!==Ym){n.msg="unknown compression method",e.mode=Lt;break}if(57344&e.flags){n.msg="unknown header flags set",e.mode=Lt;break}e.head&&(e.head.text=c>>8&1),512&e.flags&&4&e.wrap&&(O[0]=255&c,O[1]=c>>>8&255,e.check=hn(e.check,O,2,0)),c=0,l=0,e.mode=16182;case 16182:for(;l<32;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.head&&(e.head.time=c),512&e.flags&&4&e.wrap&&(O[0]=255&c,O[1]=c>>>8&255,O[2]=c>>>16&255,O[3]=c>>>24&255,e.check=hn(e.check,O,4,0)),c=0,l=0,e.mode=16183;case 16183:for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.head&&(e.head.xflags=255&c,e.head.os=c>>8),512&e.flags&&4&e.wrap&&(O[0]=255&c,O[1]=c>>>8&255,e.check=hn(e.check,O,2,0)),c=0,l=0,e.mode=16184;case 16184:if(1024&e.flags){for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.length=c,e.head&&(e.head.extra_len=c),512&e.flags&&4&e.wrap&&(O[0]=255&c,O[1]=c>>>8&255,e.check=hn(e.check,O,2,0)),c=0,l=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(f=e.length,f>o&&(f=o),f&&(e.head&&(C=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(r.subarray(s,s+f),C)),512&e.flags&&4&e.wrap&&(e.check=hn(e.check,r,f,s)),o-=f,s+=f,e.length-=f),e.length))break e;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(o===0)break e;f=0;do C=r[s+f++],e.head&&C&&e.length<65536&&(e.head.name+=String.fromCharCode(C));while(C&&f<o);if(512&e.flags&&4&e.wrap&&(e.check=hn(e.check,r,f,s)),o-=f,s+=f,C)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(o===0)break e;f=0;do C=r[s+f++],e.head&&C&&e.length<65536&&(e.head.comment+=String.fromCharCode(C));while(C&&f<o);if(512&e.flags&&4&e.wrap&&(e.check=hn(e.check,r,f,s)),o-=f,s+=f,C)break e}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(4&e.wrap&&c!==(65535&e.check)){n.msg="header crc mismatch",e.mode=Lt;break}c=0,l=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=us;break;case 16189:for(;l<32;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}n.adler=e.check=Zm(c),c=0,l=0,e.mode=Al;case Al:if(e.havedict===0)return n.next_out=a,n.avail_out=u,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=l,$w;n.adler=e.check=1,e.mode=us;case us:if(t===Fw||t===Nl)break e;case sf:if(e.last){c>>>=7&l,l-=7&l,e.mode=of;break}for(;l<3;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}switch(e.last=1&c,c>>>=1,l-=1,3&c){case 0:e.mode=16193;break;case 1:if(Gw(e),e.mode=kl,t===Nl){c>>>=2,l-=2;break e}break;case 2:e.mode=16196;break;case 3:n.msg="invalid block type",e.mode=Lt}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){n.msg="invalid stored block lengths",e.mode=Lt;break}if(e.length=65535&c,c=0,l=0,e.mode=af,t===Nl)break e;case af:e.mode=16195;case 16195:if(f=e.length,f){if(f>o&&(f=o),f>u&&(f=u),f===0)break e;i.set(r.subarray(s,s+f),a),o-=f,s+=f,u-=f,a+=f,e.length-=f;break}e.mode=us;break;case 16196:for(;l<14;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(e.nlen=257+(31&c),c>>>=5,l-=5,e.ndist=1+(31&c),c>>>=5,l-=5,e.ncode=4+(15&c),c>>>=4,l-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=Lt;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;l<3;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.lens[we[e.have++]]=7&c,c>>>=3,l-=3}for(;e.have<19;)e.lens[we[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,x={bits:e.lenbits},L=sc(0,e.lens,0,19,e.lencode,0,e.work,x),e.lenbits=x.bits,L){n.msg="invalid code lengths set",e.mode=Lt;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;k=e.lencode[c&(1<<e.lenbits)-1],m=k>>>24,b=k>>>16&255,y=65535&k,!(m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(y<16)c>>>=m,l-=m,e.lens[e.have++]=y;else{if(y===16){for(Q=m+2;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(c>>>=m,l-=m,e.have===0){n.msg="invalid bit length repeat",e.mode=Lt;break}C=e.lens[e.have-1],f=3+(3&c),c>>>=2,l-=2}else if(y===17){for(Q=m+3;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}c>>>=m,l-=m,C=0,f=3+(7&c),c>>>=3,l-=3}else{for(Q=m+7;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}c>>>=m,l-=m,C=0,f=11+(127&c),c>>>=7,l-=7}if(e.have+f>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=Lt;break}for(;f--;)e.lens[e.have++]=C}}if(e.mode===Lt)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=Lt;break}if(e.lenbits=9,x={bits:e.lenbits},L=sc(1,e.lens,0,e.nlen,e.lencode,0,e.work,x),e.lenbits=x.bits,L){n.msg="invalid literal/lengths set",e.mode=Lt;break}if(e.distbits=6,e.distcode=e.distdyn,x={bits:e.distbits},L=sc(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,x),e.distbits=x.bits,L){n.msg="invalid distances set",e.mode=Lt;break}if(e.mode=kl,t===Nl)break e;case kl:e.mode=Ol;case Ol:if(o>=6&&u>=258){n.next_out=a,n.avail_out=u,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=l,Rw(n,h),a=n.next_out,i=n.output,u=n.avail_out,s=n.next_in,r=n.input,o=n.avail_in,c=e.hold,l=e.bits,e.mode===us&&(e.back=-1);break}for(e.back=0;k=e.lencode[c&(1<<e.lenbits)-1],m=k>>>24,b=k>>>16&255,y=65535&k,!(m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(b&&!(240&b)){for(E=m,T=b,N=y;k=e.lencode[N+((c&(1<<E+T)-1)>>E)],m=k>>>24,b=k>>>16&255,y=65535&k,!(E+m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}c>>>=E,l-=E,e.back+=E}if(c>>>=m,l-=m,e.back+=m,e.length=y,b===0){e.mode=16205;break}if(32&b){e.back=-1,e.mode=us;break}if(64&b){n.msg="invalid literal/length code",e.mode=Lt;break}e.extra=15&b,e.mode=16201;case 16201:if(e.extra){for(Q=e.extra;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;k=e.distcode[c&(1<<e.distbits)-1],m=k>>>24,b=k>>>16&255,y=65535&k,!(m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(!(240&b)){for(E=m,T=b,N=y;k=e.distcode[N+((c&(1<<E+T)-1)>>E)],m=k>>>24,b=k>>>16&255,y=65535&k,!(E+m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}c>>>=E,l-=E,e.back+=E}if(c>>>=m,l-=m,e.back+=m,64&b){n.msg="invalid distance code",e.mode=Lt;break}e.offset=y,e.extra=15&b,e.mode=16203;case 16203:if(e.extra){for(Q=e.extra;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=Lt;break}e.mode=16204;case 16204:if(u===0)break e;if(f=h-u,e.offset>f){if(f=e.offset-f,f>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=Lt;break}f>e.wnext?(f-=e.wnext,p=e.wsize-f):p=e.wnext-f,f>e.length&&(f=e.length),_=e.window}else _=i,p=a-e.offset,f=e.length;f>u&&(f=u),u-=f,e.length-=f;do i[a++]=_[p++];while(--f);e.length===0&&(e.mode=Ol);break;case 16205:if(u===0)break e;i[a++]=e.length,u--,e.mode=Ol;break;case of:if(e.wrap){for(;l<32;){if(o===0)break e;o--,c|=r[s++]<<l,l+=8}if(h-=u,n.total_out+=h,e.total+=h,4&e.wrap&&h&&(n.adler=e.check=e.flags?hn(e.check,i,h,a-h):nc(e.check,i,h,a-h)),h=u,4&e.wrap&&(e.flags?c:Zm(c))!==e.check){n.msg="incorrect data check",e.mode=Lt;break}c=0,l=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;l<32;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(4&e.wrap&&c!==(4294967295&e.total)){n.msg="incorrect length check",e.mode=Lt;break}c=0,l=0}e.mode=16208;case 16208:L=qw;break e;case Lt:L=Qm;break e;case 16210:return Wm;default:return Pr}return n.next_out=a,n.avail_out=u,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=l,(e.wsize||h!==n.avail_out&&e.mode<Lt&&(e.mode<of||t!==Km))&&ev(n,n.output,n.next_out,h-n.avail_out),d-=n.avail_in,h-=n.avail_out,n.total_in+=d,n.total_out+=h,e.total+=h,4&e.wrap&&h&&(n.adler=e.check=e.flags?hn(e.check,i,h,n.next_out-h):nc(e.check,i,h,n.next_out-h)),n.data_type=e.bits+(e.last?64:0)+(e.mode===us?128:0)+(e.mode===kl||e.mode===af?256:0),(d===0&&h===0||t===Km)&&L===Ha&&(L=Hw),L},inflateEnd:n=>{if(Wa(n))return Pr;let t=n.state;return t.window&&(t.window=null),n.state=null,Ha},inflateGetHeader:(n,t)=>{if(Wa(n))return Pr;const e=n.state;return 2&e.wrap?(e.head=t,t.done=!1,Ha):Pr},inflateSetDictionary:(n,t)=>{const e=t.length;let r,i,s;return Wa(n)?Pr:(r=n.state,r.wrap!==0&&r.mode!==Al?Pr:r.mode===Al&&(i=1,i=nc(i,t,e,0),i!==r.check)?Qm:(s=ev(n,t,e,e),s?(r.mode=16210,Wm):(r.havedict=1,Ha)))},inflateInfo:"pako inflate (from Nodeca project)"},Vw=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const fy=Object.prototype.toString,{Z_NO_FLUSH:Bw,Z_FINISH:jw,Z_OK:ac,Z_STREAM_END:lf,Z_NEED_DICT:df,Z_STREAM_ERROR:Kw,Z_DATA_ERROR:tv,Z_MEM_ERROR:Qw}=To;function oc(n){this.options=uh.assign({chunkSize:65536,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||n&&n.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new uy,this.strm.avail_out=0;let e=ys.inflateInit2(this.strm,t.windowBits);if(e!==ac)throw new Error(po[e]);if(this.header=new Vw,ys.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=xc.string2buf(t.dictionary):fy.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=ys.inflateSetDictionary(this.strm,t.dictionary),e!==ac)))throw new Error(po[e])}function hf(n,t){const e=new oc(t);if(e.push(n),e.err)throw e.msg||po[e.err];return e.result}oc.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(a=t===~~t?t:t===!0?jw:Bw,fy.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),s=ys.inflate(e,a),s===df&&i&&(s=ys.inflateSetDictionary(e,i),s===ac?s=ys.inflate(e,a):s===tv&&(s=df));e.avail_in>0&&s===lf&&e.state.wrap>0&&n[e.next_in]!==0;)ys.inflateReset(e),s=ys.inflate(e,a);switch(s){case Kw:case tv:case df:case Qw:return this.onEnd(s),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||s===lf))if(this.options.to==="string"){let u=xc.utf8border(e.output,e.next_out),c=e.next_out-u,l=xc.buf2string(e.output,u);e.next_out=c,e.avail_out=r-c,c&&e.output.set(e.output.subarray(u,u+c),0),this.onData(l)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(s!==ac||o!==0){if(s===lf)return s=ys.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},oc.prototype.onData=function(n){this.chunks.push(n)},oc.prototype.onEnd=function(n){n===ac&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=uh.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var Ww={Inflate:oc,inflate:hf,inflateRaw:function(n,t){return(t=t||{}).raw=!0,hf(n,t)},ungzip:hf,constants:To};const{Deflate:Yw,deflate:Zw,deflateRaw:Jw,gzip:Xw}=Dw,{Inflate:eI,inflate:tI,inflateRaw:nI,ungzip:rI}=Ww;var Li,iI={Deflate:Yw,deflate:Zw,deflateRaw:Jw,gzip:Xw,Inflate:eI,inflate:tI,inflateRaw:nI,ungzip:rI,constants:To},nv=function(n){return g(void 0,void 0,void 0,function(){var t;return v(this,function(e){return t=iI.ungzip(n),[2,String.fromCharCode.apply(null,t)]})})};(function(n){n.CONNECTING="CONNECTING",n.OPEN="OPEN",n.CLOSED="CLOSED"})(Li||(Li={}));var qe,sI=function(n){function t(e,r){var i=r.sdkState,s=r.dispatcher,a=r.logger,o=n.call(this)||this;return o.lastActive=0,o._iid=e,o._sdkState=i,o._dispatcher=s,o._logger=a,o}return w(t,n),Object.defineProperty(t.prototype,"isOpen",{get:function(){return this.connectionState===Li.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return Li.CONNECTING;case 1:return Li.OPEN}return Li.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ws",{get:function(){var e;return(e=this._ws)!==null&&e!==void 0?e:null},enumerable:!1,configurable:!0}),t.prototype._handleMessage=function(e){var r=this;e.split(`
`).forEach(function(i){if(i){var s=it.createFromRawMessage(r._iid,i);if(r._logger.debug("receive websocket event",s),s.code==="LOGI")r.dispatch("message",s);else if(s.code==="PONG")r.dispatch("pong");else if(s.code==="EXPR"){if(s.payload){var a=new ru(s.payload);a.expiresIn>=0&&r._dispatcher.dispatch(a)}}else s.code==="NOOP"||r.dispatch("message",s)}})},t.prototype.connect=function(e,r){var i=this;r===void 0&&(r=""),this._ws=new WebSocket(e,encodeURIComponent(r)),this._ws.onopen=function(){i._logger.debug("websocket open"),i.dispatch("open")},this._ws.onmessage=function(s){return g(i,void 0,void 0,function(){var a,o,u,c,l=this;return v(this,function(d){switch(d.label){case 0:return!((c=this._sdkState.websocket)===null||c===void 0)&&c.compression?s.data instanceof Blob?((a=new FileReader).readAsArrayBuffer(s.data),a.onloadend=function(){return g(l,void 0,void 0,function(){var h,f;return v(this,function(p){switch(p.label){case 0:return p.trys.push([0,2,,3]),[4,nv(a.result)];case 1:return h=p.sent(),this._handleMessage(h),[3,3];case 2:return f=p.sent(),this.error(f),[3,3];case 3:return[2]}})})},[3,7]):[3,1]:[3,8];case 1:if(!(s.data instanceof ArrayBuffer))return[3,6];d.label=2;case 2:return d.trys.push([2,4,,5]),[4,nv(new Uint8Array(s.data))];case 3:return o=d.sent(),this._handleMessage(o),[3,5];case 4:return u=d.sent(),this.error(u),[3,5];case 5:return[3,7];case 6:typeof s.data=="string"&&this._handleMessage(s.data),d.label=7;case 7:return[3,9];case 8:this._handleMessage(s.data),d.label=9;case 9:return[2]}})})},this._ws.onerror=function(){i._logger.debug("websocket error"),i.dispatch("error",U.networkError)},this._ws.onclose=function(){i._logger.debug("websocket close"),i.dispatch("close")},this.lastActive=Date.now()},t.prototype.disconnect=function(){var e=this;return new Promise(function(r){e._logger.debug("websocket disconnect"),e._ws?(e._ws.onopen=Se,e._ws.onmessage=Se,e._ws.onerror=Se,e.connectionState!==Li.CLOSED?(e._ws.onclose=function(){e.dispatch("close"),r()},e._ws.close(),e._ws=void 0):r()):r()})},t.prototype.send=function(e){if(!this._ws)throw U.connectionClosed;e.code!=="PING"?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},t.prototype.error=function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)},t}(bo),py=function(n){function t(e){var r=e.all,i=e.feed,s=e.custom_types,a=e.ts,o=n.call(this)||this;return o.all=r,o.feed=i,o.customTypes=s,o.ts=a,o}return w(t,n),t}(rt),aI=function(){function n(t,e){var r=e.session,i=e.sdkState,s=e.dispatcher,a=e.logger,o=e.useFetchCompat,u=o!==void 0&&o,c=this;this._ackStateMap=new Map,this._sdkState=i,this._dispatcher=s,this._logger=a,this.apiClient=new iw(t,{session:r,sdkState:i,dispatcher:s,logger:a,useFetchCompat:u}),this.websocketClient=new sI(t,{sdkState:i,dispatcher:s,logger:a}),this.websocketClient.on("message",function(l){if(l.payload.unread_cnt&&c._dispatcher.dispatch(new py(l.payload.unread_cnt)),l.requestId){if(c._ackStateMap.has(l.requestId)){var d=c._ackStateMap.get(l.requestId);l.code!=="EROR"?d.resolve(l):d.reject(new U({code:l.payload.code,message:l.payload.message}))}}else c._dispatcher.dispatch(l)}).on("close",function(){c._ackStateMap.forEach(function(l){l.reject(U.connectionClosed)}),c._ackStateMap.clear()})}return n.prototype._sendApiRequest=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(t)];case 1:return[2,e.sent()]}})})},n.prototype._sendWebsocketRequest=function(t){return g(this,void 0,void 0,function(){var e,r,i,s=this;return v(this,function(a){if(!this._sdkState.websocket)throw U.connectionRequired;if(e=new Fn,t.ackRequired){i=function(o,u){s._ackStateMap.has(t.requestId)&&(s._ackStateMap.delete(t.requestId),r&&(clearTimeout(r),r=null),o?(s._logger.debug("fail websocket request",t.requestId,o),e.reject(o)):(s._logger.debug("receive websocket ack",t.requestId,t),s._logger.debug("receive websocket ack",u),e.resolve(u)))};try{r=setTimeout(function(){return i(U.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(t.requestId,{resolve:function(o){return i(void 0,o)},reject:function(o){return i(o)}}),this.websocketClient.send(t)}catch(o){i(o)}}else try{this.websocketClient.send(t),e.resolve()}catch(o){e.reject(o)}return[2,e.promise]})})},n.prototype.send=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return t instanceof K?[4,this._sendApiRequest(t)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return t instanceof Yn?[4,this._sendWebsocketRequest(t)]:[3,4];case 4:throw U.invalidParameters}})})},n.prototype.cancel=function(t){this.apiClient.cancel(t)},n.prototype.cancelAll=function(){this.apiClient.cancelAll()},n}();(function(n){n[n.NONE=0]="NONE",n[n.INITIALIZED=1]="INITIALIZED",n[n.CONNECTING=2]="CONNECTING",n[n.CONNECTED=3]="CONNECTED",n[n.RECONNECTING=4]="RECONNECTING",n[n.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",n[n.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",n[n.LOGOUT=7]="LOGOUT"})(qe||(qe={}));var Ar=function(n){function t(e){var r=e.stateType,i=n.call(this)||this;return i.stateType=r,i}return w(t,n),t}(rt),_y=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(rt),vp=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(rt),my=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(rt),rv=function(){function n(t){var e,r,i,s;this.isEnabled=(e=t.enabled)!==null&&e!==void 0&&e,this.feedChannels=(r=t.feed_channels)!==null&&r!==void 0?r:{},this.templateListToken=(i=t.template_list_token)!==null&&i!==void 0?i:null,this.settingsUpdatedAt=(s=t.settings_updated_at)!==null&&s!==void 0?s:0}return n.payloadify=function(t){return re(oe({enabled:t.isEnabled,feed_channels:t.feedChannels,template_list_token:t.templateListToken,settings_updated_at:t.settingsUpdatedAt}))},n}(),I_=function(n){return"sendbird@".concat(n,"/changelog_include_chat_notifications")},iv=function(){function n(t){var e;this.lastUpdatedAt=(e=t.last_updated_at)!==null&&e!==void 0?e:0}return n.payloadify=function(t){return re(oe({last_updated_at:t.lastUpdatedAt}))},n}(),sv=1048576,oI=5,av=function(){function n(t){var e,r,i,s,a;t===void 0&&(t={}),this.emojiHash=t.emoji_hash||"",this.uploadSizeLimit=t.file_upload_size_limit?t.file_upload_size_limit*sv:Number.MAX_SAFE_INTEGER,this.useReaction=!!t.use_reaction,this.applicationAttributes=(e=t.application_attributes)!==null&&e!==void 0?e:[],this.premiumFeatureList=(r=t.premium_feature_list)!==null&&r!==void 0?r:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=(i=t.multiple_file_send_max_size)!==null&&i!==void 0?i:5,this.allowSdkStatsUpload=(s=t.allow_sdk_log_ingestion)===null||s===void 0||s,this.uikitConfigInfo=new iv((a=t.uikit_config)!==null&&a!==void 0?a:{}),this.notificationInfo=t.notifications?new rv(t.notifications):null}return n.payloadify=function(t){return re(oe({emoji_hash:t.emojiHash,file_upload_size_limit:t.uploadSizeLimit/sv,application_attributes:t.applicationAttributes,premium_feature_list:t.premiumFeatureList,use_reaction:t.useReaction,allow_sdk_log_ingestion:t.allowSdkStatsUpload,uikit_config:t.uikitConfigInfo?iv.payloadify(t.uikitConfigInfo):null,notifications:t.notificationInfo?rv.payloadify(t.notificationInfo):null}))},n}(),yn=function(){function n(t){this._iid="",this._iid=t}return n.payloadify=function(t){return{}},n}(),uI=function(n){function t(e){var r=e.userId,i=e.metadata,s=n.call(this)||this;return s.method=j.POST,s.path="".concat(Ue,"/").concat(r,"/metadata"),s.params={metadata:i},s}return w(t,n),t}(K),cI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaData=r,i}return w(t,n),t}(W),lI=function(n){function t(e){var r=e.userId,i=e.metadata,s=e.upsert,a=n.call(this)||this;return a.method=j.PUT,a.path="".concat(Ue,"/").concat(r,"/metadata"),a.params={metadata:i,upsert:s},a}return w(t,n),t}(K),dI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metadata=r,i}return w(t,n),t}(W),hI=function(n){function t(e){var r=e.userId,i=e.metadataKey,s=n.call(this)||this;return s.method=j.DELETE,s.path="".concat(Ue,"/").concat(r,"/metadata/").concat(i),s}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var fI=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.DELETE,i.path="".concat(Ue,"/").concat(r,"/metadata"),i}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var Go,Xc=function(n,t){var e=JSON.parse(JSON.stringify(n));return e._iid&&delete e._iid,t&&t(e),e},ro=function(n,t){var e=JSON.parse(JSON.stringify(n));return t&&t(e),e},B=function(n){return{do:function(t){n||t()},throw:function(t){if(!n)throw t}}};(function(n){n.ONLINE="online",n.OFFLINE="offline",n.NON_AVAILABLE="nonavailable"})(Go||(Go={}));var iu,Oe=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m=this;return(m=n.call(this,e)||this).userId=(s=(i=r.guest_id)!==null&&i!==void 0?i:r.user_id)!==null&&s!==void 0?s:"",m.nickname=(o=(a=r.nickname)!==null&&a!==void 0?a:r.name)!==null&&o!==void 0?o:"",m.plainProfileUrl=(c=(u=r.profile_url)!==null&&u!==void 0?u:r.image)!==null&&c!==void 0?c:"",m.requireAuth=(l=r.require_auth_for_profile_image)!==null&&l!==void 0&&l,m.metaData=(d=r.metadata)!==null&&d!==void 0?d:{},m.connectionStatus=Go.NON_AVAILABLE,be(Go,r.is_online)?m.connectionStatus=r.is_online:R("boolean",r.is_online)&&(m.connectionStatus=r.is_online?Go.ONLINE:Go.OFFLINE),m.isActive=(h=r.is_active)===null||h===void 0||h,m.lastSeenAt=(f=r.last_seen_at)!==null&&f!==void 0?f:null,m.preferredLanguages=r.preferred_languages?ce([],ie(r.preferred_languages),!1):null,m.friendDiscoveryKey=(p=r.friend_discovery_key)!==null&&p!==void 0?p:null,m.friendName=(_=r.friend_name)!==null&&_!==void 0?_:null,m}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})))},Object.defineProperty(t.prototype,"profileUrl",{get:function(){var e=M.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),t.prototype.serialize=function(){return Xc(this)},t.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map(function(r){return e[r]}).every(function(r){return R("string",r)})},t.prototype._applyMetaData=function(e,r){var i=this;r===void 0&&(r=!1),Object.keys(e).forEach(function(s){r?delete i.metaData[s]:i.metaData[s]=e[s]})},t.prototype.createMetaData=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return B(this._isValidMetaData(e)).throw(U.invalidParameters),r=M.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new uI({userId:i.userId,metadata:e}),[4,s.send(a)];case 1:return o=c.sent(),u=o.as(cI).metaData,this._applyMetaData(u),[2,this.metaData]}})})},t.prototype.updateMetaData=function(e,r){return r===void 0&&(r=!1),g(this,void 0,void 0,function(){var i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return B(this._isValidMetaData(e)).throw(U.invalidParameters),i=M.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new lI({userId:s.userId,metadata:e,upsert:r}),[4,a.send(o)];case 1:return u=l.sent(),c=u.as(dI).metadata,this._applyMetaData(c),[2,this.metaData]}})})},t.prototype.deleteMetaData=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return B(R("string",e)).throw(U.invalidParameters),r=M.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new hI({userId:i.userId,metadataKey:e}),[4,s.send(a)];case 1:return u.sent(),this._applyMetaData(((o={})[e]=!0,o),!0),[2,this.metaData]}})})},t.prototype.deleteAllMetaData=function(){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new fI({userId:r.userId}),[4,i.send(s)];case 1:return a.sent(),this.metaData={},[2]}})})},t}(yn),vy=function(n){function t(e){var r=e.userProfile,i=n.call(this)||this;return i.userProfile=r,i}return w(t,n),t}(rt),gp=function(){function n(t,e){var r,i,s,a,o,u,c,l,d,h,f,p,_,m;this._iid=t,this.appInfo=new av(e),this.user=new Oe(t,e),this.connectedAt=(r=e.login_ts)!==null&&r!==void 0?r:0,this.firstConnectedAt=0,this.pingInterval=(i=e.ping_interval)!==null&&i!==void 0?i:15e3,this.pongTimeout=(s=e.pong_timeout)!==null&&s!==void 0?s:5e3,this.reconnectInterval=(o=(a=e.reconnect)===null||a===void 0?void 0:a.interval)!==null&&o!==void 0?o:3e3,this.reconnectMaxInterval=(c=(u=e.reconnect)===null||u===void 0?void 0:u.max_interval)!==null&&c!==void 0?c:6e4,this.reconnectRetryCount=(d=(l=e.reconnect)===null||l===void 0?void 0:l.retry_cnt)!==null&&d!==void 0?d:5,this.reconnectIntervalMultiple=(f=(h=e.reconnect)===null||h===void 0?void 0:h.mul)!==null&&f!==void 0?f:2,this.maxUnreadCountOnSuperGroup=(p=e.max_unread_cnt_on_super_group)!==null&&p!==void 0?p:100,this.profileImageEncryption=!!e.profile_image_encryption,this.concurrentCallLimit=(_=e.concurrent_call_limit)!==null&&_!==void 0?_:5,this.backOffDelay=(m=e.back_off_delay)!==null&&m!==void 0?m:100}return n.payloadify=function(t){return re(oe(A(A(A({},Oe.payloadify(t.user)),av.payloadify(t.appInfo)),{login_ts:t.connectedAt,ping_interval:t.pingInterval,pong_timeout:t.pongTimeout,reconnect:{interval:t.reconnectInterval,max_interval:t.reconnectMaxInterval,retry_cnt:t.reconnectRetryCount,mul:t.reconnectIntervalMultiple},max_unread_cnt_on_super_group:t.maxUnreadCountOnSuperGroup,profile_image_encryption:t.profileImageEncryption,concurrent_call_limit:t.concurrentCallLimit,back_off_delay:t.backOffDelay})))},n.prototype.apply=function(){var t=this.reconnectInterval,e=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,i=M.of(this._iid);i.sdkState.websocket&&(i.sdkState.websocket.pingInterval=1e3*this.pingInterval,i.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,i.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,i.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(s){return s>0?1e3*Math.min(t*Math.pow(r,s-1),e):10}}),i.appInfo=this.appInfo,i.sessionManager.currentUser=this.user,i.connectedAt=this.connectedAt,this.firstConnectedAt||(i.firstConnectedAt=this.connectedAt),i.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,i.concurrentCallLimit=this.concurrentCallLimit,i.backOffDelay=this.backOffDelay,i.dispatcher.dispatch(new vy({userProfile:this}))},n}(),gy=function(n){function t(e){var r=e.request,i=r===void 0||r,s=e.features,a=s===void 0?{}:s,o=e.options,u=o===void 0?{}:o,c=n.call(this)||this;return c.request=i,c.features=A({localCache:!0,notification:!0},a),c.options=A({ingestion:!0},u),c}return w(t,n),t}(rt),ld=function(n){function t(e,r,i){var s,a,o,u,c=this;return(c=n.call(this,e,r,i)||this).error=null,c.services=[],c.userProfile=new gp(e,i),c.deviceTokenLastDeletedAt=(s=i.device_token_last_deleted_at)!==null&&s!==void 0?s:0,c.key=(a=i.key)!==null&&a!==void 0?a:"",c.ekey=(o=i.ekey)!==null&&o!==void 0?o:"",c.error=i.error?new U(i):null,c.services=(u=i.services)!==null&&u!==void 0?u:[],c}return w(t,n),t.asError=function(e){return new t("","LOGI",A({user_id:"",error:!0},e))},t.prototype.applyTo=function(e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return this.error?[3,4]:(r=M.of(e))?(i=r.sessionManager,s=r.dispatcher,[4,i.login(this)]):[3,2];case 1:return a.sent(),this.userProfile.apply(),s.dispatch(new gy({request:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish"),notification:this.userProfile.appInfo.applicationAttributes.includes("allow_sdk_noti_stats_log_publish")},options:{ingestion:this.userProfile.appInfo.allowSdkStatsUpload}})),[3,3];case 2:throw U.lostInstance;case 3:return[3,5];case 4:throw this.error;case 5:return[2]}})})},t}(it),wo=function(){function n(){this.type=qe.NONE,this.name="none"}return n.prototype.run=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return[2]})})},n.prototype.onConnect=function(t,e){return g(this,void 0,void 0,function(){return v(this,function(r){return[2]})})},n.prototype.onReconnect=function(t,e){return e.resetReconnectCount,g(this,void 0,void 0,function(){return v(this,function(r){return[2]})})},n.prototype.onDisconnect=function(t,e){return e.error,e.autoReconnect,e.cause,g(this,void 0,void 0,function(){return v(this,function(r){return[2]})})},n.prototype.onDisconnectWebSocket=function(t,e){return g(this,void 0,void 0,function(){return v(this,function(r){return[2]})})},n.prototype.onLogout=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return[2]})})},n}(),le=function(n){return g(void 0,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:if(!((t=e.sent())instanceof U))throw t;return t.throwOutside(),[3,3];case 3:return[2]}})})},Tt=function(n){return g(void 0,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}})})},da=function(n){function t(e){e===void 0&&(e={});var r,i=this;return(i=n.call(this)||this).type=qe.LOGOUT,i.name="logout",i._wasPreviouslyConnected=(r=e.wasPreviouslyConnected)===null||r===void 0||r,i}return w(t,n),t.prototype.run=function(e){return g(this,void 0,void 0,function(){var r,i,s=this;return v(this,function(a){switch(a.label){case 0:return r=Date.now(),i=e.sdkState.userId,[4,e.logout()];case 1:return a.sent(),[4,e.changeState(new S_,r)];case 2:return a.sent(),this._wasPreviouslyConnected&&le(function(){return g(s,void 0,void 0,function(){return v(this,function(o){return e.connectionHandlers.forEach(function(u){u.onDisconnected&&u.onDisconnected(i)}),[2]})})}),[2]}})})},t}(wo),lh=function(n){function t(){var e=n.call(this)||this;return e.type=qe.EXTERNAL_DISCONNECTED,e.name="externaldisconnected",e}return w(t,n),t.prototype.run=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,e.disconnect()];case 1:return r.sent(),[2]}})})},t.prototype.onConnect=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.disconnect()];case 1:return s.sent(),[4,e.changeState(new hh({authToken:r}),i)];case 2:return s.sent(),[2]}})})},t.prototype.onReconnect=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new Ld,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new da,r)];case 1:return i.sent(),[2]}})})},t}(wo),Ud=function(n){function t(e){var r=e.autoReconnect,i=n.call(this)||this;return i.type=qe.INTERNAL_DISCONNECTED,i.name="internaldisconnected",i._autoReconnect=!1,i._autoReconnect=r,i}return w(t,n),t.prototype.run=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.disconnect()];case 1:return i.sent(),this._autoReconnect?[4,e.changeState(new Ld,r)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.onConnect=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.disconnect()];case 1:return s.sent(),[4,e.changeState(new hh({authToken:r}),i)];case 2:return s.sent(),[2]}})})},t.prototype.onReconnect=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new Ld,r)];case 1:return i.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new lh,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new da,r)];case 1:return i.sent(),[2]}})})},t}(wo),mr=function(n){return g(void 0,void 0,void 0,function(){return v(this,function(t){return[2,new Promise(function(e){return setTimeout(e,n)})]})})},yy=function(){function n(){}return n.prototype.calcTimeout=function(){return 0},n}(),dh=function(n,t,e){return e===void 0&&(e=new yy),g(void 0,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:r=0,i=null,s=function(l){return i=l??new Error("Halted")},a=function(){r=0},c.label=1;case 1:if(!(t===-1||r<t))return[3,9];c.label=2;case 2:return c.trys.push([2,4,,8]),[4,n(s,a)];case 3:if(o=c.sent(),i)throw i;return[2,o];case 4:if(u=c.sent(),i)return[3,6];if(++r===t)throw u;return[4,mr(e.calcTimeout(r))];case 5:return c.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return[3,1];case 9:throw"It should not happen."}})})},Ld=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=qe.RECONNECTING,e.name="reconnecting",e._callbacks=[],e}return w(t,n),t.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},t.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach(function(r){return r(e)})},t.prototype.run=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c=this;return v(this,function(l){switch(l.label){case 0:r=Date.now(),i=new Fn,this._callbacks.push(function(d){return d?i.reject(d):i.resolve()}),le(function(){return g(c,void 0,void 0,function(){return v(this,function(d){return e.connectionHandlers.forEach(function(h){h.onReconnectStarted&&h.onReconnectStarted()}),[2]})})}),l.label=1;case 1:return l.trys.push([1,4,,9]),s=e.sdkState.websocket,a=s.reconnectMaxRetry,o=s.reconnectRetryStrategy,[4,dh(function(d,h){return g(c,void 0,void 0,function(){var f;return v(this,function(p){switch(p.label){case 0:this._haltConnect=d,this._resetConnect=h,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,e.connect()];case 2:return p.sent(),[3,4];case 3:if(f=p.sent(),e.clearLoginTimer(),f instanceof U){if(f.code===ae.CONNECTION_CANCELED)return d(f),[2];if(f.isSessionExpiredError||f.isSessionInvalidatedError)return d(f),[2]}throw f;case 4:return[2]}})})},a,o)];case 2:return l.sent(),[4,e.changeState(new Ey,r)];case 3:return l.sent(),this._flushCallbacks(),le(function(){return g(c,void 0,void 0,function(){return v(this,function(d){return e.connectionHandlers.forEach(function(h){h.onReconnectSucceeded&&h.onReconnectSucceeded()}),[2]})})}),[3,9];case 4:return u=l.sent(),ar(u)?[3,7]:u instanceof U?u.code===ae.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Ud({autoReconnect:!1}),r)]:[3,6];case 5:l.sent(),l.label=6;case 6:return this._flushCallbacks(u),le(function(){return g(c,void 0,void 0,function(){return v(this,function(d){return e.connectionHandlers.forEach(function(h){h.onReconnectFailed&&h.onReconnectFailed()}),[2]})})}),[3,8];case 7:throw u;case 8:return[3,9];case 9:return[2,i.promise]}})})},t.prototype.onConnect=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){return i=new Fn,this._halt(U.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push(function(){var a=Date.now();e.changeState(new hh({authToken:r}),a).then(function(){i.resolve()}).catch(function(o){i.reject(o)})}),[2,i.promise]})})},t.prototype.onReconnect=function(e,r){var i=r.resetReconnectCount,s=i!==void 0&&i;return g(this,void 0,void 0,function(){var a;return v(this,function(o){return a=new Fn,this._resetConnect&&s&&this._resetConnect(),this._callbacks.push(function(u){return u?a.reject(u):a.resolve()}),[2,a.promise]})})},t.prototype.onDisconnect=function(e,r){r.error;var i=r.autoReconnect,s=i===void 0||i;return g(this,void 0,void 0,function(){var a;return v(this,function(o){switch(o.label){case 0:return a=Date.now(),this._halt(U.connectionCanceled),[4,e.changeState(new Ud({autoReconnect:s}),a)];case 1:return o.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(U.connectionCanceled),[4,e.changeState(new lh,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(U.connectionCanceled),[4,e.changeState(new da,r)];case 1:return i.sent(),[2]}})})},t}(wo),Ey=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=qe.CONNECTED,e.name="connected",e}return w(t,n),t.prototype.onReconnect=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.disconnect()];case 1:return i.sent(),[4,e.changeState(new Ld,r)];case 2:return i.sent(),[2]}})})},t.prototype.onDisconnect=function(e,r){var i=r.autoReconnect;return g(this,void 0,void 0,function(){var s;return v(this,function(a){switch(a.label){case 0:return s=Date.now(),[4,e.changeState(new Ud({autoReconnect:i}),s)];case 1:return a.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new lh,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new da,r)];case 1:return i.sent(),[2]}})})},t}(wo);(function(n){n.ExternalSetBackground="ExternalSetBackground",n.ExternalDisconnectWebSocket="ExternalDisconnectWebSocket"})(iu||(iu={}));var pI=function(){function n(t,e){var r=e.sdkState,i=e.cacheContext,s=e.connectionHandlers,a=e.sessionManager,o=e.websocketClient,u=e.dispatcher,c=e.logger,l=e.disableWebSocketCloseEventHandling,d=l!==void 0&&l;this._disableWebSocketCloseEventHandling=!1,this._webSocketClosedCause=null,this._logger=c,this._disableWebSocketCloseEventHandling=d,this._context=new vI(t,{sdkState:r,cacheContext:i,connectionHandlers:s,sessionManager:a,websocketClient:o,dispatcher:u,logger:c}),this._sdkState=r,this._sessionManager=a,this._websocketClient=o}return n.prototype._registerEventDispatcher=function(){var t=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh",function(){t.isConnecting||t.isConnected||(t._logger.debug("try reconnect by session key refresh"),Tt(function(){return g(t,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this.reconnect()];case 1:return e.sent(),[2]}})})}))}),this._websocketEventDispatcherContext=this._websocketClient.on("close",function(){t._sdkState.appState!=="foreground"||t._webSocketClosedCause||Tt(function(){return g(t,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this._sessionManager.isSessionKeyRefreshing?[3,2]:(this._logger.debug("try reconnect by websocket connection closed"),[4,this.reconnect()]);case 1:return e.sent(),[3,4];case 2:return[4,this.disconnectWebSocket()];case 3:e.sent(),e.label=4;case 4:return[2]}})})})}))},n.prototype._clearEventDispatcher=function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)},Object.defineProperty(n.prototype,"isConnected",{get:function(){return this._context.currentState.type===qe.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isConnecting",{get:function(){var t=this._context.currentState;return t.type===qe.CONNECTING||t.type===qe.RECONNECTING},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"websocketClient",{get:function(){return this._websocketClient},enumerable:!1,configurable:!0}),n.prototype.connect=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return e=this._context.currentState,this._webSocketClosedCause=null,[4,e.onConnect(this._context,t)];case 1:return r.sent(),this._registerEventDispatcher(),[2]}})})},n.prototype.reconnect=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._webSocketClosedCause=null,[4,t.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},n.prototype.resetAndReconnect=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._webSocketClosedCause=null,[4,t.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},n.prototype.background=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._webSocketClosedCause=iu.ExternalSetBackground,[4,t.onDisconnect(this._context,{autoReconnect:!1,cause:this._webSocketClosedCause})];case 1:return e.sent(),[2]}})})},n.prototype.disconnect=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:t,autoReconnect:!0,cause:this._webSocketClosedCause})];case 1:return e.sent(),[2]}})})},n.prototype.disconnectWebSocket=function(t){return t===void 0&&(t=!1),g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return e=this._context.currentState,t&&(this._webSocketClosedCause=iu.ExternalDisconnectWebSocket),[4,e.onDisconnectWebSocket(this._context,{cause:this._webSocketClosedCause})];case 1:return r.sent(),[2]}})})},n.prototype.logout=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._clearEventDispatcher(),[4,t.onLogout(this._context)];case 1:return e.sent(),[2]}})})},n}(),hh=function(n){function t(e){var r=e.authToken,i=n.call(this)||this;return i.type=qe.CONNECTING,i.name="connecting",i._authToken="",i._callbacks=[],i._authToken=r,i}return w(t,n),t.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},t.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._callbacks.forEach(function(r){return r(e)})},t.prototype.run=function(e){return g(this,void 0,void 0,function(){var r,i,s,a=this;return v(this,function(o){switch(o.label){case 0:r=Date.now(),i=new Fn,this._callbacks.push(function(u){return u?i.reject(u):i.resolve()}),o.label=1;case 1:return o.trys.push([1,4,,10]),[4,dh(function(u){return g(a,void 0,void 0,function(){var c;return v(this,function(l){switch(l.label){case 0:this._haltConnect=u,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return l.sent(),[3,4];case 3:if(c=l.sent(),e.clearLoginTimer(),c instanceof U&&c.code===ae.CONNECTION_CANCELED)return u(c),[2];throw c;case 4:return[2]}})})},e.sdkState.websocket.connectMaxRetry)];case 2:return o.sent(),[4,e.changeState(new Ey,r)];case 3:return o.sent(),le(function(){return g(a,void 0,void 0,function(){return v(this,function(u){return this._flushCallbacks(),e.connectionHandlers.forEach(function(c){c.onConnected&&c.onConnected(e.sdkState.userId)}),[2]})})}),[3,10];case 4:return s=o.sent(),ar(s)?[3,8]:[4,e.disconnect()];case 5:return o.sent(),s instanceof U?s.code===ae.CONNECTION_CANCELED?[3,7]:[4,e.changeState(new S_,r)]:[3,7];case 6:o.sent(),o.label=7;case 7:return le(function(){return g(a,void 0,void 0,function(){return v(this,function(u){return this._flushCallbacks(s),[2]})})}),[3,9];case 8:throw s;case 9:return[3,10];case 10:return[2,i.promise]}})})},t.prototype.onConnect=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){return r=new Fn,this._callbacks.push(function(s){return s?r.reject(s):r.resolve()}),[2,r.promise]})})},t.prototype.onDisconnect=function(e,r){var i=r.error,s=i===void 0?null:i,a=r.autoReconnect,o=a!==void 0&&a,u=r.cause,c=u===void 0?null:u;return g(this,void 0,void 0,function(){var l;return v(this,function(d){switch(d.label){case 0:return l=Date.now(),this._halt(s??ov(c)),e.hasSession?[4,e.changeState(new Ud({autoReconnect:o}),l)]:[3,2];case 1:return d.sent(),[3,4];case 2:return[4,e.changeState(new da,l)];case 3:d.sent(),d.label=4;case 4:return[2]}})})},t.prototype.onDisconnectWebSocket=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return this._halt(ov((r==null?void 0:r.cause)||null)),i=Date.now(),e.hasSession?[4,e.changeState(new lh,i)]:[3,2];case 1:return s.sent(),[3,4];case 2:return[4,e.changeState(new da,i)];case 3:s.sent(),s.label=4;case 4:return[2]}})})},t.prototype.onLogout=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(U.connectionCanceled),[4,e.changeState(new da,r)];case 1:return i.sent(),[2]}})})},t}(wo);function ov(n){var t=U.connectionCanceled;if(n){var e=null;switch(n){case iu.ExternalSetBackground:e="Connection has been canceled due to the application having externally moved to background while in ConnectingState.";break;case iu.ExternalDisconnectWebSocket:e="Connection has been canceled because sb.disconnectWebSocket() was called while in ConnectingState."}e&&t.setDetail(e)}return t}var Js,S_=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=qe.INITIALIZED,e.name="initialized",e}return w(t,n),t.prototype.onConnect=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.changeState(new hh({authToken:r}),i)];case 1:return s.sent(),[2]}})})},t.prototype.onLogout=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new da({wasPreviouslyConnected:!1}),r)];case 1:return i.sent(),[2]}})})},t}(wo),_I=function(n){function t(){return n.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return w(t,n),t}(Yn),mI=function(){function n(t){var e=t.pingDelegate,r=t.sdkState,i=t.logger;this.pingDelegate=e,this.sdkState=r,this._logger=i}return Object.defineProperty(n.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),n.prototype.ping=function(){var t,e=this;if(!this.sdkState.websocket)throw U.connectionRequired;var r=new _I;try{var i=(t=this.sdkState.websocket.pongTimeout)!==null&&t!==void 0?t:5e3;this._pingTimeoutTimer=setTimeout(function(){e._logger.debug("pinger.ping() timeout"),e.pingDelegate.error()},i),this.pingDelegate.send(r),this._logger.debug("pinger.ping()")}catch(s){this._logger.debug("pinger.ping() error",s),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return r},n.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},n.prototype.refreshTimer=function(){var t,e=this;if(!this.sdkState.websocket)throw U.connectionRequired;this._logger.debug("pinger.refreshTimer()");var r=(t=this.sdkState.websocket.pingInterval)!==null&&t!==void 0?t:15e3;this.stop(),this._pingTimer=setInterval(function(){e.ping()},r)},n.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},n.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},n}(),by=["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications"],vI=function(n){function t(e,r){var i,s=r.sdkState,a=r.cacheContext,o=r.connectionHandlers,u=r.sessionManager,c=r.websocketClient,l=r.dispatcher,d=r.logger,h=r.entryState,f=h===void 0?new S_:h,p=this;return(p=n.call(this)||this)._stateUpdatedAt=0,p._connectingAt=0,p._connectionRequestQueue=[],p._iid=e,p.sdkState=s,p.cacheContext=a,p.connectionHandlers=o,p._sessionManager=u,p._websocketClient=c,p._dispatcher=l,p._logger=d,p._currentState=f,!((i=p.sdkState.websocket)===null||i===void 0)&&i.pingerDisabled||(p._pinger=new mI({pingDelegate:{send:function(_){return p._websocketClient.send(_)},error:function(_){return p._websocketClient.error(_)}},sdkState:p.sdkState,logger:d})),p._websocketClient.on("open",function(){p._tryResolveConnectionRequest()}).on("message",function(_){_.code==="LOGI"&&(p.clearLoginTimer(),p._dispatcher.dispatch(_.as(ld)))}).on("ping-refresh",function(){var _;return(_=p._pinger)===null||_===void 0?void 0:_.refreshTimer()}).on("pong",function(){var _;return(_=p._pinger)===null||_===void 0?void 0:_.pong()}).on("error",function(){var _;return(_=p._pinger)===null||_===void 0?void 0:_.stop()}).on("close",function(){p._logiProcessingTimer=setTimeout(function(){p._logiProcessingTimer=void 0,p._unresolvedLogi||p._rejectConnectionRequest(U.networkError)},500)}),p._dispatcher.on(function(_){_ instanceof ld&&(p._unresolvedLogi=_,p._tryResolveConnectionRequest())}),p}return w(t,n),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasSession",{get:function(){return this._sessionManager.session.hasSession},enumerable:!1,configurable:!0}),t.prototype.changeState=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return r>=this._stateUpdatedAt?(this._currentState=e,this._stateUpdatedAt=r,this._dispatcher.dispatch(new Ar({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)]):[3,2];case 1:return i.sent(),[2,!0];case 2:return[2,!1]}})})},t.prototype._tryResolveConnectionRequest=function(){var e;return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=this._unresolvedLogi,this._websocketClient.isOpen&&r?(this._unresolvedLogi=void 0,r.error?[3,2]:[4,r.applyTo(this._iid)]):[3,3];case 1:return i.sent(),this._statLogConnection(),(e=this._pinger)===null||e===void 0||e.start(),this._connectionRequestQueue.forEach(function(s){return s.resolve()}),this._connectionRequestQueue=[],this.sdkState.appState="foreground",[3,3];case 2:this._sessionManager.session.authToken=void 0,(r.error.isSessionExpiredError||r.error.isSessionInvalidatedError)&&this._dispatcher.dispatch(new ru({reason:r.error.code})),this._rejectConnectionRequest(r.error),i.label=3;case 3:return[2]}})})},t.prototype._rejectConnectionRequest=function(e){var r;if((r=this._pinger)===null||r===void 0||r.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){var i=this._connectionRequestQueue;this._connectionRequestQueue=[],i.forEach(function(s){return s.reject(e)}),this._statLogConnection(e)}},t.prototype._url=function(){var e,r=this.sdkState,i=r.appId,s=r.appVersion,a=r.userId,o=r.extensions,u=r.sendbirdRuntimeEnvironment,c=this.cacheContext.localCacheEnabled,l=this._sessionManager.session,d=(e=this.sdkState.websocket)===null||e===void 0?void 0:e.compression,h=!!(o??{}).sb_uikit,f=kd.userAgentWithExtension(o);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(oa.OS_VERSION),"&sv=").concat(encodeURIComponent(oa.SDK_VERSION),"&ai=").concat(i).concat(s?"&av=".concat(s):"").concat(l.hasSession?"":"&user_id=".concat(encodeURIComponent(a)),"&pmce=").concat(d?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(["gcm","huawei","apns"].join(",")),"&SB-User-Agent=").concat(f,"&SB-SDK-User-Agent=").concat(encodeURIComponent(kd.sendbirdSdkUserAgentWithExtension(u)),"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(by))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(c?1:0,"&include_poll_details=1").concat(h?"&uikit_config=1":"")},t.prototype._statLogConnection=function(e){var r;this._dispatcher.dispatch(new b_(new dn({type:lt.WEBSOCKET_CONNECT,data:{host_url:(r=this.sdkState.websocket)===null||r===void 0?void 0:r.host,success:!e,latency:Date.now()-this._connectingAt,error_code:e==null?void 0:e.code,error_description:e==null?void 0:e.message}})))},t.prototype.connect=function(e){var r;return e===void 0&&(e=""),g(this,void 0,void 0,function(){var i,s,a,o=this;return v(this,function(u){return this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(U.connectionCanceled)),i=this._url(),s=new Fn,this._connectionRequestQueue.push(s),this._connectionRequestQueue.length===1&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){o._loginTimer=void 0,o._rejectConnectionRequest(U.loginTimeout)},(r=this.sdkState.websocket)===null||r===void 0?void 0:r.responseTimeout),a=this._sessionManager.session,e&&(a.authToken=e),this._websocketClient.connect(i,JSON.stringify(a.hasSession?{auth:a.sessionKey}:{token:e}))),[2,s.promise]})})},t.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(ld.asError(U.connectionRenew))},t.prototype.disconnect=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this._websocketClient.disconnect()];case 1:return e.sent(),[2]}})})},t.prototype.logout=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.sdkState.userId=void 0,this._unresolvedLogi=void 0,[4,this.disconnect()];case 1:return e.sent(),[4,this._sessionManager.clear()];case 2:return e.sent(),[2]}})})},t.prototype.clearLoginTimer=function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)},t}(bo),Ty=function(n){function t(e){var r=e.appId,i=e.userId,s=e.services,a=s===void 0?[Ds.CHAT]:s,o=e.includeUIKitConfig,u=o!==void 0&&o,c=e.localCacheEnabled,l=c===void 0||c,d=e.expiringSession,h=d===void 0||d,f=n.call(this)||this;return f.path="".concat(Ue,"/").concat(i,"/login"),f.method=j.POST,f.params={expiring_session:!!h,services:a,include_logi:!0,include_extra_data:String(by),uikit_config:u,use_local_cache:l,app_id:r},f.requireAuth=!1,f}return w(t,n),t}(K),gI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.logi=new ld(e,"LOGI",r),i}return w(t,n),t}(W);(function(n){n[n.ALL=0]="ALL",n[n.WEBSOCKET=1]="WEBSOCKET",n[n.API=2]="API"})(Js||(Js={}));var Ni,yI=[E_,Ty],EI=function(){function n(t,e){var r=e.session,i=e.sdkState,s=e.dispatcher,a=e.logger,o=e.useFetchCompat,u=o!==void 0&&o,c=this;this._currentConnectionStateType=qe.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new aI(t,{session:r,sdkState:i,dispatcher:s,logger:a,useFetchCompat:u}),this._session=r,this._logger=a,this._dispatcher=s,this._dispatcher.on(function(l){var d,h,f,p;if(l instanceof Ar){var _=l.stateType;switch(c._currentConnectionStateType=_,_){case qe.CONNECTED:c._resolveLazyCallQueue();break;case qe.INITIALIZED:case qe.INTERNAL_DISCONNECTED:case qe.EXTERNAL_DISCONNECTED:case qe.LOGOUT:c._rejectLazyCallQueue(!((f=c._session)===null||f===void 0)&&f.hasSession?U.connectionClosed:U.connectionRequired)}}else if(l instanceof _y)!((p=c._session.services)===null||p===void 0)&&p.includes(Ds.CHAT)||c._resolveLazyCallQueue(Js.API);else if(l instanceof vp||l instanceof my)c._rejectLazyCallQueue(U.connectionClosed);else if(l instanceof W0){var m=l.request,b=l.deferred,y=l.error;try{for(var E=Z(yI),T=E.next();!T.done;T=E.next())if(m instanceof T.value)return void b.reject(y)}catch(N){d={error:N}}finally{try{T&&!T.done&&(h=E.return)&&h.call(E)}finally{if(d)throw d.error}}c._lazyCallQueue.push({command:m,deferred:b})}})}return Object.defineProperty(n.prototype,"isReady",{get:function(){return this._currentConnectionStateType===qe.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===qe.CONNECTING||this._currentConnectionStateType===qe.RECONNECTING||this._session.isRefreshing},enumerable:!1,configurable:!0}),n.prototype._classifyLazyCallQueueByScope=function(t){var e,r=[],i=[];switch(t){case Js.ALL:e=null;break;case Js.WEBSOCKET:e=Yn;break;case Js.API:e=K}var s=!1;return this._lazyCallQueue.forEach(function(a){!e||a.command instanceof e||(s=!0),s?i.push(a):r.push(a)}),[r,i]},n.prototype._resolveLazyCallQueue=function(t){var e=this;t===void 0&&(t=Js.ALL);var r=ie(this._classifyLazyCallQueueByScope(t),2),i=r[0],s=r[1];this._lazyCallQueue=s,i.forEach(function(a){return g(e,void 0,void 0,function(){var o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:o=a.command,u=a.deferred,(c=a.timeout)&&clearTimeout(c),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this.send(o)];case 2:return l=h.sent(),u.resolve(l),[3,4];case 3:return d=h.sent(),u.reject(d),[3,4];case 4:return[2]}})})})},n.prototype._rejectLazyCallQueue=function(t,e){var r=this;e===void 0&&(e=Js.ALL);var i=ie(this._classifyLazyCallQueueByScope(e),2),s=i[0],a=i[1];this._lazyCallQueue=a,s.forEach(function(o){return g(r,void 0,void 0,function(){var u,c;return v(this,function(l){return u=o.deferred,c=o.timeout,clearTimeout(c),u.reject(t),[2]})})})},n.prototype.send=function(t){return g(this,void 0,void 0,function(){var e,r,i=this;return v(this,function(s){switch(s.label){case 0:return t instanceof Yn?this.isReady?(this._logger.debug("send websocket request",t),[4,this.commandRouter.send(t)]):[3,2]:[3,4];case 1:case 5:return[2,s.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",t),e=new Fn,this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout(function(){return i.timeout(t.requestId)},1e4)}),[2,e.promise];throw this._logger.debug("fail websocket request"),U.connectionRequired;case 3:case 7:return[3,9];case 4:return t instanceof K?this._session.hasSession?(this._logger.debug("send api request",t),[4,this.commandRouter.send(t)]):[3,6]:[3,8];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",t),e=new Fn,this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout(function(){return i.timeout(t.requestId)},1e4)}),[2,e.promise];throw r=U.connectionRequired,this._logger.debug("fail api request",r),r;case 8:throw U.invalidCommand;case 9:return[2]}})})},n.prototype.forceSend=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this._logger.debug("send forced request",t),t instanceof Yn||t instanceof K?[4,this.commandRouter.send(t)]:[3,2];case 1:return[2,e.sent()];case 2:throw U.invalidCommand}})})},n.prototype.timeout=function(t){this._logger.debug("timeout request",t);var e=this._lazyCallQueue.findIndex(function(r){return r.command.requestId===t});e>-1&&(this._lazyCallQueue[e].deferred.reject(U.connectionRequired),this._lazyCallQueue.splice(e,1))},n.prototype.cancel=function(t){this._logger.debug("cancel api request",t),this.commandRouter.cancel(t)},n.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},n}(),ff="sendbird@devicetokens",pf=function(){function n(t){var e=t.type,r=t.token;this.type=e,this.token=r}return n.payloadify=function(t){return re(oe({type:t.type,token:t.token}))},n}(),_f=new WeakMap,bI=function(n){function t(e){var r=e._iid,i=e.session,s=e.cacheContext,a=e.sdkState,o=e.dispatcher,u=e.requestQueue,c=e.logger,l=n.call(this)||this;return l._currentConnectionStateType=qe.INITIALIZED,l._isRefreshingAuthToken=!1,l.currentUser=null,l.session=i,l._iid=r,l._cacheContext=s,l._sdkState=a,l._dispatcher=o,l._requestQueue=u,l._logger=c,l._deviceTokens=[],l._dispatcher.on(function(d){var h;if(d instanceof Ar){var f=d.stateType;l._currentConnectionStateType=f}else d instanceof ru&&l.handler&&!l.isSessionKeyRefreshing&&(!((h=d.error)===null||h===void 0)&&h.isSessionInvalidatedError?l.handler.onSessionClosed&&l.handler.onSessionClosed():(d.invalidateSessionToken&&(l.session.authToken=void 0),d.error&&d.error.isSessionExpiredError&&(l._logger.debug("session expired"),l.handler.onSessionExpired&&l.handler.onSessionExpired(),l.refresh().catch(function(p){if(ar(p)&&l._sdkState.appState==="foreground")throw p}))))}),l}return w(t,n),Object.defineProperty(t.prototype,"ekey",{get:function(){return _f.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceTokens",{get:function(){return this._deviceTokens},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceTokenLastDeletedAt",{get:function(){return this._deviceTokenLastDeletedAt},enumerable:!1,configurable:!0}),t.prototype.indexOfDeviceToken=function(e,r){return this._deviceTokens.findIndex(function(i){return i.type===e&&i.token===r})},t.prototype.hasDeviceToken=function(e,r){return this.indexOfDeviceToken(e,r)>=0},t.prototype.createRefreshWebsocketCommand=function(e,r){return new ew({authToken:e,expiringSession:!0,requestId:r})},t.prototype._refreshSessionKeyByWebSocket=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return r=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(r)];case 1:if(i=u.sent(),s=i.as(nw),a=s.newKey,o=s.error)throw o;return this.session.sessionKey=a??this.session.sessionKey,[2]}})})},t.prototype._refreshSessionKeyByApi=function(e){return g(this,void 0,void 0,function(){var r,i=this;return v(this,function(s){switch(s.label){case 0:return r=new E_({userId:this._sdkState.userId,authToken:e,services:this.session.services,expiringSession:!0}),[4,dh(function(a){return g(i,void 0,void 0,function(){var o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:return h.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(r)];case 1:return o=h.sent(),u=o.as(tw),c=u.key,l=u.services,this.session.sessionKey=c,this.session.services=l,[3,3];case 2:if(d=h.sent(),!this._isSessionRelatedError(d))throw d;return a(d),[3,3];case 3:return[2]}})})},3)];case 1:return s.sent(),[2]}})})},t.prototype._refreshSessionKey=function(e,r){return r===void 0&&(r=!0),g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){switch(o.label){case 0:if(this._currentConnectionStateType!==qe.CONNECTED)return[3,11];o.label=1;case 1:return o.trys.push([1,3,,11]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return o.sent(),this.complete(),[2];case 3:return(i=o.sent())instanceof U&&(i.isSessionTokenExpiredError||i.code===ae.APPLICATION_NOT_FOUND)?r?[4,this._receiveNewAuthToken()]:[3,9]:[3,10];case 4:return(a=o.sent())?(this.session.authToken=a,[4,this._refreshSessionKey(this.session.authToken,!1)]):[3,6];case 5:return o.sent(),this.complete(),[3,8];case 6:return[4,this.clear()];case 7:o.sent(),o.label=8;case 8:return[2];case 9:this.session.authToken=void 0,o.label=10;case 10:return[3,11];case 11:return o.trys.push([11,13,,23]),[4,this._refreshSessionKeyByApi(e)];case 12:return o.sent(),this.complete(),[3,23];case 13:return(s=o.sent())instanceof U&&(s.isSessionTokenExpiredError||s.code===ae.APPLICATION_NOT_FOUND)?r?[4,this._receiveNewAuthToken()]:[3,19]:[3,21];case 14:return(a=o.sent())?(this.session.authToken=a,[4,this._refreshSessionKeyByApi(this.session.authToken)]):[3,16];case 15:return o.sent(),this.complete(),[3,18];case 16:return[4,this.clear()];case 17:o.sent(),o.label=18;case 18:return[3,20];case 19:throw this.session.authToken=void 0,s;case 20:return[3,22];case 21:throw s;case 22:return[3,23];case 23:return[2]}})})},t.prototype._receiveNewAuthToken=function(){var e,r=this,i=new Fn;if(this._isRefreshingAuthToken=!0,this.session.clear(),(e=this.handler)===null||e===void 0?void 0:e.onSessionTokenRequired){var s=null,a=function(){s&&(clearTimeout(s),s=null)},o=function(c){a(),r._isRefreshingAuthToken&&(r._isRefreshingAuthToken=!1,i.resolve(c))},u=function(c){a(),r._isRefreshingAuthToken&&(r._isRefreshingAuthToken=!1,i.reject(c))};s=setTimeout(function(){return u()},1e3*this._sdkState.sessionTokenRefreshTimeout),le(function(){return g(r,void 0,void 0,function(){var c;return v(this,function(l){return!((c=this.handler)===null||c===void 0)&&c.onSessionTokenRequired&&this.handler.onSessionTokenRequired(o,u),[2]})})})}else i.resolve(null);return i.promise},t.prototype._isSessionRelatedError=function(e){return e instanceof U&&(e.isSessionExpiredError||e.isSessionInvalidatedError)},Object.defineProperty(t.prototype,"isSessionKeyRefreshing",{get:function(){return this.session.isRefreshing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionExpiring",{get:function(){return!!this.handler},enumerable:!1,configurable:!0}),t.prototype.authenticateFeed=function(e,r){var i;return g(this,void 0,void 0,function(){var s,a,o;return v(this,function(u){switch(u.label){case 0:return this.session.authToken=r,s=new Ty({appId:this._sdkState.appId,userId:e,services:[Ds.FEED],includeUIKitConfig:!!((i=this._sdkState.extensions)!==null&&i!==void 0?i:{}).sb_uikit,localCacheEnabled:this._cacheContext.localCacheEnabled,expiringSession:!r||this.isSessionExpiring}),[4,this._requestQueue.commandRouter.send(s)];case 1:return a=u.sent(),(o=a.as(gI).logi).error?[3,3]:[4,o.applyTo(this._iid)];case 2:return u.sent(),[3,4];case 3:throw o.error;case 4:return[2]}})})},t.prototype.login=function(e){var r;return g(this,void 0,void 0,function(){var i,s,a,o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:return i=e.key,s=e.ekey,a=e.services,o=e.userProfile,u=e.deviceTokenLastDeletedAt,c=u===void 0?0:u,this.session.hasLessServiceScopeThan(a)&&(this.session.sessionKey=i,this.session.services=a),_f.set(this,s),this._deviceTokenCacheEnabled=(r=o==null?void 0:o.appInfo)===null||r===void 0?void 0:r.deviceTokenCache,l=this._cacheContext.preference,this._deviceTokenCacheEnabled?[4,l.get(ff)]:[3,5];case 1:return!(d=h.sent())||d.lastDeletedAt<c?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=c,[4,this.saveDeviceToken()]):[3,3];case 2:return h.sent(),[3,4];case 3:this._deviceTokens=d.tokens.map(function(f){return new pf(pf.payloadify(f))}),this._deviceTokenLastDeletedAt=d.lastDeletedAt,h.label=4;case 4:return[3,7];case 5:return[4,l.remove(ff)];case 6:h.sent(),h.label=7;case 7:return[2]}})})},t.prototype.complete=function(){var e=this;this.dispatch("refresh"),this._dispatcher.dispatch(new _y),le(function(){return g(e,void 0,void 0,function(){var r;return v(this,function(i){return this._logger.debug("session refreshed"),!((r=this.handler)===null||r===void 0)&&r.onSessionRefreshed&&this.handler.onSessionRefreshed(),[2]})})})},t.prototype.error=function(e){var r=this;le(function(){return g(r,void 0,void 0,function(){var i;return v(this,function(s){return!((i=this.handler)===null||i===void 0)&&i.onSessionError&&this.handler.onSessionError(e),[2]})})})},t.prototype.close=function(){var e=this;this.dispatch("close"),this._dispatcher.dispatch(new my),le(function(){return g(e,void 0,void 0,function(){var r;return v(this,function(i){return this._logger.debug("session closed"),!((r=this.handler)===null||r===void 0)&&r.onSessionClosed&&this.handler.onSessionClosed(),[2]})})})},t.prototype.refresh=function(){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:if(!this.isSessionExpiring)return[3,10];if(this.session.isRefreshing)return[3,10];if(this.session.isRefreshing=!0,this.session.authToken)return[3,7];i.label=1;case 1:return i.trys.push([1,6,,7]),[4,this._receiveNewAuthToken()];case 2:return(e=i.sent())?(this._logger.debug("session refreshing.."),this.session.authToken=e,[3,5]):[3,3];case 3:return[4,this.clear()];case 4:return i.sent(),this.session.isRefreshing=!1,[2];case 5:return[3,7];case 6:throw i.sent(),r=U.sessionTokenRequestFailed,this._dispatcher.dispatch(new vp),this.error(r),this.session.isRefreshing=!1,this._logger.debug("refresh auth token error = ",r),r;case 7:return i.trys.push([7,9,,10]),[4,this._refreshSessionKey(this.session.authToken)];case 8:return i.sent(),this.session.isRefreshing=!1,[3,10];case 9:throw i.sent(),this.session.isRefreshing=!1,r=U.sessionTokenRefreshFailed,this._dispatcher.dispatch(new vp),this.error(r),r;case 10:return[2]}})})},t.prototype.setDeviceToken=function(e,r){return this._deviceTokenCacheEnabled&&this.indexOfDeviceToken(e,r)<0?(this._deviceTokens.push(new pf({type:e,token:r})),!0):!1},t.prototype.unsetDeviceToken=function(e,r){if(this._deviceTokenCacheEnabled){var i=this.indexOfDeviceToken(e,r);i>=0&&this._deviceTokens.splice(i,1)}},t.prototype.unsetDeviceTokens=function(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter(function(r){return r.type!==e}):[])},t.prototype.setDeviceTokenDeletedAt=function(e){e>0&&(this._deviceTokenLastDeletedAt=e)},t.prototype.saveDeviceToken=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this._deviceTokenCacheEnabled?[4,this._cacheContext.preference.set(ff,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.currentUser=null,this.session.clear(),this.close(),_f.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,[4,this.saveDeviceToken()];case 1:return e.sent(),[2]}})})},t}(bo),Ya=function(n){function t(e){var r,i,s,a,o=e.type,u=e.data,c=e.ts,l=c===void 0?Date.now():c,d=n.call(this,{type:o,data:u,ts:l})||this;return d.date=new Date(l),d.key="".concat((r=d.date,i=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),"".concat(i).concat(s).concat(a)),"_").concat(o),d}return w(t,n),t}(dn),TI=function(n){function t(e){var r=e.deviceId,i=e.statLogs,s=n.call(this)||this;return s.method=j.POST,s.path="".concat(ZT),s.params={device_id:r,log_entries:i.map(function(a){return dn.payloadify(a)})},s}return w(t,n),t}(K),wy=function(n,t){var e,r;if(n!==null&&t!==null){var i=Object.keys(n),s=Object.keys(t),a=ce([],ie(new Set(ce(ce([],ie(i),!1),ie(s),!1))),!1),o={};try{for(var u=Z(a),c=u.next();!c.done;c=u.next()){var l=c.value,d=typeof n[l],h=typeof t[l];d==="undefined"?o[l]=t[l]:h==="undefined"?o[l]=n[l]:d!==h?o[l]=t[l]:d==="object"&&n[l]&&t[l]?o[l]=wy(n[l],t[l]):o[l]=t[l]}}catch(f){e={error:f}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return o}return t};(function(n){n[n.PENDING=0]="PENDING",n[n.COLLECT_ONLY=1]="COLLECT_ONLY",n[n.ENABLED=2]="ENABLED",n[n.DISABLED=3]="DISABLED"})(Ni||(Ni={}));var Es,wI=function(n){function t(e){var r=e.cacheContext,i=e.requestQueue,s=e.dispatcher,a=e.baseLimit,o=a===void 0?100:a,u=e.maxLimit,c=u===void 0?1e3:u,l=e.minLimit,d=l===void 0?10:l,h=n.call(this)||this;return h.queue=[],h.flushWaitQueue=[],h.enabledState=Ni.PENDING,h.isFlushing=!1,h.generation=1,h.lastFlushedAt=Date.now(),h._collectRequestStat=!0,h._collectFeatureLocalCacheStat=!0,h._collectionNotificationStat=!0,h.deviceId=Rs(),h.cacheContext=r,h.requestQueue=i,h.dispatcher=s,h.baseLimit=o,h.limit=o,h.maxLimit=c,h.minLimit=d,h}return w(t,n),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this.enabledState===Ni.ENABLED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isReadyToFlush",{get:function(){return this.queue.length>=this.limit||Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit},enumerable:!1,configurable:!0}),t.prototype._arrangeStat=function(){var e=ce([],ie(this.queue),!1);this._collectRequestStat||(e=e.filter(function(r){return r.type!==lt.API_RESULT&&r.type!==lt.WEBSOCKET_CONNECT})),this._collectFeatureLocalCacheStat||(e=e.filter(function(r){return r.type!==lt.FEATURE_LOCALCACHE&&r.type!==lt.FEATURE_LOCALCACHE_EVENT})),this._collectionNotificationStat||(e=e.filter(function(r){return r.type!==lt.NOTIFICATION})),this.queue=e},t.prototype._save=function(){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return this.isEnabled?(e=ce(ce([],ie(this.queue),!1),ie(this.flushWaitQueue),!1),[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:e.map(function(i){return dn.payloadify(i)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})]):[3,2];case 1:r.sent(),this.dispatch("save",e),r.label=2;case 2:return[2]}})})},t.prototype._flush=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:if(!this.isEnabled)return[3,10];if(this.isFlushing)return[3,10];this.isFlushing=!0,o.label=1;case 1:return o.trys.push([1,5,9,10]),this._arrangeStat(),e=this.queue.filter(function(u){if(u instanceof Ya){var c=new Date,l=ie([u.date.getFullYear(),c.getFullYear()],2),d=l[0],h=l[1];if(d<h)return!0;if(d===h){var f=ie([u.date.getMonth(),c.getMonth()],2),p=f[0],_=f[1];if(p<_)return!0;if(p===_){var m=ie([u.date.getDate(),c.getDate()],2);return m[0]<m[1]}}}return!1}),r=this.queue.filter(function(u){return!(u instanceof Ya)}),(i=ce(ce([],ie(e),!1),ie(r),!1).slice(0,Math.min(this.limit,this.maxLimit))).length>0?(s=new TI({deviceId:this.deviceId,statLogs:i}),[4,this.requestQueue.send(s)]):[3,4];case 2:return o.sent(),this.dispatch("flush",i),this.queue=ce(ce([],ie(e),!1),ie(r),!1).slice(i.length).concat(this.flushWaitQueue),this.flushWaitQueue=[],this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[4,this._save()];case 3:o.sent(),o.label=4;case 4:return[3,10];case 5:return(a=o.sent())instanceof U?a.code!==ae.NON_AUTHORIZED?[3,7]:[4,this.clear()]:[3,8];case 6:return o.sent(),this.enabledState=Ni.DISABLED,[3,8];case 7:a.code===ae.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=Ni.COLLECT_ONLY),o.label=8;case 8:return this.limit=this.limit+20,[3,10];case 9:return this.isFlushing=!1,[7];case 10:return[2]}})})},t.prototype.init=function(e){return g(this,void 0,void 0,function(){var r,i,s=this;return v(this,function(a){switch(a.label){case 0:return this.key=e,[4,this.cacheContext.preference.get(this.key)];case 1:return(r=a.sent())?(this.deviceId=r.deviceId,this.queue=r.statLogs.map(function(o){var u;return o.stat_type===lt.FEATURE_LOCALCACHE_EVENT&&(o.data=A({message_init_policy:"",starting_point:0},o.data)),o.stat_type===lt.NOTIFICATION&&(o.data=re(A(A({},o.data),{message_id:(u=o.data.notificationId)!==null&&u!==void 0?u:o.data.message_id,notificationId:void 0}))),new dn({type:o.stat_type,ts:o.ts,data:o.data})}),this.generation=r.generation,this.lastFlushedAt=r.lastFlushedAt,this.isReadyToFlush?(i=Math.min(Math.floor(18e4*Math.random()),100),[4,mr(i)]):[3,4]):[3,4];case 2:return a.sent(),[4,this._flush()];case 3:a.sent(),a.label=4;case 4:return this.commandEventContext||(this.commandEventContext=this.dispatcher.on(function(o){if(o instanceof b_){var u=o.statLog;s.put(u)}else if(o instanceof gy){var c=o.request,l=o.features,d=o.options;s._collectRequestStat=c,s._collectFeatureLocalCacheStat=l==null?void 0:l.localCache,s._collectionNotificationStat=l==null?void 0:l.notification,s._arrangeStat(),s._collectRequestStat||s._collectFeatureLocalCacheStat||s._collectionNotificationStat?s.enabledState=d.ingestion?Ni.ENABLED:Ni.COLLECT_ONLY:s.enabledState=Ni.DISABLED,s.isEnabled?s.isReadyToFlush&&s._flush():s.clear()}})),[2]}})})},t.prototype.put=function(e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:if(this.enabledState===Ni.DISABLED)return[3,3];if(r=this.isFlushing?this.flushWaitQueue:this.queue,e instanceof Ya)this._collectFeatureLocalCacheStat&&(i=ie(this.queue.filter(function(o){return o instanceof Ya&&o.key===e.key}),1),(s=i[0])?s.data=wy(s.data,e.data):r.push(e));else switch(e.type){case lt.API_RESULT:case lt.WEBSOCKET_CONNECT:this._collectRequestStat&&r.push(e);break;case lt.FEATURE_LOCALCACHE:case lt.FEATURE_LOCALCACHE_EVENT:this._collectFeatureLocalCacheStat&&r.push(e);break;case lt.NOTIFICATION:this._collectionNotificationStat&&r.push(e)}return[4,this._save()];case 1:return a.sent(),this.isReadyToFlush?[4,this._flush()]:[3,3];case 2:a.sent(),a.label=3;case 3:return[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.queue=[],this.flushWaitQueue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})},t.prototype.close=function(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)},t}(bo);(function(n){n[n.VERBOSE=0]="VERBOSE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.NONE=5]="NONE"})(Es||(Es={}));var z,II=function(){function n(){this.level=Es.WARN}return n.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Es.VERBOSE&&console.log.apply(console,ce(["[verbose]"],ie(t),!1))},n.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Es.DEBUG&&console.log.apply(console,ce(["[debug]"],ie(t),!1))},n.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Es.INFO&&console.log.apply(console,ce(["[info]"],ie(t),!1))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Es.WARN&&console.warn.apply(console,ce(["[warn]"],ie(t),!1))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Es.ERROR&&console.error.apply(console,ce(["[error]"],ie(t),!1))},n}(),Ma={},M=function(){function n(t,e){var r,i,s,a,o,u,c,l,d,h;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Ma[t]){Ma[t]=this;var f=(r=e.options)!==null&&r!==void 0?r:new z0,p=this.sdkState={appId:e.appId,appVersion:(i=e.appVersion)!==null&&i!==void 0?i:"",appState:"foreground",userId:void 0,extensions:{},api:{host:(s=e.apiHost)!==null&&s!==void 0?s:"https://api-".concat(e.appId,".sendbird.com")},websocket:{host:(a=e.websocketHost)!==null&&a!==void 0?a:"wss://ws-".concat(e.appId,".sendbird.com"),pingerDisabled:!!e.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new yy,responseTimeout:f.websocketResponseTimeout},sessionTokenRefreshTimeout:f.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};var _=this.logger=new II;this.logger.level=(o=e.logLevel)!==null&&o!==void 0?o:Es.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var m=this.cacheContext=new HT({encryption:e.encryption,store:e.store,localCacheEnabled:(u=e.localCacheEnabled)!==null&&u!==void 0&&u,localCacheConfig:(c=e.localCacheConfig)!==null&&c!==void 0?c:new V0});this.debugMode=(l=e.debugMode)!==null&&l!==void 0&&l,this.maxSuperGroupChannelUnreadCount=oa.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=f.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=f.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=f.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;var b=this.dispatcher=new VT,y=new GT;this.requestQueue=new EI(t,{session:y,sdkState:p,dispatcher:b,logger:_,useFetchCompat:e.useFetchCompat}),this.sessionManager=new bI({_iid:t,session:y,cacheContext:m,sdkState:p,dispatcher:b,requestQueue:this.requestQueue,logger:_}),this.connectionManager=new pI(t,{sdkState:p,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:b,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:(d=e.disableWebSocketCloseEventHandling)!==null&&d!==void 0&&d,logger:_}),this.statLogCollector=new wI({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:b}),this.appStateToggleEnabled=(h=e.appStateToggleEnabled)===null||h===void 0||h}return Ma[t]}return n.of=function(t){if(Ma[t])return Ma[t];throw U.lostInstance},n.clear=function(t){Ma[t]&&delete Ma[t]},n.prototype.hasExtension=function(t){return this.sdkState.extensions&&this.sdkState.extensions[t]},n}(),C_=function(){function n(){}return n.prototype.init=function(t,e){var r=e.sdkState,i=e.dispatcher,s=e.sessionManager,a=e.requestQueue,o=e.logger;e.onlineDetector;var u=e.cacheContext;this._iid=t,this._cacheContext=u,this._sdkState=r,this._dispatcher=i,this._sessionManager=s,this._requestQueue=a,this._logger=o},n}();(function(n){n.UNKNOWN="UNKNOWN",n.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",n.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",n.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",n.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",n.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",n.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",n.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",n.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",n.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",n.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",n.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",n.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",n.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",n.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",n.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",n.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",n.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",n.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",n.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",n.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",n.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",n.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",n.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",n.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",n.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",n.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",n.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",n.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",n.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",n.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",n.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",n.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",n.REQUEST_CHANNEL="REQUEST_CHANNEL",n.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",n.REFRESH_CHANNEL="REFRESH_CHANNEL",n.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",n.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",n.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",n.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",n.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",n.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",n.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",n.EVENT_MESSAGE_FEEDBACK_ADDED="EVENT_MESSAGE_FEEDBACK_ADDED",n.EVENT_MESSAGE_FEEDBACK_UPDATED="EVENT_MESSAGE_FEEDBACK_UPDATED",n.EVENT_MESSAGE_FEEDBACK_DELETED="EVENT_MESSAGE_FEEDBACK_DELETED",n.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",n.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",n.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",n.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",n.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",n.REQUEST_MESSAGE="REQUEST_MESSAGE",n.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",n.EVENT_POLL_VOTED="EVENT_POLL_VOTED",n.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",n.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",n.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",n.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",n.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",n.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",n.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",n.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",n.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",n.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",n.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"})(z||(z={}));var su;A({},z);var ps=function(n){return n.startsWith("EVENT_")||n.startsWith("LOCAL_MESSAGE_")||n===z.SYNC_MESSAGE_FILL||n===z.SYNC_MESSAGE_CHANGELOGS||n===z.SYNC_POLL_CHANGELOGS},mt=function(n){function t(e){var r=e.messages,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=n.call(this)||this;return o.messages=r,o.source=i,o.isWebSocketEventComing=a,o}return w(t,n),t}(rt),N_=function(n){function t(e){var r=e.messageIds,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=n.call(this)||this;return o.messageIds=r,o.source=i,o.isWebSocketEventComing=a,o}return w(t,n),t}(rt),Iy=function(n){function t(e){var r=e.event,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=n.call(this)||this;return o.event=r,o.source=i,o.isWebSocketEventComing=a,o}return w(t,n),t}(rt),Sy=function(n){function t(e){var r=e.event,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=n.call(this)||this;return o.event=r,o.source=i,o.isWebSocketEventComing=a,o}return w(t,n),t}(rt),Cy=function(n){function t(e){var r=e.reqId,i=e.source,s=n.call(this)||this;return s.reqId=r,s.source=i,s}return w(t,n),t}(rt),Ny=function(n){function t(e){var r=e.polls,i=e.source,s=n.call(this)||this;return s.polls=r,s.source=i,s}return w(t,n),t}(rt),Ay=function(n){function t(e){var r=e.event,i=e.source,s=n.call(this)||this;return s.event=r,s.source=i,s}return w(t,n),t}(rt),A_=function(n){function t(e){var r=e.event,i=e.source,s=n.call(this)||this;return s.event=r,s.source=i,s}return w(t,n),t}(rt);(function(n){n.OPEN="open",n.CLOSED="closed"})(su||(su={}));var SI="removed",yp=function(n){switch(n){case"open":return su.OPEN;case"closed":return su.CLOSED;default:return null}},ky=function(n){return!n||!!n.text&&R("string",n.text)},dd=function(n){function t(e,r){var i,s,a,o,u,c,l,d=this;return(d=n.call(this,e)||this).pollId=0,d.id=0,d.text=null,d.voteCount=0,d.createdBy=null,d.createdAt=0,d.updatedAt=0,d._lastVotedAt=0,d.pollId=(i=r.poll_id)!==null&&i!==void 0?i:0,d.id=(s=r.id)!==null&&s!==void 0?s:0,d.text=(a=r.text)!==null&&a!==void 0?a:null,d.voteCount=(o=r.vote_count)!==null&&o!==void 0?o:0,d.createdBy=(u=r.created_by)!==null&&u!==void 0?u:null,d.createdAt=(c=r.created_at)!==null&&c!==void 0?c:0,d.updatedAt=(l=r.updated_at)!==null&&l!==void 0?l:0,d}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})))},t}(yn),jr=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m,b=this;return(b=n.call(this,e)||this).id=0,b.title=null,b.createdAt=0,b.updatedAt=0,b.closeAt=-1,b.status=su.CLOSED,b.messageId=0,b.data=null,b.voterCount=-1,b.options=[],b.createdBy=null,b.allowUserSuggestion=!1,b.allowMultipleVotes=!1,b.votedPollOptionIds=[],b.id=(i=r.id)!==null&&i!==void 0?i:0,b.title=(s=r.title)!==null&&s!==void 0?s:null,b.createdAt=(a=r.created_at)!==null&&a!==void 0?a:0,b.updatedAt=(o=r.updated_at)!==null&&o!==void 0?o:0,b.closeAt=(u=r.close_at)!==null&&u!==void 0?u:-1,b.status=(c=yp(r.status))!==null&&c!==void 0?c:su.CLOSED,b.messageId=(l=r.message_id)!==null&&l!==void 0?l:0,b.data=(d=r.data)!==null&&d!==void 0?d:null,b.voterCount=(h=r.voter_count)!==null&&h!==void 0?h:-1,b.options=r.options?r.options.map(function(y){return new dd(b._iid,y)}):[],b.createdBy=(f=r.created_by)!==null&&f!==void 0?f:null,b.allowUserSuggestion=(p=r.allow_user_suggestion)!==null&&p!==void 0&&p,b.allowMultipleVotes=(_=r.allow_multiple_votes)!==null&&_!==void 0&&_,b.votedPollOptionIds=(m=r.voted_option_ids)!==null&&m!==void 0?m:[],b}return w(t,n),t.prototype._applyPollUpdatePayload=function(e){var r,i,s,a,o,u,c,l,d=this;this.title=(r=e.title)!==null&&r!==void 0?r:this.title,this.updatedAt=(i=e.updated_at)!==null&&i!==void 0?i:this.updatedAt,this.closeAt=(s=e.close_at)!==null&&s!==void 0?s:this.closeAt,this.status=(a=yp(e.status))!==null&&a!==void 0?a:this.status,this.data=(o=e.data)!==null&&o!==void 0?o:this.data,this.voterCount=(u=e.voter_count)!==null&&u!==void 0?u:this.voterCount,e.options&&(this.options=e.options.map(function(h){return new dd(d._iid,h)}),this.votedPollOptionIds=e.options.filter(function(h){return h.vote_count>0}).map(function(h){return h.id})),this.allowUserSuggestion=(c=e.allow_user_suggestion)!==null&&c!==void 0?c:this.allowUserSuggestion,this.allowMultipleVotes=(l=e.allow_multiple_votes)!==null&&l!==void 0?l:this.allowMultipleVotes},t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map(function(r){return dd.payloadify(r)}),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})))},t.prototype.applyPollUpdateEvent=function(e){var r=e._payload.poll;return!(!r||this.id!==r.id||r.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(r),!0)},t.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return!1;var r=this.options,i=r.map(function(o){return o.id}),s=e._payload,a=Math.floor(s.ts/1e3);return s.updated_vote_counts.forEach(function(o){var u=i.indexOf(o.option_id);if(u>-1){var c=r[u];a>=c._lastVotedAt&&(c.voteCount=o.vote_count,c._lastVotedAt=a)}}),s.req_id&&s.voted_option_ids&&(this.votedPollOptionIds=s.voted_option_ids),typeof s.voter_count=="number"&&(this.voterCount=s.voter_count),!0},t.prototype.serialize=function(){return Xc(this)},t}(yn),Ta=function(){function n(t,e){var r;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=t,this.limit=(r=e.limit)!==null&&r!==void 0?r:20}return Object.defineProperty(n.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),n.prototype._validate=function(){return R("number",this.limit)&&this.limit>0},n}(),wa=function(n){function t(e,r,i,s){var a=n.call(this,e,s)||this;return a.channelUrl=r,a.channelType=i,a}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&R("string",this.channelUrl)&&be(xe,this.channelType)},t}(Ta),CI=function(n){this.pollId=0,this.messageId=0,this.pollId=n.poll_id,this.messageId=n.message_id,this._payload=n},NI=function(n){function t(e){var r=e.title,i=e.optionTexts,s=e.data,a=e.allowUserSuggestion,o=e.allowMultipleVotes,u=e.closeAt,c=n.call(this)||this;return c.method=j.POST,c.path=_i,c.params={title:r,options:i,data:s,allow_user_suggestion:a,allow_multiple_votes:o,close_at:u},c}return w(t,n),t}(K),AI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new jr(e,r),i}return w(t,n),t}(W),kI=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=n.call(this)||this;return a.method=j.GET,a.path="".concat(_i,"/").concat(encodeURIComponent(s)),a.params={channel_url:r,channel_type:i},a}return w(t,n),t}(K),OI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new jr(e,r),i}return w(t,n),t}(W),MI=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=e.pollOptionId,o=n.call(this)||this;return o.method=j.GET,o.path="".concat(_i,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(a)),o.params={channel_url:r,channel_type:i},o}return w(t,n),t}(K),DI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pollOption=new dd(e,r),i}return w(t,n),t}(W),RI=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,a=e.token,o=n.call(this)||this;return o.method=j.GET,o.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/polls/changelogs"),o.params=re({change_ts:s,token:a}),o}return w(t,n),t}(K),UI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.updatedPolls=r.updated.map(function(s){return function(a,o){return new jr(a,o)}(e,s)}),i.deletedPollIds=r.deleted.map(function(s){return s}),i.hasMore=r.has_more,i.nextToken=r.next,i}return w(t,n),t}(W),LI={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},Oy=function(n){return R("string",n.title)&&(t=n.optionTexts,Ae("string",t)&&t.every(function(e){return e.trim()!==""}))&&ky(n.data)&&R("boolean",n.allowUserSuggestion,!0)&&R("boolean",n.allowMultipleVotes,!0)&&R("number",n.closeAt,!0);var t},PI={channelUrl:"",channelType:xe.BASE,pollId:0,pollOptionId:0},My=function(n){return R("string",n.channelUrl)&&n.channelUrl!==""&&be(xe,n.channelType)&&R("number",n.pollId)&&n.pollId>0&&R("number",n.pollOptionId)&&n.pollOptionId>0},xI={channelUrl:"",channelType:xe.BASE,pollId:0},Dy=function(n){return R("string",n.channelUrl)&&n.channelUrl!==""&&be(xe,n.channelType)&&R("number",n.pollId)},uv={},Pd=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.sessionManager,a=e.requestQueue,o=e.logger;this._iid=t,this._sdkState=r,this._sessionManager=s,this._requestQueue=a,this._dispatcher=i,this._logger=o,uv[t]=this}return n.of=function(t){return uv[t]},n.prototype.buildPollFromSerializedData=function(t){var e=ro(t);return new jr(this._iid,jr.payloadify(e))},n.prototype.get=function(t){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return B(Dy(t)).throw(U.invalidParameters),e=new kI(A({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(OI).poll]}})})},n.prototype.create=function(t){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return B(Oy(t)).throw(U.invalidParameters),e=new NI(A({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(AI).poll]}})})},n.prototype.getOption=function(t){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return B(My(t)).throw(U.invalidParameters),e=new MI(A({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(DI).pollOption]}})})},n.prototype.getPollChangeLogs=function(t,e,r,i){return i===void 0&&(i=z.SYNC_POLL_CHANGELOGS),g(this,void 0,void 0,function(){var s,a,o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:return s=new RI(oe({channelType:e,channelUrl:t,timestamp:typeof r=="number"?r:null,token:typeof r=="string"?r:null})),[4,this._requestQueue.send(s)];case 1:return a=h.sent(),o=a.as(UI),u=o.updatedPolls,c=o.deletedPollIds,l=o.hasMore,d=o.nextToken,u.length>0&&this._dispatcher.dispatch(new Ny({polls:u,source:i})),[2,{updatedPolls:u,deletedPollIds:c,hasMore:l,token:d}]}})})},n}(),FI=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.token,a=e.limit,o=n.call(this)||this;return o.method=j.GET,o.path=_i,o.params={channel_url:r,channel_type:i,token:s,limit:a},o}return w(t,n),t}(K),qI=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).polls=((i=r.polls)!==null&&i!==void 0?i:[]).map(function(a){return new jr(e,a)}),s.token=r.next,s}return w(t,n),t}(W),Ry=function(n){function t(e,r){return n.call(this,e,r.channelUrl,r.channelType,r)||this}return w(t,n),t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new FI(A(A({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(qI),a=s.polls,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(wa),$I=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=e.pollOptionId,o=e.token,u=e.limit,c=n.call(this)||this;return c.method=j.GET,c.path="".concat(_i,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(a),"/voters"),c.params={channel_url:r,channel_type:i,token:o,limit:u},c}return w(t,n),t}(K),HI=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).voters=((i=r.voters)!==null&&i!==void 0?i:[]).map(function(a){return new Oe(e,a)}),s.token=r.next,s}return w(t,n),t}(W),Uy=function(n){function t(e,r){var i=n.call(this,e,r.channelUrl,r.channelType,r)||this;return i.pollId=r.pollId,i.pollOptionId=r.pollOptionId,i}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&R("number",this.pollId)&&R("number",this.pollOptionId)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new $I(A(A({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(HI),a=s.voters,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(wa),Fc,Io=function(){function n(t,e,r){var i,s;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this._requireAuth=!1,this._iid=t,this.plainUrl=e.url,this.width=e.width,this.height=e.height,this.realWidth=(i=e.real_width)!==null&&i!==void 0?i:e.width,this.realHeight=(s=e.real_height)!==null&&s!==void 0?s:e.height,this._requireAuth=r}return n.payloadify=function(t){return re(oe({url:"",width:t.maxWidth,height:t.maxHeight,real_width:0,real_height:0}))},Object.defineProperty(n.prototype,"url",{get:function(){var t=M.of(this._iid).sessionManager;return this._requireAuth&&t.ekey?"".concat(this.plainUrl,"?auth=").concat(t.ekey):this.plainUrl},enumerable:!1,configurable:!0}),n}(),xd=function(n){function t(e){var r=n.call(this)||this;if(r.method=j.POST,r.path="".concat(BT),r.params=re({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var i=0;i<e.thumbnailSizes.length;i++){var s=e.thumbnailSizes[i],a=s.maxWidth,o=s.maxHeight;r.params["thumbnail".concat(i+1)]="".concat(a,",").concat(o)}return r.requestId=e.requestId,r}return w(t,n),t}(K),Fd=function(n){function t(e,r){var i,s,a,o,u=this;return(u=n.call(this,e,r)||this).url=r.url,u.fileSize=(i=r.file_size)!==null&&i!==void 0?i:0,u.thumbnails=(a=(s=r.thumbnails)===null||s===void 0?void 0:s.map(function(c){return new Io(e,c,!1)}))!==null&&a!==void 0?a:[],u.requireAuth=(o=r.require_auth)!==null&&o!==void 0&&o,u}return w(t,n),t}(W),Ep=function(n){function t(e,r){var i,s,a,o=this;return(o=n.call(this,e)||this).replyCount=0,o.lastRepliedAt=0,o.updatedAt=0,o.replyCount=(i=r.reply_count)!==null&&i!==void 0?i:0,o.mostRepliedUsers=r.most_replies&&Ae("object",r.most_replies)?r.most_replies.map(function(u){return new Oe(o._iid,u)}):[],o.lastRepliedAt=(s=r.last_replied_at)!==null&&s!==void 0?s:0,o.updatedAt=(a=r.updated_at)!==null&&a!==void 0?a:0,o}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(r){return Oe.payloadify(r)}):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))},t}(yn);(function(n){n.ADD="add",n.DELETE="delete"})(Fc||(Fc={}));var cv,k_=function(n){this.messageId=0,this.operation=null,this.updatedAt=0;var t=R("string",n.msg_id)?parseInt(n.msg_id):n.msg_id,e=n.user_id,r=n.operation?n.operation.toLowerCase():null,i=n.reaction,s=n.updated_at;t&&R("string",e)&&R("string",r)&&be(Fc,r)&&R("string",i)&&i&&R("number",s)&&(this.messageId=t,this.userId=e,this.key=i,this.operation=r,this.updatedAt=s)},Ml=function(){function n(t){var e,r,i,s=t.key,a=(i=ce([],ie(t.user_ids),!1))!==null&&i!==void 0?i:[],o=t.updated_at;R("string",s)&&s&&Ae("string",a)&&a.length>0&&R("number",o)&&(this.key=s,this.userIds=a,this.updatedAt=o);var u={};try{for(var c=Z(this.userIds),l=c.next();!l.done;l=c.next())u[l.value]=this.updatedAt}catch(d){e={error:d}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}this._version=u}return Object.defineProperty(n.prototype,"isEmpty",{get:function(){return this.userIds.length===0},enumerable:!1,configurable:!0}),n.payloadify=function(t){return re(oe({key:t.key,user_ids:t.userIds,updated_at:t.updatedAt}))},n.prototype.applyEvent=function(t){if(t.key===this.key&&this.updatedAt<=t.updatedAt){if(!this._version[t.userId]||this._version[t.userId]<=t.updatedAt){var e=this.userIds.indexOf(t.userId);switch(t.operation){case Fc.ADD:e<0&&this.userIds.push(t.userId);break;case Fc.DELETE:e>=0&&this.userIds.splice(e,1)}this._version[t.userId]=t.updatedAt}this.updatedAt=Math.max(this.updatedAt,t.updatedAt)}},n}(),lv=function(){function n(t){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=t.url,t.secure_url&&(this.secureUrl=t.secure_url),t.type&&(this.type=t.type),t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.alt&&(this.alt=t.alt)}return n.payloadify=function(t){var e,r;return re(oe({url:t.url,secure_url:t.secureUrl,type:t.type,width:(e=t.width)!==null&&e!==void 0?e:0,height:(r=t.height)!==null&&r!==void 0?r:0,alt:t.alt}))},n}(),dv=function(){function n(t){this.title=null,this.url=null,this.description=null,this.defaultImage=null,t["og:title"]&&(this.title=t["og:title"]),t["og:url"]&&(this.url=t["og:url"]),t["og:description"]&&(this.description=t["og:description"]),t["og:image"]&&(this.defaultImage=new lv(t["og:image"]))}return n.payloadify=function(t){return re(oe({"og:title":t.title,"og:url":t.url,"og:description":t.description,"og:image":t.defaultImage?lv.payloadify(t.defaultImage):null}))},n}(),Kr=function(){function n(t){var e,r;this.volume=0,this.name=(e=t.name)!==null&&e!==void 0?e:"default",this.volume=(r=t.volume)!==null&&r!==void 0?r:1}return n.prototype.serialize=function(){return{name:this.name,volume:this.volume}},n.payloadify=function(t){return re(oe({name:t.name,volume:t.volume}))},n}();(function(n){n.GOOD="good",n.BAD="bad"})(cv||(cv={}));var hv,Wo=function(){function n(t){this.id=t.id,this.rating=t.rating,this.comment=t.comment}return n.parseFeedbackStatusFromPayload=function(t){return t&&t.id!==null&&t.rating!==null?"SUBMITTED":"NOT_APPLICABLE"},n.payloadify=function(t){return re(oe({id:t.id,rating:t.rating,comment:t.comment}))},n}(),au=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).isBlockedByMe=!1,s.role=be(Gr,r.role)?r.role:Gr.NONE,s.isBlockedByMe=(i=r.is_blocked_by_me)!==null&&i!==void 0&&i,s}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))},t}(Oe),Kn=function(){function n(t){this.key=t.key,this.value=Ae("string",t.value)?ce([],ie(t.value),!1):[]}return n.payloadify=function(t){var e;return re(oe({key:t.key,value:(e=t.value)!==null&&e!==void 0?e:[]}))},n}(),Ly=function(n){switch(n){case gt.BASE:return"";case gt.USER:return"MESG";case gt.FILE:return"FILE";case gt.ADMIN:return"ADMM"}},Py=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p=this;(p=n.call(this,e)||this).channelType=xe.BASE,p.messageType=gt.BASE,p.mentionType=null,p.mentionedUsers=null,p.mentionedUserIds=null,p.metaArrays=[],p.extendedMessage={},p.createdAt=0,p.updatedAt=0,p.channelUrl=r.channel_url,p.channelType=be(xe,r.channel_type)?r.channel_type:xe.GROUP,r.channel&&(r.channel.channel_url&&(p.channelUrl=r.channel.channel_url),r.channel.channel_type&&(p.channelType=r.channel.channel_type)),p.data=(i=r.data)!==null&&i!==void 0?i:"",p.customType=(s=r.custom_type)!==null&&s!==void 0?s:"",p.mentionType=be(gn,r.mention_type)?r.mention_type:null,p.mentionedUsers=r.mentioned_users?r.mentioned_users.map(function(E){return new Oe(p._iid,E)}):null,p.mentionedUserIds=(a=r.mentioned_user_ids)!==null&&a!==void 0?a:null,p.mentionedUsers&&!p.mentionedUserIds&&(p.mentionedUserIds=p.mentionedUsers.map(function(E){return E.userId})),p.mentionedMessageTemplate=(o=r.mentioned_message_template)!==null&&o!==void 0?o:"";var _=(u=r.metaarray)!==null&&u!==void 0?u:{},m=(c=r.metaarray_key_order)!==null&&c!==void 0?c:Object.keys(_).sort(function(E,T){return E.localeCompare(T)});p.metaArrays=[];for(var b=0;b<m.length;b++){var y=m[b];p.metaArrays.push(new Kn({key:y,value:_[y]||[]}))}return r.sorted_metaarray&&(p.metaArrays=r.sorted_metaarray.map(function(E){return new Kn(E)})),p.extendedMessage=(l=r.extended_message)!==null&&l!==void 0?l:{},p.extendedMessagePayload=r.extended_message_payload,p.createdAt=(h=(d=r.created_at)!==null&&d!==void 0?d:r.ts)!==null&&h!==void 0?h:0,p.updatedAt=(f=r.updated_at)!==null&&f!==void 0?f:0,p}return w(t,n),t.payloadify=function(e){var r,i;return re(oe(A(A({},n.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,type:Ly(e.messageType),data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:(r=e.mentionedUsers)===null||r===void 0?void 0:r.map(function(s){return Oe.payloadify(s)}),mentioned_message_template:e.mentionedMessageTemplate,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(s){return Kn.payloadify(s)}),extended_message:e.extendedMessage,extended_message_payload:e.extendedMessagePayload,created_at:e.createdAt,updated_at:e.updatedAt})))},t.prototype.isIdentical=function(e){return!0},t.prototype.isEqual=function(e){return H0(this,e)},t.prototype.isUserMessage=function(){return this.messageType===gt.USER},t.prototype.isFileMessage=function(){return this.messageType===gt.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},t.prototype.isMultipleFilesMessage=function(){return this.messageType===gt.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},t.prototype.isAdminMessage=function(){return this.messageType===gt.ADMIN},t.prototype.hasForm=function(){var e,r;return!!(!((r=(e=this.extendedMessagePayload)===null||e===void 0?void 0:e.forms)===null||r===void 0)&&r[0])},t.prototype.serialize=function(){return Xc(this)},t.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter(function(r){return e.includes(r.key)})},t}(yn),mf=function(){function n(t,e,r){this.messageId=t,this.formKey=e,this.fields=r}return Object.defineProperty(n.prototype,"isSubmitted",{get:function(){return this.answers!==void 0&&Object.keys(this.answers).length>0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSubmittable",{get:function(){return this.fields.every(function(t){return t.isSubmittable})},enumerable:!1,configurable:!0}),n.prototype.getFieldAnswer=function(t){var e;return(e=this.answers)===null||e===void 0?void 0:e[t]},n.parseFormKeyFromPayload=function(t){return A(A({},t),{form_key:t.key,fields:t.fields.map(function(e){return bp.parseFieldKeyFromPayload(e)})})},n.payloadify=function(t){return re(oe(A(A({},t),{fields:t.fields.map(function(e){return bp.payloadify(e)})})))},n}(),bp=function(){function n(t){this.fieldKey=t.field_key,this.inputType=t.input_type,this.title=t.title,this.required=t.required,this.regex=t.regex,this.placeholder=t.placeholder}return n.prototype.isValid=function(t){var e,r;try{return(r=(e=this.regex)===null||e===void 0?void 0:e.test(t))===null||r===void 0||r}catch{return!0}},Object.defineProperty(n.prototype,"isSubmittable",{get:function(){return!(this.temporaryAnswer!=null&&!this.isValid(this.temporaryAnswer)||this.required&&this.temporaryAnswer==null)},enumerable:!1,configurable:!0}),n.parseFieldKeyFromPayload=function(t){return A(A({},t),{field_key:t.key})},n.payloadify=function(t){return re(oe(t))},n}();(function(n){n.Text="text",n.Phone="phone",n.Email="email",n.Password="password"})(hv||(hv={}));var fv=function(n){function t(e){var r=n.call(this)||this;return r.method=j.POST,r.path=JT(e.channelUrl,e.messageId),r.params=re({forms:e.forms}),r}return w(t,n),t}(K),zI=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.rating,o=e.comment,u=n.call(this)||this;return u.method=j.POST,u.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks"),u.params={rating:a,comment:o},u}return w(t,n),t}(K),GI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.feedback=new Wo(r),i}return w(t,n),t}(W),VI=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.feedbackId,o=e.rating,u=e.comment,c=n.call(this)||this;return c.method=j.PUT,c.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks/").concat(a),c.params={rating:o,comment:u},c}return w(t,n),t}(K),BI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.feedback=new Wo(r),i}return w(t,n),t}(W),jI=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.feedbackId,o=n.call(this)||this;return o.method=j.DELETE,o.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/feedbacks/").concat(a),o}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.feedback=new Wo(r),i}w(t,n)})(W);var ia,Er,Tp=function(n){function t(e,r){var i,s,a,o,u,c=this;return(c=n.call(this,e)||this).plainUrl="",c.fileName=null,c.mimeType=null,c.fileSize=0,c.thumbnails=[],c._requireAuth=!1,c.plainUrl=(i=r.url)!==null&&i!==void 0?i:"",c.fileName=(s=r.file_name)!==null&&s!==void 0?s:null,c.mimeType=(a=r.file_type)!==null&&a!==void 0?a:null,c.fileSize=(o=r.file_size)!==null&&o!==void 0?o:0,c._requireAuth=(u=r.require_auth)!==null&&u!==void 0&&u,c.thumbnails=r.thumbnails?r.thumbnails.map(function(l){var d;return new Io(c._iid,typeof l=="string"?{url:l,width:0,height:0}:A(A({},l),{url:((d=l.url)!==null&&d!==void 0?d:"").split("auth=")[0]}),c._requireAuth)}):[],c}return w(t,n),t.payloadify=function(e){var r;return re(oe({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){var s;return{url:((s=i.plainUrl)!==null&&s!==void 0?s:"").split("auth=")[0],width:i.width,height:i.height,real_width:i.realWidth,real_height:i.realHeight}}),require_auth:e._requireAuth}))},Object.defineProperty(t.prototype,"url",{get:function(){var e=M.of(this._iid).sessionManager;return this._requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t}(yn);(function(n){n.PENDING="pending",n.SENT="sent",n.FAILED="failed",n.CANCELED="canceled"})(ia||(ia={})),function(n){n.PENDING="pending",n.IN_QUEUE="in_queue",n.SENT="sent",n.FAILED="failed",n.CANCELED="canceled",n.REMOVED="removed"}(Er||(Er={}));var Za,Nn=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m=this;return(m=n.call(this,e,r)||this).parentMessage=null,m.silent=!1,m.isOperatorMessage=!1,m.threadInfo=null,m.reactions=[],m.appleCriticalAlertOptions=null,m.scheduledInfo=null,m.suggestedReplies=null,m.myFeedback=null,m.myFeedbackStatus="NOT_APPLICABLE",m.forms=null,m._isContinuousMessages=!1,m._scheduledStatus=null,m.messageId=(s=(i=r.msg_id)!==null&&i!==void 0?i:r.message_id)!==null&&s!==void 0?s:0,m.parentMessageId=(a=typeof r.parent_message_id=="string"?parseInt(r.parent_message_id):r.parent_message_id)!==null&&a!==void 0?a:0,m.threadInfo=r.thread_info?new Ep(m._iid,r.thread_info):null,m.reactions=r.reactions?r.reactions.map(function(b){return new Ml(b)}):[],m.ogMetaData=r.og_tag?new dv(r.og_tag):null,m.silent=(o=r.silent)!==null&&o!==void 0&&o,m.isOperatorMessage=(u=r.is_op_msg)!==null&&u!==void 0&&u,m.appleCriticalAlertOptions=r.apple_critical_alert_options?new Kr(r.apple_critical_alert_options):null,typeof r.scheduled_message_id=="number"&&typeof r.scheduled_at=="number"&&r.scheduled_status&&(m.scheduledInfo={scheduledMessageId:r.scheduled_message_id,scheduledAt:r.scheduled_at},m._scheduledStatus=r.scheduled_status),m._isContinuousMessages=(c=r.is_continuous_messages)!==null&&c!==void 0&&c,m.myFeedback=!((l=r.feedback)===null||l===void 0)&&l.id?new Wo(r.feedback):null,m.myFeedbackStatus=(d=r.my_feedback_status)!==null&&d!==void 0?d:Wo.parseFeedbackStatusFromPayload(r.feedback),m.suggestedReplies=(f=(h=r.extended_message_payload)===null||h===void 0?void 0:h.suggested_replies)!==null&&f!==void 0?f:null,m.forms=!((_=(p=r.extended_message_payload)===null||p===void 0?void 0:p.forms)===null||_===void 0)&&_[0]?r.extended_message_payload.forms.map(function(b){var y=mf.parseFormKeyFromPayload(b);return new mf(m.messageId,y.form_key,y.fields.map(function(E){return new bp(E)}))}):null,m}return w(t,n),t.payloadify=function(e){var r,i,s,a;return re(oe(A(A({},n.payloadify.call(this,e)),{message_id:e.messageId,parent_message_id:e.parentMessageId,thread_info:e.threadInfo?Ep.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(o){return Ml.payloadify(o)}),og_tag:e.ogMetaData?dv.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,scheduled_message_id:(r=e.scheduledInfo)===null||r===void 0?void 0:r.scheduledMessageId,scheduled_at:(i=e.scheduledInfo)===null||i===void 0?void 0:i.scheduledAt,scheduled_status:e._scheduledStatus,feedback:e.myFeedback?Wo.payloadify(e.myFeedback):null,my_feedback_status:e.myFeedbackStatus,forms:((a=(s=e.extendedMessagePayload)===null||s===void 0?void 0:s.forms)===null||a===void 0?void 0:a[0])!=null?e.extendedMessagePayload.forms.map(function(o){return mf.payloadify(o)}):null})))},t._getParentMessageInfoPayload=function(e){return re(oe({type:Ly(e.messageType),ts:e.createdAt,user:e.sender?au.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth},files:Array.isArray(e.fileInfoList)?e.fileInfoList.map(function(r){return Tp.payloadify(r)}):null}))},t.prototype.isIdentical=function(e){return this.messageId===e.messageId},t.prototype.applyThreadInfoUpdateEvent=function(e){return this.messageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},t.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var r=!1,i=0;i<this.reactions.length;i++)if(this.reactions[i].key===e.key){this.reactions[i].applyEvent(e),this.reactions[i].isEmpty&&this.reactions.splice(i,1),r=!0;break}r||e.operation!=="add"||this.reactions.push(new Ml(Ml.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},t.prototype.applyParentMessage=function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var r=this.parentMessage.updatedAt;if(e.updatedAt>=r)return this.parentMessage=e,!0}return!1},t.prototype.submitForm=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l;return v(this,function(d){switch(d.label){case 0:return r=M.of(this._iid),i=r.requestQueue,s=r.sdkState,a=r.logger,e.formId&&e.answers?(a.warn("The submitForm method with formId and answers is deprecated. Use submitForm({ form: Form }) instead."),o=new fv({userId:s.userId,channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,forms:[{form_key:e.formId,data:e.answers}]}),[4,i.send(o)]):[3,2];case 1:case 3:return d.sent(),[2];case 2:if(!(u=e.form).isSubmittable||u.isSubmitted)throw new U({code:ae.INVALID_PARAMETER,message:u.isSubmitted?"The given form is already submitted.":"The given form is not submittable."});if(u.messageId!=this.messageId)throw new U({code:ae.INVALID_PARAMETER,message:"This form does not belong to the message."});return c=u.fields.reduce(function(h,f){return h[f.fieldKey]=f.temporaryAnswer,h},{}),l=new fv({userId:s.userId,channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,forms:[{form_key:u.formKey,data:c}]}),[4,i.send(l)]}})})},t.prototype.submitFeedback=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return r=M.of(this._iid),i=r.requestQueue,s=r.dispatcher,a=new zI({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,rating:e.rating,comment:e.comment}),[4,i.send(a)];case 1:return o=c.sent(),u=o.as(GI),this.myFeedback=u.feedback,this.myFeedbackStatus="SUBMITTED",s.dispatch(new mt({messages:[this],source:z.EVENT_MESSAGE_FEEDBACK_ADDED})),[2]}})})},t.prototype.updateFeedback=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return r=M.of(this._iid),i=r.requestQueue,s=r.dispatcher,a=new VI({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e.id,rating:e.rating,comment:e.comment}),[4,i.send(a)];case 1:return o=c.sent(),u=o.as(BI),this.myFeedback=u.feedback,this.myFeedbackStatus="SUBMITTED",s.dispatch(new mt({messages:[this],source:z.EVENT_MESSAGE_FEEDBACK_UPDATED})),[2]}})})},t.prototype.deleteFeedback=function(e){return g(this,void 0,void 0,function(){var r,i,s,a;return v(this,function(o){switch(o.label){case 0:return r=M.of(this._iid),i=r.requestQueue,s=r.dispatcher,a=new jI({channelUrl:this.channelUrl,channelType:this.channelType,messageId:this.messageId,feedbackId:e}),[4,i.send(a)];case 1:return o.sent(),this.myFeedback=null,this.myFeedbackStatus="NO_FEEDBACK",s.dispatch(new mt({messages:[this],source:z.EVENT_MESSAGE_FEEDBACK_DELETED})),[2]}})})},t}(Py),kt=function(n){function t(e,r){var i,s,a,o,u=this;if((u=n.call(this,e,r)||this).reqId="",u.replyToChannel=!1,u.errorCode=0,u.sender=r.user?new au(u._iid,r.user):r.sender_id,u.reqId=(s=(i=r.req_id)!==null&&i!==void 0?i:r.request_id)!==null&&s!==void 0?s:"",u.replyToChannel=(a=r.is_reply_to_channel)!==null&&a!==void 0&&a,r.request_state&&be(tt,r.request_state)&&(u.sendingStatus=r.request_state),!u.sendingStatus)if(u.messageId>0)u.sendingStatus=tt.SUCCEEDED;else if(u.scheduledInfo)switch(r.scheduled_status&&(u._scheduledStatus=r.scheduled_status),r.scheduled_status){case Er.SENT:case Er.IN_QUEUE:u.sendingStatus=tt.SUCCEEDED;break;case Er.PENDING:u.sendingStatus=tt.SCHEDULED;break;case Er.FAILED:case Er.REMOVED:u.sendingStatus=tt.FAILED;break;case Er.CANCELED:u.sendingStatus=tt.CANCELED}else u.sendingStatus=tt.PENDING;return u.errorCode=(o=r.error_code)!==null&&o!==void 0?o:0,u}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{user:au.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})))},Object.defineProperty(t.prototype,"isResendable",{get:function(){return(this.sendingStatus===tt.FAILED||this.sendingStatus===tt.CANCELED)&&qT(this.errorCode)},enumerable:!1,configurable:!0}),t.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},t}(Nn),el={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:mn.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},fh=function(n){return R("number",n.prevResultSize)&&R("number",n.nextResultSize)&&R("boolean",n.isInclusive)&&R("boolean",n.reverse)&&R("string",n.messageTypeFilter)&&be(mn,n.messageTypeFilter)&&Ae("string",n.customTypesFilter,!0)&&Ae("string",n.senderUserIdsFilter,!0)&&R("boolean",n.includeMetaArray)&&R("boolean",n.includeReactions)&&R("boolean",n.includeParentMessageInfo)},ou=function(n){function t(e,r){var i,s,a,o,u=this;if((u=n.call(this,e,r)||this).translations={},u.message=(i=r.message)!==null&&i!==void 0?i:"",u.messageType=gt.ADMIN,u.translations=(s=r.translations)!==null&&s!==void 0?s:{},r.parent_message_info){var c=r.parent_message_info;u.parentMessage=$n(e,re(oe(A(A({},c),{message_id:u.parentMessageId,channel_url:u.channelUrl,channel_type:u.channelType,file:c.file,url:(a=c.file)===null||a===void 0?void 0:a.url,require_auth:(o=c.file)===null||o===void 0?void 0:o.require_auth}))))}return u}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},t.prototype.getThreadedMessagesByTimestamp=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},el),r),B(this.messageId>0&&R("number",e)&&fh(i)).throw(U.invalidParameters),[4,Xt.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t}(Nn),pv=function(){function n(t){var e,r;this.detail={},this.type=(e=t.type)!==null&&e!==void 0?e:"",this.vendor=(r=t.vendor)!==null&&r!==void 0?r:"",t.detail&&R("object",t.detail)&&!Array.isArray(t.detail)&&(this.detail=t.detail)}return n.payloadify=function(t){return re(oe({type:t.type,vendor:t.vendor,detail:t.detail}))},n}(),_v=function(){function n(t){this.status=t.status,t.original_message_info&&(this.originalMessageInfo={createdAt:t.original_message_info.ts,messageId:t.original_message_info.id})}return n.payloadify=function(t){return re({status:t.status,original_message_info:t.originalMessageInfo?{id:t.originalMessageInfo.messageId,ts:t.originalMessageInfo.createdAt}:void 0})},n}(),_n=function(n){function t(e,r){var i,s,a,o,u,c,l,d=this;if((d=n.call(this,e,r)||this).message="",d.messageParams=null,d.translations={},d.translationTargetLanguages=[],d.messageSurvivalSeconds=-1,d.plugins=[],d._poll=null,d.message=r.message,d.messageType=gt.USER,d.translations=(a=r.translations)!==null&&a!==void 0?a:{},d.translationTargetLanguages=(o=r.target_langs)!==null&&o!==void 0?o:[],Object.keys(d.translations).length===0&&d.translationTargetLanguages.length>0)try{for(var h=Z(d.translationTargetLanguages),f=h.next();!f.done;f=h.next()){var p=f.value;d.translations[p]=""}}catch(m){i={error:m}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}if(d.messageSurvivalSeconds=(u=r.message_survival_seconds)!==null&&u!==void 0?u:-1,d.plugins=r.plugins?r.plugins.map(function(m){return new pv(m)}):[],d._poll=r.poll?new jr(d._iid,r.poll):null,r.parent_message_info){var _=r.parent_message_info;d.parentMessage=$n(e,re(oe(A(A({},_),{created_at:_.ts,message_id:d.parentMessageId,channel_url:d.channelUrl,channel_type:d.channelType,file:_.file,url:(c=_.file)===null||c===void 0?void 0:c.url,require_auth:(l=_.file)===null||l===void 0?void 0:l.require_auth}))))}return r.review_info&&(d.messageReviewInfo=new _v(r.review_info)),d}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(r){return pv.payloadify(r)}),poll:e._poll?jr.payloadify(e._poll):null,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null,review_info:e.messageReviewInfo?_v.payloadify(e.messageReviewInfo):void 0})))},t.prototype.getThreadedMessagesByTimestamp=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},el),r),B(this.messageId>0&&R("number",e)&&fh(i)).throw(U.invalidParameters),[4,Xt.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(t.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),t}(kt),Ir=function(n){function t(e,r){var i,s,a,o,u,c=this;if((c=n.call(this,e,r)||this).messageParams=null,c.fileInfoList=[],c.messageSurvivalSeconds=-1,c.messageType=gt.FILE,c.fileInfoList=(s=(i=r.files)===null||i===void 0?void 0:i.map(function(d){return new Tp(e,d)}))!==null&&s!==void 0?s:[],c.messageSurvivalSeconds=(a=r.message_survival_seconds)!==null&&a!==void 0?a:-1,r.parent_message_info){var l=r.parent_message_info;c.parentMessage=$n(e,re(oe(A(A({},l),{created_at:l.ts,message_id:c.parentMessageId,channel_url:c.channelUrl,channel_type:c.channelType,file:l.file,url:(o=l.file)===null||o===void 0?void 0:o.url,require_auth:(u=l.file)===null||u===void 0?void 0:u.require_auth}))))}return c}return w(t,n),t.prototype.getThreadedMessagesByTimestamp=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},el),r),B(this.messageId>0&&R("number",e)&&fh(i)).throw(U.invalidParameters),[4,Xt.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{files:Array.isArray(e.fileInfoList)?e.fileInfoList.map(function(r){return Tp.payloadify(r)}):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},t._isMultipleFilesMessagePayload=function(e){var r=e.files;return Array.isArray(r)&&r.length>=2},t._isMultipleFilesMessageSerializedData=function(e){var r=e.fileInfoList;return Array.isArray(r)},t}(kt);(function(n){n.SENT="SENT",n.READ="READ"})(Za||(Za={}));var _o=function(n){function t(e,r){var i,s=this;if((s=n.call(this,e,r)||this).notificationData=null,s.notificationId=r.notification_message_id,s.messageType=gt.ADMIN,s.messageStatus=(i=r.message_status)!==null&&i!==void 0?i:Za.SENT,s.extendedMessage.sub_type===0)try{var a=JSON.parse(s.extendedMessage.sub_data),o=a.label,u=a.tags,c=u===void 0?[]:u,l=a.template_key,d=a.template_variables;s.notificationData={label:o,tags:c,templateKey:l,templateVariables:d}}catch{}return s}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{notification_message_id:e.notificationId,message_status:e.messageStatus})))},t.prototype.isIdentical=function(e){return this.notificationId===e.notificationId},t}(Py),mv=function(n){if(n.notificationId)return _o.payloadify(n);switch(n.messageType){case gt.USER:return _n.payloadify(n);case gt.FILE:return n.fileInfoList?Ir.payloadify(n):qt.payloadify(n);case gt.ADMIN:return ou.payloadify(n);default:throw U.unknown}},$n=function(n,t){if(t.notification_message_id)return new _o(n,t);switch(t.type){case"MESG":return new _n(n,t);case"FILE":return Ir._isMultipleFilesMessagePayload(t)?new Ir(n,t):new qt(n,t);case"ADMM":case"BRDM":return new ou(n,t);default:return null}},qt=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m,b,y=this;(y=n.call(this,e,r)||this).messageParams=null,y.plainUrl="",y.requireAuth=!1,y.thumbnails=[],y.messageSurvivalSeconds=-1,y.messageType=gt.FILE;var E=r.file;if(y.plainUrl=((s=(i=E==null?void 0:E.url)!==null&&i!==void 0?i:r.url)!==null&&s!==void 0?s:"").split("?auth=")[0],y.name=(o=(a=E==null?void 0:E.name)!==null&&a!==void 0?a:r.name)!==null&&o!==void 0?o:"File",y.size=(c=(u=E==null?void 0:E.size)!==null&&u!==void 0?u:r.size)!==null&&c!==void 0?c:0,y.data=(d=(l=E==null?void 0:E.data)!==null&&l!==void 0?l:r.custom)!==null&&d!==void 0?d:"",y.type=E?(h=E.type)!==null&&h!==void 0?h:"":(f=r.type)!==null&&f!==void 0?f:"",y.requireAuth=(p=r.require_auth)!==null&&p!==void 0&&p,y.thumbnails=r.thumbnails?r.thumbnails.map(function(N){var C;return new Io(y._iid,typeof N=="string"?{url:N,width:0,height:0}:A(A({},N),{url:((C=N.url)!==null&&C!==void 0?C:"").split("auth=")[0]}),y.requireAuth)}):[],y.messageSurvivalSeconds=(_=r.message_survival_seconds)!==null&&_!==void 0?_:-1,r.parent_message_info){var T=r.parent_message_info;y.parentMessage=$n(e,re(oe(A(A({},T),{created_at:T.ts,message_id:y.parentMessageId,channel_url:y.channelUrl,channel_type:y.channelType,file:T.file,url:(m=T.file)===null||m===void 0?void 0:m.url,require_auth:(b=T.file)===null||b===void 0?void 0:b.require_auth}))))}return y}return w(t,n),t.payloadify=function(e){var r;return re(oe(A(A({},n.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{url:i.plainUrl,width:i.width,height:i.height,real_width:i.realWidth,real_height:i.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},Object.defineProperty(t.prototype,"url",{get:function(){var e=M.of(this._iid).sessionManager;return this.requireAuth&&e.ekey?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t.prototype.getThreadedMessagesByTimestamp=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},el),r),B(this.messageId>0&&R("number",e)&&fh(i)).throw(U.invalidParameters),[4,Xt.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t}(kt),qd=function(n){function t(e,r){var i=r.file,s=r.fileUrl,a=r.fileName,o=r.fileSize,u=r.mimeType,c=r.thumbnailSizes,l=r._uploadedMetaData,d=n.call(this,e)||this;return d._plainUrl=s,d.file=i,d.fileName=a,d.fileSize=o,d.mimeType=u,d.thumbnailSizes=c,d._uploadedMetaData=l,d}return w(t,n),t.getPlainUrl=function(e){return e instanceof t?e._plainUrl:e.fileUrl},Object.defineProperty(t.prototype,"fileUrl",{get:function(){var e,r=M.of(this._iid).sessionManager;return this._plainUrl&&(!((e=this._uploadedMetaData)===null||e===void 0)&&e.requireAuth)&&r.ekey?"".concat(this._plainUrl,"?auth=").concat(r.ekey):this._plainUrl},set:function(e){this._plainUrl=e},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{file:this.file,fileUrl:this._plainUrl,fileName:this.fileName,fileSize:this.fileSize,mimeType:this.mimeType,thumbnailSizes:this.thumbnailSizes,_uploadedMetaData:this._uploadedMetaData}},t}(yn),KI=function(n){function t(e){var r,i,s,a=[];return e.mentionType===gn.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map(function(o){return o.userId}))),n.call(this,{code:"FILE",ackRequired:!0,payload:re(oe({channel_url:e.channelUrl,files:e.files?Fy(e.files):null,url:e.url,name:(r=e.fileName)!==null&&r!==void 0?r:"",type:(i=e.mimeType)!==null&&i!==void 0?i:"",size:(s=e.fileSize)!==null&&s!==void 0?s:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:a,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==hi.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,pin_message:e.isPinnedMessage}))})||this}return w(t,n),t}(Yn),QI=function(n){function t(e){var r,i,s=this;s=n.call(this)||this;var a=[];return e.mentionType===gn.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map(function(o){return o.userId}))),s.method=j.POST,s.path="".concat(Le(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),s.params=re(oe({message_type:gt.FILE,user_id:e.userId,files:e.files?Fy(e.files):null,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:a,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:(r=e.thumbnailSizes)===null||r===void 0?void 0:r.map(function(o){return Io.payloadify(o)}),require_auth:e.requireAuth,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(o){return Kn.payloadify(o)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,reply_to_channel:e.isReplyToChannel,req_id:e.reqId,pin_message:e.isPinnedMessage})),s}return w(t,n),t}(K),xy=function(n){function t(e,r,i){var s,a,o,u,c=this;(c=n.call(this,e,"FILE",i)||this).message=i.files&&i.files.length>=2?new Ir(e,i):new qt(e,i);var l=M.of(e).sdkState;return c.isMentioned=nu(c.message.mentionType,(o=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(a=c.message.mentionedUsers)===null||a===void 0?void 0:a.map(function(d){return d.userId}))!==null&&o!==void 0?o:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return w(t,n),t}(it),WI=function(n){function t(e,r){var i,s,a,o,u=this;(u=n.call(this,e,r)||this).message=r.files&&r.files.length>=2?new Ir(e,r):new qt(e,r);var c=M.of(e).sdkState;return u.isMentioned=nu(u.message.mentionType,(a=(i=u.message.mentionedUserIds)!==null&&i!==void 0?i:(s=u.message.mentionedUsers)===null||s===void 0?void 0:s.map(function(l){return l.userId}))!==null&&a!==void 0?a:[],c.userId),u.forceUpdateLastMessage=(o=r.force_update_last_message)!==null&&o!==void 0&&o,u}return w(t,n),t}(W);function Fy(n){return n.map(function(t){var e,r;return re(oe({url:qd.getPlainUrl(t),file_name:t.fileName,file_type:t.mimeType,file_size:t.fileSize,thumbnails:(e=t.thumbnailSizes)===null||e===void 0?void 0:e.map(function(i){return Io.payloadify(i)}),require_auth:(r=t._uploadedMetaData)===null||r===void 0?void 0:r.requireAuth}))})}var Bt;(function(n){n[n.PENDING=0]="PENDING",n[n.UPLOADING=1]="UPLOADING",n[n.UPLOADED=2]="UPLOADED",n[n.SENDING=3]="SENDING",n[n.FAILED=4]="FAILED"})(Bt||(Bt={}));var YI=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.requestQueue,a=e.onlineDetector,o=e.cacheContext,u=this;this._queueMap=new Map,this._iid=t,this._sdkState=r,this._requestQueue=s,this._cacheContext=o,this._dispatcher=i,this._dispatcher.on(function(c){c instanceof Ar&&(u._connectionState=c.stateType)}),this._onlineDetector=a}return Object.defineProperty(n.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===qe.CONNECTED||this._connectionState===qe.CONNECTING||this._connectionState===qe.RECONNECTING},enumerable:!1,configurable:!0}),n.prototype._sendFileMessage=function(t,e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return r=this._createSendFileMessageRequestParams(t,e),this._shouldSendThroughWebSocket?(i=new KI(r),[4,this._requestQueue.send(i)]):[3,2];case 1:return s=a.sent(),[2,s.as(xy).message];case 2:return i=new QI(A(A({},r),{userId:this._sdkState.userId})),[4,this._requestQueue.send(i)];case 3:return s=a.sent(),[2,s.as(WI).message]}})})},n.prototype._createSendFileMessageRequestParams=function(t,e){var r=A(A({},e.params),{channelUrl:t.url,channelType:t.channelType,reqId:e.requestId,url:""});if(e.multipleFileUploadInfo){var i=e.params;r.files=i.fileInfoList}else i=e.params,r.url=i.fileUrl,r.requireAuth=i.requireAuth;return r},n.prototype._resolveMessageQueue=function(t){var e;return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h,f,p,_;return v(this,function(m){switch(m.label){case 0:if(!(r=this._queueMap.get(t.url)))return[3,21];if(r.isResolving)return[3,20];r.isResolving=!0,i=[],s=!0,m.label=1;case 1:m.trys.push([1,15,16,17]),a=Z(r.messageQueue),o=a.next(),m.label=2;case 2:if(o.done)return[3,14];switch(u=o.value,u.state){case Bt.PENDING:case Bt.UPLOADING:return[3,3];case Bt.UPLOADED:return[3,4];case Bt.FAILED:return[3,12]}return[3,13];case 3:return s=!1,i.push(u),[3,13];case 4:if(!s)return[3,10];m.label=5;case 5:return m.trys.push([5,8,,9]),u.state=Bt.SENDING,[4,this._sendFileMessage(t,u)];case 6:return c=m.sent(),u.deferred.resolve(c),[4,mr(100)];case 7:return m.sent(),[3,9];case 8:return l=m.sent(),u.deferred.reject(l),[3,9];case 9:return[3,11];case 10:i.push(u),m.label=11;case 11:return[3,13];case 12:return d=(e=u.error)!==null&&e!==void 0?e:U.unknown,u.deferred.reject(d.code===ae.REQUEST_CANCELED?U.fileUploadCanceled:d),[3,13];case 13:return o=a.next(),[3,2];case 14:return[3,17];case 15:return h=m.sent(),p={error:h},[3,17];case 16:try{o&&!o.done&&(_=a.return)&&_.call(a)}finally{if(p)throw p.error}return[7];case 17:return f=r.isResolveRequestPending,r.messageQueue=i,r.isResolving=!1,r.isResolveRequestPending=!1,f?[4,this._resolveMessageQueue(t)]:[3,19];case 18:m.sent(),m.label=19;case 19:return[3,21];case 20:r.isResolveRequestPending=!0,m.label=21;case 21:return[2]}})})},n.prototype._uploadNextPendingItem=function(t){var e;return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h;return v(this,function(f){switch(f.label){case 0:return(r=this._queueMap.get(t.url))&&(i=r.messageQueue.find(function(p){return p.state===Bt.PENDING}))?i.multipleFileUploadInfo?(s=i.multipleFileUploadInfo,a=s.uploadIndex,o=s.uploadCount,u=s.requestHandler,h=i.params,c=h.fileInfoList[a],!On(c.file)||!((e=c._uploadedMetaData)===null||e===void 0)&&e.isUploaded?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(t,r,i)]):[3,4]:[3,9];case 1:return f.sent(),[3,3];case 2:i.state=a<o-1?Bt.PENDING:Bt.UPLOADED,f.label=3;case 3:return l=h.fileInfoList[a],d=i.multipleFileUploadInfo.uploadIndex++,i.multipleFileUploadInfo.isCopy||u==null||u._triggerOnFileUploaded(i.requestId,d,l,i.error),[3,7];case 4:return h=i.params,On(h.file)?[4,this._tryUploadNextItemAndUpdateItemState(t,r,i)]:[3,6];case 5:return f.sent(),[3,7];case 6:h.thumbnailSizes=[],i.state=Bt.UPLOADED,f.label=7;case 7:return this._uploadNextPendingItem(t),[4,this._resolveMessageQueue(t)];case 8:f.sent(),f.label=9;case 9:return[2]}})})},n.prototype._tryUploadNextItemAndUpdateItemState=function(t,e,r){return g(this,void 0,void 0,function(){var i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return[4,this._onlineDetector.isOnline()];case 1:if(i=l.sent(),!M.of(this._iid).sessionManager.currentUser||!i)return r.error=U.connectionRequired,r.state=Bt.FAILED,[2];if(!(e.uploadQueue.length<6))return[3,9];r.state=Bt.UPLOADING,e.uploadQueue.push(r),l.label=2;case 2:return l.trys.push([2,7,,8]),r.multipleFileUploadInfo?(s=r.multipleFileUploadInfo,a=s.uploadIndex,o=s.uploadCount,u=r.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(t,r,u)]):[3,4];case 3:return l.sent(),r.state=a<o-1?Bt.PENDING:Bt.UPLOADED,[3,6];case 4:return u=r.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(t,r,u)];case 5:l.sent(),r.state=Bt.UPLOADED,l.label=6;case 6:return[3,8];case 7:switch((c=l.sent()).code){case ae.REQUEST_FAILED:r.error=new U({code:ae.NETWORK_ERROR,message:"Failed to upload a file."});break;case ae.REQUEST_CANCELED:r.error=U.fileUploadCanceled;break;default:r.error=c}return r.state=Bt.FAILED,[3,8];case 8:this._dequeueUploadItem(e,r),l.label=9;case 9:return[2]}})})},n.prototype._dequeueUploadItem=function(t,e){var r=t.uploadQueue.findIndex(function(i){return i.requestId===e.requestId});r>=0&&t.uploadQueue.splice(r,1)},n.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(t,e,r){var i,s,a;return g(this,void 0,void 0,function(){var o,u,c,l,d,h,f,p,_,m;return v(this,function(b){switch(b.label){case 0:return o=new xd({file:r.file,channelUrl:t.url,thumbnailSizes:r.thumbnailSizes,requestId:e.requestId}),[4,this._requestQueue.send(o)];case 1:return u=b.sent(),c=u.as(Fd),l=c.url,d=c.fileSize,h=d===void 0?r.fileSize:d,f=c.thumbnails,p=f===void 0?[]:f,_=c.requireAuth,m=_!==void 0&&_,r.fileName=(i=r.fileName)!==null&&i!==void 0?i:r.file.name,r.mimeType=(s=r.mimeType)!==null&&s!==void 0?s:r.file.type,r.fileSize=(a=r.fileSize)!==null&&a!==void 0?a:r.file.size,r.fileUrl=l,r.fileSize=h,r.thumbnailSizes=p==null?void 0:p.map(function(y){return{maxWidth:y.width,maxHeight:y.height}}),r.requireAuth=m,[2]}})})},n.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(t,e,r){var i,s,a;return g(this,void 0,void 0,function(){var o,u,c,l,d,h,f,p,_,m,b;return v(this,function(y){switch(y.label){case 0:return o=e.multipleFileUploadInfo.uploadIndex,u=r.fileInfoList[o],c=new xd({file:u.file,channelUrl:t.url,thumbnailSizes:u.thumbnailSizes,requestId:e.requestId}),[4,this._requestQueue.send(c)];case 1:return l=y.sent(),d=l.as(Fd),h=d.url,f=d.fileSize,p=f===void 0?u.fileSize:f,_=d.thumbnails,m=d.requireAuth,b=m!==void 0&&m,u.fileName=(i=u.fileName)!==null&&i!==void 0?i:u.file.name,u.mimeType=(s=u.mimeType)!==null&&s!==void 0?s:u.file.type,u.fileSize=(a=u.fileSize)!==null&&a!==void 0?a:u.file.size,u.file=void 0,u.fileUrl=h,u.fileSize=p,u.thumbnailSizes=_==null?void 0:_.map(function(E){return{maxWidth:E.width,maxHeight:E.height}}),u._uploadedMetaData=A(A({},u._uploadedMetaData),{requireAuth:b,isUploaded:!0}),u instanceof qd||(r.fileInfoList[o]=new qd(this._iid,u)),[2]}})})},n.prototype.request=function(t,e,r,i){return i===void 0&&(i={}),g(this,void 0,void 0,function(){var s,a,o,u,c;return v(this,function(l){return this._queueMap.has(t.url)||(s={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(t.url,s)),a=this._queueMap.get(t.url),o=new Fn,u={requestId:e,params:r,state:Bt.PENDING,deferred:o},function(d){return"fileInfoList"in d}(r)&&(c=A({uploadIndex:0,uploadCount:r.fileInfoList.length},i),u.multipleFileUploadInfo=c),a.messageQueue.push(u),this._uploadNextPendingItem(t),[2,o.promise]})})},n.prototype.cancel=function(t,e){var r,i,s=this._queueMap.get(t.url);if(s){var a=e?[s.messageQueue.find(function(p){return p.requestId===e})]:ce([],ie(s.messageQueue),!1);try{for(var o=Z(a),u=o.next();!u.done;u=o.next()){var c=u.value;if(c)switch(c.state){case Bt.PENDING:if(c.state=Bt.FAILED,c.error=U.requestCanceled,c.multipleFileUploadInfo&&!c.multipleFileUploadInfo.isCopy){var l=c.multipleFileUploadInfo,d=l.uploadIndex,h=l.requestHandler,f=c.params.fileInfoList[d];h==null||h._triggerOnFileUploaded(c.requestId,d,f,U.fileUploadCanceled)}this._resolveMessageQueue(t);break;case Bt.UPLOADING:this._requestQueue.cancel(c.requestId),this._dispatcher.dispatch(new Od({requestId:c.requestId}))}}}catch(p){r={error:p}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}}else e&&(this._requestQueue.cancel(e),this._dispatcher.dispatch(new Od({requestId:e})))},n}(),wp,uc={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:mn.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:vn.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},vv=function(n){return R("number",n.prevResultSize)&&R("number",n.nextResultSize)&&R("boolean",n.isInclusive)&&R("boolean",n.reverse)&&R("string",n.messageTypeFilter)&&be(mn,n.messageTypeFilter)&&Ae("string",n.customTypesFilter,!0)&&Ae("string",n.senderUserIdsFilter,!0)&&be(vn,n.replyType)&&R("boolean",n.includeMetaArray)&&R("boolean",n.includeReactions)&&R("boolean",n.includeParentMessageInfo)&&R("boolean",n.includeThreadInfo)&&R("boolean",n.showSubchannelMessagesOnly)},Ip={replyType:vn.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},gv=function(n){return be(vn,n.replyType)&&R("boolean",n.includeReactions)&&R("boolean",n.includeMetaArray)&&R("boolean",n.includeParentMessageInfo)&&R("boolean",n.includeThreadInfo)},ZI=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.includeMetaArray,o=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,l=n.call(this)||this;return l.method=j.GET,l.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s)),l.params={is_sdk:!0,with_sorted_meta_array:a,include_reactions:o,include_thread_info:u,include_parent_message_info:c,include_poll_details:!0},l}return w(t,n),t}(K),JI=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=r?$n(e,A({},r)):null,i}return w(t,n),t}(W),Dl=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,a=e.token,o=e.prevResultSize,u=e.nextResultSize,c=e.isInclusive,l=e.reverse,d=e.messageTypeFilter,h=e.customTypesFilter,f=e.senderUserIdsFilter,p=e.replyType,_=e.includeMetaArray,m=e.includeReactions,b=e.parentMessageId,y=e.includeThreadInfo,E=e.includeParentMessageInfo,T=e.showSubchannelMessagesOnly,N=e.checkingHasNext,C=e.checkingContinuousMessages,L=n.call(this)||this;return L.method=j.GET,L.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages"),L.params=re(oe({is_sdk:!0,prev_limit:o,next_limit:u,include:c,reverse:l,message_ts:s,message_id:a,message_type:d??null,custom_types:h,sender_ids:f,include_reply_type:p,with_sorted_meta_array:_,include_reactions:m,parent_message_id:b,include_thread_info:y,include_parent_message_info:E,show_subchannel_message_only:T,include_poll_details:!0,checking_has_next:N,checking_continuous_messages:C})),L}return w(t,n),t}(K),Rl=function(n){function t(e,r){var i=n.call(this,e,r)||this;return r.is_continuous_messages!==void 0&&(i.isContinuousMessages=r.is_continuous_messages),r.has_next!==void 0&&(i.hasNext=r.has_next),i.messages=r.messages.map(function(s){return $n(e,s)}),i}return w(t,n),t}(W),XI=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,a=e.token,o=e.replyType,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,d=e.includeParentMessageInfo,h=n.call(this)||this;return h.method=j.GET,h.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/changelogs"),h.params={change_ts:s,token:a,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_reply_type:o,include_parent_message_info:d,include_poll_details:!0},h}return w(t,n),t}(K),e1=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.updatedMessages=r.updated.map(function(s){return $n(e,s)}),i.deletedMessagesInfo=r.deleted.map(function(s){return{messageId:s.message_id,deletedAt:s.deleted_at}}),i.hasMore=r.has_more,i.nextToken=r.next,i}return w(t,n),t}(W),t1=function(n){function t(e){var r=e.channelUrl,i=e.scheduledMessageId,s=n.call(this)||this;return s.method=j.GET,s.path="".concat(Mn,"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(i)),s.params={},s}return w(t,n),t}(K),n1=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=r?$n(e,A({},r)):null,i}return w(t,n),t}(W);(function(n){n.MUTED="muted",n.BANNED="banned"})(wp||(wp={}));var yv=function(){function n(t){var e,r,i,s;this.restrictionType=null,be(wp,t.restriction_type)&&(this.restrictionType=t.restriction_type),this.description=(e=t.description)!==null&&e!==void 0?e:null,this.endAt=(i=(r=t.end_at)!==null&&r!==void 0?r:t.muted_end_at)!==null&&i!==void 0?i:-1,this.remainingDuration=(s=t.remaining_duration)!==null&&s!==void 0?s:-1}return n.payloadify=function(t){return re(oe({restriction_type:t.restrictionType,description:t.description,end_at:t.endAt,remaining_duration:t.remainingDuration}))},n}(),So=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.restrictionInfo=new yv(r),i}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),yv.payloadify(e.restrictionInfo))))},t}(Oe);(function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).isMuted=!1,s.isMuted=(i=r.is_muted)!==null&&i!==void 0&&i,s}return w(t,n),t})(Oe);var rr=function(){function n(){this._onPending=Se,this._onFailed=Se,this._onSucceeded=Se}return n.prototype._trigger=function(t){switch(t==null?void 0:t.sendingStatus){case tt.PENDING:t.errorCode===0&&this._onPending(t);break;case tt.SCHEDULED:case tt.SUCCEEDED:this._onSucceeded(t)}},n.prototype._triggerFailed=function(t,e){switch(e==null?void 0:e.sendingStatus){case tt.FAILED:case tt.CANCELED:this._onFailed(t,e.scheduledInfo?null:e)}},n.prototype.onPending=function(t){return this._onPending=t,this},n.prototype.onFailed=function(t){return this._onFailed=t,this},n.prototype.onSucceeded=function(t){return this._onSucceeded=t,this},n}(),ph={data:void 0,customType:void 0,mentionType:gn.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1},_h=function(n){return R("string",n.data,!0)&&R("string",n.customType,!0)&&be(gn,n.mentionType)&&Ae("string",n.mentionedUserIds,!0)&&Ae(Oe,n.mentionedUsers,!0)&&R("string",n.mentionedMessageTemplate,!0)&&Ae(Kn,n.metaArrays,!0)&&R("number",n.parentMessageId,!0)&&R("boolean",n.isReplyToChannel)&&be(hi,n.pushNotificationDeliveryOption,!0)&&R(Kr,n.appleCriticalAlertOptions,!0)&&R("boolean",n.isPinnedMessage,!0)},Ev=function(n){return{isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption,pollId:n.pollId}},qy=A(A({},ph),{message:"",translationTargetLanguages:void 0,pollId:void 0,extendedMessagePayload:void 0});function $y(n){var t,e,r;return(t=n.messageParams)!==null&&t!==void 0?t:oe(A(A({},n),{mentionType:n.mentionType,mentionedUserIds:(e=n.mentionedUserIds)!==null&&e!==void 0?e:(r=n.mentionedUsers)===null||r===void 0?void 0:r.map(function(i){return i.userId}),translationTargetLanguages:Object.keys(n.translations),pushNotificationDeliveryOption:hi.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1}))}var io,Sp=function(n){var t;return re(oe({data:n.data,customType:n.customType,mentionType:n.mentionType,mentionedUsers:n.mentionedUsers,mentionedUserIds:n.mentionedUserIds,mentionedMessageTemplate:n.mentionedMessageTemplate,metaArrays:n.metaArrays,pollId:(t=n.poll)===null||t===void 0?void 0:t.id,parentMessageId:n.parentMessageId,appleCriticalAlertOptions:n.appleCriticalAlertOptions,message:n.message,translationTargetLanguages:Object.keys(n.translations),extendedMessagePayload:n.extendedMessagePayload}))},Hy=function(n){return _h(n)&&R("string",n.message)&&Ae("string",n.translationTargetLanguages,!0)&&R("number",n.pollId,!0)&&R("object",n.extendedMessagePayload,!0)};(function(n){n.FILE="file",n.BLOB="blob",n.BLOB_LIKE_OBJECT="blobLikeObject",n.URL="url"})(io||(io={}));var hd=function(n){return typeof window<"u"&&"Blob"in window&&typeof Blob<"u"&&n instanceof Blob},vf=function(n){return n===io.BLOB||n===io.FILE},bv=function(n){return{file:n.file,fileKey:n.fileKey,fileType:n.fileType,isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption}},Tv=A(A({},ph),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1});function zy(n){var t,e,r,i;return(t=n.messageParams)!==null&&t!==void 0?t:oe(A(A({},n),{fileUrl:n.plainUrl,fileName:n.name,fileSize:n.size,mimeType:n.type,mentionType:n.mentionType,mentionedUserIds:(e=n.mentionedUserIds)!==null&&e!==void 0?e:(r=n.mentionedUsers)===null||r===void 0?void 0:r.map(function(s){return s.userId}),pushNotificationDeliveryOption:hi.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:(i=n.thumbnails)===null||i===void 0?void 0:i.map(function(s){return{maxWidth:s.width,maxHeight:s.height}}),requireAuth:n.requireAuth,isPinnedMessage:!1}))}var cc,Cp=function(n,t){var e;return n.messageParams?(!n.url&&On(t)&&(n.messageParams.file=t),n.messageParams):re(oe({data:n.data,customType:n.customType,mentionType:n.mentionType,mentionedUsers:n.mentionedUsers,mentionedUserIds:n.mentionedUserIds,metaArrays:n.metaArrays,parentMessageId:n.parentMessageId,appleCriticalAlertOptions:n.appleCriticalAlertOptions,file:t,fileUrl:n.url,fileName:n.name,fileSize:n.size,mimeType:n.type,thumbnailSizes:(e=n.thumbnails)===null||e===void 0?void 0:e.map(function(r){return{maxWidth:r.width,maxHeight:r.height}})}))},wv=function(n){return _h(n)&&(On(n.file)||R("string",n.fileUrl))&&R("string",n.fileName,!0)&&R("string",n.mimeType,!0)&&R("number",n.fileSize,!0)&&(n.thumbnailSizes===null||n.thumbnailSizes===void 0||Array.isArray(n.thumbnailSizes)&&n.thumbnailSizes.every(function(t){return R("object",t)&&t.maxWidth>0&&t.maxHeight>0}))},O_={data:void 0,customType:void 0,mentionType:gn.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},M_=function(n){return R("string",n.data,!0)&&R("string",n.customType,!0)&&be(gn,n.mentionType)&&Ae("string",n.mentionedUserIds,!0)&&Ae(Oe,n.mentionedUsers,!0)&&R("string",n.mentionedMessageTemplate,!0)&&Ae(Kn,n.metaArrays,!0)&&be(hi,n.pushNotificationDeliveryOption,!0)&&R(Kr,n.appleCriticalAlertOptions,!0)},Gy=A(A({},O_),{message:void 0,translationTargetLanguages:void 0,pollId:void 0}),Vy=function(n){return M_(n)&&R("string",n.message,!0)&&Ae("string",n.translationTargetLanguages,!0)&&R("number",n.pollId,!0)},r1=A({},O_),i1=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.token,a=e.limit,o=n.call(this)||this;return o.method=j.GET,o.path="".concat(Le(i),"/").concat(encodeURIComponent(r),"/operators"),o.params={token:s,limit:a},o}return w(t,n),t}(K),s1=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.operators=r.operators.map(function(s){return new Oe(e,s)}),i.token=r.next,i}return w(t,n),t}(W),a1=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,r=M.of(this._iid).requestQueue,i=new i1(A(A({},this),{channelUrl:this.channelUrl,token:this._token})),[4,r.send(i)]):[3,2]):[3,5];case 1:return s=c.sent(),a=s.as(s1),o=a.operators,u=a.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,[2,o];case 2:return[2,e];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(wa),o1=function(n){function t(e,r,i,s){var a,o,u,c,l,d,h,f,p,_,m=this;return(m=n.call(this,e,r,i,s)||this).reverse=!1,m.messageTypeFilter=mn.ALL,m.customTypesFilter=null,m.senderUserIdsFilter=null,m.replyType=vn.NONE,m.includeMetaArray=!1,m.includeReactions=!1,m.includeParentMessageInfo=!1,m.includeThreadInfo=!1,m.showSubchannelMessagesOnly=!1,m._edge=Number.MAX_SAFE_INTEGER,m.reverse=(a=s.reverse)!==null&&a!==void 0&&a,m.messageTypeFilter=(o=s.messageTypeFilter)!==null&&o!==void 0?o:mn.ALL,m.customTypesFilter=(u=s.customTypesFilter)!==null&&u!==void 0?u:null,m.senderUserIdsFilter=(c=s.senderUserIdsFilter)!==null&&c!==void 0?c:null,m.replyType=(l=s.replyType)!==null&&l!==void 0?l:vn.NONE,m.includeMetaArray=(d=s.includeMetaArray)!==null&&d!==void 0&&d,m.includeReactions=(h=s.includeReactions)!==null&&h!==void 0&&h,m.includeParentMessageInfo=(f=s.includeParentMessageInfo)!==null&&f!==void 0&&f,m.includeThreadInfo=(p=s.includeThreadInfo)!==null&&p!==void 0&&p,m.showSubchannelMessagesOnly=(_=s.showSubchannelMessagesOnly)!==null&&_!==void 0&&_,m}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&R("boolean",this.reverse)&&be(mn,this.messageTypeFilter)&&be(vn,this.replyType)&&Ae("string",this.customTypesFilter,!0)&&Ae("string",this.senderUserIdsFilter,!0)&&R("boolean",this.includeMetaArray)&&R("boolean",this.includeReactions)&&R("boolean",this.includeParentMessageInfo)&&R("boolean",this.includeThreadInfo)&&R("boolean",this.showSubchannelMessagesOnly)},t.prototype.load=function(){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Xt.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,oe({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}))]):[3,2]:[3,5];case 1:return e=r.sent(),this._edge=Math.min.apply(Math,ce([Number.MAX_SAFE_INTEGER],ie(e.map(function(i){return i.createdAt})),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(wa),u1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.limit,o=e.token;return(r=n.call(this)||this).method=j.GET,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={limit:a,token:o},r}return w(t,n),t}(K),c1=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.mutedUsers=[];var s=r.next,a=r.muted_list;return i.token=s,a&&a.length>0&&(i.mutedUsers=a.map(function(o){return new So(e,o)})),i}return w(t,n),t}(W),l1=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return w(t,n),t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new u1(A(A({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(c1),a=s.mutedUsers,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(wa),d1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.limit,o=e.token;return(r=n.call(this)||this).method=j.GET,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=re({limit:a,token:o}),r}return w(t,n),t}(K),h1=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.bannedUsers=[];var s=r.next,a=r.banned_list;return i.token=s,a&&a.length>0&&(i.bannedUsers=a.map(function(o){return new So(e,o.user)})),i}return w(t,n),t}(W),f1=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new d1(A(A({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(h1),a=s.bannedUsers,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(wa);(function(n){n.SPAM="spam",n.HARASSING="harassing",n.SUSPICIOUS="suspicious",n.INAPPROPRIATE="inappropriate"})(cc||(cc={}));var p1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.operatorUserIds;return(r=n.call(this)||this).method=j.POST,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:a},r}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var _1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.operatorUserIds;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:a},r}return w(t,n),t}(K);(function(n){function t(e,r){return n.call(this,e,r)||this}w(t,n)})(W);var m1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=j.GET,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/mute/").concat(a),r}return w(t,n),t}(K),v1=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.isMuted=!1,i.startAt=0,i.endAt=0;var s=r.is_muted,a=r.start_at,o=r.end_at,u=r.remaining_duration,c=r.description;return i.isMuted=s,i.startAt=a,i.endAt=o,i.remainingDuration=u,i.description=c,i}return w(t,n),t}(W),Iv=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.keys;return(r=n.call(this)||this).method=j.GET,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={keys:a,include_ts:!0},r}return w(t,n),t}(K),Sv=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.metadata,a=r.ts;return i.metadata=s,i.ts=a,i}return w(t,n),t}(W),g1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metadata;return(r=n.call(this)||this).method=j.POST,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:a,include_ts:!0},r}return w(t,n),t}(K),y1=function(n){function t(e,r){var i,s,a=this;return(a=n.call(this,e,r)||this).metaData=(i=r.metadata)!==null&&i!==void 0?i:{},a.ts=(s=r.ts)!==null&&s!==void 0?s:null,a}return w(t,n),t}(W),E1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metadata,o=e.upsert;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:a,include_ts:!0,upsert:o!=null&&o},r}return w(t,n),t}(K),b1=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.metadata,a=r.ts;return i.metadata=s,i.ts=a,i}return w(t,n),t}(W),T1=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return w(t,n),t}(it),w1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.key;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(a),r.params={include_ts:!0},r}return w(t,n),t}(K),I1=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.ts;return i.ts=s,i}return w(t,n),t}(W),S1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={include_ts:!0},r}return w(t,n),t}(K),C1=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.ts;return i.ts=s,i}return w(t,n),t}(W),Cv=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.keys;return(r=n.call(this)||this).method=j.GET,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={keys:a},r}return w(t,n),t}(K),Nv=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return w(t,n),t}(W),N1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metaCounter;return(r=n.call(this)||this).method=j.POST,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:a},r}return w(t,n),t}(K),A1=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return w(t,n),t}(W),gf=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metaCounter,o=e.upsert,u=o!==void 0&&o,c=e.mode,l=c===void 0?"set":c;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:a,upsert:u,mode:l},r}return w(t,n),t}(K),yf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return w(t,n),t}(W),k1=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return w(t,n),t}(it),O1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.key;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(a),r.params={},r}return w(t,n),t}(K);(function(n){function t(e,r){return n.call(this,e,r)||this}w(t,n)})(W);var M1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={},r}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var D1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId,o=e.seconds,u=e.description;return(r=n.call(this)||this).method=j.POST,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={user_id:a,seconds:o,description:u},r}return w(t,n),t}(K);(function(n){function t(e,r){return n.call(this,e,r)||this}w(t,n)})(W);var R1=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new So(e,i.data),s}return w(t,n),t}(it),U1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(a)),r}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var L1=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new So(e,i.data),s}return w(t,n),t}(it),P1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId,o=e.seconds,u=e.description;return(r=n.call(this)||this).method=j.POST,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=re({user_id:a,seconds:o,description:u}),r}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var x1=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new So(e,i.data),i.data.member_count&&(s.memberCount=i.data.member_count),i.data.joined_member_count&&(s.joinedMemberCount=i.data.joined_member_count),s}return w(t,n),t}(it),F1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(a)),r}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var q1=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new So(e,i.data),s}return w(t,n),t}(it),Av=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.freezing;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/freeze"),r.params={freeze:a},r}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var $1=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.freeze=i.data.freeze,s}return w(t,n),t}(it),H1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.description;return(r=n.call(this)||this).method=j.POST,r.path="".concat(K0(s),"/").concat(encodeURIComponent(i)),r.params={report_category:a,reporting_user_id:o,report_description:u},r}return w(t,n),t}(K),z1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.offendingUserId,c=e.description;return(r=n.call(this)||this).method=j.POST,r.path="".concat(hp,"/users/").concat(u),r.params={channel_url:i,channel_type:s===xe.OPEN?"open_channels":"group_channels",report_category:a,reporting_user_id:o,report_description:c},r}return w(t,n),t}(K),G1=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.offendingUserId,c=e.messageId,l=e.description;return(r=n.call(this)||this).method=j.POST,r.path="".concat(K0(s),"/").concat(encodeURIComponent(i),"/messages/").concat(c),r.params={report_category:a,reporting_user_id:o,report_description:l,offending_user_id:u},r}return w(t,n),t}(K),V1=function(n){function t(e){var r=[];return e.mentionType===gn.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"MESG",ackRequired:!0,payload:re(oe({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==hi.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage,extended_message_payload:e.extendedMessagePayload}))})||this}return w(t,n),t}(Yn),By=function(n){function t(e,r,i){var s,a,o,u,c=this;(c=n.call(this,e,"MESG",i)||this).message=new _n(e,i);var l=M.of(e).sdkState;return c.isMentioned=nu(c.message.mentionType,(o=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(a=c.message.mentionedUsers)===null||a===void 0?void 0:a.map(function(d){return d.userId}))!==null&&o!==void 0?o:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return w(t,n),t}(it),kv=function(n){function t(e){var r=null;return e.mentionType===gn.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"MEDI",ackRequired:!0,payload:re(oe({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,poll_id:e.pollId}))})||this}return w(t,n),t}(Yn),Np=function(n){function t(e,r,i){var s,a,o,u,c,l=this;(l=n.call(this,e,"MEDI",i)||this).message=new _n(e,i);var d=M.of(e).sdkState;return l.mentionCountChange=y_({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(o=(a=i.old_values)===null||a===void 0?void 0:a.mentioned_user_ids)!==null&&o!==void 0?o:[]},oe({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(h){return h.userId})}),d.userId),l}return w(t,n),t}(it),Ov=function(n){function t(e){var r=null;return e.mentionType===gn.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"FEDI",ackRequired:!0,payload:re(oe({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,apple_critical_alert_options:e.appleCriticalAlertOptions}))})||this}return w(t,n),t}(Yn),Ap=function(n){function t(e,r,i){var s,a,o,u,c,l=this;(l=n.call(this,e,"FEDI",i)||this).message=new qt(e,i);var d=M.of(e).sdkState;return l.mentionCountChange=y_({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(o=(a=i.old_values)===null||a===void 0?void 0:a.mentioned_user_ids)!==null&&o!==void 0?o:[]},oe({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(h){return h.userId})}),d.userId),l}return w(t,n),t}(it),B1=function(n){function t(e){var r=n.call(this)||this;return r.method=j.DELETE,r.path="".concat(Le(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),r}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var j1=function(n){function t(e,r,i){var s=n.call(this,e,"DELM",i)||this;return s.channelUrl=i.channel_url,s.channelType=i.channel_type,s.messageId=Number(i.msg_id),s}return w(t,n),t}(it),K1=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.reactionKey,o=n.call(this)||this;return o.method=j.POST,o.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return w(t,n),t}(K),Q1=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.reactionEvent=new k_(r),i}return w(t,n),t}(W),W1=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.reactionKey,o=n.call(this)||this;return o.method=j.DELETE,o.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return w(t,n),t}(K),Y1=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.reactionEvent=new k_(A({},r)),i}return w(t,n),t}(W),Z1=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.translationTargetLanguages,o=n.call(this)||this;return o.method=j.POST,o.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s),"/translation"),o.params={target_langs:a},o}return w(t,n),t}(K),J1=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new _n(e,r),i}return w(t,n),t}(W),X1=function(n){function t(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===gn.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map(function(u){return u.userId})));var a=e.channelType,o=e.channelUrl;return i.method=j.POST,i.path="".concat(Le(a),"/").concat(encodeURIComponent(o),"/scheduled_messages"),i.params=re(oe({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:tu.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:(r=e.metaArrays)===null||r===void 0?void 0:r.map(function(u){return Kn.payloadify(u)}),apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),i}return w(t,n),t}(K),jy=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new _n(e,r),i}return w(t,n),t}(W),eS=function(n){function t(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===gn.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map(function(u){return u.userId})));var a=e.channelType,o=e.channelUrl;return i.method=j.POST,i.path="".concat(Le(a),"/").concat(encodeURIComponent(o),"/scheduled_messages"),i.params=oe({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:tu.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(u){return Io.payloadify(u)}):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:(r=e.metaArrays)===null||r===void 0?void 0:r.map(function(u){return Kn.payloadify(u)}),apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption}),i}return w(t,n),t}(K),tS=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new qt(e,r),i}return w(t,n),t}(W),nS=function(n){function t(e){var r=e.pollId,i=e.title,s=e.data,a=e.allowUserSuggestion,o=e.allowMultipleVotes,u=e.closeAt,c=n.call(this)||this;return c.method=j.PUT,c.path="".concat(_i,"/").concat(encodeURIComponent(r)),c.params={title:i,data:s,allow_user_suggestion:a,allow_multiple_votes:o,close_at:u},c}return w(t,n),t}(K),rS=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new jr(e,r),i}return w(t,n),t}(W),iS=function(n){function t(e){var r=e.pollId,i=n.call(this)||this;return i.method=j.DELETE,i.path="".concat(_i,"/").concat(encodeURIComponent(r)),i}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var sS=function(n){function t(e){var r=e.pollId,i=n.call(this)||this;return i.method=j.PUT,i.path="".concat(_i,"/").concat(encodeURIComponent(r),"/close"),i}return w(t,n),t}(K),aS=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new jr(e,r),i}return w(t,n),t}(W),oS=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=e.optionText,o=n.call(this)||this;return o.method=j.POST,o.path="".concat(_i,"/").concat(encodeURIComponent(s),"/options"),o.params={channel_url:r,channel_type:i,text:a},o}return w(t,n),t}(K),uS=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new jr(e,r),i}return w(t,n),t}(W),cS=function(n){function t(e){var r=e.pollId,i=e.pollOptionId,s=e.optionText,a=n.call(this)||this;return a.method=j.PUT,a.path="".concat(_i,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),a.params={text:s},a}return w(t,n),t}(K),lS=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new jr(e,r),i}return w(t,n),t}(W),dS=function(n){function t(e){var r=e.pollId,i=e.pollOptionId,s=n.call(this)||this;return s.method=j.DELETE,s.path="".concat(_i,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),s}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var hS=function(n){function t(e){var r=e.reqId,i=e.channelType,s=e.channelUrl,a=e.pollId,o=e.pollOptionIds;return n.call(this,{code:"VOTE",ackRequired:!0,payload:re({req_id:r,channel_type:i===xe.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:a,option_ids:o})})||this}return w(t,n),t}(Yn),Ky=function(n){function t(e,r,i){var s=n.call(this,e,"VOTE",i)||this;return s.event=new CI(i),s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return w(t,n),t}(it),Qy=100,Wy="GroupChannel",fS="url",Yy=100,kp="Message",pS="messageId",Zy="NotificationMessage",_S="notificationId",mS="Poll",vS="pollId",gS="FeedChannel",yS="url";function ES(n){var t,e,r;return(t=n.messageParams)!==null&&t!==void 0?t:oe(A(A({},n),{isReplyToChannel:!1,mentionedUserIds:(e=n.mentionedUserIds)!==null&&e!==void 0?e:(r=n.mentionedUsers)===null||r===void 0?void 0:r.map(function(i){return i.userId}),pushNotificationDeliveryOption:hi.DEFAULT,isPinnedMessage:!1,fileInfoList:n.fileInfoList.map(function(i){var s;return{fileUrl:i.plainUrl,fileName:i.fileName,fileSize:i.fileSize,mimeType:i.mimeType,thumbnailSizes:(s=i.thumbnails)===null||s===void 0?void 0:s.map(function(a){return{maxWidth:a.width,maxHeight:a.height}}),_uploadedMetaData:{requireAuth:i._requireAuth,isUploaded:!0}}})}))}var ln,bS=A(A({},ph),{fileInfoList:[]}),TS=function(n){return(On(n.file)||R("string",n.fileUrl))&&R("string",n.fileName,!0)&&R("string",n.mimeType,!0)&&R("number",n.fileSize,!0)&&(n.thumbnailSizes===void 0||Array.isArray(n.thumbnailSizes)&&n.thumbnailSizes.every(function(t){return t.maxWidth>0&&t.maxHeight>0}))},fd=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e._onFileUploaded=Se,e}return w(t,n),t.prototype._triggerOnFileUploaded=function(e,r,i,s){this._onFileUploaded(e,r,i,s)},t.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},t.prototype.onPending=function(e){return n.prototype.onPending.call(this,e),this},t.prototype.onFailed=function(e){return n.prototype.onFailed.call(this,e),this},t.prototype.onSucceeded=function(e){return n.prototype.onSucceeded.call(this,e),this},t}(rr),wS=2;(function(n){n.SEND="send",n.RESEND="resend",n.COPY="copy"})(ln||(ln={}));var ft,Mv=function(n){function t(e,r){var i,s,a,o,u,c,l=this;return(l=n.call(this,e)||this)._name="",l._createdAt=0,l.channelType=xe.BASE,l.coverUrl="",l.customType="",l.data="",l.isFrozen=!1,l.isEphemeral=!1,l.creator=null,l._messageCollectionLastAccessedAt=0,l._url=r.channel_url,l._name=(i=r.name)!==null&&i!==void 0?i:"",l._createdAt=1e3*r.created_at,l.coverUrl=(s=r.cover_url)!==null&&s!==void 0?s:"",l.customType=(a=r.custom_type)!==null&&a!==void 0?a:"",l.data=(o=r.data)!==null&&o!==void 0?o:"",l.isFrozen=(u=r.freeze)!==null&&u!==void 0&&u,l.isEphemeral=(c=r.is_ephemeral)!==null&&c!==void 0&&c,l.creator=r.created_by?new Oe(l._iid,r.created_by):null,r.metadata&&Object.keys(r.metadata).length>0&&r.ts&&(l._cachedMetaData=new Map,Object.keys(r.metadata).forEach(function(d){l._cachedMetaData.set(d,{value:r.metadata[d],isRemoved:!1,updatedAt:r.ts})})),l}return w(t,n),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return A(A({},this),{url:this._url,name:this._name,createdAt:this._createdAt})},t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:e.creator?Oe.payloadify(e.creator):null,created_at:e.createdAt/1e3})))},t.prototype.isGroupChannel=function(){return this.channelType===xe.GROUP},t.prototype.isOpenChannel=function(){return this.channelType===xe.OPEN},t.prototype.isFeedChannel=function(){return this.channelType===xe.FEED},Object.defineProperty(t.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData&&this._cachedMetaData.forEach(function(r,i){r.isRemoved||(e[i]=r.value)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageCollectionLastAccessedAt",{get:function(){return this._messageCollectionLastAccessedAt},enumerable:!1,configurable:!0}),t.prototype._updateMessageCollectionLastAccessedAt=function(){this._messageCollectionLastAccessedAt=Date.now()},t.prototype._update=function(e){var r=re(e);Object.assign(this,r)},t.prototype._upsertCachedMetaData=function(e,r){var i=this;Object.keys(e).forEach(function(s){i._cachedMetaData||(i._cachedMetaData=new Map);var a=i._cachedMetaData.get(s);(!a||a.updatedAt<=r)&&i._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:r})})},t.prototype._updateCachedMetaData=function(e,r){var i=this;this._cachedMetaData?this._cachedMetaData.forEach(function(s,a){var o;s.updatedAt<=r&&i._cachedMetaData.set(a,{value:(o=e[a])!==null&&o!==void 0?o:s.value,isRemoved:!e[a],updatedAt:r})}):(this._cachedMetaData=new Map,Object.keys(e).forEach(function(s){i._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:r})}))},t.prototype._removeFromCachedMetaData=function(e,r){var i=this;this._cachedMetaData&&e.forEach(function(s){var a=i._cachedMetaData.get(s);a&&a.updatedAt<r&&(a.isRemoved=!0,a.updatedAt=r)})},t.prototype._runIfHandleableWithGroupChannel=function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)},t.prototype._generateRequestId=function(){return"rq-".concat(Rs())},t.prototype.isIdentical=function(e){return e&&this.url===e.url},t.prototype.isEqual=function(e){return H0(this,e)},t.prototype.createOperatorListQuery=function(e){return e===void 0&&(e={}),new a1(this._iid,this.url,this.channelType,e)},t.prototype.createMutedUserListQuery=function(e){return e===void 0&&(e={}),new l1(this._iid,this.url,this.channelType,e)},t.prototype.createBannedUserListQuery=function(e){return e===void 0&&(e={}),new f1(this._iid,this.url,this.channelType,e)},t.prototype.createPreviousMessageListQuery=function(e){return e===void 0&&(e={}),new o1(this._iid,this.url,this.channelType,e)},t.prototype.addOperators=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return B(Ae("string",e)).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new p1({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.removeOperators=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return B(Ae("string",e)).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new _1({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.getMyMutedInfo=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h;return v(this,function(f){switch(f.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new m1({channelUrl:this.url,channelType:this.channelType,userId:r.userId}),[4,i.send(s)];case 1:return a=f.sent(),o=a.as(v1),u=o.isMuted,c=o.startAt,l=o.endAt,d=o.remainingDuration,h=o.description,[2,{isMuted:u,startAt:c,endAt:l,remainingDuration:d,description:h}]}})})},t.prototype.getMetaData=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return B(Ae("string",e)).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new Iv({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,r.send(i)];case 1:return s=c.sent(),a=s.as(Sv),o=a.metadata,u=a.ts,this._upsertCachedMetaData(o,u),[2,o]}})})},t.prototype.getAllMetaData=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return e=M.of(this._iid).requestQueue,r=new Iv({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(r)];case 1:return i=u.sent(),s=i.as(Sv),a=s.metadata,o=s.ts,this._updateCachedMetaData(a,o),[2,a]}})})},t.prototype.createMetaData=function(e){return g(this,void 0,void 0,function(){var r,i,s,a;return v(this,function(o){switch(o.label){case 0:return r=M.of(this._iid).requestQueue,i=new g1({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,r.send(i)];case 1:return s=o.sent(),a=s.as(y1).metaData,this._upsertCachedMetaData(a,0),[2,a]}})})},t.prototype.updateMetaData=function(e,r){return r===void 0&&(r=!1),g(this,void 0,void 0,function(){var i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return i=M.of(this._iid).requestQueue,s=new E1({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:r}),[4,i.send(s)];case 1:return a=l.sent(),o=a.as(b1),u=o.metadata,c=o.ts,this._upsertCachedMetaData(u,c),[2,u]}})})},t.prototype.deleteMetaData=function(e){return g(this,void 0,void 0,function(){var r,i,s,a;return v(this,function(o){switch(o.label){case 0:return B(R("string",e)).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new w1({channelUrl:this.url,channelType:this.channelType,key:e}),[4,r.send(i)];case 1:return s=o.sent(),a=s.as(I1).ts,this._removeFromCachedMetaData([e],a),[2]}})})},t.prototype.deleteAllMetaData=function(){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return e=M.of(this._iid).requestQueue,r=new S1({channelUrl:this.url,channelType:this.channelType}),[4,e.send(r)];case 1:return i=a.sent(),s=i.as(C1).ts,this._removeFromCachedMetaData(ce([],ie(this._cachedMetaData.keys()),!1),s),[2]}})})},t.prototype.getMetaCounters=function(e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return B(Ae("string",e)).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new Cv({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(Nv).metaCounter]}})})},t.prototype.getAllMetaCounters=function(){return g(this,void 0,void 0,function(){var e,r,i;return v(this,function(s){switch(s.label){case 0:return e=M.of(this._iid).requestQueue,r=new Cv({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(Nv).metaCounter]}})})},t.prototype.createMetaCounters=function(e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return r=M.of(this._iid).requestQueue,i=new N1({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(A1).metaCounter]}})})},t.prototype.updateMetaCounters=function(e,r){return r===void 0&&(r=!1),g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){switch(o.label){case 0:return i=M.of(this._iid).requestQueue,s=new gf({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:r}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(yf).metaCounter]}})})},t.prototype.increaseMetaCounters=function(e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return r=M.of(this._iid).requestQueue,i=new gf({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(yf).metaCounter]}})})},t.prototype.decreaseMetaCounters=function(e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return r=M.of(this._iid).requestQueue,i=new gf({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(yf).metaCounter]}})})},t.prototype.deleteMetaCounter=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return B(R("string",e)).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new O1({channelUrl:this.url,channelType:this.channelType,key:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.deleteAllMetaCounters=function(){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return e=M.of(this._iid).requestQueue,r=new M1({channelUrl:this.url,channelType:this.channelType}),[4,e.send(r)];case 1:return i.sent(),[2]}})})},t.prototype.muteUser=function(e,r,i){return g(this,void 0,void 0,function(){return v(this,function(s){return[2,this.muteUserWithUserId(e.userId,r,i)]})})},t.prototype.muteUserWithUserId=function(e,r,i){return g(this,void 0,void 0,function(){var s,a;return v(this,function(o){switch(o.label){case 0:return B(R("string",e)&&R("number",r,!0)&&R("string",i,!0)).throw(U.invalidParameters),s=M.of(this._iid).requestQueue,a=new D1({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:r,description:i}),[4,s.send(a)];case 1:return o.sent(),[2]}})})},t.prototype.unmuteUser=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return[2,this.unmuteUserWithUserId(e.userId)]})})},t.prototype.unmuteUserWithUserId=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return B(R("string",e)).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new U1({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.banUser=function(e,r,i){return g(this,void 0,void 0,function(){return v(this,function(s){return[2,this.banUserWithUserId(e.userId,r,i)]})})},t.prototype.banUserWithUserId=function(e,r,i){return g(this,void 0,void 0,function(){var s,a;return v(this,function(o){switch(o.label){case 0:return B(R("string",e)&&R("number",r,!0)&&R("string",i,!0)).throw(U.invalidParameters),s=M.of(this._iid).requestQueue,a=new P1({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:r,description:i}),[4,s.send(a)];case 1:return o.sent(),[2]}})})},t.prototype.unbanUser=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return[2,this.unbanUserWithUserId(e.userId)]})})},t.prototype.unbanUserWithUserId=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return B(R("string",e)).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new F1({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.freeze=function(){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return e=M.of(this._iid).requestQueue,r=new Av({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(r)];case 1:return i.sent(),this.isFrozen=!0,[2]}})})},t.prototype.unfreeze=function(){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return e=M.of(this._iid).requestQueue,r=new Av({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(r)];case 1:return i.sent(),this.isFrozen=!1,[2]}})})},t.prototype.getMessagesByMessageId=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},uc),r),B(R("number",e)&&vv(i)).throw(U.invalidParameters),[4,Xt.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessagesByTimestamp=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},uc),r),B(R("number",e)&&vv(i)).throw(U.invalidParameters),[4,Xt.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessageChangeLogsSinceTimestamp=function(e,r){return r===void 0&&(r={}),g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},Ip),r),B(R("number",e)&&gv(i)).throw(U.invalidParameters),[4,Xt.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessageChangeLogsSinceToken=function(e,r){return r===void 0&&(r={}),g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},Ip),r),B(R("string",e)&&gv(i)).throw(U.invalidParameters),[4,Xt.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype._createPendingSendableMessagePayload=function(e,r,i){var s,a=M.of(this._iid).sessionManager;return re(oe({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(o){return Kn.payloadify(o)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,created_at:i,user:a.currentUser?au.payloadify(a.currentUser):null,req_id:r,request_state:tt.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:(s=e.mentionedUsers)===null||s===void 0?void 0:s.map(function(o){return Oe.payloadify(o)})}))},t.prototype._createPendingUserMessage=function(e,r,i){var s,a,o={};if(e.translationTargetLanguages)try{for(var u=Z(e.translationTargetLanguages),c=u.next();!c.done;c=u.next())o[c.value]=""}catch(h){s={error:h}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(s)throw s.error}}var l=re(A(A({},this._createPendingSendableMessagePayload(e,r,i)),{type:gt.USER,message:e.message,translations:o,extended_message_payload:e.extendedMessagePayload})),d=new _n(this._iid,l);return d.messageParams=e,d},t.prototype._createPendingScheduledUserMessage=function(e,r,i){var s=this._createPendingUserMessage(e,r,i);return s.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},s},t.prototype._createPendingFileMessage=function(e,r,i){var s,a,o,u,c,l,d=re(A(A({},this._createPendingSendableMessagePayload(e,r,i)),{type:gt.FILE,url:e.fileUrl,file:{name:(s=e.fileName)!==null&&s!==void 0?s:(a=e.file)===null||a===void 0?void 0:a.name,size:(o=e.fileSize)!==null&&o!==void 0?o:(u=e.file)===null||u===void 0?void 0:u.size,type:(c=e.mimeType)!==null&&c!==void 0?c:(l=e.file)===null||l===void 0?void 0:l.type,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(f){return{url:"",width:f.maxWidth,height:f.maxHeight}}):[]})),h=new qt(this._iid,d);return h.messageParams=e,h},t.prototype._createPendingMultipleFilesMessage=function(e,r,i){var s=re(A(A({},this._createPendingSendableMessagePayload(e,r,i)),{type:gt.FILE})),a=new Ir(this._iid,s);return a.messageParams=e,a},t.prototype._validateFailedFileMessageHasFile=function(e,r){var i;return!!e.url||On(r)||On((i=e.messageParams)===null||i===void 0?void 0:i.file)},t.prototype._createPendingScheduledFileMessage=function(e,r,i){var s=this._createPendingFileMessage(e,r,i);return s.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},s},t.prototype._markMessageAsFailed=function(e,r,i){i===void 0&&(i=!1),e.errorCode=r.code,r.code===ae.REQUEST_CANCELED||r.code===ae.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=tt.CANCELED:i||(e.sendingStatus=tt.FAILED)},t.prototype.sendUserMessage=function(e){var r=A(A({},qy),e);return B(Hy(r)).throw(U.invalidParameters),this._sendUserMessage(r)},t.prototype._sendUserMessage=function(e,r,i){var s=this;r===void 0&&(r=ln.SEND);var a=M.of(this._iid),o=a.dispatcher,u=a.requestQueue,c=i??this._generateRequestId(),l=Date.now(),d=new rr;return mr(2).then(function(){var h=s._createPendingUserMessage(e,c,l);o.dispatch(new mt({messages:[h],source:r===ln.RESEND?z.LOCAL_MESSAGE_RESEND_STARTED:z.EVENT_MESSAGE_SENT_PENDING})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(p){return[2,d._trigger(h)]})})});var f=new V1(A(A({},e),{channelUrl:s.url,channelType:s.channelType,reqId:c}));u.send(f).then(function(p){var _=p.as(By).message;o.dispatch(new mt({messages:[_],source:z.EVENT_MESSAGE_SENT_SUCCESS})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(m){return[2,d._trigger(_)]})})})}).catch(function(p){if(ar(p))throw p;mr(2).then(function(){var _=s._createPendingUserMessage(e,c,l),m=M.of(s._iid).cacheContext,b=m.localCacheEnabled&&m.localCacheConfig.enableAutoResend&&Nd(p.code);s._markMessageAsFailed(_,p,b),o.dispatch(new mt({messages:[_],source:_.sendingStatus===tt.PENDING?z.REQUEST_RESEND_MESSAGE:z.EVENT_MESSAGE_SENT_FAILED})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(y){return[2,d._triggerFailed(p,_)]})})})})})}),d},t.prototype._autoResendUserMessage=function(e){return B(e instanceof _n&&!!e.messageParams).throw(U.invalidParameters),this._sendUserMessage(e.messageParams,ln.SEND,e.reqId)},t.prototype.resendUserMessage=function(e){var r;return g(this,void 0,void 0,function(){var i,s;return v(this,function(a){return B(e instanceof _n&&!e.scheduledInfo).throw(U.invalidParameters),i=new Fn,s=(r=e.messageParams)!==null&&r!==void 0?r:Sp(e),this._sendUserMessage(s,ln.RESEND,e.reqId).onFailed(function(o){return i.reject(o)}).onSucceeded(function(o){return i.resolve(o)}),[2,i.promise]})})},t.prototype.updateUserMessage=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o;return v(this,function(u){switch(u.label){case 0:return i=A(A({},Gy),r),B(R("number",e)&&Vy(i)).throw(U.invalidParameters),s=M.of(this._iid).requestQueue,a=new kv(A({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:i.metaArrays?{array:i.metaArrays,mode:"add",upsert:!0}:void 0},i)),[4,s.send(a)];case 1:return o=u.sent(),[2,o.as(Np).message]}})})},t.prototype.copyUserMessage=function(e,r){var i,s,a;return g(this,void 0,void 0,function(){var o,u;return v(this,function(c){return B(e instanceof t&&r instanceof _n&&r.sendingStatus===tt.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(U.invalidParameters),B(!r.poll).throw(U.notSupportedError),o=new Fn,u=(i=r.messageParams)!==null&&i!==void 0?i:oe(A(A({},r),{mentionType:r.mentionType,mentionedUserIds:(s=r.mentionedUserIds)!==null&&s!==void 0?s:(a=r.mentionedUsers)===null||a===void 0?void 0:a.map(function(l){return l.userId}),translationTargetLanguages:Object.keys(r.translations),pushNotificationDeliveryOption:hi.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),e._sendUserMessage(u).onSucceeded(function(l){o.resolve(l)}).onFailed(function(l){return o.reject(l)}),[2,o.promise]})})},t.prototype.translateUserMessage=function(e,r){return g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){switch(o.label){case 0:return B(e instanceof _n&&e.messageId>0&&Ae("string",r)).throw(U.invalidParameters),i=M.of(this._iid).requestQueue,s=new Z1({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:r}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(J1).message]}})})},t.prototype._createScheduledUserMessage=function(e,r){var i=this,s=M.of(this._iid).requestQueue,a=Date.now(),o=this._generateRequestId();mr(2).then(function(){var c=i._createPendingScheduledUserMessage(e,o,a);le(function(){return g(i,void 0,void 0,function(){return v(this,function(l){return[2,r._trigger(c)]})})})});var u=new X1(A({reqId:o,channelType:this.channelType,channelUrl:this.url},e));s.send(u).then(function(c){var l=c.as(jy).message;le(function(){return g(i,void 0,void 0,function(){return v(this,function(d){return[2,r._trigger(l)]})})})}).catch(function(c){if(ar(c))throw c;mr(2).then(function(){var l=i._createPendingScheduledUserMessage(e,o,a);i._markMessageAsFailed(l,c),le(function(){return g(i,void 0,void 0,function(){return v(this,function(d){return[2,r._triggerFailed(c,l)]})})})})})},t.prototype.sendFileMessage=function(e){var r=A(A({},Tv),e);return B(wv(r)).throw(U.invalidParameters),this._sendFileMessage(r)},t.prototype.sendMultipleFilesMessage=function(e){var r,i=A(A({},bS),e),s=M.of(this._iid);B(function(o,u){return u===void 0&&(u=oI),_h(o)&&Array.isArray(o.fileInfoList)&&o.fileInfoList.length>=2&&o.fileInfoList.length<=u&&o.fileInfoList.every(function(c){return TS(c)})}(i,(r=s.appInfo)===null||r===void 0?void 0:r.multipleFilesMessageFileCountLimit)).throw(U.invalidParameters);var a=!!e.fileInfoList.find(function(o){var u=s.appInfo.uploadSizeLimit;return o.file instanceof Blob&&o.file.size>u||o.fileSize>u});return B(!a).throw(U.fileSizeLimitExceededError),this._sendMultipleFilesMessage(i)},t.prototype._sendFileMessage=function(e,r,i){var s=this;r===void 0&&(r=ln.SEND);var a=M.of(this._iid).dispatcher,o=Xt.of(this._iid).fileMessageQueue,u=i??this._generateRequestId(),c=Date.now(),l=new rr;return mr(2).then(function(){var d=s._createPendingFileMessage(e,u,c);a.dispatch(new mt({messages:[d],source:r===ln.RESEND?z.LOCAL_MESSAGE_RESEND_STARTED:z.EVENT_MESSAGE_SENT_PENDING})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(h){return[2,l._trigger(d)]})})}),o.request(s,u,e).then(function(h){a.dispatch(new mt({messages:[h],source:z.EVENT_MESSAGE_SENT_SUCCESS})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(f){return[2,l._trigger(h)]})})})}).catch(function(h){if(ar(h))throw h;mr(2).then(function(){var f=s._createPendingFileMessage(e,u,c),p=M.of(s._iid).cacheContext,_=p.localCacheEnabled&&p.localCacheConfig.enableAutoResend&&Nd(h.code);s._markMessageAsFailed(f,h,_),a.dispatch(new mt({messages:[f],source:f.sendingStatus===tt.PENDING?z.REQUEST_RESEND_MESSAGE:h.code===ae.FILE_UPLOAD_CANCEL_FAILED?z.LOCAL_MESSAGE_CANCELED:z.EVENT_MESSAGE_SENT_FAILED})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(m){return[2,l._triggerFailed(h,f)]})})})})})}),l},t.prototype._autoResendFileMessage=function(e){B(e instanceof qt&&!!e.messageParams).throw(U.invalidParameters);var r=M.of(this._iid).logger;return r.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,ln.SEND,e.reqId).onFailed(function(i){r.debug("autoResendFileMessage failed",i)}).onSucceeded(function(i){r.debug("autoResendFileMessage success",i)})},t.prototype._sendMultipleFilesMessage=function(e,r,i){var s=this,a=M.of(this._iid).dispatcher,o=Xt.of(this._iid).fileMessageQueue,u=i??this._generateRequestId(),c=Date.now(),l=new fd;return mr(2).then(function(){var d=s._createPendingMultipleFilesMessage(e,u,c);a.dispatch(new mt({messages:[d],source:r===ln.RESEND?z.LOCAL_MESSAGE_RESEND_STARTED:z.EVENT_MESSAGE_SENT_PENDING})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(h){return[2,l._trigger(d)]})})}),o.request(s,u,e,{requestHandler:l,isCopy:r===ln.COPY}).then(function(h){a.dispatch(new mt({messages:[h],source:z.EVENT_MESSAGE_SENT_SUCCESS})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(f){return[2,l._trigger(h)]})})})}).catch(function(h){if(ar(h))throw h;mr(2).then(function(){var f=s._createPendingMultipleFilesMessage(e,u,c);s._markMessageAsFailed(f,h),a.dispatch(new mt({messages:[f],source:z.EVENT_MESSAGE_SENT_FAILED})),le(function(){return g(s,void 0,void 0,function(){return v(this,function(p){return[2,l._triggerFailed(h,f)]})})})})})}),l},t.prototype._createScheduledFileMessage=function(e,r,i,s){var a=this,o=M.of(this._iid).requestQueue,u=new eS(A(A({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));o.send(u).then(function(c){var l=c.as(tS).message;le(function(){return g(a,void 0,void 0,function(){return v(this,function(d){return[2,r._trigger(l)]})})})}).catch(function(c){if(ar(c))throw c;mr(2).then(function(){var l=a._createPendingScheduledFileMessage(e,i,s);a._markMessageAsFailed(l,c),le(function(){return g(a,void 0,void 0,function(){return v(this,function(d){return[2,r._triggerFailed(c,l)]})})})})})},t.prototype.sendFileMessages=function(e){var r,i;B(e.every(function(c){return wv(A(A({},Tv),c))})).throw(U.invalidParameters);var s=new rr;try{for(var a=Z(e),o=a.next();!o.done;o=a.next()){var u=o.value;this.sendFileMessage(u).onPending(function(c){return s._trigger(c)}).onFailed(function(c,l){return s._triggerFailed(c,l)}).onSucceeded(function(c){return s._trigger(c)})}}catch(c){r={error:c}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return s},t.prototype.resendFileMessage=function(e,r){return g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){return i=this._validateFailedFileMessageHasFile(e,r),B(e instanceof qt&&i&&!e.scheduledInfo).throw(U.invalidParameters),s=new Fn,a=Cp(e,r),this._sendFileMessage(a,ln.RESEND,e.reqId).onFailed(function(u){return s.reject(u)}).onSucceeded(function(u){return s.resolve(u)}),[2,s.promise]})})},t.prototype.resendMessage=function(e,r){var i,s;if(B(e instanceof kt&&!e.scheduledInfo&&e.isResendable).throw(U.invalidParameters),e.isUserMessage()){var a=(i=e.messageParams)!==null&&i!==void 0?i:Sp(e);return this._sendUserMessage(a,ln.RESEND,e.reqId)}if(e.isFileMessage()){var o=this._validateFailedFileMessageHasFile(e,r);return B(o).throw(U.invalidParameters),a=(s=e.messageParams)!==null&&s!==void 0?s:Cp(e,r),this._sendFileMessage(a,ln.RESEND,e.reqId)}if(e.isMultipleFilesMessage())throw U.channelTypeNotSupportedError},t.prototype.updateFileMessage=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o;return v(this,function(u){switch(u.label){case 0:return i=A(A({},r1),r),B(R("number",e)&&function(c){return M_(c)}(i)).throw(U.invalidParameters),s=M.of(this._iid).requestQueue,a=new Ov(A({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:i.metaArrays?{array:i.metaArrays,mode:"add",upsert:!0}:void 0},i)),[4,s.send(a)];case 1:return o=u.sent(),[2,o.as(Ap).message]}})})},t.prototype.uploadFile=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return r=M.of(this._iid).requestQueue,i=Rs(),(s=new xd({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:i})).uploadProgressHandler=e.progressHandler,e.uploadStartedHandler&&e.uploadStartedHandler(i),[4,r.send(s)];case 1:return a=l.sent(),o=a.as(Fd),u=o.url,c=o.thumbnails,[2,{requestId:i,url:u,thumbnails:c}]}})})},t.prototype.cancelUploadingFileMessage=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return B(R("string",e)).throw(U.invalidParameters),Xt.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]})})},t.prototype.copyFileMessage=function(e,r){var i,s,a;return g(this,void 0,void 0,function(){var o,u;return v(this,function(c){return B(e instanceof t&&r instanceof qt&&r.sendingStatus===tt.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(U.invalidParameters),o=new Fn,u=oe(A(A({},r),{fileUrl:r.url,fileName:r.name,fileSize:r.size,mimeType:r.type,mentionType:r.mentionType,mentionedUserIds:(i=r.mentionedUserIds)!==null&&i!==void 0?i:(s=r.mentionedUsers)===null||s===void 0?void 0:s.map(function(l){return l.userId}),pushNotificationDeliveryOption:hi.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:(a=r.thumbnails)===null||a===void 0?void 0:a.map(function(l){return{maxWidth:l.width,maxHeight:l.height}}),requireAuth:r.requireAuth,isPinnedMessage:!1})),e._sendFileMessage(u).onSucceeded(function(l){return o.resolve(l)}).onFailed(function(l){return o.reject(l)}),[2,o.promise]})})},t.prototype.copyMessage=function(e,r){B(e instanceof t&&r instanceof kt&&r.sendingStatus===tt.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(U.invalidParameters);var i=r,s=e;if(i.isUserMessage()){B(!i.poll).throw(U.notSupportedError);var a=$y(i);return s._sendUserMessage(a)}if(i.isFileMessage())return a=zy(i),s._sendFileMessage(a);if(r.isMultipleFilesMessage())throw U.channelTypeNotSupportedError},t.prototype.deleteMessage=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return B(e instanceof Nn).throw(U.invalidParameters),e.messageId>0?(r=M.of(this._iid).requestQueue,i=new B1({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,r.send(i)]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.addReaction=function(e,r){return g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){switch(o.label){case 0:return B(e instanceof Nn&&e.messageId>0&&R("string",r)).throw(U.invalidParameters),i=M.of(this._iid).requestQueue,s=new K1({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:r}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(Q1).reactionEvent]}})})},t.prototype.deleteReaction=function(e,r){return g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){switch(o.label){case 0:return B(e instanceof Nn&&e.messageId>0&&R("string",r)).throw(U.invalidParameters),i=M.of(this._iid).requestQueue,s=new W1({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:r}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(Y1).reactionEvent]}})})},t.prototype._updateUserMessageMetaArray=function(e,r,i,s){return g(this,void 0,void 0,function(){var a,o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:return a=M.of(this._iid),o=a.dispatcher,u=a.requestQueue,c=new kv({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:r,mode:i,upsert:s}}),[4,u.send(c)];case 1:return l=h.sent(),d=l.as(Np).message,o.dispatch(new mt({messages:[d],source:z.EVENT_MESSAGE_UPDATED})),[2,d]}})})},t.prototype._updateFileMessageMetaArray=function(e,r,i,s){return g(this,void 0,void 0,function(){var a,o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:return a=M.of(this._iid),o=a.dispatcher,u=a.requestQueue,c=new Ov({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:r,mode:i,upsert:s}}),[4,u.send(c)];case 1:return l=h.sent(),d=l.as(Ap).message,o.dispatch(new mt({messages:[d],source:z.EVENT_MESSAGE_UPDATED})),[2,d]}})})},t.prototype.createMessageMetaArrayKeys=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){return B(e instanceof Nn&&e.messageId>0&&Ae("string",r)).throw(U.invalidParameters),i=r.map(function(a){return new Kn({key:a})}),e instanceof qt?[2,this._updateFileMessageMetaArray(e.messageId,i,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,i,"add",!0)]})})},t.prototype.deleteMessageMetaArrayKeys=function(e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){return B(e instanceof Nn&&e.messageId>0&&Ae("string",r)).throw(U.invalidParameters),i=r.map(function(a){return new Kn({key:a})}),e instanceof qt?[2,this._updateFileMessageMetaArray(e.messageId,i,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,i,"remove",!0)]})})},t.prototype.addMessageMetaArrayValues=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){return B(e instanceof Nn&&e.messageId>0&&r.every(function(s){return s instanceof Kn})).throw(U.invalidParameters),e instanceof qt?[2,this._updateFileMessageMetaArray(e.messageId,r,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,r,"add",!0)]})})},t.prototype.removeMessageMetaArrayValues=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){return B(e instanceof Nn&&e.messageId>0&&r.every(function(s){return s instanceof Kn})).throw(U.invalidParameters),e instanceof qt?[2,this._updateFileMessageMetaArray(e.messageId,r,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,r,"remove",!0)]})})},t.prototype.report=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o;return v(this,function(u){switch(u.label){case 0:return B(be(cc,e)&&R("string",r)).throw(U.invalidParameters),i=M.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new H1({channelUrl:this.url,channelType:this.channelType,userId:s.userId,category:e,description:r}),[4,a.send(o)];case 1:return u.sent(),[2]}})})},t.prototype.reportUser=function(e,r,i){return g(this,void 0,void 0,function(){var s,a,o,u;return v(this,function(c){switch(c.label){case 0:return B(e instanceof Oe&&be(cc,r)&&R("string",i)).throw(U.invalidParameters),s=M.of(this._iid),a=s.sdkState,o=s.requestQueue,u=new z1({channelUrl:this.url,channelType:this.channelType,userId:a.userId,offendingUserId:e.userId,category:r,description:i}),[4,o.send(u)];case 1:return c.sent(),[2]}})})},t.prototype.reportMessage=function(e,r,i){return g(this,void 0,void 0,function(){var s,a,o,u;return v(this,function(c){switch(c.label){case 0:return B(e instanceof kt&&be(cc,r)&&R("string",i)).throw(U.invalidParameters),s=M.of(this._iid),a=s.sdkState,o=s.requestQueue,u=new G1({channelUrl:this.url,channelType:this.channelType,userId:a.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:r,description:i}),[4,o.send(u)];case 1:return c.sent(),[2]}})})},t.prototype.updatePoll=function(e,r){return g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){switch(o.label){case 0:return B(R("number",e)&&function(u){return R("string",u.title,!0)&&ky(u.data)&&R("boolean",u.allowUserSuggestion,!0)&&R("boolean",u.allowMultipleVotes,!0)&&R("number",u.closeAt,!0)}(r)).throw(U.invalidParameters),i=M.of(this._iid).requestQueue,s=new nS(A({pollId:e},r)),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(rS).poll]}})})},t.prototype.deletePoll=function(e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return r=R("number",e),B(r).throw(U.invalidParameters),i=M.of(this._iid).requestQueue,s=new iS({pollId:e}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},t.prototype.closePoll=function(e){return g(this,void 0,void 0,function(){var r,i,s,a;return v(this,function(o){switch(o.label){case 0:return r=R("number",e),B(r).throw(U.invalidParameters),i=M.of(this._iid).requestQueue,s=new sS({pollId:e}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(aS).poll]}})})},t.prototype.addPollOption=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o;return v(this,function(u){switch(u.label){case 0:return i=R("number",e)&&R("string",r)&&r.trim()!=="",B(i).throw(U.invalidParameters),s=M.of(this._iid).requestQueue,a=new oS({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:r}),[4,s.send(a)];case 1:return o=u.sent(),[2,o.as(uS).poll]}})})},t.prototype.updatePollOption=function(e,r,i){return g(this,void 0,void 0,function(){var s,a,o,u;return v(this,function(c){switch(c.label){case 0:return s=R("number",e)&&R("number",r)&&R("string",i)&&i.trim()!=="",B(s).throw(U.invalidParameters),a=M.of(this._iid).requestQueue,o=new cS({pollId:e,pollOptionId:r,optionText:i}),[4,a.send(o)];case 1:return u=c.sent(),[2,u.as(lS).poll]}})})},t.prototype.deletePollOption=function(e,r){return g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){switch(o.label){case 0:return i=R("number",e)&&R("number",r),B(i).throw(U.invalidParameters),s=M.of(this._iid).requestQueue,a=new dS({pollId:e,pollOptionId:r}),[4,s.send(a)];case 1:return o.sent(),[2]}})})},t.prototype.votePoll=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o,u,c,l;return v(this,function(d){switch(d.label){case 0:return i=R("number",e)&&Ae("number",r),B(i).throw(U.invalidParameters),s=M.of(this._iid),a=s.requestQueue,o=s.dispatcher,u=new hS({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:r}),[4,a.send(u)];case 1:return c=d.sent(),l=c.as(Ky).event,o.dispatch(new A_({event:l,source:z.EVENT_POLL_VOTED})),[2,l]}})})},t.prototype.getPollChangeLogsSinceTimestamp=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return B(R("number",e)).throw(U.invalidParameters),[4,Pd.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,r.sent()]}})})},t.prototype.getPollChangeLogsSinceToken=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return B(R("string",e,!0)),[4,Pd.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,r.sent()]}})})},t.prototype.createPollListQuery=function(e){return e===void 0&&(e=10),new Ry(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},t.prototype.createPollVoterListQuery=function(e,r,i){return i===void 0&&(i=20),new Uy(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:r,limit:i})},t}(yn),Jy=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return w(t,n),t}(function(){this.onConnected=Se,this.onReconnectStarted=Se,this.onReconnectSucceeded=Se,this.onReconnectFailed=Se,this.onDisconnected=Se}),IS=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return w(t,n),t}(function(){this.onSessionExpired=Se,this.onSessionTokenRequired=function(n){return n(null)},this.onSessionError=Se,this.onSessionRefreshed=Se,this.onSessionClosed=Se}),SS=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return w(t,n),t}(function(){this.onFriendsDiscovered=Se,this.onTotalUnreadMessageCountChanged=Se,this.onTotalUnreadMessageCountUpdated=Se}),CS=function(n){function t(e){var r=e.limit,i=e.token,s=e.userIdsFilter,a=e.metaDataKeyFilter,o=e.metaDataValuesFilter,u=e.nicknameStartsWithFilter,c=n.call(this)||this;return c.method=j.GET,c.path=Ue,c.params=re({limit:r,token:i,user_ids:s,metadatakey:a,metadatavalues_in:o,nickname_startswith:u}),c}return w(t,n),t}(K),NS=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new Oe(e,s)}),i.next=r.next,i}return w(t,n),t}(W),AS=function(n){function t(e,r){var i,s,a,o=this;return(o=n.call(this,e,r)||this).userIdsFilter=null,o.metaDataKeyFilter=null,o.metaDataValuesFilter=null,o.nicknameStartsWithFilter=null,o.userIdsFilter=(i=r.userIdsFilter)!==null&&i!==void 0?i:null,o.metaDataKeyFilter=(s=r.metaDataKeyFilter)!==null&&s!==void 0?s:null,o.metaDataValuesFilter=(a=r.metaDataValuesFilter)!==null&&a!==void 0?a:null,o.nicknameStartsWithFilter=r.nicknameStartsWithFilter||null,o}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&Ae("string",this.userIdsFilter,!0)&&R("string",this.metaDataKeyFilter,!0)&&Ae("string",this.metaDataValuesFilter,!0)&&R("string",this.nicknameStartsWithFilter,!0)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new CS(oe(A(A({},this),{token:this._token}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(NS),a=s.users,o=s.next,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(Ta),kS=function(n){function t(e){var r=e.userId,i=e.limit,s=e.token,a=e.userIdsFilter,o=n.call(this)||this;return o.method=j.GET,o.path="".concat(Ue,"/").concat(r,"/block"),o.params=re({limit:i,token:s,user_ids:a}),o}return w(t,n),t}(K),OS=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new Oe(e,s)}),i.next=r.next,i}return w(t,n),t}(W),MS=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).userIdsFilter=null,s.userIdsFilter=(i=r.userIdsFilter)!==null&&i!==void 0?i:null,s}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&Ae("string",this.userIdsFilter,!0)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new kS(oe(A(A({},this),{userId:r.userId,token:this._token}))),[4,i.send(s)]):[3,2]:[3,5];case 1:return a=l.sent(),o=a.as(OS),u=o.users,c=o.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(Ta),DS=function(n){function t(e){var r=e.userId,i=e.limit,s=e.token,a=n.call(this)||this;return a.method=j.GET,a.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/friends"),a.params={limit:i,token:s},a}return w(t,n),t}(K),RS=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.hasMore=r.has_more,i.users=r.users.map(function(s){return new Oe(e,s)}),i.next=r.next,i}return w(t,n),t}(W),US=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l;return v(this,function(d){switch(d.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new DS(A(A({},this),{userId:r.userId,token:this._token})),[4,i.send(s)]):[3,2]:[3,5];case 1:return a=d.sent(),o=a.as(RS),u=o.users,c=o.hasMore,l=o.next,this._token=l,this._hasNext=c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(Ta),Ul={},tl=function(){function n(t){var e=t.dbname,r=t.itemSizeLimit,i=r===void 0?1048576:r,s=t.cacheLimit,a=s===void 0?256:s,o=t.blockHashBase,u=o===void 0?2:o,c=t.blockHashMultiplier,l=c===void 0?10:c,d=t.blockHashConstant,h=d===void 0?11:d,f=t.transactionApplyDelay,p=f===void 0?200:f,_=t.disableLogger,m=_!==void 0&&_;return Ul[e]||(this.itemSizeLimit=i,this.cacheLimit=a,this.blockHashBase=u,this.blockHashMultiplier=l,this.blockHashConstant=h,this.transactionApplyDelay=p,this.disableLogger=m,Ul[e]=this),Ul[e]}return n.get=function(t){return Ul[t]},n}();(function(n){n[n.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",n[n.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",n[n.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",n[n.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",n[n.STORE_IS_FULL=61001003]="STORE_IS_FULL",n[n.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",n[n.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",n[n.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",n[n.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",n[n.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",n[n.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",n[n.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",n[n.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",n[n.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",n[n.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",n[n.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",n[n.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",n[n.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",n[n.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",n[n.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",n[n.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",n[n.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",n[n.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",n[n.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",n[n.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",n[n.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"})(ft||(ft={}));var Ja,Fe=function(n){function t(e){var r=e.code,i=r===void 0?ft.UNKNOWN_ERROR:r,s=e.message,a=s===void 0?"Unknown error occurred.":s,o=n.call(this,a)||this;return o.code=i,Object.setPrototypeOf(o,t.prototype),o}return w(t,n),Object.defineProperty(t,"storeNotDefined",{get:function(){return new t({code:ft.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailable",{get:function(){return new t({code:ft.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailableInPrivateBrowsing",{get:function(){return new t({code:ft.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeIsFull",{get:function(){return new t({code:ft.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotInitialized",{get:function(){return new t({code:ft.STORE_NOT_INITIALIZED,message:"Store is not initialized."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeKeyTypeIsInvalid",{get:function(){return new t({code:ft.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenIntegrity",{get:function(){return new t({code:ft.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenBlob",{get:function(){return new t({code:ft.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeEncryptionInvalid",{get:function(){return new t({code:ft.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeItemSizeExceeded",{get:function(){return new t({code:ft.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeReadFailed",{get:function(){return new t({code:ft.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeWriteFailed",{get:function(){return new t({code:ft.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseSchemaNotOnUpgrade",{get:function(){return new t({code:ft.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionNotReady",{get:function(){return new t({code:ft.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotMatch",{get:function(){return new t({code:ft.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionQueryNotValid",{get:function(){return new t({code:ft.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionInsertDuplicate",{get:function(){return new t({code:ft.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotFound",{get:function(){return new t({code:ft.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotGiven",{get:function(){return new t({code:ft.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionWriteFailed",{get:function(){return new t({code:ft.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionItemSizeExceeded",{get:function(){return new t({code:ft.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTableIsRequired",{get:function(){return new t({code:ft.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTypesNotMatch",{get:function(){return new t({code:ft.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"compareTypesNotMatch",{get:function(){return new t({code:ft.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"circularReferenceFound",{get:function(){return new t({code:ft.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),t}(Error);(function(n){n.INIT="init",n.READY="ready",n.CLOSED="closed"})(Ja||(Ja={}));var Dv,Bn=function(n,t){if(t===void 0&&(t=new WeakMap),typeof n=="object"&&n!==null){if(t.has(n))throw Fe.circularReferenceFound;t.set(n,!0);var e=void 0;if(Array.isArray(n))e=n.map(function(i){return Bn(i,t)});else if(n instanceof RegExp)e=n;else if(n instanceof Date)e=n;else for(var r in e={},n)e[r]=Bn(n[r],t);return t.delete(n),e}return n},Is=function(n,t){if(t==null)return 1;if(n==null)return-1;if(typeof n!=typeof t)throw Fe.compareTypesNotMatch;var e=0;switch(typeof n){case"boolean":case"number":e=n-t;break;case"string":e=n.localeCompare(t)}return e},Rv=function(n,t){for(var e=0,r=0;r<n.length;r++)e=n.charCodeAt(r)+(e<<6)+(e<<16)-e;return(e>>>0)%t},Ll=function(n){return new Promise(function(t){setTimeout(function(){return t()},n)})},so=function(n,t){if(!t)return!1;if(typeof n!="function"){for(var e in n)if(["/and","&&"].includes(e)){if(n[e].some(function(u){return!so(u,t)}))return!1}else if(["/or","||"].includes(e)){if(n[e].every(function(u){return!so(u,t)}))return!1}else if(e==="/where"){if(!(0,n[e])(t))return!1}else{var r=e;if(typeof n[r]=="object"){var i=n[r];for(var s in i)switch(s){case"/eq":case"=":if((a=t[r])!==(o=i[s]))return!1;break;case"/neq":case"!=":if((a=t[r])===(o=i[s]))return!1;break;case"/gt":case">":var a=t[r],o=i[s];if(!(Is(a,o)>0))return!1;break;case"/gte":case">=":if(a=t[r],o=i[s],!(Is(a,o)>=0))return!1;break;case"/lt":case"<":if(a=t[r],o=i[s],!(Is(a,o)<0))return!1;break;case"/lte":case"<=":if(a=t[r],o=i[s],!(Is(a,o)<=0))return!1;break;case"/in":if(a=t[r],!(o=i[s]).includes(a))return!1;break;case"/nin":if(a=t[r],(o=i[s]).includes(a))return!1;break;case"/contain":if(a=t[r],o=i[s],!a.includes(o))return!1;break;case"/regex":if(a=t[r],!(o=i[s]).test(a))return!1;break;case"/where":if(a=t[r],!(0,i[s])(a))return!1}}else if(typeof n[r]=="function"){if(!n[r](t[r]))return!1}else if(n[r]!==t[r])return!1}return!0}return n(t)},Vu=function(){},Uv=function(){return Promise.resolve()},LS=function(n){return n},Lv=function(n,t){t()};(function(n){n[n.FORWARD=0]="FORWARD",n[n.BACKWARD=1]="BACKWARD"})(Dv||(Dv={}));var ao,An,Oi,PS=function(){function n(t){var e=t.initialPrevValue,r=e===void 0?null:e,i=t.initialNextValue,s=i===void 0?null:i,a=t.iterator,o=t.map,u=o===void 0?LS:o,c=t.backward,l=c===void 0?Uv:c,d=t.forward,h=d===void 0?Uv:d,f=t.complete,p=f===void 0?Vu:f;this._prevValue=r,this._nextValue=s,this._error=null,this._map=u,this._backward=l,this._forward=h,this._iterator=a,this._complete=p}return Object.defineProperty(n.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),n.prototype.prev=function(){return g(this,void 0,void 0,function(){var t,e,r;return v(this,function(i){switch(i.label){case 0:if(!this.hasPrevious)return[3,6];i.label=1;case 1:return i.trys.push([1,3,,4]),t=this._prevValue,e=this,[4,this._backward()];case 2:return e._prevValue=i.sent()||null,this._nextValue=t,[3,4];case 3:return r=i.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,i.sent()];case 6:this._complete(),i.label=7;case 7:return[2]}})})},n.prototype.next=function(){return g(this,void 0,void 0,function(){var t,e,r;return v(this,function(i){switch(i.label){case 0:if(!this.hasNext)return[3,6];i.label=1;case 1:return i.trys.push([1,3,,4]),t=this._nextValue,e=this,[4,this._forward()];case 2:return e._nextValue=i.sent()||null,this._prevValue=t,[3,4];case 3:return r=i.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,i.sent()];case 6:this._complete(),i.label=7;case 7:return[2]}})})},n.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},n}(),Op=function(){function n(t){var e=t.condition,r=e===void 0?{}:e,i=t.backward,s=i!==void 0&&i,a=t.blockManager,o=t.indexer;this.condition=r,this.backward=s,this._blockManager=a,this._indexer=o}return n.prototype.findOptimizedStartPosition=function(){var t=this,e=["=","/eq",">",">=","/gt","/gte"],r=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var i=this._indexer.origin.length-1;if(typeof this.condition!="function")for(var s in this._indexer.fields){var a=this._indexer.fields[s],o=1;if(a[0]==="-"&&(a=a.slice(1),o=-1),this.condition[a]){if(typeof this.condition[a]=="object"){var u=o>0?r:e;for(var c in this.condition[a])if(u.includes(c)){for(var l=i;l>=0;l--)if(o*Is(this._indexer.origin[l].columnValues[s],this.condition[a][c])<=0){i=l;break}}}else for(l=i;l>=0;l--)if(o*Is(this._indexer.origin[l].columnValues[s],this.condition[a])<=0){i=l;break}}}return Math.min(i+1,this._indexer.origin.length-1)}var d=0;if(typeof this.condition!="function")for(var h=function(_){var m=f._indexer.fields[_],b=1;if(m[0]==="-"&&(m=m.slice(1),b=-1),f.condition[m]){if(typeof f.condition[m]=="object")Object.keys(f.condition[m]).forEach(function(E){if((b>0?e:r).includes(E)){for(var T=d;T<t._indexer.origin.length;T++)if(b*Is(t._indexer.origin[T].columnValues[_],t.condition[m][E])>=0){d=T;break}}});else for(var y=d;y<f._indexer.origin.length;y++)if(b*Is(f._indexer.origin[y].columnValues[_],f.condition[m])>=0){d=y;break}}},f=this,s=0;s<this._indexer.fields.length;s++)h(s);return Math.max(d-1,0)},n.prototype.each=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c=this;return v(this,function(l){switch(l.label){case 0:if(e=this.findOptimizedStartPosition(),r=0,this.backward&&this._indexer.origin[e]&&(r=this._indexer.origin[e].keys.length-1),i=function(){if(c._indexer.origin[e]){if(!c._indexer.origin[e].keys[++r]){if(!c._indexer.origin[++e])return!1;r=0}return!0}return!1},s=function(){if(c._indexer.origin[e]){if(!c._indexer.origin[e].keys[--r]){if(!c._indexer.origin[--e])return!1;r=c._indexer.origin[e].keys.length-1}return!0}return!1},a=null,!this._indexer.origin[e])return[3,4];o=this.backward?s:i,l.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])];case 2:if((u=l.sent())&&so(this.condition,u))return a=u,[3,4];l.label=3;case 3:if(o())return[3,1];l.label=4;case 4:return[4,new Promise(function(d){var h=new PS({initialNextValue:Bn(a),iterator:t,forward:function(){return g(c,void 0,void 0,function(){var f,p;return v(this,function(_){switch(_.label){case 0:f=this.backward?s:i,_.label=1;case 1:return f()?[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])]:[3,3];case 2:return(p=_.sent())&&so(this.condition,p)?[2,Bn(p)]:[3,1];case 3:return[2,null]}})})},backward:function(){return g(c,void 0,void 0,function(){var f,p;return v(this,function(_){switch(_.label){case 0:f=this.backward?i:s,_.label=1;case 1:return f()?[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])]:[3,3];case 2:return(p=_.sent())&&so(this.condition,p)?[2,Bn(p)]:[3,1];case 3:return[2,null]}})})},complete:d});t(h)})];case 5:return[2,l.sent()]}})})},n}(),xS=function(){function n(t){var e=t.condition,r=e===void 0?{}:e,i=t.backward,s=i!==void 0&&i,a=t.mutex,o=t.blockManager,u=t.indexer;this._mutex=a,this._iterator=new Op({condition:r,backward:s,blockManager:o,indexer:u})}return n.prototype.fetch=function(t){return t===void 0&&(t={}),g(this,void 0,void 0,function(){var e,r,i,s,a=this;return v(this,function(o){switch(o.label){case 0:if(e=Math.max(t.offset||0,0),(r=typeof t.limit=="number"?t.limit:Number.MAX_SAFE_INTEGER)===0)return[2,[]];if(r<0)throw Fe.collectionQueryNotValid;o.label=1;case 1:return o.trys.push([1,4,,5]),i=[],[4,this._mutex.lock()];case 2:return o.sent(),[4,this._iterator.each(function(u){return g(a,void 0,void 0,function(){return v(this,function(c){return u.error?u.stop():u.hasNext?e===0?(i.push(u.nextValue),0<r&&r<=i.length?u.stop():u.next()):(e--,u.next()):u.stop(),[2]})})})];case 3:return o.sent(),this._mutex.unlock(),[2,i];case 4:throw s=o.sent(),this._mutex.unlock(),s;case 5:return[2]}})})},n.prototype.count=function(){return g(this,void 0,void 0,function(){var t,e,r=this;return v(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=0,[4,this._mutex.lock()];case 1:return i.sent(),[4,this._iterator.each(function(s){return g(r,void 0,void 0,function(){return v(this,function(a){return s.error?s.stop():s.hasNext?(t++,s.next()):s.stop(),[2]})})})];case 2:return i.sent(),this._mutex.unlock(),[2,t];case 3:throw e=i.sent(),this._mutex.unlock(),e;case 4:return[2]}})})},n}(),Mp=function(n){return"".concat("nest","@").concat(n)},mo=function(n,t){return"".concat(Mp(n),"/").concat(t)},Ef=function(n,t){return"".concat(mo(n,t),".metadata")},Dp=function(n,t){return"".concat(mo(n,t),"/block.")},Pv=function(n,t){return"".concat(mo(n,t),"/blob.")},FS=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.store;this.dbname=e,this.collectionName=r,this.store=i}return n.prototype.get=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l;return v(this,function(d){switch(d.label){case 0:return[4,this.store.get(t)];case 1:return(e=d.sent())?(r=e.data,i=e.type,typeof fetch>"u"?[3,4]:[4,fetch(r)]):[3,5];case 2:return[4,d.sent().blob()];case 3:return[2,d.sent()];case 4:for(s=[],a=atob(r.split(",")[1]),o=0;o<a.length;o+=512){for(u=a.slice(o,o+512),c=new Array(u.length),l=0;l<u.length;l++)c[l]=u.charCodeAt(l);s.push(new Uint8Array(c))}return[2,new Blob(s,{type:i})];case 5:return[2,null]}})})},n.prototype.save=function(t,e){return e===void 0&&(e="".concat(Date.now())),g(this,void 0,void 0,function(){var r,i,s,a,o=this;return v(this,function(u){switch(u.label){case 0:return[4,new Promise(function(c){var l=function(h,f,p,_){return _===void 0&&(_=0),"".concat(Pv(h,f)).concat(p,".").concat(_)}(o.dbname,o.collectionName,e),d=new FileReader;d.onload=function(){c({blobId:l,data:d.result,type:t.type})},d.readAsDataURL(t)})];case 1:return r=u.sent(),i=r.blobId,s=r.data,a=r.type,[4,this.store.set({key:i,value:{data:s,type:a}})];case 2:return u.sent(),[2,i]}})})},n.prototype.remove=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this.store.remove(t)];case 1:return e.sent(),[2]}})})},n.prototype.clear=function(){return g(this,void 0,void 0,function(){var t,e,r=this;return v(this,function(i){switch(i.label){case 0:return t=Pv(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return e=i.sent(),[4,Promise.all(e.filter(function(s){return s.startsWith(t)}).map(function(s){return g(r,void 0,void 0,function(){return v(this,function(a){switch(a.label){case 0:return[4,this.store.remove(s)];case 1:return[2,a.sent()]}})})}))];case 2:return i.sent(),[2]}})})},n}();(function(n){n[n.COMMIT=0]="COMMIT",n[n.WRITE=1]="WRITE",n[n.ERROR=2]="ERROR"})(ao||(ao={})),function(n){n.PENDING="pending",n.PERSISTENT="persistent",n.VOLATILE="volatile"}(An||(An={})),function(n){n[n.NO_CACHE=0]="NO_CACHE",n[n.DEFAULT=1]="DEFAULT",n[n.PERSISTENT=2]="PERSISTENT"}(Oi||(Oi={}));var lc,wn,xv=[An.PENDING,An.VOLATILE],Pl={},$r=function(){function n(t){var e=t.dbname,r=t.limit,i=r===void 0?256:r;return Pl[e]||(this.dbname=e,this._items=[],this._limit=i,Pl[e]=this),Pl[e]}return n.get=function(t){return Pl[t]},Object.defineProperty(n.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),n.prototype.find=function(t,e,r){return r===void 0&&(r=Oi.DEFAULT),g(this,void 0,void 0,function(){var i,s;return v(this,function(a){switch(a.label){case 0:return(i=this.get(e))?[3,2]:[4,t.get(e)];case 1:return(s=a.sent())&&(i={key:e,value:s,state:r===Oi.PERSISTENT?An.PERSISTENT:An.VOLATILE},this.put(i)),[3,3];case 2:r===Oi.PERSISTENT&&(i.state=An.PERSISTENT),a.label=3;case 3:return[2,i]}})})},n.prototype.get=function(t,e){e===void 0&&(e=Oi.DEFAULT);var r=this._items.map(function(s){return s.key}).indexOf(t);if(r>-1){var i=this._items[r];return e===Oi.PERSISTENT&&(i.state=An.PERSISTENT),e!==Oi.NO_CACHE&&this.put(i),i}return null},n.prototype.put=function(t){var e,r;if(this._limit>0){var i=this._items.map(function(d){return d.key}).indexOf(t.key);if(i>-1)xv.includes(this._items[i].state)&&xv.includes(t.state)?(this._items.splice(i,1),this._items.push(t)):(this._items[i].state=t.state,this._items[i].value=t.value);else{this._items.push(t);var s=this._items.filter(function(d){return d.state===An.VOLATILE}),a=s.length-this._limit;if(a>0){var o=[];try{for(var u=Z(this._items),c=u.next();!c.done;c=u.next()){var l=c.value;l.state===An.VOLATILE&&a>0?a--:o.push(l)}}catch(d){e={error:d}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}this._items=o}}}},n.prototype.remove=function(t){var e=this._items.map(function(r){return r.key}).indexOf(t);e>-1&&this._items.splice(e,1)},n.prototype.clearByCondition=function(t){this._items=this._items.filter(function(e){return!t(e)})},n.prototype.clear=function(t){t===void 0&&(t=!1),this._items=t?[]:this._items.filter(function(e){return e.state!==An.VOLATILE})},n}(),qS=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.store;this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=e,this.collectionName=r,this.metadataKey=function(s,a){return"".concat(mo(s,a),"/trans.metadata")}(e,r),this.recordsetKey=function(s,a){return"".concat(mo(s,a),"/trans.recordset")}(e,r),this._store=i}return Object.defineProperty(n.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),n.prototype._getReducedRecordset=function(t){return t===void 0&&(t=[]),g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(e=r.sent()||[]).push.apply(e,ce([],ie(t),!1)),[2,this._reduceRecordSet(e)]}})})},n.prototype._reduceRecordSet=function(t){for(var e=[],r={},i=t.length-1;i>=0;i--){for(var s=t[i],a=[],o=s.requests.length-1;o>=0;o--){var u=s.requests[o],c=u.data;r[c.key]||(a.unshift(u),r[c.key]=!0)}a.length>0&&(s.requests=a,e.unshift(s))}return e},n.prototype._applyRecord=function(t,e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:r=$r.get(this.dbname),i=e.generation,s=e.requests,a=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(s.map(function(f){return A(A({},f.data),{generation:i})}))];case 2:for(o=h.sent(),u=0;u<s.length;u++)o[u]instanceof Error&&(a||(a=o[u]),c=s[u].data,r.put(A(A({},c),{state:An.PERSISTENT})));return[3,4];case 3:return l=h.sent(),a=l,[3,4];case 4:return a?[3,6]:(d=t.filter(function(f){return f.generation!==i}),[4,this._store.set({key:this.recordsetKey,value:d})]);case 5:return h.sent(),this._onWrite.forEach(function(f){f(s.map(function(p){return p.data}))}),[3,7];case 6:this._onError.forEach(function(f){a&&f(a)}),h.label=7;case 7:return[2]}})})},n.prototype.init=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return t=this,[4,this._store.get(this.metadataKey)];case 1:return t._metadata=c.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:e=c.sent(),c.label=3;case 3:c.trys.push([3,8,9,10]),r=Z(e),i=r.next(),c.label=4;case 4:return i.done?[3,7]:(s=i.value,[4,this._applyRecord(e,s)]);case 5:c.sent(),c.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return a=c.sent(),o={error:a},[3,10];case 9:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 10:return[2]}})})},n.prototype.on=function(t,e,r){switch(t){case ao.COMMIT:this._onCommit.set(e,r);break;case ao.WRITE:this._onWrite.set(e,r);break;case ao.ERROR:this._onError.set(e,r)}},n.prototype.requestWrite=function(t,e){this._requests.push({data:t,options:e}),$r.get(this.dbname).put(A({state:An.PENDING},t))},n.prototype.requestMultipleWrite=function(t,e){var r,i,s=$r.get(this.dbname);try{for(var a=Z(t),o=a.next();!o.done;o=a.next()){var u=o.value;this._requests.push({data:u,options:e}),s.put(A({state:An.PENDING},u))}}catch(c){r={error:c}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},n.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(t){return $r.get(this.dbname).clearByCondition(function(e){return e.state===An.PENDING}),this._requests=[],[2]})})},n.prototype.commit=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c,l,d,h,f=this;return v(this,function(p){switch(p.label){case 0:if(!((t=this._requests).length>0))return[3,4];for(e=[],r={},u=t.length-1;u>=0;u--)i=t[u],l=i.data,r[l.key]||(r[l.key]=!0,e.unshift(i));return s={generation:this.generation,requests:e},[4,this._getReducedRecordset([s])];case 1:return a=p.sent(),[4,this._store.set({key:this.recordsetKey,value:a})];case 2:return p.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata})];case 3:for(p.sent(),o=$r.get(this.dbname),u=0;u<e.length;u++)c=e[u],l=c.data,d=c.options,o.put(A(A({},l),{state:d&&d.persistent?An.PERSISTENT:An.VOLATILE}));this._requests=[],this._onCommit.forEach(function(_){_(t.map(function(m){return m.data}))}),h=tl.get(this.dbname),setTimeout(function(){try{f._applyRecord(a,s)}catch(_){f._onError.forEach(function(m){return m(_)})}},h.transactionApplyDelay),p.label=4;case 4:return[2]}})})},n}(),pd=function(){function n(t){var e=t.blockId,r=t.keyName,i=t.items,s=i===void 0?[]:i,a=t.limit;this.blockId=e,this.keyName=r,this.limit=a,this._items=ce([],ie(s),!1)}return n.createFromCacheItem=function(t){return t?new n(t.value):null},Object.defineProperty(n.prototype,"isEmpty",{get:function(){return this._items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),n.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},n.prototype.getItemByKey=function(t){var e=this,r=this._items.find(function(i){var s=i[e.keyName];return t===s});return r??null},n.prototype.has=function(t){var e=this;return this._items.map(function(r){return r[e.keyName]}).includes(t)},n.prototype.add=function(t){var e=this,r=this._items.map(function(i){return i[e.keyName]}).indexOf(t[this.keyName]);return r<0?this._items.length<this.limit&&(this._items.push(t),!0):(this._items[r]=t,!0)},n.prototype.remove=function(t){for(var e in this._items)if(this._items[e][this.keyName]===t)return this._items.splice(parseInt(e),1),!0;return!1},n.prototype.clear=function(){this._items=[]},n}(),$S=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.metadata,s=t.hashFunction,a=s===void 0?Rv:s,o=t.transaction,u=t.store;this.dbname=e,this.collectionName=r,this.hashFunction=a,this.metadata=i,this._transaction=o,this._store=u}return Object.defineProperty(n.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),n.prototype.createBlockId=function(t,e){return e===void 0&&(e=this.metadata.blockLevel),r=this.dbname,i=this.collectionName,s=e,a="".concat(function(o,u,c){var l=c.base*Math.pow(c.multiplier,u)+c.constant;return(c.hashFunction||Rv)(o,l)}(t,e,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(Dp(r,i)).concat(s,".").concat(a);var r,i,s,a},n.prototype._findBlock=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:e=$r.get(this.dbname),r=this.metadata.blockLevel,o.label=1;case 1:return r>0?(i=this.createBlockId(t,r),[4,e.find(this._store,i)]):[3,4];case 2:if((s=o.sent())&&(a=pd.createFromCacheItem(s),a==null?void 0:a.getItemByKey(t)))return[2,a];o.label=3;case 3:return r--,[3,1];case 4:return[2,null]}})})},n.prototype.getFromBlock=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return[4,this._findBlock(t)];case 1:return[2,(e=r.sent())?e.getItemByKey(t):null]}})})},n.prototype.putToBlock=function(t,e){return g(this,void 0,void 0,function(){var r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return r=tl.get(this.dbname),i=this.createBlockId(t),s=Math.floor(this._store.itemSizeLimit/r.itemSizeLimit),[4,$r.get(this.dbname).find(this._store,i)];case 1:return a=u.sent(),(o=a?pd.createFromCacheItem(a):new pd({blockId:i,keyName:this.keyName,items:[],limit:s}))!=null&&o.add(e)?(this._transaction.requestWrite({key:o.blockId,value:o.serialize()}),[2,!0]):[2,!1]}})})},n.prototype.removeFromBlock=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return[4,this._findBlock(t)];case 1:return(e=r.sent())&&e.remove(t)?(this._transaction.requestWrite({key:e.blockId,value:e.serialize()}),[2,!0]):[2,!1]}})})},n.prototype.clearAllBlocks=function(){return g(this,void 0,void 0,function(){var t,e,r;return v(this,function(i){switch(i.label){case 0:return t=Dp(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return e=i.sent(),r=e.filter(function(s){return s.startsWith(t)}),[4,this._store.removeMany(r)];case 2:return i.sent(),[4,this._transaction.clear()];case 3:return i.sent(),$r.get(this.dbname).clearByCondition(function(s){return s.key.startsWith(t)}),[2]}})})},n}(),Po={},Qs=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.keyName,s=t.fields,a=t.transaction,o=t.store,u=this;this._origin=[],this._table=[];var c=function(l,d,h){return"".concat(mo(l,d),"/index.").concat(h)}(e,r,s.join(">"));return Po[c]||(this.dbname=e,this.collectionName=r,this.keyName=i,this.fields=s,this.indexerKey=c,this._transaction=a,this._store=o,this._transaction.on(ao.COMMIT,this.indexerKey,function(){return u.commit()}),this._transaction.on(ao.ERROR,this.indexerKey,function(){return u.abort()})),Po[c]}return n.createKey=function(t){return t.join(">")},n.parseKey=function(t){return t.split(">")},n.clearIndexerMap=function(){for(var t in Po)delete Po[t]},n.prototype._addItem=function(t){var e=t[this.keyName],r=this.getColumnValues(t),i=ie(this.indexOf(r),2),s=i[0];return i[1]?!this._table[s].keys.includes(e)&&(this._table[s].keys.push(e),!0):(this._table.splice(s,0,{columnValues:r,keys:[e]}),!0)},n.prototype._removeItem=function(t){var e=t[this.keyName],r=this.getColumnValues(t),i=ie(this.indexOf(r),2),s=i[0];if(i[1]){var a=this._table[s].keys.indexOf(e);if(a>-1)return this._table[s].keys.splice(a,1),this._table[s].keys.length===0&&this._table.splice(s,1),!0}return!1},Object.defineProperty(n.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),n.prototype.getColumnValues=function(t){var e,r,i,s,a=[];try{for(var o=Z(this.fields),u=o.next();!u.done;u=o.next()){var c=u.value;if(c[0]==="-"&&(c=c.slice(1)),i=t[c],s=void 0,s=typeof i,i!==null&&s!=="undefined"&&s!=="boolean"&&s!=="number"&&s!=="string")throw Fe.indexTypesNotMatch;a.push(t[c])}}catch(l){e={error:l}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return a},n.prototype.diff=function(t,e){for(var r in this.fields){var i=this.fields[r][0]==="-"?-1:1,s=Is(t[r],e[r]);if(s!==0)return i*s}return 0},n.prototype.indexOf=function(t){if(this._table.length>0){for(var e=0,r=this._table.length-1;e<=r;){var i=Math.floor((e+r)/2),s=this.diff(t,this._table[i].columnValues);if(s>0)e=i+1;else{if(!(s<0))return[i,!0];r=i-1}}return[e,!1]}return[0,!1]},n.prototype.ensure=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c,l,d,h,f,p,_,m,b;return v(this,function(y){switch(y.label){case 0:return[4,(t=$r.get(this.dbname)).find(this._store,this.indexerKey,Oi.PERSISTENT)];case 1:return(e=y.sent())?[3,11]:(r=Dp(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:i=y.sent(),y.label=3;case 3:y.trys.push([3,8,9,10]),s=Z(i),a=s.next(),y.label=4;case 4:return a.done?[3,7]:(o=a.value).startsWith(r)?[4,t.find(this._store,o,Oi.NO_CACHE)]:[3,6];case 5:if(u=y.sent(),c=pd.createFromCacheItem(u))try{for(m=void 0,l=Z(c.items),d=l.next();!d.done;d=l.next())h=d.value,this._addItem(h)}catch(E){m={error:E}}finally{try{d&&!d.done&&(b=l.return)&&b.call(l)}finally{if(m)throw m.error}}y.label=6;case 6:return a=s.next(),[3,4];case 7:return[3,10];case 8:return f=y.sent(),p={error:f},[3,10];case 9:try{a&&!a.done&&(_=s.return)&&_.call(s)}finally{if(p)throw p.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=e.value,this._table=Bn(this._origin),y.label=12;case 12:return Po[this.indexerKey]=this,[2]}})})},n.prototype.drop=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return $r.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return t.sent(),delete Po[this.indexerKey],[2]}})})},n.prototype.addItem=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return this._addItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.removeItem=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return this._removeItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(t){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.commit=function(){this._origin=this._table,this._table=Bn(this._origin)},n.prototype.abort=function(){this._table=Bn(this._origin)},n}(),$d=function(){return typeof document<"u"&&typeof navigator<"u"&&navigator.product!=="ReactNative"},Fv=function(){var n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(t==="x"?e:3&e|8).toString(16)})};(function(n){n[n.PROCESSING=0]="PROCESSING",n[n.DONE=1]="DONE"})(lc||(lc={})),function(n){n.NEWNODE="newnode",n.REMOVENODE="removenode",n.CLAIM_HOST="claimhost",n.SYNC_HOST="synchost",n.REQUEST_LOCK="requestlock",n.ACQUIRE_LOCK="acquirelock",n.RELEASE_LOCK="releaselock"}(wn||(wn={}));var si,bf={},D_=function(){function n(t,e){e===void 0&&(e={});var r=this;return this._state=lc.PROCESSING,this._queue=[],this._activationQueue=[],bf[t]&&!e.forceCreate||(this.nodeId=Fv(),this.key=t,$d()&&(e.startAsInvisible?this.registerNode():document.visibilityState==="visible"?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"&&r.claimHost()}),window.addEventListener("message",function(i){var s,a,o=i.data,u=o.nodeId,c=o.requestId,l=o.key,d=o.op,h=o.data;if(u!==r.nodeId&&l===r.key)switch(d){case wn.NEWNODE:r._sendSync();break;case wn.CLAIM_HOST:r._sendSync(),r._hostId=u;break;case wn.SYNC_HOST:if(!r.isInSync){r._activationTimeout&&clearTimeout(r._activationTimeout);var f=h,p=f.currentItemRequestId,_=f.queue,m=function(T){var N=r._queue.findIndex(function(C){return C.requestId===T.requestId});N<0&&r._requestLock({nodeId:T.nodeId,requestId:T.requestId,key:r.key,op:wn.REQUEST_LOCK,ts:T.ts})};try{for(var b=Z(_),y=b.next();!y.done;y=b.next())m(y.value)}catch(T){s={error:T}}finally{try{y&&!y.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}r._currentItem=r._queue.find(function(T){return T.requestId===p}),r._completeSync()}break;case wn.REMOVENODE:r._queue=r._queue.filter(function(T){return T.nodeId!==o.nodeId}),r._currentItem&&r._currentItem.nodeId===o.nodeId&&(r._currentItem=void 0,r._acquire(r._queue[0]));break;case wn.REQUEST_LOCK:r._requestLock(o);break;case wn.ACQUIRE_LOCK:var E=r._queue.find(function(T){return T.requestId===c});r._acquire(E);break;case wn.RELEASE_LOCK:r._release(c)}}),window.addEventListener("beforeunload",function(){r._send(wn.REMOVENODE)})),bf[t]=this),bf[t]}return Object.defineProperty(n.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isInSync",{get:function(){return this._state==lc.DONE},enumerable:!1,configurable:!0}),n.prototype._send=function(t,e){var r;e===void 0&&(e={});var i={nodeId:this.nodeId,requestId:(r=e==null?void 0:e.requestId)!==null&&r!==void 0?r:Fv(),key:this.key,op:t,data:e.data,ts:Date.now()};return $d()&&window.postMessage(i,"*"),i},n.prototype._acquire=function(t){t?(this._currentItem=t,this._currentItem.onAcquired&&this._currentItem.onAcquired(t.requestId)):this._currentItem=void 0},n.prototype._release=function(t){if(this._currentItem&&this._currentItem.requestId===t){var e=this._currentItem;this._currentItem=void 0,e.nodeId===this.nodeId&&this._send(wn.RELEASE_LOCK,{requestId:e.requestId});var r=this._queue.findIndex(function(i){return i.requestId===t});r>-1&&this._queue.splice(r,1),e.onReleased&&e.onReleased(t)}},n.prototype._requestLock=function(t){var e=this;return new Promise(function(r){var i={nodeId:t.nodeId,requestId:t.requestId,ts:t.ts,onAcquired:function(o){e.isHost&&e._send(wn.ACQUIRE_LOCK,{requestId:o}),r()},onReleased:function(){e._acquire(e._queue[0])}},s=!1;for(var a in e._queue)if(e._queue[a].ts>i.ts){e._queue.splice(parseInt(a),0,i),s=!0;break}s||e._queue.push(i),e._currentItem||e._acquire(e._queue[0])})},n.prototype._sendSync=function(){var t;this.isHost&&this._send(wn.SYNC_HOST,{data:{currentItemRequestId:(t=this._currentItem)===null||t===void 0?void 0:t.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},n.prototype._waitUntilSyncCompleted=function(){return g(this,void 0,void 0,function(){var t=this;return v(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(r){t._activationQueue.push(r)})]:[2]})})},n.prototype._waitSync=function(){var t=this;this.isInSync||(this._activationTimeout=setTimeout(function(){t._completeSync()},8))},n.prototype._completeSync=function(){this.isInSync||(this._state=lc.DONE,this._activationQueue.forEach(function(t){return t()}),this._activationQueue=[])},n.prototype.registerNode=function(){this._send(wn.NEWNODE),this._waitSync()},n.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(wn.CLAIM_HOST),this._waitSync()},n.prototype.lock=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),t=this._send(wn.REQUEST_LOCK),[4,this._requestLock(t)];case 2:return e.sent(),[2]}})})},n.prototype.unlock=function(){var t;!((t=this._currentItem)===null||t===void 0)&&t.requestId&&this._release(this._currentItem.requestId)},n}(),Tf=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.keyName,s=t.keyHash,a=t.indexes,o=t.store,u=this;this._state=Ja.INIT,this._indexers=[],this.dbname=e,this.name=r,this.keyName=i,this.indexes=ce([[i]],ie(a.filter(function(c){return Qs.createKey(c)!==u.keyName})),!1),this._keyHash=s,this._store=o,this._mutex=new D_(function(c,l){return"".concat(mo(c,l),".lock")}(e,r)),this._blobContainer=new FS({dbname:e,collectionName:r,store:o}),this._transaction=new qS({dbname:e,collectionName:r,store:o})}return n.metadataOf=function(t,e,r){return g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=Ef(t,e),[4,r.get(i)];case 1:return[2,s.sent()]}})})},Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isReady",{get:function(){return this._state===Ja.READY},enumerable:!1,configurable:!0}),n.prototype.init=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c,l,d,h,f,p,_=this;return v(this,function(m){switch(m.label){case 0:return[4,this._mutex.lock()];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,9,,10]),t=tl.get(this.dbname),[4,n.metadataOf(this.dbname,this.name,this._store)];case 3:return e=m.sent(),this._metadata=e||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:m.sent(),this._blockManager=new $S({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=ce([],ie(this.indexes),!1),i=[],s=r.map(function(b){return Qs.createKey(b)}),a=e?e.indexes.map(function(b){return Qs.createKey(b)}):[];try{for(o=Z(a),u=o.next();!u.done;u=o.next())c=u.value,s.includes(c)||i.push(Qs.parseKey(c))}catch(b){f={error:b}}finally{try{u&&!u.done&&(p=o.return)&&p.call(o)}finally{if(f)throw f.error}}return(l=[]).push.apply(l,ce([],ie(r.map(function(b){var y=new Qs({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:b,transaction:_._transaction,store:_._store});return _._indexers.push(y),y.ensure()})),!1)),l.push.apply(l,ce([],ie(i.map(function(b){return new Qs({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:b,transaction:_._transaction,store:_._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return m.sent(),[4,this._transaction.commit()];case 6:return m.sent(),s.sort().join(",")===a.sort().join(",")?[3,8]:(d=Ef(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata})]);case 7:m.sent(),m.label=8;case 8:return this._state=Ja.READY,this._mutex.unlock(),[3,10];case 9:throw h=m.sent(),this._mutex.unlock(),h;case 10:return[2]}})})},n.prototype.close=function(){this._state=Ja.CLOSED},n.prototype._hasPropertyOfKeyName=function(t){var e=t[this.keyName];return typeof e=="string"&&!!e},n.prototype._getIndexerBy=function(t){var e,r;t===void 0&&(t=null),t||(t=[this.keyName]);var i=Qs.createKey(t);try{for(var s=Z(this._indexers),a=s.next();!a.done;a=s.next()){var o=a.value;if(i===Qs.createKey(o.fields))return o}}catch(u){e={error:u}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}throw Fe.indexTableIsRequired},n.prototype._upgradeBlockLevel=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return t=Ef(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:t,value:this._metadata})];case 1:return e.sent(),[2]}})})},n.prototype._requestInsert=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return u.sent()?[3,13]:[4,this._blockManager.putToBlock(e,t)];case 2:return u.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return u.sent(),[4,this._blockManager.putToBlock(e,t)];case 4:u.sent(),u.label=5;case 5:u.trys.push([5,10,11,12]),r=Z(this._indexers),i=r.next(),u.label=6;case 6:return i.done?[3,9]:[4,i.value.addItem(t)];case 7:u.sent(),u.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=u.sent(),a={error:s},[3,12];case 11:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 12:return[3,14];case 13:throw Fe.collectionInsertDuplicate;case 14:return[2]}})})},n.prototype._requestUpsert=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h,f,p;return v(this,function(_){switch(_.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return(r=_.sent())?[3,13]:[4,this._blockManager.putToBlock(e,t)];case 2:return _.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return _.sent(),[4,this._blockManager.putToBlock(e,t)];case 4:_.sent(),_.label=5;case 5:_.trys.push([5,10,11,12]),i=Z(this._indexers),s=i.next(),_.label=6;case 6:return s.done?[3,9]:[4,(c=s.value).addItem(t)];case 7:_.sent(),_.label=8;case 8:return s=i.next(),[3,6];case 9:return[3,12];case 10:return a=_.sent(),d={error:a},[3,12];case 11:try{s&&!s.done&&(h=i.return)&&h.call(i)}finally{if(d)throw d.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(e,t)];case 14:_.sent(),_.label=15;case 15:_.trys.push([15,21,22,23]),o=Z(this._indexers),u=o.next(),_.label=16;case 16:return u.done?[3,20]:(c=u.value).diff(c.getColumnValues(r),c.getColumnValues(t))===0?[3,19]:[4,c.removeItem(r)];case 17:return _.sent(),[4,c.addItem(t)];case 18:_.sent(),_.label=19;case 19:return u=o.next(),[3,16];case 20:return[3,23];case 21:return l=_.sent(),f={error:l},[3,23];case 22:try{u&&!u.done&&(p=o.return)&&p.call(o)}finally{if(f)throw f.error}return[7];case 23:return[2]}})})},n.prototype._requestUpdate=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return(r=l.sent())?[4,this._blockManager.putToBlock(e,t)]:[3,11];case 2:l.sent(),l.label=3;case 3:l.trys.push([3,9,10,11]),i=Z(this._indexers),s=i.next(),l.label=4;case 4:return s.done?[3,8]:(a=s.value).diff(a.getColumnValues(r),a.getColumnValues(t))===0?[3,7]:[4,a.removeItem(r)];case 5:return l.sent(),[4,a.addItem(t)];case 6:l.sent(),l.label=7;case 7:return s=i.next(),[3,4];case 8:return[3,11];case 9:return o=l.sent(),u={error:o},[3,11];case 10:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 11:return[2]}})})},n.prototype._requestRemove=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return[4,this._blockManager.getFromBlock(t)];case 1:return(e=u.sent())?[4,this._blockManager.removeFromBlock(t)]:[3,10];case 2:u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),r=Z(this._indexers),i=r.next(),u.label=4;case 4:return i.done?[3,7]:[4,i.value.removeItem(e)];case 5:u.sent(),u.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return s=u.sent(),a={error:s},[3,10];case 9:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},n.prototype._requestClear=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s;return v(this,function(a){switch(a.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:a.sent(),a.label=2;case 2:a.trys.push([2,7,8,9]),t=Z(this._indexers),e=t.next(),a.label=3;case 3:return e.done?[3,6]:[4,e.value.clear()];case 4:a.sent(),a.label=5;case 5:return e=t.next(),[3,3];case 6:return[3,9];case 7:return r=a.sent(),i={error:r},[3,9];case 8:try{e&&!e.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 9:return[2]}})})},n.prototype.getByKey=function(t){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(t)];case 3:return e=i.sent(),this._mutex.unlock(),[2,Bn(e)];case 4:throw r=i.sent(),this._mutex.unlock(),r;case 5:return[3,7];case 6:throw Fe.collectionNotReady;case 7:return[2]}})})},n.prototype.query=function(t){if(t===void 0&&(t={}),this.isReady)return new xS({condition:t.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(t.index),backward:!!t.backward});throw Fe.collectionNotReady},n.prototype.insertOne=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw Fe.collectionKeyNotGiven;return[4,this._requestInsert(Bn(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Fe.collectionNotReady;case 9:return[2]}})})},n.prototype.insertMany=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c=this;return v(this,function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),t.some(function(d){return!c._hasPropertyOfKeyName(d)}))throw Fe.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),e=Z(t),r=e.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._requestInsert(Bn(i))]);case 5:l.sent(),l.label=6;case 6:return r=e.next(),[3,4];case 7:return[3,10];case 8:return s=l.sent(),o={error:s},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(o)throw o.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,t];case 12:return a=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),a;case 14:return[3,16];case 15:throw Fe.collectionNotReady;case 16:return[2]}})})},n.prototype.upsertOne=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw Fe.collectionKeyNotGiven;return[4,this._requestUpsert(Bn(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Fe.collectionNotReady;case 9:return[2]}})})},n.prototype.upsertMany=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c=this;return v(this,function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),t.some(function(d){return!c._hasPropertyOfKeyName(d)}))throw Fe.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),e=Z(t),r=e.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._requestUpsert(Bn(i))]);case 5:l.sent(),l.label=6;case 6:return r=e.next(),[3,4];case 7:return[3,10];case 8:return s=l.sent(),o={error:s},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(o)throw o.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,t];case 12:return a=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),a;case 14:return[3,16];case 15:throw Fe.collectionNotReady;case 16:return[2]}})})},n.prototype.update=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw Fe.collectionKeyNotGiven;return[4,this._requestUpdate(Bn(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Fe.collectionNotReady;case 9:return[2]}})})},n.prototype.updateIf=function(t,e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h,f,p,_,m,b=this;return v(this,function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,15]),r=t.where,i=r===void 0?{}:r,s=t.index,a=s===void 0?null:s,o=t.backward,u=o!==void 0&&o,c=[],[4,new Op({condition:i,blockManager:this._blockManager,backward:u,indexer:this._getIndexerBy(a)}).each(function(E){return g(b,void 0,void 0,function(){var T,N;return v(this,function(C){if(E.error)throw E.stop(),E.error;if(E.hasNext){if(T=E.nextValue,so(i,T)&&e.set){if(typeof e.set!="function")for(N in e.set)T[N]=e.set[N];else e.set(T);c.push(T)}E.next()}else E.stop();return[2]})})})];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),l=Z(c),d=l.next(),y.label=5;case 5:return d.done?[3,8]:(h=d.value,[4,this._requestUpdate(Bn(h))]);case 6:y.sent(),y.label=7;case 7:return d=l.next(),[3,5];case 8:return[3,11];case 9:return f=y.sent(),_={error:f},[3,11];case 10:try{d&&!d.done&&(m=l.return)&&m.call(l)}finally{if(_)throw _.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,c];case 13:return p=y.sent(),[4,this._transaction.clear()];case 14:throw y.sent(),this._mutex.unlock(),p;case 15:return[3,17];case 16:throw this._transaction.clear(),Fe.collectionNotReady;case 17:return[2]}})})},n.prototype.remove=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,5,,7]),[4,this._requestRemove(t)];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[3,7];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw Fe.collectionNotReady;case 9:return[2]}})})},n.prototype.removeIf=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h,f,p,_,m=this;return v(this,function(b){switch(b.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:b.sent(),b.label=2;case 2:return b.trys.push([2,13,,14]),e=t.where,r=e===void 0?{}:e,i=t.index,s=i===void 0?null:i,a=t.backward,o=a!==void 0&&a,u=[],[4,new Op({condition:r,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(s)}).each(function(y){return g(m,void 0,void 0,function(){var E,T;return v(this,function(N){if(y.error)throw y.stop(),y.error;return y.hasNext?(E=y.nextValue,so(r,E)&&(T=E[this.keyName],u.push(T)),y.next()):y.stop(),[2]})})})];case 3:b.sent(),b.label=4;case 4:b.trys.push([4,9,10,11]),c=Z(u),l=c.next(),b.label=5;case 5:return l.done?[3,8]:(d=l.value,[4,this._requestRemove(d)]);case 6:b.sent(),b.label=7;case 7:return l=c.next(),[3,5];case 8:return[3,11];case 9:return h=b.sent(),p={error:h},[3,11];case 10:try{l&&!l.done&&(_=c.return)&&_.call(c)}finally{if(p)throw p.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return b.sent(),this._mutex.unlock(),[2,u];case 13:throw f=b.sent(),this._mutex.unlock(),f;case 14:return[3,16];case 15:throw this._transaction.clear(),Fe.collectionNotReady;case 16:return[2]}})})},n.prototype.clear=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw Fe.collectionNotReady;case 9:return[2]}})})},n.prototype.getBlob=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(t)];case 1:return[2,e.sent()]}})})},n.prototype.saveBlob=function(t,e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._blobContainer.save(t,e)];case 1:return[2,r.sent()]}})})},n.prototype.removeBlob=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(t)];case 1:return e.sent(),[2]}})})},n.prototype.removeAllBlobs=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this._blobContainer.clear()];case 1:return t.sent(),[2]}})})},n}(),wf="[NESTDB]",xl=!0,xa=function(){function n(){}return n.off=function(){xl=!1},n.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];xl&&console.log.apply(console,ce(["".concat(wf,"[LOG]")],ie(t),!1))},n.warning=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];xl&&console.warn.apply(console,ce(["".concat(wf,"[WARNING]")],ie(t),!1))},n.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];xl&&console.error.apply(console,ce(["".concat(wf,"[ERROR]")],ie(t),!1))},n}(),HS=[{},{a:700400,n:"error"}],mh=function(){function n(t){var e,r,i;this.encryption=(e=t.encryption)!==null&&e!==void 0?e:G0,this.itemSizeLimit=(r=t.itemSizeLimit)!==null&&r!==void 0?r:4194304,this.metadataBuffer=(i=t.metadataBuffer)!==null&&i!==void 0?i:256}return Object.defineProperty(n.prototype,"_encryptionCheckKey",{get:function(){return"".concat(this.dbname,".encrypt")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_reservedKeys",{get:function(){return[this._encryptionCheckKey]},enumerable:!1,configurable:!0}),n.prototype._getRawKey=function(t,e){return e===void 0&&(e=""),"".concat(t).concat(e)},n.prototype._generateShardPostfixArray=function(t){return t===void 0&&(t=1),ce([],ie(Array(t).keys()),!1)},n.prototype._shardify=function(t){var e=this,r=t.key,i=t.value,s=JSON.stringify(this.encryption.encrypt(i)),a=Math.ceil(s.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(a).map(function(o){var u={key:e._getRawKey(r,".".concat(o)),data:s.substring(o*e.adjustedItemSizeLimit,(o+1)*e.adjustedItemSizeLimit)};return o===0&&(u.metadata={shards:a}),u})},n.prototype._resetIfEncryptionChanged=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c,l=this;return v(this,function(d){switch(d.label){case 0:return[4,this.get(this._encryptionCheckKey)];case 1:if(t=d.sent(),e={encrypted:HS.map(function(h){var f;return(f=l.encryption)===null||f===void 0?void 0:f.encrypt(h)})},!(t&&t.encrypted&&Array.isArray(t.encrypted)))return[3,6];for(s in r=t.encrypted,i=[],r)i.push(s);a=0,d.label=2;case 2:return a<i.length?(s=i[a])in r?(o=s,u=JSON.stringify(t.encrypted[o]),c=JSON.stringify(e.encrypted[o]),u===c?[3,4]:(xa.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this.clear()])):[3,4]:[3,5];case 3:return d.sent(),[3,5];case 4:return a++,[3,2];case 5:return[3,8];case 6:return[4,this.clear()];case 7:d.sent(),d.label=8;case 8:return[4,this.set({key:this._encryptionCheckKey,value:e})];case 9:return d.sent(),[2]}})})},Object.defineProperty(n.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),n.prototype.usage=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return t=0,[4,this._getAllRawKeys()];case 1:e=l.sent(),l.label=2;case 2:l.trys.push([2,7,8,9]),r=Z(e),i=r.next(),l.label=3;case 3:return i.done?[3,6]:(s=i.value,[4,this._getRaw(s)]);case 4:(a=l.sent())&&(t+=JSON.stringify(a).length),l.label=5;case 5:return i=r.next(),[3,3];case 6:return[3,9];case 7:return o=l.sent(),u={error:o},[3,9];case 8:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 9:return[2,t]}})})},n.prototype.getAllKeys=function(){return g(this,void 0,void 0,function(){var t=this;return v(this,function(e){switch(e.label){case 0:return[4,this._getAllRawKeys()];case 1:return[2,e.sent().filter(function(r){return r.endsWith(".0")}).map(function(r){return r.replace(/\.0$/,"")}).filter(function(r){return!t._reservedKeys.includes(r)})]}})})},n.prototype.get=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u=this;return v(this,function(c){switch(c.label){case 0:return e=this._getRawKey(t,".0"),[4,this._getRaw(e)];case 1:if(!(r=c.sent()))return[3,7];c.label=2;case 2:return c.trys.push([2,6,,7]),i=r.data,(s=r.metadata)!=null&&s.shards&&s.shards>1?[4,Promise.all(this._generateShardPostfixArray(s==null?void 0:s.shards).map(function(l){return g(u,void 0,void 0,function(){var d,h;return v(this,function(f){switch(f.label){case 0:return l>0?(d=this._getRawKey(t,".".concat(l)),[4,this._getRaw(d)]):[3,2];case 1:if(!(h=f.sent()))throw Fe.storeBrokenIntegrity;return[2,h.data];case 2:return[2,i]}})})}))]:[3,4];case 3:return o=c.sent(),[3,5];case 4:o=[i],c.label=5;case 5:return a=o,[2,this.encryption.decrypt(JSON.parse(a.join("")))];case 6:return c.sent(),[2,null];case 7:return[2,null]}})})},n.prototype.set=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return e=this._shardify(t),[4,this._setRaw(e)];case 1:return r.sent(),[2,A({},t.value)]}})})},n.prototype.setMany=function(t){return g(this,void 0,void 0,function(){var e,r=this;return v(this,function(i){switch(i.label){case 0:return e=[],[4,this._setRaw(e.concat.apply(e,ce([],ie(t.map(function(s){return r._shardify(s)})),!1)))];case 1:return i.sent(),[2,t.map(function(s){return s.value})]}})})},n.prototype.remove=function(t){return g(this,void 0,void 0,function(){var e,r,i,s=this;return v(this,function(a){switch(a.label){case 0:return e=this._getRawKey(t,".0"),[4,this._getRaw(e)];case 1:return(r=a.sent())?(i=r.metadata,[4,this._removeRaw(this._generateShardPostfixArray(i==null?void 0:i.shards).map(function(o){return s._getRawKey(t,".".concat(o))}))]):[3,3];case 2:return a.sent(),[2,!0];case 3:return[2,!1]}})})},n.prototype.removeMany=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d=this;return v(this,function(h){switch(h.label){case 0:e=[],r=function(f){var p,_,m;return v(this,function(b){switch(b.label){case 0:return p=i._getRawKey(f,".0"),[4,i._getRaw(p)];case 1:return(_=b.sent())&&(m=_.metadata,e.push.apply(e,ce([],ie(i._generateShardPostfixArray(m==null?void 0:m.shards).map(function(y){return d._getRawKey(f,".".concat(y))})),!1))),[2]}})},i=this,h.label=1;case 1:h.trys.push([1,6,7,8]),s=Z(t),a=s.next(),h.label=2;case 2:return a.done?[3,5]:(o=a.value,[5,r(o)]);case 3:h.sent(),h.label=4;case 4:return a=s.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),c={error:u},[3,8];case 7:try{a&&!a.done&&(l=s.return)&&l.call(s)}finally{if(c)throw c.error}return[7];case 8:return e.length>0?[4,this._removeRaw(e)]:[3,10];case 9:h.sent(),h.label=10;case 10:return[2,t]}})})},n}(),Gn={},Xs=function(n){function t(e){e===void 0&&(e={});var r,i=this;i=n.call(this,A(A({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:4194304}))||this;var s=e.delay,a=s===void 0?1:s;return i.delay=a,i.observer={},i}return w(t,n),Object.defineProperty(t.prototype,"rawData",{get:function(){return Gn[this.dbname]},set:function(e){Gn[this.dbname]=e},enumerable:!1,configurable:!0}),t.prototype._getAllRawKeys=function(){return g(this,void 0,void 0,function(){return v(this,function(e){if(Gn[this.dbname])return[2,Object.keys(Gn[this.dbname])];throw Fe.storeNotAvailable})})},t.prototype._getRaw=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return Gn[this.dbname]?[4,Ll(this.delay)]:[3,2];case 1:return r.sent(),[2,Gn[this.dbname][e]?A({key:e},Gn[this.dbname][e]):null];case 2:throw Fe.storeNotAvailable}})})},t.prototype._setRaw=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l;return v(this,function(d){switch(d.label){case 0:return Gn[this.dbname]?[4,Ll(this.delay)]:[3,2];case 1:d.sent();try{for(r=Z(e),i=r.next();!i.done;i=r.next())s=i.value,a=s.key,o=s.data,u=s.metadata,Gn[this.dbname][a]=Object.freeze({data:o,metadata:u})}catch(h){c={error:h}}finally{try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}return[3,3];case 2:throw Fe.storeNotAvailable;case 3:return[2]}})})},t.prototype._removeRaw=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return Gn[this.dbname]?[4,Ll(this.delay)]:[3,2];case 1:u.sent();try{for(r=Z(e),i=r.next();!i.done;i=r.next())s=i.value,Gn[this.dbname][s]&&delete Gn[this.dbname][s]}catch(c){a={error:c}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}}return[3,3];case 2:throw Fe.storeNotAvailable;case 3:return[2]}})})},t.prototype.observe=function(e,r,i){var s=this;this.observer[e]||(this.observer[e]={}),r.forEach(function(a){return s.observer[e][a]=i})},t.prototype.checkAvailability=function(){return g(this,void 0,void 0,function(){return v(this,function(e){return[2]})})},t.prototype.init=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.dbname=e,Gn[this.dbname]||(Gn[this.dbname]={}),[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.set=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){if((r=this.observer[e.key])&&typeof r.set=="function"&&(i=r.set()))throw i;return[2,n.prototype.set.call(this,e)]})})},t.prototype.setMany=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return v(this,function(l){try{for(r=Z(e),i=r.next();!i.done;i=r.next())if(s=i.value,(a=this.observer[s.key])&&typeof a.set=="function"&&(o=a.set()))throw o}catch(d){u={error:d}}finally{try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}}return[2,n.prototype.setMany.call(this,e)]})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,Ll(this.delay)];case 1:return e.sent(),Gn[this.dbname]={},[2]}})})},t}(mh),qv="NestDBStore";(function(n){n[n.UNINITIALIZED=0]="UNINITIALIZED",n[n.OPENING=1]="OPENING",n[n.OPEN=2]="OPEN",n[n.CLOSED=3]="CLOSED"})(si||(si={}));var zS=function(n){function t(e){e===void 0&&(e={});var r,i=this;return(i=n.call(this,A(A({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:104857600}))||this)._storeName=qv,i._state=si.UNINITIALIZED,i._openJobQueue=[],i._window=typeof window<"u"?window:void 0,i._indexedDb=i._window?i._window.indexedDB||i._window.mozIndexedDB||i._window.webkitIndexedDB||i._window.msIndexedDB:void 0,i}return w(t,n),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTransactionReusable",{get:function(){var e=navigator==null?void 0:navigator.userAgent;if(e){var r="15.0.0";if(e.includes("Safari/")?r=e.split("Safari/")[0].trim().split("Version/")[1]:e.includes("AppleWebKit/")&&(r=e.split("AppleWebKit/")[0].trim().split("Version/")[1]),(r?parseInt(r.split(".")[0]):0)<=14)return!1}return!0},enumerable:!1,configurable:!0}),t.prototype._putToObjectStore=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){return[2,new Promise(function(s,a){var o=e.put(r);o.addEventListener("success",function(u){s(u.target.result)}),o.addEventListener("error",function(){a("Failed to write.")})})]})})},t.prototype._deleteFromObjectStore=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){return[2,new Promise(function(s,a){var o=e.delete(r);o.addEventListener("success",function(){return s(r)}),o.addEventListener("error",function(u){return a(u.target.error)})})]})})},t.prototype._openDatabase=function(e){var r=this;return new Promise(function(i,s){if(r._indexedDb){r._state=si.OPENING;var a=r._indexedDb.open(e);a.addEventListener("upgradeneeded",function(o){o.target.result.createObjectStore(qv,{keyPath:"key"})}),a.addEventListener("success",function(o){r._state=si.OPEN,r._database=o.target.result,r._openJobQueue.forEach(function(u){return u()}),r._openJobQueue=[],r._database.onclose=function(){r._database=void 0,r._state=si.OPENING,setTimeout(function(){r._openDatabase(e)},5)},i(r._database)}),a.addEventListener("error",function(o){r._state=si.UNINITIALIZED,s(o.target.error)})}else s(Fe.storeNotAvailable)})},t.prototype._getObjectStore=function(e){return g(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return this._database?[2,this._database.transaction(this._storeName,e).objectStore(this._storeName)]:[3,1];case 1:switch(this._state){case si.UNINITIALIZED:case si.OPEN:return[3,2];case si.OPENING:case si.CLOSED:return[3,3]}return[3,4];case 2:throw Fe.storeNotInitialized;case 3:return[2,new Promise(function(s){r._openJobQueue.push(function(){return s(r._getObjectStore(e))})})];case 4:return[4,this._getObjectStore(e)];case 5:return[2,i.sent()]}})})},t.prototype._getAllRawKeys=function(){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return e=r.sent(),[4,new Promise(function(i,s){var a=e.getAllKeys();a.addEventListener("success",function(o){i(o.target.result)}),a.addEventListener("error",function(o){return s(o.target.error)})})];case 2:return[2,r.sent()]}})})},t.prototype._getRaw=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return r=i.sent(),[4,new Promise(function(s,a){var o=r.get(e);o.addEventListener("success",function(u){var c;s((c=u==null?void 0:u.target)===null||c===void 0?void 0:c.result)}),o.addEventListener("error",function(u){return a(u.target.error)})})];case 2:return[2,i.sent()]}})})},t.prototype._setRaw=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l=this;return v(this,function(d){switch(d.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return r=d.sent(),this.isTransactionReusable?[4,Promise.all(e.map(function(h){return l._putToObjectStore(r,h)}))]:[3,3];case 2:return d.sent(),[3,10];case 3:d.trys.push([3,8,9,10]),i=Z(e),s=i.next(),d.label=4;case 4:return s.done?[3,7]:(a=s.value,[4,this._putToObjectStore(r,a)]);case 5:d.sent(),d.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return o=d.sent(),u={error:o},[3,10];case 9:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 10:return[2]}})})},t.prototype._removeRaw=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l=this;return v(this,function(d){switch(d.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return r=d.sent(),this.isTransactionReusable?[4,Promise.all(e.map(function(h){return l._deleteFromObjectStore(r,h)}))]:[3,3];case 2:return d.sent(),[3,10];case 3:d.trys.push([3,8,9,10]),i=Z(e),s=i.next(),d.label=4;case 4:return s.done?[3,7]:(a=s.value,[4,this._deleteFromObjectStore(r,a)]);case 5:d.sent(),d.label=6;case 6:return s=i.next(),[3,4];case 7:return[3,10];case 8:return o=d.sent(),u={error:o},[3,10];case 9:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 10:return[2]}})})},t.prototype._triggerDatabaseClose=function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))},t.prototype.checkAvailability=function(){return g(this,void 0,void 0,function(){var e,r=this;return v(this,function(i){switch(i.label){case 0:if(!((e=typeof window<"u"?window:null)!=null&&e.indexedDB||e!=null&&e.mozIndexedDB||e!=null&&e.webkitIndexedDB||e!=null&&e.msIndexedDB))return[3,6];if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!$d())return[3,4];if(!($d()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")))return[3,1];if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw Fe.storeNotAvailableInPrivateBrowsing;return[3,3];case 1:return[4,new Promise(function(s,a){if(r._indexedDb)try{var o=r._indexedDb.open("_testMozilla");o.onerror=function(){return a(Fe.storeNotAvailableInPrivateBrowsing)},o.onsuccess=function(u){if(u.target.result.close(),r._indexedDb){var c=r._indexedDb.deleteDatabase("_testMozilla");c.onerror=function(){return s()},c.onsuccess=function(){return s()}}else a(Fe.storeNotAvailable)}}catch{a(Fe.storeNotAvailableInPrivateBrowsing)}else a(Fe.storeNotAvailable)})];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:throw Fe.storeNotAvailable;case 5:return[3,7];case 6:throw Fe.storeNotAvailable;case 7:return[2]}})})},t.prototype.init=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this.checkAvailability()];case 1:return r.sent(),[4,this._openDatabase(e)];case 2:return r.sent(),[4,this._resetIfEncryptionChanged()];case 3:return r.sent(),[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return e=r.sent(),[4,new Promise(function(i,s){var a=e.clear();a.addEventListener("success",function(){return i()}),a.addEventListener("error",function(o){return s(o.target.error)})})];case 2:return[2,r.sent()]}})})},t}(mh),GS=function(n){function t(e){var r=this,i=e.AsyncStorage,s=e.itemSizeLimit,a=s===void 0?6291456:s,o=LT(e,["AsyncStorage","itemSizeLimit"]);return(r=n.call(this,A(A({},o),{itemSizeLimit:a}))||this)._asyncStorage=i,r}return w(t,n),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return g(this,void 0,void 0,function(){var e,r=this;return v(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return e=i.sent(),[2,e.filter(function(s){return r._isBelonging(s)}).map(function(s){return s.substring("".concat(r.dbname,"/").length)})]}})})},t.prototype._getRaw=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(r=i.sent())?JSON.parse(r):null]}})})},t.prototype._setRaw=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:r=[];try{for(i=Z(e),s=i.next();!s.done;s=i.next())a=s.value,o=a.key,a.data.length<=this.adjustedItemSizeLimit&&r.push([this._getActualKey(o),JSON.stringify(a)])}catch(d){u={error:d}}finally{try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}}return[4,this._asyncStorage.multiSet(r)];case 1:return l.sent(),[2]}})})},t.prototype._removeRaw=function(e){return g(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.multiRemove(e.map(function(s){return r._getActualKey(s)}))];case 1:return i.sent(),[2]}})})},t.prototype.checkAvailability=function(){return g(this,void 0,void 0,function(){return v(this,function(e){if(!this._asyncStorage)throw Fe.storeNotAvailable;return[2]})})},t.prototype.init=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return[4,this.getAllKeys()];case 1:return e=r.sent(),[4,this.removeMany(e)];case 2:return r.sent(),[2]}})})},t}(mh);(function(n){function t(e){var r,i=this;return(i=n.call(this,A(A({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:6291456}))||this)._mmkv=e.MMKV,i}w(t,n),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return g(this,void 0,void 0,function(){var e,r=this;return v(this,function(i){switch(i.label){case 0:return[4,this._mmkv.getAllKeys()];case 1:return e=i.sent(),[2,e.filter(function(s){return r._isBelonging(s)}).map(function(s){return s.substring("".concat(r.dbname,"/").length)})]}})})},t.prototype._getRaw=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return[4,this._mmkv.getString(this._getActualKey(e))];case 1:return[2,(r=i.sent())?JSON.parse(r):null]}})})},t.prototype._setRaw=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){try{for(r=Z(e),i=r.next();!i.done;i=r.next())s=i.value,a=s.key,s.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(a),JSON.stringify(s))}catch(l){o={error:l}}finally{try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}}return[2]})})},t.prototype._removeRaw=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o;return v(this,function(u){try{for(r=Z(e),i=r.next();!i.done;i=r.next())s=i.value,this._mmkv.delete(this._getActualKey(s))}catch(c){a={error:c}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}}return[2]})})},t.prototype.checkAvailability=function(){return g(this,void 0,void 0,function(){return v(this,function(e){if(!this._mmkv)throw Fe.storeNotAvailable;return[2]})})},t.prototype.init=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return[4,this.getAllKeys()];case 1:return e=r.sent(),[4,this.removeMany(e)];case 2:return r.sent(),[2]}})})}})(mh);var Mi;(function(n){n.INIT="INIT",n.OPENING="OPENING",n.OPENED="OPENED",n.CLOSED="CLOSED"})(Mi||(Mi={}));var an,VS=function(){function n(t){var e=t.name,r=t.version,i=t.store,s=t.config;this.name=e,this._version=r,this._state=Mi.INIT,this._config=s||new tl({dbname:e}),this._store=i,this._event={success:Vu,error:Vu,storeReplaced:Vu,upgrade:Lv},this._collections=new Map,this._globalMutex=new D_("".concat(this.name,".lock")),this._config.disableLogger&&xa.off(),new $r({dbname:e,limit:this._config.cacheLimit})}return Object.defineProperty(n.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),n.prototype.estimateUsage=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,(e=this._store,g(void 0,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,e.usage()];case 1:return[2,r.sent()]}})}))];case 1:return[2,t.sent()]}var e})})},n.prototype.commitSchema=function(t){return g(this,void 0,void 0,function(){var e=this;return v(this,function(r){switch(r.label){case 0:return this._state!==Mi.OPENING?[3,2]:[4,Promise.all(t.map(function(i){return g(e,void 0,void 0,function(){var s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return s=i.collectionName,a=i.keyName,o=i.index,u=o===void 0?[]:o,this._collections.has(s)||this._collections.set(s,new Tf({dbname:this.name,collectionName:s,keyName:a,indexes:u,store:this._store})),(c=this._collections.get(s))?[4,c.init()]:[3,2];case 1:l.sent(),l.label=2;case 2:return[2]}})})}))];case 1:return r.sent(),[3,3];case 2:throw Fe.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},n.prototype.open=function(){var t;return g(this,void 0,void 0,function(){var e,r,i,s,a=this;return v(this,function(o){switch(o.label){case 0:return[4,this._globalMutex.lock()];case 1:if(o.sent(),this._state===Mi.OPENED)return[3,12];this._state=Mi.OPENING,o.label=2;case 2:return o.trys.push([2,5,,12]),[4,this._store.init(this.name)];case 3:return o.sent(),u=this.name,e="".concat(Mp(u),".metadata"),r={version:0,collectionNames:[]},[4,this._store.get(e)];case 4:return i=(t=o.sent())!==null&&t!==void 0?t:r,[2,new Promise(function(c,l){var d=function(f){i.version<a._version?a._event.upgrade(i.version,function(p){return g(a,void 0,void 0,function(){var _;return v(this,function(m){switch(m.label){case 0:if(p)return[3,5];i.version++,i.collectionNames=Array.from(this._collections.keys()),m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this._store.set({key:e,value:i})];case 2:return m.sent(),f({continued:!0}),[3,4];case 3:return _=m.sent(),f({continued:!1,err:_}),[3,4];case 4:return[3,6];case 5:f({continued:!1,err:p}),m.label=6;case 6:return[2]}})})}):f({continued:!1})},h=function(f){var p=f.continued,_=p!==void 0&&p,m=f.err,b=m===void 0?null:m;if(_)setTimeout(function(){return d(h)},10);else if(b)xa.error(b.message),a._globalMutex.unlock(),a._event.error(b),l(b);else{var y=[];i.collectionNames.forEach(function(E){var T=a._collections.get(E);T&&T.state===Ja.READY||y.push(g(a,void 0,void 0,function(){var N,C;return v(this,function(L){switch(L.label){case 0:return[4,Tf.metadataOf(this.name,E,this._store)];case 1:return(N=L.sent())?(C=new Tf({dbname:this.name,collectionName:E,keyName:N.keyName,indexes:N.indexes,store:this._store}),this._collections.set(E,C),[4,C.init()]):[3,3];case 2:L.sent(),L.label=3;case 3:return[2]}})}))}),Promise.all(y).then(function(){a._state=Mi.OPENED,a._globalMutex.unlock(),a._event.success(),c()}).catch(function(E){xa.error(E.message),a._globalMutex.unlock(),a._event.error(E),l(E)})}};d(h)})];case 5:switch(s=o.sent(),s.code){case ft.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case ft.STORE_NOT_AVAILABLE:return[3,8]}return[3,10];case 6:return xa.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new Xs({}),this._globalMutex.unlock(),this._event.error(s),this._event.storeReplaced(this._store),[4,this.open()];case 7:return o.sent(),[3,11];case 8:return xa.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new Xs({}),this._globalMutex.unlock(),this._event.error(s),this._event.storeReplaced(this._store),[4,this.open()];case 9:return o.sent(),[3,11];case 10:throw xa.error(s.message),this._globalMutex.unlock(),this._event.error(s),s;case 11:return[3,12];case 12:return[2]}var u})})},n.prototype.close=function(){this._collections.forEach(function(t){return t.close()}),this._state=Mi.CLOSED},n.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return t.sent(),[2]}})})},n.prototype.reset=function(){return g(this,void 0,void 0,function(){var t,e=this;return v(this,function(r){switch(r.label){case 0:return this.close(),(t=$r.get(this.name))&&t.clearByCondition(function(i){return i.key.startsWith(Mp(e.name))}),[4,this._store.clear()];case 1:return r.sent(),[2]}})})},n.prototype.on=function(t,e){this._event[t]=e},n.prototype.off=function(t){typeof this._event[t]=="function"&&(t==="upgrade"?this._event[t]=Lv:this._event[t]=Vu)},n.prototype.collection=function(t){var e=this._collections.get(t);if(e)return e;throw Fe.collectionNotReady},n}(),Us=function(){function n(t){var e,r,i,s;this.messageTypeFilter=(e=t==null?void 0:t.messageTypeFilter)!==null&&e!==void 0?e:mn.ALL,this.customTypesFilter=(r=t==null?void 0:t.customTypesFilter)!==null&&r!==void 0?r:null,this.senderUserIdsFilter=(i=t==null?void 0:t.senderUserIdsFilter)!==null&&i!==void 0?i:null,this.replyType=(s=t==null?void 0:t.replyType)!==null&&s!==void 0?s:vn.NONE}return n.prototype.clone=function(){var t=new n,e=JSON.parse(JSON.stringify(this));return Object.keys(e).forEach(function(r){t[r]=e[r]}),t},n.prototype.match=function(t){switch(this.messageTypeFilter){case mn.USER:if(t.messageType!==gt.USER)return!1;break;case mn.FILE:if(t.messageType!==gt.FILE)return!1;break;case mn.ADMIN:if(t.messageType!==gt.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(t.customType)||this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0&&(!(t instanceof kt)||!this.senderUserIdsFilter.includes(t.sender.userId)))return!1;if(t instanceof Nn)switch(this.replyType){case vn.NONE:if(t.parentMessageId>0)return!1;break;case vn.ONLY_REPLY_TO_CHANNEL:if(t instanceof kt&&t.parentMessageId>0&&!t.replyToChannel)return!1}return!0},n}();(function(n){n.CHANNEL_LATEST="channel_latest",n.NEWEST_CHILD_MESSAGE="newest_child_message"})(an||(an={}));var dc,$i=function(n){switch(n){case an.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case an.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}},BS=function(){return["channelUrl","-createdAt","-notificationId"]},jS=A(A({},qy),{scheduledAt:void 0}),KS=function(n){return Hy(n)&&R("number",n.scheduledAt,!0)},QS=A(A({},ph),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),WS=function(n){return _h(n)&&R("number",n.scheduledAt)&&(On(n.file)||R("string",n.fileUrl))&&R("string",n.fileName,!0)&&R("string",n.mimeType,!0)&&R("number",n.fileSize,!0)&&(n.thumbnailSizes===null||n.thumbnailSizes===void 0||n.thumbnailSizes.every(function(t){return R("object",t)&&t.maxWidth>0&&t.maxHeight>0}))},Xy="UnsentMessage",YS="reqId",Fl={},vo=function(n){function t(e){var r=n.call(this,e)||this;return r._mutex=new D_("unsendmessagecache.lock"),Fl[e]=r,r}return w(t,n),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return M.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),t.of=function(e,r){return r===void 0&&(r=!1),Fl[e]&&!r||(Fl[e]=new t(e)),Fl[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb,r=e==null?void 0:e.collection(Xy);if(!r)throw U.databaseError;return r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){if(e.messageId>0)throw U.invalidParameters;var r,i=A({},e.serialize());return e instanceof _n?(e.messageParams&&(i.messageParams=Ev(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(i.scheduledInfo.scheduledMessageParams=(r=e.scheduledInfo.scheduledMessageParams,A(A({},Ev(r)),{scheduledAt:r.scheduledAt})))):e instanceof qt?(e.messageParams&&(i.messageParams=bv(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(i.scheduledInfo.scheduledMessageParams=function(s){return A(A({},bv(s)),{scheduledAt:s.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))):e instanceof Ir&&e.messageParams&&(i.messageParams=function(s){return re({fileInfoList:s.fileInfoList,isReplyToChannel:s.isReplyToChannel,pushNotificationDeliveryOption:s.pushNotificationDeliveryOption})}(e.messageParams)),i},t.prototype._deserialize=function(e){return e=A(A({},e),{messageId:parseInt(e.messageId)}),Xt.of(this._iid).buildMessageFromSerializedData(e)},t.prototype._deserializeWithMessageCreateParams=function(e){var r,i,s;return g(this,void 0,void 0,function(){var a,o,u,c,l,d,h=this;return v(this,function(f){switch(f.label){case 0:return a=Xt.of(this._iid),o=this._deserialize(e),e.messageParams?o instanceof _n?(c=e.messageParams,o.messageParams=a.buildUserMessageCreateParamsFromSerializedData(c,o),[3,6]):[3,1]:[3,6];case 1:return o instanceof qt?(c=e.messageParams).fileKey&&typeof c.fileKey=="string"&&vf((r=c.fileType)!==null&&r!==void 0?r:"")?(u=c,[4,this.collection.getBlob(c.fileKey)]):[3,3]:[3,4];case 2:u.file=(i=f.sent())!==null&&i!==void 0?i:void 0,f.label=3;case 3:return o.messageParams=a.buildFileMessageCreateParamsFromSerializedData(c,o),[3,6];case 4:return o instanceof Ir&&(c=e.messageParams)&&c.fileInfoList?(o.messageParams=a.buildMultipleFilesMessageCreateParamsFromSerializedData(c,o),[4,Promise.all(o.messageParams.fileInfoList.map(function(p){return g(h,void 0,void 0,function(){var _,m,b,y,E;return v(this,function(T){switch(T.label){case 0:return typeof((m=p._uploadedMetaData)===null||m===void 0?void 0:m.fileKey)=="string"&&vf((y=(b=p._uploadedMetaData)===null||b===void 0?void 0:b.fileType)!==null&&y!==void 0?y:"")?(_=p,[4,this.collection.getBlob(p._uploadedMetaData.fileKey)]):[3,2];case 1:_.file=(E=T.sent())!==null&&E!==void 0?E:void 0,T.label=2;case 2:return[2]}})})}))]):[3,6];case 5:f.sent(),f.label=6;case 6:return o.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?o instanceof _n?(l=e.scheduledInfo.scheduledMessageParams,o.scheduledInfo.scheduledMessageParams=a.buildScheduledUserMessageCreateParamsFromSerializedData(l,o),[3,10]):[3,7]:[3,10];case 7:return o instanceof qt?(l=e.scheduledInfo.scheduledMessageParams).fileKey&&typeof l.fileKey=="string"&&typeof l.fileType=="string"&&vf(l.fileType)?(d=l,[4,this.collection.getBlob(l.fileKey)]):[3,9]:[3,10];case 8:d.file=(s=f.sent())!==null&&s!==void 0?s:void 0,f.label=9;case 9:o.scheduledInfo.scheduledMessageParams=a.buildScheduledFileMessageCreateParamsFromSerializedData(l,o),f.label=10;case 10:return[2,o]}})})},t.prototype._getFileInfoBlobKey=function(e,r){return"".concat(e,".").concat(r)},t.prototype.get=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(r=i.sent())return[2,this._deserializeWithMessageCreateParams(r)];i.label=2;case 2:return[2,void 0]}})})},t.prototype.fetch=function(e){var r=e.channelUrl,i=e.filter,s=i===void 0?new Us:i,a=e.order,o=a===void 0?an.CHANNEL_LATEST:a,u=e.sendingStatus,c=e.backward,l=c!==void 0&&c,d=e.parentMessageId;return g(this,void 0,void 0,function(){var h,f,p,_,m=this;return v(this,function(b){switch(b.label){case 0:return this.localCacheEnabled?(h=$i(o),f={"/where":function(y){return!!(o!==an.NEWEST_CHILD_MESSAGE||d&&y.parentMessageId!==0&&y.parentMessageId===d)&&s.match(m._deserialize(y))}},r&&(f.channelUrl=r),u&&(f.sendingStatus=u),p={where:f,index:h,backward:l},[4,this.collection.query(p)]):[3,3];case 1:return[4,b.sent().fetch({})];case 2:return _=b.sent(),[2,Promise.all(_.map(function(y){return g(m,void 0,void 0,function(){return v(this,function(E){switch(E.label){case 0:return[4,this._deserializeWithMessageCreateParams(y)];case 1:return[2,E.sent()]}})})}))];case 3:return[2,[]]}})})},t.prototype.getAllChildMessages=function(e,r){return r===void 0&&(r=new Us),g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this.fetch({filter:r,order:an.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,i.sent()]}})})},t.prototype.upsert=function(e){return g(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return g(r,void 0,void 0,function(){var a;return v(this,function(o){switch(o.label){case 0:return s instanceof qt||s instanceof Ir?[4,this._mutex.lock()]:[3,4];case 1:return o.sent(),[4,this.saveBlob(s)];case 2:return o.sent(),[4,this._mutex.unlock()];case 3:o.sent(),o.label=4;case 4:return a=this._serialize(s),[4,this.collection.upsertOne(a)];case 5:return o.sent(),[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.upsertChildMessages=function(e){return g(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return g(r,void 0,void 0,function(){var a;return v(this,function(o){switch(o.label){case 0:return a=[],s.threadInfo&&s.threadInfo.replyCount>0?[4,this.getAllChildMessages(s)]:[3,2];case 1:a=o.sent(),o.label=2;case 2:return a.length>0?(a.forEach(function(u){return u.applyParentMessage(s)}),[4,this.upsert(a)]):[3,4];case 3:o.sent(),o.label=4;case 4:return[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=Z(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove(s)]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return a=c.sent(),o={error:a},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},t.prototype.removeMessagesOfChannel=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.saveBlob=function(e){return g(this,void 0,void 0,function(){var r,i,s,a=this;return v(this,function(o){switch(o.label){case 0:return e instanceof qt?e.messageParams&&(s=e.messageParams).file&&hd(s.file)?[4,this.collection.saveBlob(s.file,e.reqId)]:[3,2]:[3,5];case 1:i=o.sent(),s.fileKey=i,s.fileType=io.BLOB,o.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(r=e.scheduledInfo.scheduledMessageParams).file&&hd(r.file)?[4,this.collection.saveBlob(r.file,e.reqId)]:[3,4];case 3:i=o.sent(),r.fileKey=i,r.fileType=io.BLOB,o.label=4;case 4:return[3,7];case 5:return e instanceof Ir&&(s=e.messageParams)&&s.fileInfoList&&Array.isArray(s.fileInfoList)?[4,Promise.all(s.fileInfoList.map(function(u,c){return g(a,void 0,void 0,function(){var l;return v(this,function(d){switch(d.label){case 0:return u.file&&hd(u.file)?[4,this.collection.saveBlob(u.file,this._getFileInfoBlobKey(e.reqId,c))]:[3,2];case 1:l=d.sent(),u._uploadedMetaData||(u._uploadedMetaData={}),u._uploadedMetaData.fileKey=l,u._uploadedMetaData.fileType=io.BLOB,d.label=2;case 2:return[2]}})})}))]:[3,7];case 6:o.sent(),o.label=7;case 7:return[2]}})})},t}(yn),ql={},Yo=function(n){function t(e){var r=n.call(this,e)||this;return ql[e]=r,r}return w(t,n),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return M.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return M.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return vo.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,r){return r===void 0&&(r=!1),ql[e]&&!r||(ql[e]=new t(e)),ql[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return B(!!e).throw(U.databaseError),e.collection(kp)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return A(A({},e.serialize()),{messageId:"".concat(e.messageId)})},t.prototype._deserialize=function(e){return e=A(A({},e),{messageId:parseInt(e.messageId)}),Xt.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(r=i.sent())return[2,this._deserialize(r)];i.label=2;case 2:return[2,void 0]}})})},t.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,s=e.limit,a=s===void 0?100:s,o=e.filter,u=o===void 0?new Us:o,c=e.order,l=c===void 0?an.CHANNEL_LATEST:c,d=e.backward,h=d!==void 0&&d,f=e.parentMessageId,p=e.isPollOnly,_=p!==void 0&&p,m=e.exactMatch,b=m!==void 0&&m,y=e.inclusive,E=y===void 0||y;return g(this,void 0,void 0,function(){var T,N,C,L=this;return v(this,function(k){switch(k.label){case 0:return this.localCacheEnabled?(T=$i(l),N={where:{channelUrl:r,"/where":function(O){if(i)switch(l){case an.CHANNEL_LATEST:if(b&&O.createdAt!==i)return!1;if(h){if(E&&O.createdAt<i||!E&&O.createdAt<=i)return!1}else if(E&&O.createdAt>i||!E&&O.createdAt>=i)return!1;break;case an.NEWEST_CHILD_MESSAGE:if(!f||O.parentMessageId===0||O.parentMessageId!==f)return!1}return!(_&&!O._poll)&&u.match(L._deserialize(O))}},index:T,backward:h},[4,this.collection.query(N)]):[3,3];case 1:return[4,k.sent().fetch({limit:a??void 0})];case 2:return C=k.sent(),[2,Promise.all(C.map(function(O){return g(L,void 0,void 0,function(){return v(this,function(x){return[2,this._deserialize(O)]})})}))];case 3:return[2,[]]}})})},t.prototype.getAllChildMessages=function(e,r){return r===void 0&&(r=new Us),g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:r,order:an.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,i.sent()]}})})},t.prototype.upsert=function(e){return g(this,void 0,void 0,function(){var r,i=this;return v(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return s.sent(),r=e.map(function(a){return i._serialize(a)}),[4,this.collection.upsertMany(r)];case 2:return s.sent(),[4,this.upsertChildMessages(e)];case 3:return s.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:s.sent(),s.label=5;case 5:return[2]}})})},t.prototype.upsertChildMessages=function(e){return g(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return g(r,void 0,void 0,function(){var a,o;return v(this,function(u){switch(u.label){case 0:return a=[],!((o=s.threadInfo)===null||o===void 0)&&o.replyCount&&s.threadInfo.replyCount>0?[4,this.getAllChildMessages(s)]:[3,2];case 1:a=u.sent(),u.label=2;case 2:return a.length>0?(a.forEach(function(c){return c.applyParentMessage(s)}),[4,this.upsert(a)]):[3,4];case 3:u.sent(),u.label=4;case 4:return[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=Z(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove("".concat(s))]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return a=c.sent(),o={error:a},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},t.prototype.removeMessagesOfChannel=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:$i(an.CHANNEL_LATEST)})]:[3,6];case 1:return i.sent(),[4,(r=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:i.sent(),i.label=6;case 6:return[2]}})})},t.prototype.removeUnderOffset=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":r}},index:$i(an.CHANNEL_LATEST)})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.countBetween=function(e,r,i){return g(this,void 0,void 0,function(){var s,a=this;return v(this,function(o){switch(o.label){case 0:return this.localCacheEnabled?(s=$i(an.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(u){var c=a._deserialize(u);return i.includes(c.createdAt)&&r.match(c)}},index:s}).count()]):[3,2];case 1:return[2,o.sent()];case 2:return[2,0]}})})},t.prototype.saveBlobs=function(e){return g(this,void 0,void 0,function(){var r=this;return v(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(s){return g(r,void 0,void 0,function(){var a,o;return v(this,function(u){switch(u.label){case 0:return s instanceof qt&&s.messageParams&&(a=s.messageParams).file&&hd(a.file)?[4,this.collection.saveBlob(a.file,s.reqId)]:[3,2];case 1:o=u.sent(),a.fileKey=o,u.label=2;case 2:return[2]}})})}))];case 1:return i.sent(),[2]}})})},t.prototype._getGroupChannelPreferenceSize=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return r=0,[4,(i=this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 1:return s=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 2:return a=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 3:return o=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 4:return u=c.sent(),s&&(r+=JSON.stringify(s).length),a&&(r+=JSON.stringify(a).length),o&&(r+=JSON.stringify(o).length),u&&(r+=JSON.stringify(u).length),[2,r]}})})},t}(yn),$l={},ZS=function(n){function t(e){var r=n.call(this,e)||this;return $l[e]=r,r}return w(t,n),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return M.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return M.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),t.of=function(e,r){return r===void 0&&(r=!1),$l[e]&&!r||($l[e]=new t(e)),$l[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return B(!!e).throw(U.databaseError),e.collection(Zy)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return A({},e.serialize())},t.prototype._deserialize=function(e){return Xt.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(r=i.sent())return[2,this._deserialize(r)];i.label=2;case 2:return[2,void 0]}})})},t.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,s=e.limit,a=s===void 0?100:s,o=e.filter,u=o===void 0?new Us:o,c=e.backward,l=c!==void 0&&c,d=e.exactMatch,h=d!==void 0&&d,f=e.inclusive,p=f===void 0||f;return g(this,void 0,void 0,function(){var _,m=this;return v(this,function(b){switch(b.label){case 0:return this.localCacheEnabled?(_={where:{channelUrl:r,"/where":function(y){if(i){if(h&&y.createdAt!==i)return!1;if(l){if(p&&y.createdAt<i||!p&&y.createdAt<=i)return!1}else if(p&&y.createdAt>i||!p&&y.createdAt>=i)return!1}return u.match(m._deserialize(y))}},index:["channelUrl","-createdAt","-notificationId"],backward:l},[4,this.collection.query(_)]):[3,3];case 1:return[4,b.sent().fetch({limit:a??void 0})];case 2:return[2,b.sent().map(function(y){return m._deserialize(y)})];case 3:return[2,[]]}})})},t.prototype.upsert=function(e){return g(this,void 0,void 0,function(){var r,i=this;return v(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?(r=e.map(function(a){return i._serialize(a)}),[4,this.collection.upsertMany(r)]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=Z(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove(s)]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return a=c.sent(),o={error:a},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},t.prototype.markAsReadByTimestamp=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,messageStatus:Za.SENT,createdAt:{"<":r}}},{set:{messageStatus:Za.READ}})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.markAsReadByMessageIds=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.updateIf({where:{channelUrl:e,notificationId:{"/in":r},messageStatus:Za.SENT}},{set:{messageStatus:Za.READ}})]:[3,2];case 1:return[2,i.sent().length];case 2:return[2,0]}})})},t.prototype.removeMessagesOfChannel=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:["channelUrl","-createdAt","-notificationId"]})]:[3,6];case 1:return i.sent(),[4,(r=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:i.sent(),i.label=6;case 6:return[2]}})})},t.prototype.removeUnderOffset=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":r}},index:$i(an.CHANNEL_LATEST)})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.countBetween=function(e,r,i){return g(this,void 0,void 0,function(){var s,a=this;return v(this,function(o){switch(o.label){case 0:return this.localCacheEnabled?(s=["channelUrl","-createdAt","-notificationId"],[4,this.collection.query({where:{channelUrl:e,"/where":function(u){var c=a._deserialize(u);return i.includes(c.createdAt)&&r.match(c)}},index:s}).count()]):[3,2];case 1:return[2,o.sent()];case 2:return[2,0]}})})},t}(yn),Ru={},eE=function(n){function t(e){var r=n.call(this,e)||this;return r._observers=new Map,r._dispatcherContext=r._dispatcher.on(function(i){return g(r,void 0,void 0,function(){var s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k=this;return v(this,function(O){switch(O.label){case 0:return i instanceof mt?(s=i.messages,L=i.source,l=i.isWebSocketEventComing,a=s.filter(function(x){return x instanceof Nn&&x.channelType!==xe.OPEN&&x.messageId>0}),o=s.filter(function(x){return x instanceof Nn&&x.channelType!==xe.OPEN&&x.messageId===0}),u=s.filter(function(x){return x instanceof _o}),a.length>0?[4,Tt(function(){return g(k,void 0,void 0,function(){return v(this,function(x){switch(x.label){case 0:return[4,this._messageCache.upsert(a)];case 1:return x.sent(),[4,this._unsentMessageCache.remove(a.map(function(Q){return Q instanceof kt?Q.reqId:null}).filter(function(Q){return Q!==null}))];case 2:return x.sent(),[2]}})})})]:[3,2]):[3,7];case 1:O.sent(),l||this._broadcastUpdateEvent(a,L),O.label=2;case 2:return o.length>0?[4,Tt(function(){return g(k,void 0,void 0,function(){return v(this,function(x){switch(x.label){case 0:return[4,this._unsentMessageCache.upsert(o)];case 1:return x.sent(),[2]}})})})]:[3,4];case 3:O.sent(),l||this._broadcastUpdateEvent(o,L),O.label=4;case 4:return u.length>0?[4,Tt(function(){return g(k,void 0,void 0,function(){return v(this,function(x){switch(x.label){case 0:return[4,this._notificationCache.upsert(u)];case 1:return x.sent(),[2]}})})})]:[3,6];case 5:O.sent(),l||this._broadcastUpdateEvent(u,L),O.label=6;case 6:return[3,24];case 7:return i instanceof N_?(c=i.messageIds,L=i.source,l=i.isWebSocketEventComing,d=c.filter(function(x){return typeof x=="number"}),h=c.filter(function(x){return typeof x=="string"}),[4,Tt(function(){return g(k,void 0,void 0,function(){return v(this,function(x){switch(x.label){case 0:return d.length>0?[4,this._messageCache.remove(d)]:[3,2];case 1:x.sent(),x.label=2;case 2:return h.length>0?[4,this._notificationCache.remove(h)]:[3,4];case 3:x.sent(),x.label=4;case 4:return[2]}})})})]):[3,9];case 8:return O.sent(),l||this._broadcastRemoveEvent(c,L),[3,24];case 9:return i instanceof Cy?(f=i.reqId,L=i.source,[4,Tt(function(){return g(k,void 0,void 0,function(){return v(this,function(x){switch(x.label){case 0:return[4,this._unsentMessageCache.remove([f])];case 1:return x.sent(),[2]}})})})]):[3,11];case 10:return O.sent(),this._broadcastRemoveUnsentEvent(f,L),[3,24];case 11:return i instanceof Ny?(p=i.polls,L=i.source,this._cacheContext.localCacheEnabled?(_=p.map(function(x){return x.messageId}),[4,Promise.all(_.map(function(x){return k._messageCache.get(x)}))]):[3,14]):[3,15];case 12:return(m=O.sent().filter(function(x){return x})).length>0&&p.forEach(function(x){var Q=m.find(function(we){return we.messageId===x.messageId});Q&&Q.applyPoll(x)}),[4,Tt(function(){return g(k,void 0,void 0,function(){return v(this,function(x){switch(x.label){case 0:return[4,this._messageCache.upsert(m)];case 1:return[2,x.sent()]}})})})];case 13:O.sent(),O.label=14;case 14:return this._broadcastPollChangeLogEvent(p,L),[3,24];case 15:return i instanceof Ay?(b=i.event,L=i.source,[4,this._messageCache.get(b.messageId)]):[3,19];case 16:return(y=O.sent())&&y.isUserMessage()&&y.poll&&y.poll.applyPollUpdateEvent(b)?[4,Tt(function(){return g(k,void 0,void 0,function(){return v(this,function(x){switch(x.label){case 0:return[4,this._messageCache.upsert([y])];case 1:return[2,x.sent()]}})})})]:[3,18];case 17:O.sent(),O.label=18;case 18:return this._broadcastPollUpdateEvent(b,L),[3,24];case 19:return i instanceof A_?(E=i.event,L=i.source,[4,this._messageCache.get(E.messageId)]):[3,23];case 20:return(T=O.sent())&&T.isUserMessage()&&T.poll&&T.poll.applyPollVoteEvent(E)?[4,Tt(function(){return g(k,void 0,void 0,function(){return v(this,function(x){switch(x.label){case 0:return[4,this._messageCache.upsert([T])];case 1:return[2,x.sent()]}})})})]:[3,22];case 21:O.sent(),O.label=22;case 22:return this._broadcastPollVoteEvent(E,L),[3,24];case 23:i instanceof Iy?(N=i.event,L=i.source,N.messageId>0&&this._broadcastReactionUpdateEvent(N,L)):i instanceof Sy&&(C=i.event,L=i.source,this._broadcastThreadUpdateEvent(C,L)),O.label=24;case 24:return[2]}})})}),r}return w(t,n),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return M.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_dispatcher",{get:function(){return M.of(this._iid).dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_messageCache",{get:function(){return Yo.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return vo.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_notificationCache",{get:function(){return ZS.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,r){var i;return r===void 0&&(r=!1),Ru[e]&&!r||(Ru[e]&&((i=Ru[e]._dispatcherContext)===null||i===void 0||i.close()),Ru[e]=new t(e)),Ru[e]},t.prototype._broadcastUpdateEvent=function(e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onUpdate&&u.onUpdate(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastPollChangeLogEvent=function(e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onPollChangeLogUpdate&&u.onPollChangeLogUpdate(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastPollUpdateEvent=function(e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onPollUpdate&&u.onPollUpdate(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastPollVoteEvent=function(e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onPollVote&&u.onPollVote(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastRemoveEvent=function(e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onRemove&&u.onRemove(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastRemoveUnsentEvent=function(e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onRemoveUnsent&&u.onRemoveUnsent(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastReactionUpdateEvent=function(e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onReactionUpdate&&u.onReactionUpdate(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastThreadUpdateEvent=function(e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onThreadInfoUpdate&&u.onThreadInfoUpdate(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype.subscribe=function(e,r){this._observers.set(e,r)},t.prototype.unsubscribe=function(e){this._observers.delete(e)},t.prototype.unsubscribeAll=function(){this._observers.clear()},t}(yn),$v={},Xt=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.requestQueue,a=e.onlineDetector,o=e.cacheContext;this._iid=t,this._sdkState=r,this._requestQueue=s,this._dispatcher=i,this._cacheContext=o,Yo.of(t),vo.of(t),eE.of(t),this.fileMessageQueue=new YI(t,{sdkState:r,dispatcher:i,requestQueue:s,onlineDetector:a,cacheContext:o}),$v[t]=this}return n.of=function(t){return $v[t]},n.prototype.buildMessageFromSerializedData=function(t){var e=ro(t);if(e.notificationId)return new _o(this._iid,_o.payloadify(e));switch(e.messageType){case gt.USER:return new _n(this._iid,_n.payloadify(e));case gt.FILE:return Ir._isMultipleFilesMessageSerializedData(e)?new Ir(this._iid,Ir.payloadify(e)):new qt(this._iid,qt.payloadify(e));case gt.ADMIN:return new ou(this._iid,ou.payloadify(e))}throw U.invalidParameters},n.prototype.buildUserMessageCreateParamsFromSerializedData=function(t,e){return re(oe({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,message:e.message,translationTargetLanguages:Object.keys(e.translations),pollId:t.pollId}))},n.prototype.buildFileMessageCreateParamsFromSerializedData=function(t,e){var r;return re(oe({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,file:t.file,fileKey:t.fileKey,fileUrl:e.plainUrl,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{maxWidth:i.width,maxHeight:i.height}}),fileType:t.fileType,requireAuth:e.requireAuth}))},n.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(t,e){var r=this;return re({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,fileInfoList:t.fileInfoList.map(function(i){return new qd(r._iid,i)})})},n.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(t,e){return A(A({},this.buildUserMessageCreateParamsFromSerializedData(t,e)),{scheduledAt:t.scheduledAt})},n.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(t,e){return A(A({},this.buildFileMessageCreateParamsFromSerializedData(t,e)),{scheduledAt:t.scheduledAt})},n.prototype.buildSenderFromSerializedData=function(t){var e=ro(t);return new au(this._iid,au.payloadify(e))},n.prototype.getMessage=function(t){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return e=new ZI(t),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(JI).message]}})})},n.prototype.getScheduledMessage=function(t){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return e=new t1(t),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(n1).message]}})})},n.prototype.getMessagesByMessageId=function(t,e,r,i,s){return s===void 0&&(s=z.REQUEST_MESSAGE),g(this,void 0,void 0,function(){var a,o,u;return v(this,function(c){switch(c.label){case 0:return a=new Dl(A(A({channelType:e,channelUrl:t,token:String(r)},uc),i)),[4,this._requestQueue.send(a)];case 1:return o=c.sent(),u=o.as(Rl).messages,this._dispatcher.dispatch(new mt({messages:u,source:s})),[2,u]}})})},n.prototype.getMessagesByTimestamp=function(t,e,r,i,s){return s===void 0&&(s=z.REQUEST_MESSAGE),g(this,void 0,void 0,function(){var a,o,u;return v(this,function(c){switch(c.label){case 0:return a=new Dl(A(A({channelType:e,channelUrl:t,timestamp:r},uc),i)),[4,this._requestQueue.send(a)];case 1:return o=c.sent(),u=o.as(Rl).messages,this._dispatcher.dispatch(new mt({messages:u,source:s})),[2,u]}})})},n.prototype._getMessagesByTimestampForCollection=function(t,e,r,i,s,a,o){return s===void 0&&(s=z.REQUEST_MESSAGE),g(this,void 0,void 0,function(){var u,c,l,d,h,f;return v(this,function(p){switch(p.label){case 0:return u=new Dl(A(A(A({channelType:e,channelUrl:t,timestamp:r},uc),i),{checkingHasNext:a,checkingContinuousMessages:o})),[4,this._requestQueue.send(u)];case 1:return c=p.sent(),l=c.as(Rl),d=l.messages,h=l.isContinuousMessages,f=l.hasNext,this._dispatcher.dispatch(new mt({messages:d,source:s})),[2,{messages:d,isContinuousMessages:h,hasNext:f}]}})})},n.prototype.getThreadedMessagesByTimestamp=function(t,e,r,i){return i===void 0&&(i=z.REQUEST_THREADED_MESSAGE),g(this,void 0,void 0,function(){var s,a,o,u;return v(this,function(c){switch(c.label){case 0:return s=new Dl(A(A(A({channelUrl:t.channelUrl,channelType:t.channelType,timestamp:e},el),r),{replyType:vn.ALL,parentMessageId:t.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(s)];case 1:return a=c.sent(),o=a.as(Rl).messages,(u=o.slice(1)).forEach(function(l){l.parentMessage=t}),this._dispatcher.dispatch(new mt({messages:u,source:i})),[2,{parentMessage:o[0],threadedMessages:u}]}})})},n.prototype.getMessageChangelogs=function(t,e,r,i,s){return s===void 0&&(s=z.REQUEST_MESSAGE_CHANGELOGS),g(this,void 0,void 0,function(){var a,o,u,c,l,d,h,f;return v(this,function(p){switch(p.label){case 0:return a=new XI(re(oe(A(A({channelType:e,channelUrl:t,timestamp:typeof r=="number"?r:null,token:typeof r=="string"?r:null},Ip),i)))),[4,this._requestQueue.send(a)];case 1:return o=p.sent(),u=o.as(e1),c=u.updatedMessages,l=u.deletedMessagesInfo,d=u.hasMore,h=u.nextToken,f=l.map(function(_){return _.messageId}),c.length>0&&this._dispatcher.dispatch(new mt({messages:c,source:s})),f.length>0&&this._dispatcher.dispatch(new N_({messageIds:f,source:s})),[2,{updatedMessages:c,deletedMessageIds:f,hasMore:d,token:h}]}})})},n}(),JS=function(n){function t(e,r){var i=n.call(this,e)||this;i.targetMessageId=0;var s=r.thread_info,a=r.parent_message_id,o=r.channel_url,u=r.channel_type;return s&&R("object",s)&&R("number",a)&&R("string",o)&&R("string",u)&&(i.threadInfo=new Ep(e,s),i.targetMessageId=a,i.channelUrl=o,i.channelType=u),i}return w(t,n),t}(yn),XS={channelUrl:"",channelType:xe.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},eC=function(n){function t(e){var r=e.channelCustomType,i=e.keyword,s=e.limit,a=e.reverse,o=e.exactMatch,u=e.channelUrl,c=e.order,l=e.messageTimestampFrom,d=e.messageTimestampTo,h=e.advancedQuery,f=e.targetFields,p=e.nextToken,_=n.call(this)||this;return _.method=j.GET,_.path="".concat(QT,"/messages"),_.params={custom_type:r,query:i,limit:s,reverse:a,exact_match:o,channel_url:u,message_ts_from:l,message_ts_to:d,sort_field:c,advanced_query:h,target_fields:f,after:p},_}return w(t,n),t}(K),tC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.messages=r.results.map(function(s){return $n(e,s)}),i.hasNext=r.has_next,i.nextToken=r.end_cursor,i.totalCount=r.total_count,i}return w(t,n),t}(W);(function(n){n.SCORE="score",n.TIMESTAMP="ts"})(dc||(dc={}));var nC=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f=this;return(f=n.call(this,e,r)||this).keyword="",f.reverse=!1,f.exactMatch=!1,f.channelUrl="",f.channelCustomType="",f.messageTimestampFrom=null,f.messageTimestampTo=null,f.order=dc.SCORE,f.advancedQuery=!1,f.targetFields=null,f._nextToken="",f.totalCount=-1,f.keyword=r.keyword,f.reverse=(i=r.reverse)!==null&&i!==void 0&&i,f.exactMatch=(s=r.exactMatch)!==null&&s!==void 0&&s,f.channelUrl=(a=r.channelUrl)!==null&&a!==void 0?a:"",f.channelCustomType=(o=r.channelCustomType)!==null&&o!==void 0?o:"",f.messageTimestampFrom=(u=r.messageTimestampFrom)!==null&&u!==void 0?u:null,f.messageTimestampTo=(c=r.messageTimestampTo)!==null&&c!==void 0?c:null,f.order=(l=r.order)!==null&&l!==void 0?l:dc.SCORE,f.advancedQuery=(d=r.advancedQuery)!==null&&d!==void 0&&d,f.targetFields=(h=r.targetFields)!==null&&h!==void 0?h:null,f}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&R("string",this.keyword)&&this.keyword.length>0&&R("boolean",this.reverse)&&R("boolean",this.exactMatch)&&R("string",this.channelUrl)&&R("string",this.channelCustomType)&&(R("number",this.messageTimestampFrom)||this.messageTimestampFrom===null)&&(R("number",this.messageTimestampTo)||this.messageTimestampTo===null)&&be(dc,this.order)&&R("boolean",this.advancedQuery)&&Ae("string",this.targetFields,!0)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new eC(oe(A(A({},this),{nextToken:this._nextToken?this._nextToken:null}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(tC),a=s.messages,o=s.hasNext,u=s.nextToken,c=s.totalCount,this._nextToken=u,this._hasNext=o,this._isLoading=!1,this.totalCount=c,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(Ta),rC={channelUrl:"",scheduledMessageId:0},iC=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.name="message",e}return w(t,n),t.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,a=r.sessionManager,o=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;n.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:a,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Xt(e,{sdkState:i,dispatcher:s,requestQueue:o,onlineDetector:c,cacheContext:l})},t.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},t.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},t.prototype.getMessage=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return r=A(A({},XS),e),B(function(a){return R("string",a.channelUrl)&&be(xe,a.channelType)&&R("number",a.messageId)&&R("boolean",a.includeReactions,!0)&&R("boolean",a.includeMetaArray,!0)&&R("boolean",a.includeParentMessageInfo,!0)&&R("boolean",a.includeThreadInfo,!0)}(r)).throw(U.invalidParameters),[4,this._manager.getMessage(r)];case 1:if((i=s.sent())instanceof Nn||i instanceof _o||i===null)return[2,i];throw"Unknown message type is given."}})})},t.prototype.getScheduledMessage=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){return r=A(A({},rC),e),B(function(s){return R("string",s.channelUrl)&&s.channelUrl!==""&&R("number",s.scheduledMessageId)&&s.scheduledMessageId>0}(r)).throw(U.invalidParameters),[2,this._manager.getScheduledMessage(r)]})})},t}(C_),sC=function(n,t){this.pollId=0,this.messageId=0,this.pollId=t.poll.id,this.messageId=t.poll.message_id,this._iid=n,this._payload=t},aC=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.name="poll",e}return w(t,n),t.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,a=r.sessionManager,o=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;n.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:a,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Pd(e,{sdkState:i,dispatcher:s,sessionManager:a,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l})},t.prototype.create=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){return r=A(A({},LI),e),B(Oy(r)).throw(U.invalidParameters),[2,this._manager.create(r)]})})},t.prototype.get=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){return r=A(A({},xI),e),B(Dy(r)).throw(U.invalidParameters),[2,this._manager.get(r)]})})},t.prototype.getOption=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){return r=A(A({},PI),e),B(My(r)).throw(U.invalidParameters),[2,this._manager.getOption(r)]})})},t.prototype.buildPollFromSerializedData=function(e){return this._manager.buildPollFromSerializedData(e)},t}(C_),At,hc,Rp;(function(n){n.LATEST_LAST_MESSAGE="latest_last_message",n.CHRONOLOGICAL="chronological",n.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",n.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"})(At||(At={})),function(n){n.CHRONOLOGICAL="chronological",n.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",n.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(hc||(hc={})),function(n){n.CREATED_AT="created_at",n.SCHEDULED_AT="scheduled_at"}(Rp||(Rp={}));var qc,_d=function(n){switch(n){case At.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case At.CHRONOLOGICAL:return["-createdAt","syncIndex"];case At.CHANNEL_NAME_ALPHABETICAL:return["name"];default:return["-lastMessageUpdatedAt","-createdAt","syncIndex"]}},tE=function(n){function t(e){var r=e.message,i=n.call(this)||this;return i.message=r,i}return w(t,n),t}(rt),Hv={},Bu=function(){function n(t,e){var r=e.localCacheEnabled,i=e.enableAutoResend,s=e.dispatcher,a=e.sdkState,o=e.logger,u=this;this._iid=t,Hv[t]=this,this._localCacheEnabled=r,this._enableAutoResend=i,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=s,this._logger=o,this._sdkState=a,this._localCacheEnabled&&s.on(function(c){if(c instanceof Ar)switch(c.stateType){case qe.CONNECTED:u._isProcessingAutoResend||u.processAutoResendRegisteredPendingMessages().then(function(){return u._processNextAutoResend()});break;case qe.INTERNAL_DISCONNECTED:case qe.EXTERNAL_DISCONNECTED:u._isProcessingAutoResend=!1}})}return n.of=function(t){return Hv[t]},n.prototype.processNonAutoResendRegisteredPendingMessages=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return this._enableAutoResend?[4,this._fetchAllCachedPendingMessages()]:[2];case 1:t=o.sent();try{for(e=Z(t),r=e.next();!r.done;r=e.next())(i=r.value).errorCode===0&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=tt.FAILED,i.errorCode=ae.ACK_TIMEOUT,this._dispatcher.dispatch(new mt({messages:[i],source:z.LOCAL_MESSAGE_FAILED})))}catch(u){s={error:u}}finally{try{r&&!r.done&&(a=e.return)&&a.call(e)}finally{if(s)throw s.error}}return[2]}})})},n.prototype.processAutoResendRegisteredPendingMessages=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=c.sent();try{for(e=Z(t),r=e.next();!r.done;r=e.next())i=r.value,this._enableAutoResend&&i.errorCode&&Nd(i.errorCode)&&(s=new Date().getTime(),a=i.createdAt+2592e5,this._enableAutoResend&&s<=a?this._autoResendQueue.map(function(l){return l.reqId}).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),i.sendingStatus=tt.FAILED,this._dispatcher.dispatch(new mt({messages:[i],source:z.LOCAL_MESSAGE_FAILED}))))}catch(l){o={error:l}}finally{try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(o)throw o.error}}return[2]}})})},n.prototype.completeCurrentAndProcessNextAutoResend=function(t){if(this._localCacheEnabled&&this._enableAutoResend&&(t.sendingStatus===tt.SUCCEEDED||t.sendingStatus===tt.FAILED&&!Nd(t.errorCode))){var e=this.indexOf(t);e>=0&&this._autoResendQueue.splice(e,1),e===0&&this._processNextAutoResend()}},n.prototype._fetchAllCachedPendingMessages=function(){return g(this,void 0,void 0,function(){var t,e;return v(this,function(r){switch(r.label){case 0:return t=vo.of(this._iid),(e=new Us).replyType=vn.ALL,[4,t.fetch({sendingStatus:tt.PENDING,backward:!0,filter:e})];case 1:return[2,r.sent()]}})})},n.prototype.indexOf=function(t){return this._autoResendQueue.length>0?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(t.reqId):-1},n.prototype._isNotInQueue=function(t){return this._autoResendQueue.map(function(e){return e.reqId}).indexOf(t.reqId)===-1},n.prototype._processNextAutoResend=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){if(this._localCacheEnabled&&this._enableAutoResend&&this._sdkState.appState==="foreground")try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new tE({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(r){this._logger.warn("process auto-resend error: ",r),this._isProcessingAutoResend=!1}return[2]})})},n}();(function(n){n[n.USER_BLOCK=20001]="USER_BLOCK",n[n.USER_UNBLOCK=2e4]="USER_UNBLOCK",n[n.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"})(qc||(qc={}));var Hd=function(){function n(t){this.category=t.cat,this.data=t.data}return n.getDataAsUserBlockEvent=function(t,e){var r=e.data,i=r.blocker,s=r.blockee;return{blocker:new Oe(t,i),blockee:new Oe(t,s)}},n.getDataAsFriendDiscoveredEvent=function(t,e){var r=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(r)?r.map(function(i){return new Oe(t,i)}):[]}},n}(),nE=function(n){function t(e,r){var i=r.userId,s=n.call(this)||this;return s._iid=e,s.userId=i,s}return w(t,n),t}(rt),rE=function(n){function t(){return n.call(this)||this}return w(t,n),t}(rt),iE=function(n){function t(e,r,i){var s=n.call(this,e,"USEV",i)||this;return s.event=new Hd(i),s}return w(t,n),t}(it),oC=function(n){return["-lastMessageUpdatedAt","-createdAt","syncIndex"]},zv=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(rt),sE=function(n){this.key=n.key,this.url=n.url},aE=function(n){this.id=n.id,this.name=n.name,this.url=n.url,this.emojis=n.emojis?n.emojis.map(function(t){return new sE(t)}):[]},uC=function(n){this.emojiHash=n.emoji_hash||"",this.emojiCategories=n.emoji_categories?n.emoji_categories.map(function(t){return new aE(t)}):[]},cC={profileImage:void 0,profileUrl:void 0,nickname:void 0},Gv=function(n){return function(t,e){return g(void 0,void 0,void 0,function(){var r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:switch(t){case 1:case 2:case 3:return[3,1];case 4:return[3,2];case 5:return[3,9]}return[3,13];case 1:return e(),[3,14];case 2:return u.trys.push([2,7,,8]),[4,n.clear()];case 3:return u.sent(),r=function(c){return{v2:function(){return g(void 0,void 0,void 0,function(){return v(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:Wy,keyName:fS,index:[_d(At.LATEST_LAST_MESSAGE),_d(At.CHRONOLOGICAL),_d(At.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:kp,keyName:pS,index:[$i(an.CHANNEL_LATEST),$i(an.NEWEST_CHILD_MESSAGE)]},{collectionName:Xy,keyName:YS,index:[$i(an.CHANNEL_LATEST),$i(an.NEWEST_CHILD_MESSAGE)]},{collectionName:mS,keyName:vS}])];case 1:return[2,l.sent()]}})})},v3:function(){return g(void 0,void 0,void 0,function(){return v(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:gS,keyName:yS,index:[oC()]}])];case 1:return[2,l.sent()]}})})},v4:function(){return g(void 0,void 0,void 0,function(){return v(this,function(l){switch(l.label){case 0:return[4,c.commitSchema([{collectionName:Zy,keyName:_S,index:[BS()]}])];case 1:return[2,l.sent()]}})})}}}(n),i=r.v2,s=r.v3,a=r.v4,[4,i()];case 4:return u.sent(),[4,s()];case 5:return u.sent(),[4,a()];case 6:return u.sent(),e(),[3,8];case 7:return o=u.sent(),e(o),[3,8];case 8:return[3,14];case 9:return u.trys.push([9,11,,12]),[4,n.collection(kp).removeIf({where:{channelType:xe.OPEN}})];case 10:case 11:return u.sent(),[3,12];case 12:return e(),[3,14];case 13:e(),u.label=14;case 14:return[2]}})})}},lC=function(){return typeof document<"u"?document.visibilityState:"visible"},dC=function(n){function t(e){var r=e.getVisibilityState,i=r===void 0?lC:r,s=e.initialState,a=s===void 0?"visible":s,o=e.isEnabled,u=o===void 0||o,c=e.pauseCheckDelay,l=c===void 0?3e4:c,d=n.call(this)||this;return d._pauseCheckDelay=3e4,d._currentState="visible",d._getVisibilityState=i,d._pauseCheckDelay=l,d._currentState=a,d._isEnabled=u,d._boundToggleState=d._toggleState.bind(d),d}return w(t,n),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAvailable",{get:function(){return typeof window<"u"&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),t.prototype._toggleState=function(){var e=this,r=this._getVisibilityState();r!=="hidden"?this._currentState==="hidden"&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=void 0),this.dispatch("resume")):this._currentState!=="hidden"&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=void 0,e.dispatch("pause")},this._pauseCheckDelay)),this._currentState=r},t.prototype.start=function(){this._isEnabled&&this.isAvailable&&(this._boundToggleState=this._toggleState.bind(this),window.addEventListener("visibilitychange",this._boundToggleState,{capture:!0}))},t.prototype.stop=function(){this._isEnabled&&this.isAvailable&&this._boundToggleState&&window.removeEventListener("visibilitychange",this._boundToggleState,{capture:!0})},t}(bo),hC=function(){function n(t){var e=t.logger,r=t.connectionDelegate,i=r===void 0?null:r,s=this;this._onlineWorker=function(){var a;return(a=s.connectionDelegate)===null||a===void 0?void 0:a.reconnect()},this._offlineWorker=function(){var a;return(a=s.connectionDelegate)===null||a===void 0?void 0:a.disconnect()},this.unsubscribes=[],this._onlineListener=function(a){if(s.isAvailableOnWeb)return window.addEventListener("online",a),function(){return window.removeEventListener("online",a,!1)}},this._offlineListener=function(a){if(s.isAvailableOnWeb)return window.addEventListener("offline",a),function(){return window.removeEventListener("offline",a,!1)}},this.logger=e,i&&(this.connectionDelegate=i)}return Object.defineProperty(n.prototype,"isAvailableOnWeb",{get:function(){return typeof window<"u"&&!!window.addEventListener&&"ononline"in window&&"onoffline"in window&&typeof navigator<"u"&&navigator.onLine!==void 0},enumerable:!1,configurable:!0}),n.prototype.setOnlineListener=function(t){t&&typeof t=="function"&&(this._onlineListener=t)},n.prototype.setOfflineListener=function(t){t&&typeof t=="function"&&(this._offlineListener=t)},n.prototype.start=function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]},n.prototype.stop=function(){var t=this;this.unsubscribes.forEach(function(e){try{e==null||e()}catch(r){t.logger.warn(r.message)}}),this.unsubscribes=[]},n.prototype.isOnline=function(){return g(this,void 0,void 0,function(){return v(this,function(t){return this.isAvailableOnWeb?[2,navigator.onLine]:[2,new Promise(function(e){fetch("https://www.google.com",{method:j.GET,mode:"no-cors"}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},n}(),Vv=function(n){function t(e){var r=e.userId,i=e.nickname,s=e.profileUrl,a=e.profileImage,o=e.preferredLanguages,u=n.call(this)||this;return u.method=j.PUT,u.path="".concat(Ue,"/").concat(encodeURIComponent(r)),u.params=re(oe({nickname:i,profile_url:s,profile_file:a,preferred_languages:o})),u}return w(t,n),t}(K),Bv=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.user=new Oe(e,A({},r)),i}return w(t,n),t}(W),fC=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=j.POST,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/apns"),s.params={apns_device_token:i,always_push:!0},s}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.type=r.type?Yt[r.type.toLowerCase()]:Yt.UNKNOWN,i.user=new Oe(e,r.user),i}w(t,n)})(W);var pC=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=j.POST,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/gcm"),s.params={gcm_reg_token:i,always_push:!0},s}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.type=r.type?Yt[r.type.toLowerCase()]:Yt.UNKNOWN,i.user=new Oe(e,r.user),i}w(t,n)})(W);var _C=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=j.DELETE,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/apns/").concat(encodeURIComponent(i)),s}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.user=new Oe(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}w(t,n)})(W);var mC=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=j.DELETE,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/gcm/").concat(encodeURIComponent(i)),s}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.user=new Oe(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}w(t,n)})(W);var vC=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.DELETE,i.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/apns"),i}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.type=r.type?Yt[r.type.toLowerCase()]:Yt.UNKNOWN,i.user=new Oe(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}w(t,n)})(W);var gC=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.DELETE,i.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/gcm"),i}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.type=r.type?Yt[r.type.toLowerCase()]:Yt.UNKNOWN,i.user=new Oe(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}w(t,n)})(W);var yC=function(n){function t(e){var r=e.userId,i=e.type,s=e.token,a=e.ts,o=n.call(this)||this;return o.method=j.GET,o.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/").concat(encodeURIComponent(i),"/device_tokens"),o.params={created_ts:a,token:s},o}return w(t,n),t}(K),EC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTokens={type:r.type?Yt[r.type.toLowerCase()]:Yt.UNKNOWN,deviceTokens:r.device_tokens,hasMore:r.has_more,token:r.token},i}return w(t,n),t}(W),bC=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),i}return w(t,n),t}(K),TC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.autoAccept=r.auto_accept,i}return w(t,n),t}(W),wC=function(n){function t(e){var r=e.userId,i=e.willAutoAccept,s=n.call(this)||this;return s.method=j.PUT,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),s.params={auto_accept:i},s}return w(t,n),t}(K),IC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.autoAccept=r.auto_accept,i}return w(t,n),t}(W),SC=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push_preference"),i}return w(t,n),t}(K),CC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.preference={doNotDisturbOn:r.do_not_disturb,startHour:r.start_hour,startMin:r.start_min,endHour:r.end_hour,endMin:r.end_min,timezone:r.timezone},i}return w(t,n),t}(W),NC=function(n){function t(e){var r=e.userId,i=e.doNotDisturbOn,s=e.startHour,a=e.startMin,o=e.endHour,u=e.endMin,c=e.timezone,l=n.call(this)||this;return l.method=j.PUT,l.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push_preference"),l.params={do_not_disturb:i,start_hour:s,start_min:a,end_hour:o,end_min:u,timezone:c},l}return w(t,n),t}(K),AC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.preference={doNotDisturbOn:r.do_not_disturb,startHour:r.start_hour,startMin:r.start_min,endHour:r.end_hour,endMin:r.end_min,timezone:r.timezone},i}return w(t,n),t}(W),kC=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push_preference"),i}return w(t,n),t}(K),OC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.snoozePeriod={isSnoozeOn:r.snooze_enabled},typeof r.snooze_start_ts=="number"&&(i.snoozePeriod.startTs=r.snooze_start_ts),typeof r.snooze_end_ts=="number"&&(i.snoozePeriod.endTs=r.snooze_end_ts),i}return w(t,n),t}(W),MC=function(n){function t(e){var r=e.userId,i=e.snoozeOn,s=e.startTs,a=e.endTs,o=n.call(this)||this;return o.method=j.PUT,o.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push_preference"),o.params={snooze_enabled:i,snooze_start_ts:s,snooze_end_ts:a},o}return w(t,n),t}(K),DC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.snoozePeriod={isSnoozeOn:r.snooze_enabled},typeof r.snooze_start_ts=="number"&&(i.snoozePeriod.startTs=r.snooze_start_ts),typeof r.snooze_end_ts=="number"&&(i.snoozePeriod.endTs=r.snooze_end_ts),i}return w(t,n),t}(W),RC=function(n){function t(e){var r=e.userId,i=e.blockedUserId,s=n.call(this)||this;return s.method=j.POST,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/block"),s.params={target_id:i},s}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.user=new Oe(e,r),i}w(t,n)})(W);var UC=function(n){function t(e){var r=e.userId,i=e.unblockedUserId,s=n.call(this)||this;return s.method=j.DELETE,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/block/").concat(encodeURIComponent(i)),s}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var LC=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push_preference"),i}return w(t,n),t}(K),PC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i}return w(t,n),t}(W),xC=function(n){function t(e){var r=e.userId,i=e.pushTriggerOption,s=n.call(this)||this;return s.method=j.PUT,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push_preference"),s.params={push_trigger_option:i},s}return w(t,n),t}(K),FC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i}return w(t,n),t}(W),qC=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/template"),i}return w(t,n),t}(K),$C=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.name=r.name,i}return w(t,n),t}(W),HC=function(n){function t(e){var r=e.userId,i=e.templateName,s=n.call(this)||this;return s.method=j.PUT,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push/template"),s.params={name:i},s}return w(t,n),t}(K),zC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.name=r.name,i}return w(t,n),t}(W),GC=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=j.GET,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/friends/changelogs"),s.params={token:i},s}return w(t,n),t}(K),VC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.changelogs={addedUsers:r.added.map(function(s){return new Oe(e,s)}),updatedUsers:r.updated.map(function(s){return new Oe(e,s)}),deletedUserIds:r.deleted,hasMore:r.has_more,token:r.next},i}return w(t,n),t}(W),BC=function(n){function t(e){var r=e.userId,i=e.discoveries,s=n.call(this)||this;return s.method=j.PUT,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discoveries:i.map(function(a){return{friend_discovery_key:a.friendDiscoveryKey,friend_name:a.friendName}})},s}return w(t,n),t}(K),jC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.friendDiscoveryRequestId=r.friend_discovery_request_id,i}return w(t,n),t}(W),KC=function(n){function t(e){var r=e.userId,i=e.discoveryKeys,s=n.call(this)||this;return s.method=j.DELETE,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discovery_keys:i},s}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var QC=function(n){function t(e){var r=e.userId,i=e.userIds,s=n.call(this)||this;return s.method=j.POST,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return w(t,n),t}(K),WC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new Oe(e,s)}),i}return w(t,n),t}(W),YC=function(n){function t(e){var r=e.userId,i=e.userIds,s=n.call(this)||this;return s.method=j.DELETE,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var ZC=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(Ue,"/").concat(r,"/allow_friend_discovery"),i.params={},i}return w(t,n),t}(K),JC=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.allowFriendDiscovery=r.allow_friend_discovery,i}return w(t,n),t}(W),XC=function(n){function t(e){var r=e.userId,i=e.allowFriendDiscovery,s=n.call(this)||this;return s.method=j.PUT,s.path="".concat(Ue,"/").concat(r,"/allow_friend_discovery"),s.params={allow_friend_discovery:i},s}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var Uu,eN=function(n){function t(){var e=n.call(this)||this;return e.method=j.GET,e.path=B0,e}return w(t,n),t}(K),tN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emojiContainer=new uC(r),i}return w(t,n),t}(W),nN=function(n){function t(e){var r=e.categoryId,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(B0,"/").concat(r),i}return w(t,n),t}(K),rN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emojiCategory=new aE(r),i}return w(t,n),t}(W),iN=function(n){function t(e){var r=e.key,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(WT,"/").concat(r),i}return w(t,n),t}(K),sN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emoji=new sE(r),i}return w(t,n),t}(W),aN=function(n){function t(){var e=n.call(this)||this;return e.method=j.GET,e.path="".concat(YT),e}return w(t,n),t}(K),oN=function(n){function t(e,r){var i,s=this,a=r??{};return(s=n.call(this,e,r)||this).uikitConfiguration={string:JSON.stringify(a),json:a},s.updatedAt=(i=r==null?void 0:r.updated_at)!==null&&i!==void 0?i:0,s}return w(t,n),t}(W),uN=function(){function n(t,e,r){var i=this;this._storeInitialized=!1,this._iid=t,this.options=e;var s=M.of(t),a=s.sdkState,o=s.cacheContext,u=s.dispatcher,c=s.sessionManager,l=s.requestQueue,d=s.logger,h=s.userEventHandlers,f=s.appStateToggleEnabled;this._onlineDetector=new hC({logger:d,connectionDelegate:{reconnect:function(){return g(i,void 0,void 0,function(){var _,m,b,y,E,T;return v(this,function(N){switch(N.label){case 0:if(_=M.of(t),m=_.sdkState,b=_.connectionManager,(y=_.sessionManager).session.hasSession)return[3,5];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,b.connect(y.session.authToken)];case 2:return N.sent(),[3,4];case 3:if(E=N.sent(),ar(E))throw E;return d.debug("connect failed by reconnect event = ",E),[3,4];case 4:return[3,9];case 5:if(m.appState!=="foreground")return[3,9];N.label=6;case 6:return N.trys.push([6,8,,9]),[4,b.resetAndReconnect()];case 7:return N.sent(),[3,9];case 8:if(T=N.sent(),ar(T))throw T;return d.debug("resetAndReconnect failed by reconnect event = ",T),[3,9];case 9:return u.dispatch(new zv),[2]}})})},disconnect:function(){Tt(function(){return g(i,void 0,void 0,function(){return v(this,function(_){switch(_.label){case 0:return[4,M.of(t).connectionManager.disconnect()];case 1:return _.sent(),[2]}})})})}}});var p=new Bu(t,{localCacheEnabled:o.localCacheEnabled,enableAutoResend:o.localCacheConfig.enableAutoResend,dispatcher:u,sdkState:a,logger:d});r.forEach(function(_){_.init(t,{sdkState:a,cacheContext:o,dispatcher:u,sessionManager:c,requestQueue:l,logger:d,onlineDetector:i._onlineDetector}),i[_.name]=_}),this._appStateChangeDetector=new dC({isEnabled:f}),this._appStateChangeDetector.on("resume",function(){d.debug("the page resumes from freeze"),i.setForegroundState()}).on("pause",function(){d.debug("the page freezes"),i.setBackgroundState()}),u.on(function(_){var m;if(_ instanceof Ar)_.stateType===qe.CONNECTED&&p.processNonAutoResendRegisteredPendingMessages();else if(_ instanceof it){if(_.code==="USEV"){var b=_.as(iE).event;if(b.category===qc.FRIEND_DISCOVERED){var y=Hd.getDataAsFriendDiscoveredEvent(t,b).friendDiscoveries;le(function(){return g(i,void 0,void 0,function(){return v(this,function(L){return[2,h.forEach(function(k){k.onFriendsDiscovered&&k.onFriendsDiscovered(y)})]})})})}}}else if(_ instanceof py){var E=M.of(i._iid).subscribedUnreadMessageCount,T=!1,N=_.ts;if(typeof N=="number"&&N>E.ts){if(E.all!==_.all&&(T=!0),E.all=_.all>=0?_.all:0,_.customTypes)for(var C in _.customTypes)E.customTypes[C]!==_.customTypes[C]&&(T=!0),E.customTypes[C]=_.customTypes[C];T=T&&E.ts>0,E.ts=N}T&&le(function(){return g(i,void 0,void 0,function(){return v(this,function(L){return[2,h.forEach(function(k){k.onTotalUnreadMessageCountChanged&&k.onTotalUnreadMessageCountChanged({groupChannelCount:E.all,feedChannelCount:E.feed,customTypeUnreadCount:E.customTypes}),k.onTotalUnreadMessageCountUpdated&&k.onTotalUnreadMessageCountUpdated(E.all,E.customTypes)})]})})})}else _ instanceof vy?(o.preference.set(i._getUserProfileCacheKey(a.userId),gp.payloadify(_.userProfile)),!((m=_.userProfile.appInfo.notificationInfo)===null||m===void 0)&&m.isEnabled&&o.preference.set(I_(i.appId),{value:!0})):_ instanceof ru&&_.error&&_.error.isSessionInvalidatedError&&(d.debug("session revoked."),i.disconnect())})}return n.init=function(t){var e=t.appId,r=t.appVersion,i=t.modules,s=i===void 0?[]:i,a=t.options,o=a===void 0?new z0:a,u=t.debugMode,c=u!==void 0&&u,l=t.customApiHost,d=t.customWebSocketHost,h=t.newInstance,f=h!==void 0&&h,p=t.logLevel,_=t.localCacheEnabled,m=_!==void 0&&_,b=t.localCacheConfig,y=b===void 0?new V0:b,E=t.localCacheEncryption,T=t.useAsyncStorageStore,N=T===void 0?null:T,C=t.appStateToggleEnabled,L=C===void 0||C;if(!Uu||f){var k="su-".concat(Rs()),O=E??{encrypt:function(Ie){return Ie},decrypt:function(Ie){return Ie}},x=new Xs({encryption:O});c||(x=fp()?N?new GS({AsyncStorage:N,encryption:O}):new Xs({encryption:O}):new zS({encryption:O})),new M(k,{appId:e,appVersion:r,options:o,apiHost:l??"https://api-".concat(e,".sendbird.com"),websocketHost:d??"wss://ws-".concat(e,".sendbird.com"),store:x,encryption:O,logLevel:p,localCacheEnabled:m,localCacheConfig:y,debugMode:c,appStateToggleEnabled:L});var Q=[new iC,new aC],we=new n(k,o,ce(ce([],ie(s),!1),ie(Q),!1));return Uu||(Uu=we),we}return Uu},Object.defineProperty(n,"instance",{get:function(){return Uu},enumerable:!1,configurable:!0}),Object.defineProperty(n,"version",{get:function(){return $0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appId",{get:function(){return M.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appInfo",{get:function(){var t=M.of(this._iid).appInfo;return t??null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appVersion",{get:function(){var t;return(t=M.of(this._iid).sdkState.appVersion)!==null&&t!==void 0?t:""},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"debugMode",{get:function(){return!!M.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"logLevel",{get:function(){return M.of(this._iid).logger.level},set:function(t){M.of(this._iid).logger.level=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isCacheEnabled",{get:function(){return M.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheConfig",{get:function(){var t=M.of(this._iid).cacheContext;return t.localCacheEnabled?t.localCacheConfig:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ekey",{get:function(){return M.of(this._iid).sessionManager.ekey},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentUser",{get:function(){var t;return(t=M.of(this._iid).sessionManager.currentUser)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"connectionState",{get:function(){var t=M.of(this._iid).connectionManager;return t.isConnected?Li.OPEN:t.isConnecting?Li.CONNECTING:Li.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastConnectedAt",{get:function(){var t=M.of(this._iid),e=t.connectedAt;return t.connectionManager.isConnected?e:0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fcmPushToken",{get:function(){var t;return(t=this._fcmPushToken)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"apnsPushToken",{get:function(){var t;return(t=this._apnsPushToken)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),n.prototype._getNestDBVersion=function(){return 6},n.prototype._getPreferenceCacheKey=function(t){return"sendbird@".concat(this.appId,"/").concat(t,".pref")},n.prototype._getUserProfileCacheKey=function(t){return"sendbird@".concat(this.appId,"/").concat(t,".profile")},n.prototype.getMemoryStoreForDebugging=function(){var t=M.of(this._iid),e=t.debugMode,r=t.cacheContext;if(e)return r.store instanceof Xs?r.store:null;throw U.debugModeRequired},n.prototype.addExtension=function(t,e){var r=M.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(t)>-1&&r.extensions&&(r.extensions[t]=e)},n.prototype.addSendbirdExtensions=function(t,e,r){var i,s,a=M.of(this._iid),o=a.logger,u=a.sdkState,c=new RegExp(rw);if(t.length===0)return o.debug("sb.addSendbirdExtensions() has failed because the given sendbirdExtensions is empty."),!1;if(t.find(function(_){return!c.test(_.version)}))return o.debug("sb.addSendbirdExtensions() has failed because the given version did not satisfy the SemVer specification."),!1;if(r)try{for(var l=Z(Object.entries(r)),d=l.next();!d.done;d=l.next()){var h=ie(d.value,2),f=h[0],p=h[1];if(/&|=/.test(f)||/&|=/.test(p))return o.debug("sb.addSendbirdExtensions() has failed because the given customData includes at least one invalid character: = or &."),!1}}catch(_){i={error:_}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}return u.sendbirdRuntimeEnvironment={sendbirdExtensions:t,deviceOS:e,customData:r},!0},n.prototype.setOnlineListener=function(t){this._onlineDetector.setOnlineListener(t)},n.prototype.setOfflineListener=function(t){this._onlineDetector.setOfflineListener(t)},n.prototype._safeInitializeStore=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:e=M.of(this._iid).cacheContext,r.label=1;case 1:return r.trys.push([1,3,,5]),[4,e.store.init(t)];case 2:return r.sent(),this._storeInitialized=!0,[3,5];case 3:return r.sent(),e.replaceStore(new Xs),[4,this._safeInitializeStore(t)];case 4:return r.sent(),[3,5];case 5:return[2]}})})},n.prototype.initializeCache=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l;return v(this,function(d){switch(d.label){case 0:if(e=M.of(this._iid),r=e.sdkState,i=e.cacheContext,s=e.dispatcher,a=e.logger,r.userId&&r.userId===t)return[3,9];if(o="sendbird@".concat(r.appId,"/").concat(t,".db"),!i.localCacheEnabled)return[3,7];d.label=1;case 1:return d.trys.push([1,4,,6]),i.nestdb&&i.nestdb.state!==Mi.CLOSED&&i.nestdb.name===o?[3,3]:(u="sendbird@".concat(r.appId,"/").concat(t,".db"),(c=i.nestdb=new VS({name:u,version:this._getNestDBVersion(),store:i.store,config:new tl({dbname:u,itemSizeLimit:61440})})).on("upgrade",Gv(c)),c.on("storeReplaced",function(h){i.replaceStore(h),i.localCacheEnabled=!1,c.on("upgrade",Gv(c))}),[4,c.open()]);case 2:d.sent(),this._storeInitialized=!0,s.dispatch(new nE(this._iid,{userId:t})),d.label=3;case 3:return r.userId=t,[3,6];case 4:return l=d.sent(),a.warn("Nest DB Open Failed. ",l),i.store instanceof Xs||(i.replaceStore(new Xs),i.localCacheEnabled=!1),[4,this._safeInitializeStore(o)];case 5:throw d.sent(),r.userId=t,U.databaseError;case 6:return[3,9];case 7:return[4,this._safeInitializeStore(o)];case 8:d.sent(),r.userId=t,d.label=9;case 9:return[2]}})})},n.prototype.getCacheDataSize=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return(t=M.of(this._iid).cacheContext).localCacheEnabled&&t.nestdb?[4,t.nestdb.estimateUsage()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},n.prototype.clearCachedData=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return(t=M.of(this._iid).cacheContext).localCacheEnabled&&t.nestdb?[4,t.nestdb.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this._storeInitialized?[4,t.preference.clear()]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.prototype.clearCachedMessages=function(t){return g(this,void 0,void 0,function(){var e,r,i=this;return v(this,function(s){switch(s.label){case 0:return B(Ae("string",t)).throw(U.invalidParameters),e=Yo.of(this._iid),r=vo.of(this._iid),e&&r?[4,Promise.all(t.map(function(a){return g(i,void 0,void 0,function(){return v(this,function(o){switch(o.label){case 0:return[4,e.removeMessagesOfChannel(a)];case 1:return o.sent(),[4,r.removeMessagesOfChannel(a)];case 2:return o.sent(),[2]}})})}))]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},n.prototype._setupPreference=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.cacheContext,s=e.statLogCollector,[4,i.preference.init(this._getPreferenceCacheKey(t),this._getNestDBVersion())];case 1:return o.sent(),[4,i.preference.get(this._getUserProfileCacheKey(t))];case 2:return(a=o.sent())&&new gp(this._iid,a).apply(),[4,s.init("sendbird@".concat(r.appId,"/").concat(t,".statlog"))];case 3:return o.sent(),[2]}})})},n.prototype._ready=function(t,e,r){return r===void 0&&(r={}),g(this,void 0,void 0,function(){var i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return B(R("string",t)&&R("string",e,!0)).throw(U.invalidParameters),i=M.of(this._iid),s=i.sdkState,a=i.cacheContext,o=i.connectionManager,u=r.errorForOtherUser,s.userId&&s.userId!==t?u?[3,2]:[4,o.logout()]:[3,3];case 1:return l.sent(),[3,3];case 2:throw u;case 3:return l.trys.push([3,5,6,8]),[4,this.initializeCache(t)];case 4:return l.sent(),M.of(this._iid).dispatcher.dispatch(new rE),[3,8];case 5:return l.sent(),c=M.of(this._iid).logger,a.localCacheEnabled=!1,c.warn("Cache initialization failed - cache is not available."),[3,8];case 6:return[4,this._setupPreference(t)];case 7:return l.sent(),[7];case 8:return[2]}})})},n.prototype.authenticateFeed=function(t,e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return r=M.of(this._iid),i=r.sessionManager,s=r.connectionManager,[4,this._ready(t,e,{errorForOtherUser:s.isConnected?U.alreadyConnectedAsAnotherUser:void 0})];case 1:return a.sent(),i.session.hasLessServiceScopeThan([Ds.FEED])?[4,i.authenticateFeed(t,e)]:[3,3];case 2:a.sent(),a.label=3;case 3:return[2,this.currentUser]}})})},n.prototype.connect=function(t,e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._ready(t,e)];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,,4,5]),[4,M.of(this._iid).connectionManager.connect(e)];case 3:return r.sent(),[3,5];case 4:return this._onlineDetector.start(),this._appStateChangeDetector.start(),[7];case 5:return[2,this.currentUser]}})})},n.prototype.reconnect=function(){var t=M.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.sessionManager.session.hasSession;return i&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),e.resetAndReconnect().then(function(){r.appState="foreground"}).catch(function(){})),i},n.prototype.disconnect=function(){return g(this,void 0,void 0,function(){var t,e,r,i;return v(this,function(s){switch(s.label){case 0:return t=M.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),i.cancelAll(),[4,e.logout()];case 1:return s.sent(),[4,this.clearCachedData()];case 2:return s.sent(),r.appState="foreground",[2]}})})},n.prototype.disconnectWebSocket=function(){return g(this,void 0,void 0,function(){var t,e,r;return v(this,function(i){switch(i.label){case 0:return t=M.of(this._iid),e=t.connectionManager,r=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,e.disconnectWebSocket(!0)];case 1:return i.sent(),[2]}})})},n.prototype.setBackgroundState=function(){var t=M.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.logger;r.appState==="foreground"&&(r.appState="background",i.debug("going background state"),e.background().catch(function(s){i.debug("setBackgroundState error = ",s)}))},n.prototype.setForegroundState=function(){var t=M.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.dispatcher,s=t.logger;r.appState==="background"&&(r.appState="foreground",s.debug("going foreground state"),e.resetAndReconnect().catch(function(a){s.debug("setForgroundState error = ",a)}),i.dispatch(new zv))},n.prototype.setSessionHandler=function(t){B(t instanceof IS).throw(U.invalidParameters),M.of(this._iid).sessionManager.handler=t},n.prototype.addUserEventHandler=function(t,e){B(R("string",t)&&e instanceof SS).throw(U.invalidParameters),M.of(this._iid).userEventHandlers.set(t,e)},n.prototype.removeUserEventHandler=function(t){M.of(this._iid).userEventHandlers.delete(t)},n.prototype.removeAllUserEventHandler=function(){M.of(this._iid).userEventHandlers.clear()},n.prototype.addConnectionHandler=function(t,e){B(R("string",t)&&e instanceof Jy).throw(U.invalidParameters),M.of(this._iid).connectionHandlers.set(t,e)},n.prototype.removeConnectionHandler=function(t){M.of(this._iid).connectionHandlers.delete(t)},n.prototype.removeAllConnectionHandler=function(){M.of(this._iid).connectionHandlers.clear()},n.prototype.createApplicationUserListQuery=function(t){return t===void 0&&(t={}),new AS(this._iid,t)},n.prototype.createBlockedUserListQuery=function(t){return t===void 0&&(t={}),new MS(this._iid,t)},n.prototype.createFriendListQuery=function(t){return t===void 0&&(t={}),new US(this._iid,t)},n.prototype.createMessageSearchQuery=function(t){return new nC(this._iid,t)},n.prototype.createPollListQuery=function(t){return new Ry(this._iid,A({},t))},n.prototype.createPollVoterListQuery=function(t){return new Uy(this._iid,A({},t))},n.prototype.buildUserFromSerializedData=function(t){var e=ro(t);return new Oe(this._iid,Oe.payloadify(e))},n.prototype.updateCurrentUserInfo=function(t){return t===void 0&&(t={}),g(this,void 0,void 0,function(){var e,r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return e=A(A({},cC),t),B(function(l){return On(l.profileImage,!0)&&R("string",l.profileUrl,!0)&&R("string",l.nickname,!0)}(e)).throw(U.invalidParameters),this.currentUser?(r=M.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new Vv(A({userId:i.userId},e)),[4,s.send(a)]):[3,2];case 1:return o=c.sent(),u=o.as(Bv).user,this.currentUser&&(e.nickname&&(this.currentUser.nickname=u.nickname),(e.profileUrl||e.profileImage)&&(this.currentUser.plainProfileUrl=u.profileUrl)),[2,u];case 2:throw U.connectionRequired}})})},n.prototype.updateCurrentUserInfoWithPreferredLanguages=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return B(Ae("string",t)).throw(U.invalidParameters),this.currentUser?(e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new Vv({userId:r.userId,preferredLanguages:t}),[4,i.send(s)]):[3,2];case 1:return a=u.sent(),o=a.as(Bv).user,this.currentUser&&(this.currentUser.preferredLanguages=o.preferredLanguages),[2,o];case 2:throw U.connectionRequired}})})},n.prototype.registerFCMPushTokenForCurrentUser=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o=this;return v(this,function(u){switch(u.label){case 0:if(B(R("string",t)).throw(U.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),e=M.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,r.hasDeviceToken(Yt.FCM,t)?[2,Ln.SUCCESS]:(a=new pC({userId:i.userId,token:t}),[4,s.send(a)]);case 2:return u.sent(),[4,Tt(function(){return g(o,void 0,void 0,function(){return v(this,function(c){switch(c.label){case 0:return r.setDeviceToken(Yt.FCM,t),[4,r.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 3:return u.sent(),this._fcmPushToken="",[2,Ln.SUCCESS];case 4:return u.sent(),[2,Ln.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=t,[2,Ln.PENDING];case 7:return[2]}})})},n.prototype.unregisterFCMPushTokenForCurrentUser=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u=this;return v(this,function(c){switch(c.label){case 0:if(B(R("string",t)).throw(U.invalidParameters),!this.currentUser)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),e=M.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,a=new mC({userId:i.userId,token:t}),[4,s.send(a)];case 2:return o=c.sent().lastDeletedAt,[4,Tt(function(){return g(u,void 0,void 0,function(){return v(this,function(l){switch(l.label){case 0:return r.unsetDeviceToken(Yt.FCM,t),r.setDeviceTokenDeletedAt(o),[4,r.saveDeviceToken()];case 1:return l.sent(),[2]}})})})];case 3:return c.sent(),this._fcmPushToken="",[2,Ln.SUCCESS];case 4:return c.sent(),[2,Ln.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=t,[2,Ln.PENDING];case 7:return[2]}})})},n.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o=this;return v(this,function(u){switch(u.label){case 0:return this.currentUser?(t=M.of(this._iid),e=t.sessionManager,r=t.sdkState,i=t.requestQueue,s=new gC({userId:r.userId}),[4,i.send(s)]):[3,3];case 1:return a=u.sent().lastDeletedAt,[4,Tt(function(){return g(o,void 0,void 0,function(){return v(this,function(c){switch(c.label){case 0:return e.unsetDeviceTokens(Yt.FCM),e.setDeviceTokenDeletedAt(a),[4,e.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 2:u.sent(),u.label=3;case 3:return[2]}})})},n.prototype.registerAPNSPushTokenForCurrentUser=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o=this;return v(this,function(u){switch(u.label){case 0:if(B(R("string",t)).throw(U.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),e=M.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,r.hasDeviceToken(Yt.APNS,t)?[2,Ln.SUCCESS]:(a=new fC({userId:i.userId,token:t}),[4,s.send(a)]);case 2:return u.sent(),[4,Tt(function(){return g(o,void 0,void 0,function(){return v(this,function(c){switch(c.label){case 0:return r.setDeviceToken(Yt.APNS,t),[4,r.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 3:return u.sent(),this._apnsPushToken="",[2,Ln.SUCCESS];case 4:return u.sent(),[2,Ln.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=t,[2,Ln.PENDING];case 7:return[2]}})})},n.prototype.unregisterAPNSPushTokenForCurrentUser=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u=this;return v(this,function(c){switch(c.label){case 0:if(B(R("string",t)).throw(U.invalidParameters),!this.currentUser)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),e=M.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,a=new _C({userId:i.userId,token:t}),[4,s.send(a)];case 2:return o=c.sent().lastDeletedAt,[4,Tt(function(){return g(u,void 0,void 0,function(){return v(this,function(l){switch(l.label){case 0:return r.unsetDeviceToken(Yt.APNS,t),r.setDeviceTokenDeletedAt(o),[4,r.saveDeviceToken()];case 1:return l.sent(),[2]}})})})];case 3:return c.sent(),this._apnsPushToken="",[2,Ln.SUCCESS];case 4:return c.sent(),[2,Ln.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=t,[2,Ln.PENDING];case 7:return[2]}})})},n.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s,a,o=this;return v(this,function(u){switch(u.label){case 0:return this.currentUser?(t=M.of(this._iid),e=t.sessionManager,r=t.sdkState,i=t.requestQueue,s=new vC({userId:r.userId}),[4,i.send(s)]):[3,3];case 1:return a=u.sent().lastDeletedAt,[4,Tt(function(){return g(o,void 0,void 0,function(){return v(this,function(c){switch(c.label){case 0:return e.unsetDeviceTokens(Yt.APNS),e.setDeviceTokenDeletedAt(a),[4,e.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 2:u.sent(),u.label=3;case 3:return[2]}})})},n.prototype.getChannelInvitationPreference=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s;return v(this,function(a){switch(a.label){case 0:return t=M.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new bC({userId:e.userId}),[4,r.send(i)];case 1:return s=a.sent(),[2,{autoAccept:s.as(TC).autoAccept}]}})})},n.prototype.setChannelInvitationPreference=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return B(R("boolean",t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new wC({userId:r.userId,willAutoAccept:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,{autoAccept:a.as(IC).autoAccept}]}})})},n.prototype.getDoNotDisturb=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s;return v(this,function(a){switch(a.label){case 0:return t=M.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new SC({userId:e.userId}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(CC).preference]}})})},n.prototype.setDoNotDisturb=function(t,e,r,i,s,a){return e===void 0&&(e=0),r===void 0&&(r=0),i===void 0&&(i=0),s===void 0&&(s=0),a===void 0&&(a=""),g(this,void 0,void 0,function(){var o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:return B(R("boolean",t)&&R("number",e)&&R("number",r)&&R("number",i)&&R("number",s)&&R("string",a)).throw(U.invalidParameters),o=M.of(this._iid),u=o.sdkState,c=o.requestQueue,l=new NC({userId:u.userId,doNotDisturbOn:t,startHour:e,startMin:r,endHour:i,endMin:s,timezone:a}),[4,c.send(l)];case 1:return d=h.sent(),[2,d.as(AC).preference]}})})},n.prototype.getSnoozePeriod=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s;return v(this,function(a){switch(a.label){case 0:return t=M.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new kC({userId:e.userId}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(OC).snoozePeriod]}})})},n.prototype.setSnoozePeriod=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=0),g(this,void 0,void 0,function(){var i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return B(R("boolean",t)&&R("number",e)&&R("number",r)).throw(U.invalidParameters),i=M.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new MC({userId:s.userId,snoozeOn:t,startTs:e,endTs:r}),[4,a.send(o)];case 1:return u=c.sent(),[2,u.as(DC).snoozePeriod]}})})},n.prototype.getMyPushTokensByToken=function(t,e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h,f,p;return v(this,function(_){switch(_.label){case 0:return B(R("string",t)&&be(Yt,e)).throw(U.invalidParameters),r=M.of(this._iid),i=r.sdkState,s=r.requestQueue,a=r.sessionManager,o=new yC({userId:i.userId,type:e,token:t}),[4,s.send(o)];case 1:u=_.sent(),c=u.as(EC).pushTokens;try{for(l=Z(c.deviceTokens),d=l.next();!d.done;d=l.next())h=d.value,a.setDeviceToken(c.type,h)}catch(m){f={error:m}}finally{try{d&&!d.done&&(p=l.return)&&p.call(l)}finally{if(f)throw f.error}}return[4,a.saveDeviceToken()];case 2:return _.sent(),[2,c]}})})},n.prototype.getPushTriggerOption=function(){return g(this,void 0,void 0,function(){var t,e,r,i;return v(this,function(s){switch(s.label){case 0:return t=M.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new LC({userId:e.userId}),[4,r.send(i)];case 1:return[2,s.sent().as(PC).pushTriggerOption]}})})},n.prototype.setPushTriggerOption=function(t){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return B(be(Ka,t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new xC({userId:r.userId,pushTriggerOption:t}),[4,i.send(s)];case 1:return[2,a.sent().as(FC).pushTriggerOption]}})})},n.prototype.getPushTemplate=function(){return g(this,void 0,void 0,function(){var t,e,r,i;return v(this,function(s){switch(s.label){case 0:return t=M.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new qC({userId:e.userId}),[4,r.send(i)];case 1:return[2,s.sent().as($C).name]}})})},n.prototype.setPushTemplate=function(t){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return B(be(dp,t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new HC({userId:r.userId,templateName:t}),[4,i.send(s)];case 1:return[2,a.sent().as(zC).name]}})})},n.prototype.blockUser=function(t){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return B(t instanceof Oe||R("string",t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new RC({userId:r.userId,blockedUserId:t instanceof Oe?t.userId:t}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},n.prototype.blockUserWithUserId=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return[2,this.blockUser(t)]})})},n.prototype.unblockUser=function(t){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return B(t instanceof Oe||R("string",t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new UC({userId:r.userId,unblockedUserId:t instanceof Oe?t.userId:t}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},n.prototype.unblockUserWithUserId=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return[2,this.unblockUser(t)]})})},n.prototype.getFriendChangeLogsByToken=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return B(R("string",t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new GC({userId:r.userId,token:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(VC).changelogs]}})})},n.prototype.getAllowFriendDiscovery=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s;return v(this,function(a){switch(a.label){case 0:return t=M.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new ZC({userId:e.userId}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(JC).allowFriendDiscovery]}})})},n.prototype.setAllowFriendDiscovery=function(t){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return B(R("boolean",t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new XC({userId:r.userId,allowFriendDiscovery:t}),[4,i.send(s)];case 1:return a.sent(),[2,t]}})})},n.prototype.uploadFriendDiscoveries=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new BC({userId:r.userId,discoveries:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(jC).friendDiscoveryRequestId]}})})},n.prototype.deleteFriendDiscovery=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return[2,this.deleteFriendDiscoveries([t])]})})},n.prototype.deleteFriendDiscoveries=function(t){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return B(Ae("string",t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new KC({userId:r.userId,discoveryKeys:t}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},n.prototype.addFriends=function(t){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return B(Ae("string",t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new QC({userId:r.userId,userIds:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(WC).users]}})})},n.prototype.deleteFriend=function(t){return g(this,void 0,void 0,function(){return v(this,function(e){return[2,this.deleteFriends([t])]})})},n.prototype.deleteFriends=function(t){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return B(Ae("string",t)).throw(U.invalidParameters),e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new YC({userId:r.userId,userIds:t}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},n.prototype.getAllEmoji=function(){return g(this,void 0,void 0,function(){var t,e,r;return v(this,function(i){switch(i.label){case 0:return t=M.of(this._iid).requestQueue,e=new eN,[4,t.send(e)];case 1:return r=i.sent(),[2,r.as(tN).emojiContainer]}})})},n.prototype.getEmojiCategory=function(t){return g(this,void 0,void 0,function(){var e,r,i;return v(this,function(s){switch(s.label){case 0:return e=M.of(this._iid).requestQueue,r=new nN({categoryId:t}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(rN).emojiCategory]}})})},n.prototype.getEmoji=function(t){return g(this,void 0,void 0,function(){var e,r,i;return v(this,function(s){switch(s.label){case 0:return e=M.of(this._iid).requestQueue,r=new iN({key:t}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(sN).emoji]}})})},n.prototype.getUIKitConfiguration=function(){return g(this,void 0,void 0,function(){var t,e,r,i;return v(this,function(s){switch(s.label){case 0:return t=M.of(this._iid),B(t.hasExtension("sb_uikit")).throw(U.notSupportedError),e=t.requestQueue,r=new aN,[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(oN).uikitConfiguration]}})})},n}(),xt;(function(n){n[n.NONE=0]="NONE",n[n.CHANNEL_ENTER=10102]="CHANNEL_ENTER",n[n.CHANNEL_EXIT=10103]="CHANNEL_EXIT",n[n.USER_CHANNEL_MUTE=10201]="USER_CHANNEL_MUTE",n[n.USER_CHANNEL_UNMUTE=10200]="USER_CHANNEL_UNMUTE",n[n.USER_CHANNEL_BAN=10601]="USER_CHANNEL_BAN",n[n.USER_CHANNEL_UNBAN=10600]="USER_CHANNEL_UNBAN",n[n.CHANNEL_FREEZE=10701]="CHANNEL_FREEZE",n[n.CHANNEL_UNFREEZE=10700]="CHANNEL_UNFREEZE",n[n.TYPING_START=10900]="TYPING_START",n[n.TYPING_END=10901]="TYPING_END",n[n.CHANNEL_JOIN=1e4]="CHANNEL_JOIN",n[n.CHANNEL_LEAVE=10001]="CHANNEL_LEAVE",n[n.CHANNEL_OPERATOR_UPDATE=10002]="CHANNEL_OPERATOR_UPDATE",n[n.CHANNEL_INVITE=10020]="CHANNEL_INVITE",n[n.CHANNEL_ACCEPT_INVITE=10021]="CHANNEL_ACCEPT_INVITE",n[n.CHANNEL_DECLINE_INVITE=10022]="CHANNEL_DECLINE_INVITE",n[n.CHANNEL_PROP_CHANGED=11e3]="CHANNEL_PROP_CHANGED",n[n.CHANNEL_DELETED=12e3]="CHANNEL_DELETED",n[n.CHANNEL_META_DATA_CHANGED=11100]="CHANNEL_META_DATA_CHANGED",n[n.CHANNEL_META_COUNTERS_CHANGED=11200]="CHANNEL_META_COUNTERS_CHANGED",n[n.CHANNEL_HIDE=13e3]="CHANNEL_HIDE",n[n.CHANNEL_UNHIDE=13001]="CHANNEL_UNHIDE",n[n.PINNED_MESSAGE_CHANGED=11300]="PINNED_MESSAGE_CHANGED"})(xt||(xt={}));var cN=function(){function n(t){var e;this.channelUrl=t.channel_url,this.channelType=t.channel_type,this.category=t.cat,this.data=(e=t.data)!==null&&e!==void 0?e:{},this.ts=t.ts}return Object.defineProperty(n.prototype,"isGroupChannelEvent",{get:function(){return this.channelType===xe.GROUP},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isOpenChannelEvent",{get:function(){return this.channelType===xe.OPEN},enumerable:!1,configurable:!0}),n}(),hu=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.event=new cN(i),s}return w(t,n),t}(it),lN=function(n){function t(e,r,i){var s=n.call(this,e,r,i)||this,a=i.data.operators,o=a===void 0?[]:a;return s.operators=o.map(function(u){return new Oe(s._iid,u)}),s}return w(t,n),t}(hu),dN=function(n){function t(e,r){var i=n.call(this,e)||this;return i._logger=r.logger,i._sdkState=r.sdkState,i._sessionManager=r.sessionManager,i._requestQueue=r.requestQueue,i._dispatcher=r.dispatcher,i._cacheContext=r.cacheContext,i._channelType=r.channelType,i}return w(t,n),Object.defineProperty(t.prototype,"_messageBroadcast",{get:function(){return eE.of(this._iid)},enumerable:!1,configurable:!0}),t.prototype.subscribeMessageEvent=function(e,r){this._messageBroadcast.subscribe(e,r)},t.prototype.unsubscribeMessageEvent=function(e){this._messageBroadcast.unsubscribe(e)},t.prototype.getMessageFromCache=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return[2,null]})})},t.prototype.getExactlyMatchingMessagesForTokenFromCache=function(e,r,i){return g(this,void 0,void 0,function(){return v(this,function(s){return[2,[]]})})},t.prototype.getMessagesFromCache=function(e,r,i,s,a,o){return g(this,void 0,void 0,function(){return v(this,function(u){return[2,[]]})})},t.prototype.getPollMessagesFromCache=function(e,r,i,s){return g(this,void 0,void 0,function(){return v(this,function(a){return[2,[]]})})},t.prototype.getCachedMessageCountBetween=function(e,r,i,s){return g(this,void 0,void 0,function(){return v(this,function(a){return[2,0]})})},t.prototype.getUnsentMessagesFromCache=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){return[2,[]]})})},t.prototype.removeFailedMessageFromCache=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return[2]})})},t}(yn),hN=function(n){function t(e,r,i){var s,a,o,u,c=this;(c=n.call(this,e,"ADMM",i)||this).message=new ou(e,i);var l=M.of(e).sdkState;return c.isMentioned=nu(c.message.mentionType,(o=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(a=c.message.mentionedUsers)===null||a===void 0?void 0:a.map(function(d){return d.userId}))!==null&&o!==void 0?o:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return w(t,n),t}(it),fN=function(n){function t(e,r,i){var s,a,o,u,c,l=this;(l=n.call(this,e,"AEDI",i)||this).message=new ou(e,i);var d=M.of(e).sdkState;return l.mentionCountChange=y_({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(o=(a=i.old_values)===null||a===void 0?void 0:a.mentioned_user_ids)!==null&&o!==void 0?o:[]},oe({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(h){return h.userId})}),d.userId),l}return w(t,n),t}(it),pN=function(n){function t(e,r,i){var s=n.call(this,e,"MRCT",i)||this;return s.channelUrl=i.channel_url,s.channelType=i.channel_type,s.event=new k_(i),s}return w(t,n),t}(it),_N=function(n){function t(e,r,i){var s=n.call(this,e,"MTHD",i)||this;return s.event=new JS(e,i),s}return w(t,n),t}(it),mN=function(n){function t(e,r,i){var s=n.call(this,e,"MCNT",i)||this;return s.groupChannelMemberCounts=i.group_channels.map(function(a){return{channelUrl:a.channel_url,memberCount:a.member_count,joinedMemberCount:a.joined_member_count,updatedAt:a.ts}}),s.openChannelMemberCounts=i.open_channels.map(function(a){return{channelUrl:a.channel_url,participantCount:a.participant_count,updatedAt:a.ts}}),s}return w(t,n),t}(it),vN=function(n){function t(e,r,i){var s=n.call(this,e,"PEDI",i)||this;return s.event=new sC(e,i),s.status=yp(i.poll.status)||i.poll.status,s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return w(t,n),t}(it),Nt;(function(n){n.NONE="none",n.JOINED="joined",n.INVITED="invited",n.LEFT="left"})(Nt||(Nt={}));var zi,or,Zn,ha,ci,zd,ks,$c,Tr=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.state=null,i.role=null,i.isMuted=!1,i.isBlockedByMe=!1,i.isBlockingMe=!1,i.state=be(Nt,r.state)?r.state:null,i.role=be(Gr,r.role)?r.role:null,typeof r.is_muted=="boolean"&&(i.isMuted=r.is_muted),typeof r.is_blocked_by_me=="boolean"&&(i.isBlockedByMe=r.is_blocked_by_me),typeof r.is_blocking_me=="boolean"&&(i.isBlockingMe=r.is_blocking_me),i}return w(t,n),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{state:e.state,role:e.role,is_muted:e.isMuted,is_blocked_by_me:e.isBlockedByMe,is_blocking_me:e.isBlockingMe})))},t}(So),oE=function(n){function t(e,r){var i,s,a=this;return(a=n.call(this,e)||this).channelUrl=(i=r.channel_url)!==null&&i!==void 0?i:"",a.channelType=(s=r.channel_type)!==null&&s!==void 0?s:xe.GROUP,a.reader=new Oe(a._iid,r.user),a.readAt=r.ts,a}return w(t,n),t}(yn);(function(n){n.ALL="all",n.PUBLIC="public",n.PRIVATE="private"})(zi||(zi={})),function(n){n.ALL="all",n.JOINED="joined_only",n.INVITED="invited_only",n.INVITED_BY_FRIEND="invited_by_friend",n.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(or||(or={})),function(n){n.ALL="all",n.SUPER="super",n.NON_SUPER="nonsuper",n.BROADCAST_ONLY="broadcast_only",n.EXCLUSIVE_ONLY="exclusive_only"}(Zn||(Zn={})),function(n){n.ALL="all",n.UNREAD_MESSAGE="unread_message"}(ha||(ha={})),function(n){n.ALL="all",n.UNHIDDEN="unhidden_only",n.HIDDEN="hidden_only",n.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",n.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(ci||(ci={})),function(n){n.ALL="all",n.OPERATOR="operator",n.NONOPERATOR="nonoperator"}(zd||(zd={})),function(n){n.AND="AND",n.OR="OR"}(ks||(ks={})),function(n){n.MEMBER_NICKNAME="member_nickname",n.CHANNEL_NAME="channel_name"}($c||($c={}));var Kt,uE=function(){function n(t){var e,r,i,s,a,o,u,c,l,d,h,f,p,_;this._searchFilter=null,this._userIdsFilter=null,this.includeEmpty=(e=t==null?void 0:t.includeEmpty)!==null&&e!==void 0&&e,this.nicknameContainsFilter=(r=t==null?void 0:t.nicknameContainsFilter)!==null&&r!==void 0?r:null,this.nicknameStartsWithFilter=(i=t==null?void 0:t.nicknameStartsWithFilter)!==null&&i!==void 0?i:null,this.nicknameExactMatchFilter=(s=t==null?void 0:t.nicknameExactMatchFilter)!==null&&s!==void 0?s:null,this.channelNameContainsFilter=(a=t==null?void 0:t.channelNameContainsFilter)!==null&&a!==void 0?a:"",this.myMemberStateFilter=(o=t==null?void 0:t.myMemberStateFilter)!==null&&o!==void 0?o:or.ALL,this.customTypesFilter=(u=t==null?void 0:t.customTypesFilter)!==null&&u!==void 0?u:null,this.channelUrlsFilter=(c=t==null?void 0:t.channelUrlsFilter)!==null&&c!==void 0?c:null,this.superChannelFilter=(l=t==null?void 0:t.superChannelFilter)!==null&&l!==void 0?l:Zn.ALL,this.publicChannelFilter=(d=t==null?void 0:t.publicChannelFilter)!==null&&d!==void 0?d:zi.ALL,this.customTypeStartsWithFilter=(h=t==null?void 0:t.customTypeStartsWithFilter)!==null&&h!==void 0?h:null,this.unreadChannelFilter=(f=t==null?void 0:t.unreadChannelFilter)!==null&&f!==void 0?f:ha.ALL,this.hiddenChannelFilter=(p=t==null?void 0:t.hiddenChannelFilter)!==null&&p!==void 0?p:ci.UNHIDDEN,this.includeFrozen=(_=t==null?void 0:t.includeFrozen)===null||_===void 0||_,t!=null&&t.createdAfter&&(this.createdAfter=t.createdAfter),t!=null&&t.createdBefore&&(this.createdBefore=t.createdBefore)}return n.prototype._isFriend=function(t){return!(!t||!t.friendDiscoveryKey&&!t.friendName)},Object.defineProperty(n.prototype,"searchFilter",{get:function(){return this._searchFilter},enumerable:!1,configurable:!0}),n.prototype.setSearchFilter=function(t,e){Array.isArray(t)&&t.length!==0&&typeof e=="string"&&e&&(this._searchFilter={query:e,fields:t})},Object.defineProperty(n.prototype,"userIdsFilter",{get:function(){return this._userIdsFilter},enumerable:!1,configurable:!0}),n.prototype.setUserIdsFilter=function(t,e,r){r===void 0&&(r=ks.AND),this._userIdsFilter={userIds:t,includeMode:e,queryType:r}},n.prototype.clone=function(){var t,e=new n;this.searchFilter&&e.setSearchFilter(this.searchFilter.fields,(t=this.searchFilter.query)!==null&&t!==void 0?t:void 0),this.userIdsFilter&&e.setUserIdsFilter(this.userIdsFilter.userIds,this.userIdsFilter.includeMode,this.userIdsFilter.queryType);var r=JSON.parse(JSON.stringify(this));return Object.keys(r).forEach(function(i){e[i]=r[i]}),e},n.prototype.match=function(t,e){if(this._searchFilter){var r=this._searchFilter,i=r.query,s=r.fields;if(i&&s&&s.length>0&&!s.some(function(p){switch(p){case $c.CHANNEL_NAME:return t.name.toLowerCase().includes(i.toLowerCase());case $c.MEMBER_NICKNAME:return t.members.some(function(_){return _.nickname.toLowerCase().includes(i.toLowerCase())});default:return!0}}))return!1}if(this._userIdsFilter){var a=this._userIdsFilter,o=a.userIds,u=a.includeMode,c=a.queryType,l=t.members.map(function(p){return p.userId});if(u){if(o.length>0)switch(c){case ks.AND:if(o.some(function(p){return!l.includes(p)}))return!1;break;case ks.OR:if(o.every(function(p){return!l.includes(p)}))return!1}}else if(o.includes(e)||o.push(e),t.members.length>o.length||!$T(o,l))return!1}if(!this.includeEmpty&&!t.lastMessage||!this.includeFrozen&&t.isFrozen||this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes("*")&&!this.customTypesFilter.includes(t.customType)||this.customTypeStartsWithFilter&&!new RegExp("^".concat(this.customTypeStartsWithFilter)).test(t.customType)||this.channelNameContainsFilter&&!t.name.toLowerCase().includes(this.channelNameContainsFilter.toLowerCase()))return!1;if(this.nicknameContainsFilter){var d=this.nicknameContainsFilter.toLowerCase();if(!t.members.some(function(p){return p.userId!==e&&p.nickname.toLowerCase().includes(d)}))return!1}if(this.nicknameStartsWithFilter){var h=this.nicknameStartsWithFilter.toLowerCase();if(!t.members.some(function(p){return p.userId!==e&&p.nickname.toLowerCase().startsWith(h)}))return!1}if(this.nicknameExactMatchFilter){var f=this.nicknameExactMatchFilter.toLowerCase();if(!t.members.some(function(p){return p.userId!==e&&p.nickname.toLowerCase()!=f}))return!1}if(this.channelUrlsFilter&&this.channelUrlsFilter.length>0&&!this.channelUrlsFilter.includes(t.url))return!1;if(this.myMemberStateFilter)switch(this.myMemberStateFilter){case or.JOINED:if(t.myMemberState!=="joined")return!1;break;case or.INVITED:if(t.myMemberState!=="invited")return!1;break;case or.INVITED_BY_FRIEND:if(t.myMemberState!=="invited"||!this._isFriend(t.inviter))return!1;break;case or.INVITED_BY_NON_FRIEND:if(t.myMemberState!=="invited"||this._isFriend(t.inviter))return!1}if(this.hiddenChannelFilter)switch(this.hiddenChannelFilter){case ci.UNHIDDEN:if(t.isHidden||t.hiddenState!=="unhidden")return!1;break;case ci.HIDDEN:if(!t.isHidden)return!1;break;case ci.HIDDEN_ALLOW_AUTO_UNHIDE:if(!t.isHidden||t.hiddenState!=="hidden_allow_auto_unhide")return!1;break;case ci.HIDDEN_PREVENT_AUTO_UNHIDE:if(!t.isHidden||t.hiddenState!=="hidden_prevent_auto_unhide")return!1}if(this.unreadChannelFilter&&this.unreadChannelFilter===ha.UNREAD_MESSAGE&&t.unreadMessageCount===0)return!1;if(this.publicChannelFilter)switch(this.publicChannelFilter){case zi.PUBLIC:if(!t.isPublic)return!1;break;case zi.PRIVATE:if(t.isPublic)return!1}if(this.superChannelFilter)switch(this.superChannelFilter){case Zn.SUPER:if(!t.isSuper)return!1;break;case Zn.NON_SUPER:if(t.isSuper)return!1}return!(this.createdAfter&&t.createdAt<this.createdAfter)&&!(this.createdBefore&&t.createdAt>this.createdBefore)},n}(),gN=function(n){function t(e,r){var i=r.sdkState,s=r.cacheContext,a=n.call(this,e)||this;return a._channels=new Map,a._sdkState=i,a._cacheContext=s,a}return w(t,n),Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return B(!!e).throw(U.databaseError),e.collection(Wy)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e,r){return r===void 0&&(r=0),A(A({},e.serialize()),{lastMessageUpdatedAt:e.lastMessage?e.lastMessage.createdAt:0,syncIndex:r})},t.prototype._deserialize=function(e){return Wt.of(this._iid).buildGroupChannelFromSerializedData(e)},Object.defineProperty(t.prototype,"channels",{get:function(){return ce([],ie(this._channels.values()),!1)},enumerable:!1,configurable:!0}),t.prototype.isCachedInMemory=function(e){return this._channels.has(e)},t.prototype.filterOffsetChanged=function(e){var r=this;return e.filter(function(i){if(r._channels.has(i.url))return r._channels.get(i.url).messageOffsetTimestamp<i.messageOffsetTimestamp})},t.prototype.get=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return this._channels.has(e)?[3,3]:this.localCacheEnabled?[4,this.collection.getByKey(e)]:[3,2];case 1:if(r=s.sent())return i=this._deserialize(r),this._channels.set(e,i),[2,i];s.label=2;case 2:return[2,void 0];case 3:return[2,this._channels.get(e)]}})})},t.prototype.fetch=function(e){var r=e.token,i=e.limit,s=i===void 0?Qy:i,a=e.backward,o=a!==void 0&&a,u=e.filter,c=u===void 0?new uE:u,l=e.order,d=l===void 0?At.LATEST_LAST_MESSAGE:l,h=e.borderlineChannelUrl;return g(this,void 0,void 0,function(){var f,p,_,m,b=this;return v(this,function(y){switch(y.label){case 0:return this.localCacheEnabled?(f=_d(d),p={where:function(E){if(r)switch(d){case At.CHANNEL_NAME_ALPHABETICAL:if(!o&&E.name.localeCompare(r)<0||o&&E.name.localeCompare(r)>0||h&&h===E.url)return!1;break;case At.CHRONOLOGICAL:if(!o&&E.createdAt>r||o&&E.createdAt<r||h&&h===E.url)return!1;break;case At.LATEST_LAST_MESSAGE:if(!o&&E.lastMessageUpdatedAt>r||o&&E.lastMessageUpdatedAt<r||h&&h===E.url)return!1}return c.match(b._deserialize(E),b._sdkState.userId)},index:f,backward:o},[4,this.collection.query(p)]):[3,3];case 1:return[4,y.sent().fetch({limit:s})];case 2:return _=y.sent(),(m=_.map(function(E){return b._deserialize(E)})).forEach(function(E){b._channels.has(E.url)||b._channels.set(E.url,E)}),[2,m];case 3:return[2,[]]}})})},t.prototype.upsert=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o=this;return v(this,function(u){switch(u.label){case 0:if(i=[],e.forEach(function(c){if(o._channels.has(c.url)){var l=o._channels.get(c.url);l._pinnedMessagesUpdatedAt<c._pinnedMessagesUpdatedAt&&(l._pinnedMessagesUpdatedAt=c._pinnedMessagesUpdatedAt),l._messageCollectionLastAccessedAt>c._messageCollectionLastAccessedAt&&Object.assign(c,{_messageCollectionLastAccessedAt:void 0}),c.cachedMetaData&&r&&(l._updateCachedMetaData(c.cachedMetaData,r),Object.assign(c,{_cachedMetaData:void 0})),l._update(c),i.push(l)}else o._channels.set(c.url,c),i.push(c)}),!this.localCacheEnabled)return[3,2];for(a in s=[],i)s.push(this._serialize(i[a],parseInt(a)));return[4,this.collection.upsertMany(s)];case 1:u.sent(),u.label=2;case 2:return[2,i]}})})},t.prototype.remove=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,7]),r=Z(e),i=r.next(),c.label=1;case 1:return i.done?[3,4]:(s=i.value,this._channels.delete(s),this.localCacheEnabled?[4,this.collection.remove(s)]:[3,3]);case 2:c.sent(),c.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return a=c.sent(),o={error:a},[3,7];case 6:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 7:return[2]}})})},t.prototype.clear=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return this.clearMemoryCache(),this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.clearMemoryCache=function(){this._channels.clear()},t.prototype._setBlockStateOfAllChannels=function(e,r,i){return g(this,void 0,void 0,function(){var s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L;return v(this,function(k){switch(k.label){case 0:if(s=[],e===this._sdkState.userId)try{for(a=Z(this._channels.values()),o=a.next();!o.done;o=a.next()){h=o.value;try{for(y=void 0,u=Z(h.members),c=u.next();!c.done;c=u.next())if((_=c.value).userId===r){_.isBlockedByMe=i,s.push(h);break}}catch(O){y={error:O}}finally{try{c&&!c.done&&(E=u.return)&&E.call(u)}finally{if(y)throw y.error}}}}catch(O){m={error:O}}finally{try{o&&!o.done&&(b=a.return)&&b.call(a)}finally{if(m)throw m.error}}else if(r===this._sdkState.userId)try{for(l=Z(this._channels.values()),d=l.next();!d.done;d=l.next()){h=d.value;try{for(C=void 0,f=Z(h.members),p=f.next();!p.done;p=f.next())if((_=p.value).userId===e){_.isBlockingMe=i,s.push(h);break}}catch(O){C={error:O}}finally{try{p&&!p.done&&(L=f.return)&&L.call(f)}finally{if(C)throw C.error}}}}catch(O){T={error:O}}finally{try{d&&!d.done&&(N=l.return)&&N.call(l)}finally{if(T)throw T.error}}return s.length>0?[4,this.upsert(s)]:[3,2];case 1:k.sent(),k.label=2;case 2:return[2]}})})},t.prototype.block=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this._setBlockStateOfAllChannels(e,r,!0)];case 1:return i.sent(),[2]}})})},t.prototype.unblock=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this._setBlockStateOfAllChannels(e,r,!1)];case 1:return i.sent(),[2]}})})},t.prototype.markAsRead=function(e,r){return r===void 0&&(r=ce([],ie(this._channels.keys()),!1)),g(this,void 0,void 0,function(){var i,s,a,o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:i=[],h.label=1;case 1:h.trys.push([1,6,7,8]),s=Z(r),a=s.next(),h.label=2;case 2:return a.done?[3,5]:(o=a.value,[4,this.get(o)]);case 3:(u=h.sent())!=null&&u._updateUnreadMemberState(this._sdkState.userId,e)&&(u._updateUnreadCount(0,0),i.push(u)),h.label=4;case 4:return a=s.next(),[3,2];case 5:return[3,8];case 6:return c=h.sent(),l={error:c},[3,8];case 7:try{a&&!a.done&&(d=s.return)&&d.call(s)}finally{if(l)throw l.error}return[7];case 8:return i.length>0?[4,this.upsert(i)]:[3,10];case 9:h.sent(),h.label=10;case 10:return[2]}})})},t}(yn),md={invitedUserIds:void 0,channelUrl:void 0,coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isSuper:void 0,isBroadcast:void 0,isExclusive:void 0,isPublic:void 0,isDiscoverable:void 0,isStrict:void 0,isEphemeral:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},Up=function(n){return Ae("string",n.invitedUserIds,!0)&&R("string",n.channelUrl,!0)&&R("string",n.coverUrl,!0)&&(On(n.coverImage)||R("string",n.coverImage,!0))&&R("boolean",n.isDistinct,!0)&&R("boolean",n.isSuper,!0)&&R("boolean",n.isBroadcast,!0)&&R("boolean",n.isExclusive,!0)&&R("boolean",n.isPublic,!0)&&R("boolean",n.isStrict,!0)&&R("boolean",n.isDiscoverable,!0)&&R("boolean",n.isEphemeral,!0)&&R("string",n.accessCode,!0)&&R("string",n.name,!0)&&R("string",n.data,!0)&&R("string",n.customType,!0)&&Ae("string",n.operatorUserIds,!0)&&R("number",n.messageSurvivalSeconds,!0)},Gd={customTypes:void 0,includeEmpty:!1,includeFrozen:!0,includeChatNotification:!1},Lp=function(n){return Ae("string",n.customTypes,!0)&&R("boolean",n.includeEmpty)&&R("boolean",n.includeFrozen)&&R("boolean",n.includeChatNotification)},cE={myMemberStateFilter:or.ALL},lE=function(n){return be(or,n.myMemberStateFilter)};(function(n){n.GROUP_CHANNEL_UNREAD_MENTION_COUNT="group_channel_unread_mention_count",n.NONSUPER_UNREAD_MENTION_COUNT="non_super_group_channel_unread_mention_count",n.SUPER_UNREAD_MENTION_COUNT="super_group_channel_unread_mention_count",n.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT="group_channel_unread_message_count",n.NONSUPER_UNREAD_MESSAGE_COUNT="non_super_group_channel_unread_message_count",n.SUPER_UNREAD_MESSAGE_COUNT="super_group_channel_unread_message_count",n.GROUP_CHANNEL_INVITATION_COUNT="group_channel_invitation_count",n.NONSUPER_INVITATION_COUNT="non_super_group_channel_invitation_count",n.SUPER_INVITATION_COUNT="super_group_channel_invitation_count"})(Kt||(Kt={}));var yN={keys:[]},EN={channelCustomTypesFilter:void 0,superChannelFilter:Zn.ALL},bN=function(n){return Ae("string",n.channelCustomTypesFilter,!0)&&be(Zn,n.superChannelFilter)},TN={channelUrl:void 0,scheduledStatus:void 0,messageTypeFilter:mn.ALL};A({},z);var vd=function(n){return n.startsWith("EVENT_")||n===z.SYNC_CHANNEL_CHANGELOGS||n===z.REFRESH_CHANNEL},Ne=function(n){function t(e){var r=e.channels,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=e.data,u=o===void 0?null:o,c=e.ts,l=n.call(this)||this;return l.channels=r,l.source=i,l.isWebSocketEventComing=a,l.data=u,l.ts=c,l}return w(t,n),t}(rt),hs=function(n){function t(e){var r=e.channelUrls,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=n.call(this)||this;return o.channelUrls=r,o.source=i,o.isWebSocketEventComing=a,o}return w(t,n),t}(rt),wN=function(){function n(t){var e=t.groupChannelCache,r=t.messageCache,i=t.unsentMessageCache,s=t.dispatcher,a=this;this._observers=new Map,s.on(function(o){return g(a,void 0,void 0,function(){var u,c,l,d,h,f,p,_,m,b,y,E,T,N,C=this;return v(this,function(L){switch(L.label){case 0:if(!(o instanceof Ne))return[3,10];u=o.channels,y=o.source,E=o.isWebSocketEventComing,c=o.data,l=u.filter(function(k){return k instanceof Nr}),d=e.filterOffsetChanged(l),L.label=1;case 1:L.trys.push([1,6,7,8]),h=Z(d),f=h.next(),L.label=2;case 2:return f.done?[3,5]:(p=f.value,[4,r.removeUnderOffset(p.url,p.messageOffsetTimestamp)]);case 3:L.sent(),L.label=4;case 4:return f=h.next(),[3,2];case 5:return[3,8];case 6:return _=L.sent(),T={error:_},[3,8];case 7:try{f&&!f.done&&(N=h.return)&&N.call(h)}finally{if(T)throw T.error}return[7];case 8:return[4,e.upsert(l,o.ts)];case 9:return m=L.sent(),E||this._broadcastUpdateEvent(m,y,c),[3,15];case 10:return o instanceof hs?(b=o.channelUrls,y=o.source,E=o.isWebSocketEventComing,[4,e.remove(b)]):[3,13];case 11:return L.sent(),[4,Tt(function(){return g(C,void 0,void 0,function(){var k,O,x,Q,we,Ie;return v(this,function(ze){switch(ze.label){case 0:ze.trys.push([0,6,7,8]),k=Z(b),O=k.next(),ze.label=1;case 1:return O.done?[3,5]:(x=O.value,[4,r.removeMessagesOfChannel(x)]);case 2:return ze.sent(),[4,i.removeMessagesOfChannel(x)];case 3:ze.sent(),ze.label=4;case 4:return O=k.next(),[3,1];case 5:return[3,8];case 6:return Q=ze.sent(),we={error:Q},[3,8];case 7:try{O&&!O.done&&(Ie=k.return)&&Ie.call(k)}finally{if(we)throw we.error}return[7];case 8:return[2]}})})})];case 12:return L.sent(),E||this._broadcastRemoveEvent(b,y),[3,15];case 13:return o instanceof nE?[4,e.fetch({token:Number.MAX_SAFE_INTEGER,limit:Number.MAX_SAFE_INTEGER})]:[3,15];case 14:L.sent(),L.label=15;case 15:return[2]}})})})}return n.prototype._broadcastUpdateEvent=function(t,e,r){var i,s;try{for(var a=Z(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onUpdate&&u.onUpdate(t,e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},n.prototype._broadcastRemoveEvent=function(t,e){var r,i;try{for(var s=Z(this._observers.values()),a=s.next();!a.done;a=s.next()){var o=a.value;o.onRemove&&o.onRemove(t,e)}}catch(u){r={error:u}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},n.prototype.subscribe=function(t,e){this._observers.set(t,e)},n.prototype.unsubscribe=function(t){this._observers.delete(t)},n.prototype.unsubscribeAll=function(){this._observers.clear()},n}(),IN=function(n){function t(e){var r=e.userId,i=e.ts,s=e.token,a=e.filter,o=e.includeChatNotification,u=o!==void 0&&o,c=n.call(this)||this,l=A(A({},Gd),a),d=l.customTypes,h=l.includeEmpty,f=l.includeFrozen;return c.method=j.GET,c.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/my_group_channels/changelogs"),c.params=re(oe({show_delivery_receipt:!0,show_member:!0,show_read_receipt:!0,change_ts:i||null,token:s,custom_types:d,show_empty:h,show_frozen:f,include_chat_notification:u})),c}return w(t,n),t}(K),SN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.updatedChannels=r.updated.map(function(s){return new Nr(e,Object.assign(s,{ts:r.ts}))}),i.deletedChannelUrls=r.deleted,i.hasMore=r.has_more,i.token=r.next,i.ts=r.ts,i}return w(t,n),t}(W),Pp=function(n){function t(e){var r=e.channelUrl,i=e.isInternalCall,s=n.call(this)||this;return s.method=j.GET,s.path="".concat(i?jT:Mn,"/").concat(encodeURIComponent(r)),s.params={show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0},s}return w(t,n),t}(K),xp=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new Nr(e,r),i}return w(t,n),t}(W),xo={includeEmpty:!1,includeFrozen:!0,includeMetaData:!0,includeChatNotification:!1,channelUrlsFilter:void 0,customTypesFilter:void 0,customTypeStartsWithFilter:void 0,nicknameContainsFilter:void 0,nicknameStartsWithFilter:void 0,nicknameExactMatchFilter:void 0,channelNameContainsFilter:void 0,myMemberStateFilter:or.ALL,unreadChannelFilter:ha.ALL,superChannelFilter:Zn.ALL,publicChannelFilter:zi.ALL,hiddenChannelFilter:ci.ALL,userIdsFilter:{userIds:[],includeMode:!0,queryType:ks.AND},searchFilter:{query:void 0,fields:[]},metadataKey:void 0,metadataValues:void 0,metadataOrderKeyFilter:void 0,metadataValueStartsWith:void 0,order:At.LATEST_LAST_MESSAGE,createdAfter:void 0,createdBefore:void 0},CN=function(n){function t(e){var r=this,i=e.userId,s=e.token,a=e.limit,o=e.order,u=e.includeEmpty,c=e.myMemberStateFilter,l=e.superChannelFilter,d=e.publicChannelFilter,h=e.unreadChannelFilter,f=e.nicknameContainsFilter,p=e.nicknameStartsWithFilter,_=e.nicknameExactMatchFilter,m=e.channelNameContainsFilter,b=e.channelUrlsFilter,y=e.customTypesFilter,E=e.customTypeStartsWithFilter,T=e.hiddenChannelFilter,N=e.metadataOrderKeyFilter,C=e.metadataKey,L=e.metadataValues,k=e.metadataValueStartsWith,O=e.includeFrozen,x=e.includeMetaData,Q=e.searchFilter,we=e.userIdsFilter,Ie=e.includeChatNotification,ze=Ie!==void 0&&Ie,$t=e.createdAfter,Gt=e.createdBefore;return(r=n.call(this)||this).method=j.GET,r.path="".concat(Ue,"/").concat(encodeURIComponent(i),"/my_group_channels"),r.params=re({token:s,limit:a,order:o??xo.order,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:u??xo.includeEmpty,member_state_filter:c??xo.myMemberStateFilter,super_mode:l??xo.superChannelFilter,public_mode:d??xo.publicChannelFilter,unread_filter:h??xo.unreadChannelFilter,members_nickname_contains:f,members_nickname_startswith:p,members_nickname:_,name_contains:m,channel_urls:b,custom_types:y,custom_type_startswith:E,hidden_mode:T,metadata_order_key:N,metadata_key:C,metadata_values:L,metadata_value_startswith:k,show_frozen:O,show_metadata:x,include_chat_notification:ze,created_after:$t,created_before:Gt}),Q&&Q.query&&Q.fields&&(r.params.search_query=Q.query,r.params.search_fields=Q.fields),we&&we.userIds&&we.userIds.length>0&&(we.includeMode?(r.params.members_include_in=we.userIds,r.params.query_type=we.queryType.toUpperCase()):r.params.members_exactly_in=we.userIds),r}return w(t,n),t}(K),NN=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.channels=[];var s=r.next,a=r.channels,o=r.ts;return i.token=s,a&&a.length>0&&(i.channels=a.map(function(u){return u.ts=o,new Nr(e,u)})),i.ts=o??0,i}return w(t,n),t}(W),AN=function(n){function t(e){var r=e.userId,i=e.filter,s=n.call(this)||this,a=i.myMemberStateFilter;return s.method=j.GET,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/group_channel_count"),s.params={state:a??or.ALL},s}return w(t,n),t}(K),kN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.groupChannelCount=r.group_channel_count,i}return w(t,n),t}(W),ON=function(n){function t(e){var r=e.userId,i=e.filter,s=n.call(this)||this,a=i.keys;return s.method=j.GET,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/unread_item_count"),s.params=re({item_keys:a}),s}return w(t,n),t}(K),MN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return typeof r[Kt.GROUP_CHANNEL_UNREAD_MENTION_COUNT]=="number"&&(i.groupChannelUnreadMentionCount=r[Kt.GROUP_CHANNEL_UNREAD_MENTION_COUNT]),typeof r[Kt.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]=="number"&&(i.groupChannelUnreadMessageCount=r[Kt.GROUP_CHANNEL_UNREAD_MESSAGE_COUNT]),typeof r[Kt.GROUP_CHANNEL_INVITATION_COUNT]=="number"&&(i.groupChannelInvitationCount=r[Kt.GROUP_CHANNEL_INVITATION_COUNT]),typeof r[Kt.SUPER_UNREAD_MENTION_COUNT]=="number"&&(i.superGroupChannelUnreadMentionCount=r[Kt.SUPER_UNREAD_MENTION_COUNT]),typeof r[Kt.SUPER_UNREAD_MESSAGE_COUNT]=="number"&&(i.superGroupChannelUnreadMessageCount=r[Kt.SUPER_UNREAD_MESSAGE_COUNT]),typeof r[Kt.SUPER_INVITATION_COUNT]=="number"&&(i.superGroupChannelInvitationCount=r[Kt.SUPER_INVITATION_COUNT]),typeof r[Kt.NONSUPER_UNREAD_MENTION_COUNT]=="number"&&(i.nonSuperGroupChannelUnreadMentionCount=r[Kt.NONSUPER_UNREAD_MENTION_COUNT]),typeof r[Kt.NONSUPER_UNREAD_MESSAGE_COUNT]=="number"&&(i.nonSuperGroupChannelUnreadMessageCount=r[Kt.NONSUPER_UNREAD_MESSAGE_COUNT]),typeof r[Kt.NONSUPER_INVITATION_COUNT]=="number"&&(i.nonSuperGroupChannelInvitationCount=r[Kt.NONSUPER_INVITATION_COUNT]),i}return w(t,n),t}(W),DN=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=j.GET,i.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/unread_channel_count"),i}return w(t,n),t}(K),RN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.unreadCount=r.unread_count,i}return w(t,n),t}(W),UN=function(n){function t(e){var r=e.userId,i=e.filter,s=e.includeFeedChannel,a=s!==void 0&&s,o=n.call(this)||this,u=i.channelCustomTypesFilter,c=i.superChannelFilter;return o.method=j.GET,o.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/unread_message_count"),o.params={super_mode:c??Zn.ALL,custom_types:u,include_feed_channel:a},o}return w(t,n),t}(K),LN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.unreadCount=r.unread_count,i.unreadFeedCount=r.unread_feed_count,i}return w(t,n),t}(W),PN=function(n){function t(e){var r=e.channelUrl,i=e.scheduledStatus,s=e.messageTypeFilter,a=n.call(this)||this;return a.method=j.GET,a.path="".concat(j0,"/count"),a.params={channel_url:r,status:FN(i)},s&&(a.params.message_type=s),a}return w(t,n),t}(K),xN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.count=r.count,i}return w(t,n),t}(W),FN=function(n){if(!n)return[];var t=[];return n.forEach(function(e){switch(e){case ia.PENDING:t.push(Er.PENDING);break;case ia.SENT:t.push(Er.IN_QUEUE),t.push(Er.SENT);break;case ia.CANCELED:t.push(Er.CANCELED);break;case ia.FAILED:t.push(Er.FAILED)}}),t},qN=function(n){function t(e){var r=this,i=e.userId,s=e.channelUrl,a=e.coverUrl,o=e.coverImage,u=e.isDistinct,c=e.isSuper,l=e.isBroadcast,d=e.isPublic,h=e.isExclusive,f=e.isDiscoverable,p=e.isStrict,_=e.isEphemeral,m=e.accessCode,b=e.name,y=e.data,E=e.customType,T=e.messageSurvivalSeconds,N=e.invitedUserIds,C=e.operatorUserIds;return(r=n.call(this)||this).method=j.POST,r.path=Mn,r.params=re({user_ids:ce([i],ie(N??[]),!1).filter(function(L,k,O){return k===O.indexOf(L)}),channel_url:s,cover_url:a,cover_file:o,is_distinct:u,is_super:c,is_broadcast:l,is_exclusive:h,is_public:d,is_discoverable:f,strict:p,is_ephemeral:_,access_code:m,name:b,data:y,custom_type:E,operator_ids:C,message_survival_seconds:T}),r}return w(t,n),t}(K),$N=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).channel=new Nr(e,r),s.isCreated=(i=r.is_created)===null||i===void 0||i,s}return w(t,n),t}(W),jv=function(n){function t(e){var r=e.userId,i=e.channelUrls,s=n.call(this)||this;return s.method=j.PUT,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/mark_as_read_all"),s.params={channel_urls:i},s}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var HN=function(n){function t(e){var r=this,i=e.channelUrl,s=e.userId,a=e.accessCode;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/join"),r.params={user_id:s,access_code:a},r}return w(t,n),t}(K),zN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new Nr(e,r),i}return w(t,n),t}(W),GN=function(n){function t(e,r,i){var s=n.call(this,e,r,i)||this,a=i.data,o=a.member_count,u=o===void 0?0:o,c=a.joined_member_count,l=c===void 0?0:c,d=a.users,h=d===void 0?null:d;return s.memberCount=u,s.joinedMemberCount=l,s.members=Array.isArray(h)?h.map(function(f){return new Tr(e,f)}):[new Tr(e,i.data)],s}return w(t,n),t}(hu),VN=function(n){function t(e){var r=this,i=e.channelUrl,s=e.userId,a=e.shouldRemoveOperatorStatus;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/leave"),r.params={user_id:s,should_remove_operator_status:a},r}return w(t,n),t}(K);(function(n){function t(e,r){return n.call(this,e,r)||this}w(t,n)})(W);var BN=function(n){function t(e,r,i){var s=n.call(this,e,r,i)||this,a=i.data,o=a.member_count,u=o===void 0?0:o,c=a.joined_member_count,l=c===void 0?0:c;return s.memberCount=u,s.joinedMemberCount=l,s.member=new Tr(s._iid,i.data),s}return w(t,n),t}(hu),jN=function(n){function t(e){var r=this,i=e.channelUrl,s=e.userIds;return(r=n.call(this)||this).method=j.POST,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/invite"),r.params={user_ids:s},r}return w(t,n),t}(K),KN=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new Nr(e,r),i}return w(t,n),t}(W),QN=function(n){function t(e,r,i){var s=n.call(this,e,r,i)||this;s.inviter=null;var a=i.data,o=a.member_count,u=o===void 0?0:o,c=a.joined_member_count,l=c===void 0?0:c,d=a.inviter,h=a.invitees,f=h===void 0?[]:h;return s.memberCount=u,s.joinedMemberCount=l,d&&Object.keys(d).length>0&&(s.inviter=new Oe(e,d)),s.invitees=f.map(function(p){return new Tr(e,p)}),s}return w(t,n),t}(hu),WN=function(n){function t(e){var r=this,i=e.channelUrl,s=e.userId;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/decline"),r.params={user_id:s},r}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new Nr(e,r),i.channel.myMemberState=Nt.NONE,i}w(t,n)})(W);var YN=function(n){function t(e,r,i){var s=n.call(this,e,r,i)||this,a=i.data,o=a.member_count,u=a.joined_member_count,c=a.inviter,l=a.invitee;return s.memberCount=o??0,s.joinedMemberCount=u??0,s.inviter=new Oe(e,c),s.invitee=new Tr(e,l),s}return w(t,n),t}(hu),Fp={hidePreviousMessages:!1,allowAutoUnhide:!0},ZN=function(n){function t(e){var r=this,i=e.channelUrl,s=e.userId,a=e.hidePreviousMessages,o=e.allowAutoUnhide;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/hide"),r.params={user_id:s,hide_previous_messages:a??Fp.hidePreviousMessages,allow_auto_unhide:o??Fp.allowAutoUnhide},r}return w(t,n),t}(K),JN=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.ts_message_offset;return i.messageOffsetTimestamp=s,i}return w(t,n),t}(W),XN=function(n){function t(e,r,i){var s,a,o,u=this;return(u=n.call(this,e,"SYEV",i)||this).allowAutoUnhide=null,u.hidePreviousMessages=null,u.messageOffsetTimestamp=null,i.data&&(u.allowAutoUnhide=(s=i.data.allow_auto_unhide)!==null&&s!==void 0?s:null,u.hidePreviousMessages=(a=i.data.hide_previous_messages)!==null&&a!==void 0?a:null),u.messageOffsetTimestamp=(o=i.ts_message_offset)!==null&&o!==void 0?o:null,u}return w(t,n),t}(it),eA=function(n){function t(e){var r=e.channelUrl,i=e.time;return n.call(this,{code:"TPST",ackRequired:!1,payload:{channel_url:r,time:i}})||this}return w(t,n),t}(Yn),tA=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new Oe(e,i.data),s}return w(t,n),t}(it),nA=function(n){function t(e){var r=e.channelUrl,i=e.time;return n.call(this,{code:"TPEN",ackRequired:!1,payload:{channel_url:r,time:i}})||this}return w(t,n),t}(Yn),rA=function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new Oe(e,i.data),s}return w(t,n),t}(it),iA=function(n){function t(e){var r=e.channelUrl,i=e.messageId;return n.call(this,{code:"MACK",ackRequired:!1,payload:{channel_url:r,msg_id:i}})||this}return w(t,n),t}(Yn),dE=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k,O,x,Q=this;return(Q=n.call(this,e,r)||this).includeEmpty=!1,Q.includeFrozen=!0,Q.includeMetaData=!0,Q.includeChatNotification=!1,Q.channelUrlsFilter=null,Q.customTypesFilter=null,Q.customTypeStartsWithFilter=null,Q.nicknameContainsFilter=null,Q.nicknameStartsWithFilter=null,Q.nicknameExactMatchFilter=null,Q.channelNameContainsFilter="",Q.myMemberStateFilter=or.ALL,Q.unreadChannelFilter=ha.ALL,Q.superChannelFilter=Zn.ALL,Q.publicChannelFilter=zi.ALL,Q.hiddenChannelFilter=ci.UNHIDDEN,Q.searchFilter={fields:[],query:null},Q.userIdsFilter={userIds:[],includeMode:!0,queryType:ks.AND},Q.metadataKey=null,Q.metadataValues=null,Q.metadataOrderKeyFilter=null,Q.metadataValueStartsWith=null,Q.order=At.LATEST_LAST_MESSAGE,Q.includeEmpty=(i=r.includeEmpty)!==null&&i!==void 0&&i,Q.includeFrozen=(s=r.includeFrozen)===null||s===void 0||s,Q.includeMetaData=(a=r.includeMetaData)===null||a===void 0||a,Q.includeChatNotification=(o=r.includeChatNotification)!==null&&o!==void 0&&o,Q.channelUrlsFilter=(u=r.channelUrlsFilter)!==null&&u!==void 0?u:null,Q.customTypesFilter=(c=r.customTypesFilter)!==null&&c!==void 0?c:null,Q.customTypeStartsWithFilter=(l=r.customTypeStartsWithFilter)!==null&&l!==void 0?l:"",Q.nicknameContainsFilter=(d=r.nicknameContainsFilter)!==null&&d!==void 0?d:null,Q.nicknameStartsWithFilter=(h=r.nicknameStartsWithFilter)!==null&&h!==void 0?h:null,Q.nicknameExactMatchFilter=(f=r.nicknameExactMatchFilter)!==null&&f!==void 0?f:null,Q.channelNameContainsFilter=(p=r.channelNameContainsFilter)!==null&&p!==void 0?p:"",Q.myMemberStateFilter=(_=r.myMemberStateFilter)!==null&&_!==void 0?_:or.ALL,Q.unreadChannelFilter=(m=r.unreadChannelFilter)!==null&&m!==void 0?m:ha.ALL,Q.superChannelFilter=(b=r.superChannelFilter)!==null&&b!==void 0?b:Zn.ALL,Q.publicChannelFilter=(y=r.publicChannelFilter)!==null&&y!==void 0?y:zi.ALL,Q.hiddenChannelFilter=(E=r.hiddenChannelFilter)!==null&&E!==void 0?E:ci.UNHIDDEN,Q.searchFilter=(T=r.searchFilter)!==null&&T!==void 0?T:{fields:[],query:null},Q.userIdsFilter=(N=r.userIdsFilter)!==null&&N!==void 0?N:{userIds:[],includeMode:!0,queryType:ks.AND},Q.metadataKey=(C=r.metadataKey)!==null&&C!==void 0?C:null,Q.metadataValues=(L=r.metadataValues)!==null&&L!==void 0?L:null,Q.metadataOrderKeyFilter=(k=r.metadataOrderKeyFilter)!==null&&k!==void 0?k:null,Q.metadataValueStartsWith=(O=r.metadataValueStartsWith)!==null&&O!==void 0?O:null,Q.order=(x=r.order)!==null&&x!==void 0?x:At.LATEST_LAST_MESSAGE,r.createdAfter&&(Q.createdAfter=r.createdAfter),r.createdBefore&&(Q.createdBefore=r.createdBefore),Q}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&R("boolean",this.includeEmpty)&&R("boolean",this.includeFrozen)&&R("boolean",this.includeMetaData)&&R("string",this.channelNameContainsFilter)&&Ae("string",this.channelUrlsFilter,!0)&&Ae("string",this.customTypesFilter,!0)&&R("string",this.customTypeStartsWithFilter)&&R("string",this.nicknameContainsFilter,!0)&&R("string",this.nicknameStartsWithFilter,!0)&&R("string",this.nicknameExactMatchFilter,!0)&&be(or,this.myMemberStateFilter)&&be(Zn,this.superChannelFilter)&&be(zi,this.publicChannelFilter)&&be(ha,this.unreadChannelFilter)&&be(ci,this.hiddenChannelFilter)&&Ae($c,this.searchFilter.fields)&&R("string",this.searchFilter.query,!0)&&Ae("string",this.userIdsFilter.userIds)&&R("boolean",this.userIdsFilter.includeMode)&&be(ks,this.userIdsFilter.queryType)&&be(At,this.order)&&R("string",this.metadataOrderKeyFilter,!0)&&R("string",this.metadataKey,!0)&&Ae("string",this.metadataValues,!0)&&R("string",this.metadataValueStartsWith,!0)&&Nm(this.createdAfter,!0)&&Nm(this.createdBefore,!0)},t.prototype.serialize=function(){return Xc(this)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i;return v(this,function(s){switch(s.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Wt.of(this._iid).getMyGroupChannels(this._token,oe(A({},this)),this.limit)]):[3,2]:[3,5];case 1:return e=s.sent(),r=e.channels,i=e.token,this._token=i,this._hasNext=!!i,this._isLoading=!1,[2,r];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(Ta),sA=function(n){function t(e,r,i){var s,a=this;return(a=n.call(this,e,"SYEV",i)||this).pinnedMessageIds=[],a.latestPinnedMessage=null,a.ts=0,i.data&&(a.pinnedMessageIds=(s=i.data.pinned_message_ids)!==null&&s!==void 0?s:[],a.latestPinnedMessage=i.data.latest_pinned_message?$n(e,A({},i.data.latest_pinned_message)):null),a.ts=i.ts,a}return w(t,n),t}(it),aA=function(n){function t(e){var r=e.channelUrl;return n.call(this,{code:"READ",ackRequired:!0,payload:{channel_url:r}})||this}return w(t,n),t}(Yn);(function(n){function t(e){var r=n.call(this)||this,i=e.channelUrl,s=e.channelType,a=e.userId,o=e.notificationIds;return r.method=j.PUT,r.path="".concat(Le(s),"/").concat(encodeURIComponent(i),"/messages/mark_as_read"),r.params=re(oe({user_id:encodeURIComponent(a),message_ids:o})),r}return w(t,n),t})(K);var hE=function(n){function t(e,r,i){var s=n.call(this,e,"READ",i)||this;return s.readStatus=new oE(e,i),s}return w(t,n),t}(it);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.readAt=r.ts,i.unreadMessageCount=r.unread_message_count,i}return w(t,n),t})(W);var oA=function(n){function t(e){var r=e.channelUrl,i=e.userId,s=n.call(this)||this;return s.method=j.PUT,s.path="".concat(Mn,"/").concat(encodeURIComponent(r),"/messages/mark_as_delivered"),s.params=re({userId:i}),s}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var _s,uA=function(n){function t(e,r,i){var s=n.call(this,e,"DLVR",i)||this;return s.channelUrl=i.channel_url,s.deliveredStateUpdate=i.updated,s}return w(t,n),t}(it),Pi=function(){function n(t){var e=t.top,r=e===void 0?Number.MAX_SAFE_INTEGER:e,i=t.bottom,s=i===void 0?0:i;this.top=r,this.bottom=s}return n.prototype.includes=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.every(function(i){return t.top<=i&&i<=t.bottom})},n.prototype.overlap=function(t){return this.includes(t.top)||this.includes(t.bottom)},n.prototype.intersect=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.some(function(i){return t.top<=i&&i<=t.bottom})},n.prototype.extends=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.top=Math.min.apply(Math,ce([this.top],ie(t),!1)),this.bottom=Math.max.apply(Math,ce([this.bottom],ie(t),!1))},n}(),Da={},Wt=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,A(A({},r),{channelType:xe.GROUP}))||this)._leftChannels=new Map,s._disableMack=!1,s._markAsReadAllLastSentAt=0,s._disableMack=(i=r.disableMack)!==null&&i!==void 0&&i,s._groupChannelHandlers=new Map,s._groupChannelCache=new gN(s._iid,{sdkState:r.sdkState,cacheContext:r.cacheContext}),s._groupChannelBroadcast=new wN({dispatcher:r.dispatcher,groupChannelCache:s._groupChannelCache,messageCache:Yo.of(s._iid),unsentMessageCache:vo.of(s._iid)}),setInterval(function(){var a,o,u=function(d){d.invalidateTypingStatus()&&(s._dispatcher.dispatch(new Ne({channels:[d],source:z.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),s._groupChannelHandlers.forEach(function(h){h.onTypingStatusUpdated&&h.onTypingStatusUpdated(d)}))};try{for(var c=Z(s._groupChannelCache.channels),l=c.next();!l.done;l=c.next())u(l.value)}catch(d){a={error:d}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(a)throw a.error}}},1e3),s._dispatcher.on(function(a){a instanceof it?s._handleEvent(a).catch(function(o){if(ar(o)&&s._sdkState.appState==="foreground")throw o}):a instanceof tE?g(s,void 0,void 0,function(){var o,u;return v(this,function(c){switch(c.label){case 0:return o=a.message,[4,this.getChannel(o.channelUrl,!0)];case 1:return u=c.sent(),o instanceof _n?u._autoResendUserMessage(o):o instanceof qt&&u._autoResendFileMessage(o),[2]}})}):a instanceof rE&&s.reduceDBSize()}),Da[e]||(Da[e]=s),s}return w(t,n),Object.defineProperty(t.prototype,"_messageCache",{get:function(){return Yo.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return vo.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e){return Da[e]||(Da[e]=new t(e,M.of(e))),Da[e]},t.clear=function(e){Da[e]&&delete Da[e]},Object.defineProperty(t.prototype,"handlers",{get:function(){return ce([],ie(this._groupChannelHandlers.values()),!1)},enumerable:!1,configurable:!0}),t.prototype.buildGroupChannelFromSerializedData=function(e){var r=ro(e);return new Nr(this._iid,Nr.payloadify(r))},t.prototype.buildGroupChannelListQueryFromSerializedData=function(e){var r=ro(e);return new dE(this._iid,r)},t.prototype.buildMemberFromSerializedData=function(e){var r=ro(e);return new Tr(this._iid,Tr.payloadify(r))},t.prototype.getChannelFromCache=function(e){var r;return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this._groupChannelCache.get(e)];case 1:return[2,(r=i.sent())!==null&&r!==void 0?r:null]}})})},t.prototype.getChannelsFromCache=function(e,r,i,s,a){return g(this,void 0,void 0,function(){return v(this,function(o){switch(o.label){case 0:return[4,this._groupChannelCache.fetch({token:e,filter:r,order:i,limit:s,borderlineChannelUrl:a})];case 1:return[2,o.sent()]}})})},t.prototype.upsertChannelsToCache=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._groupChannelCache.upsert(e)];case 1:return[2,r.sent()]}})})},t.prototype.removeChannelsFromCache=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._groupChannelCache.remove(e)];case 1:return r.sent(),[2]}})})},t.prototype.clearChannelsFromCache=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this._groupChannelCache.clear()];case 1:return e.sent(),[2]}})})},t.prototype.reduceDBSize=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h,f,p,_,m;return v(this,function(b){switch(b.label){case 0:return e=Yo.of(this._iid),r=M.of(this._iid).cacheContext,i=r.localCacheConfig,s=r.nestdb,r.localCacheEnabled&&s&&s.state==Mi.OPENED?(a=1024*i.maxSize*1024,[4,s.estimateUsage()]):[2];case 1:if((o=b.sent())<a)return[2];u=[],c=this._groupChannelCache.channels,l={},p=0,b.label=2;case 2:return p<c.length?[4,this.getMessagesFromCache(c[p].url,0,"prev",new Us)]:[3,5];case 3:d=b.sent(),l[c[p].url]=JSON.stringify(d).length,h=new zT({channel:c[p],cachedMessageCount:d.length}),u.push(h),b.label=4;case 4:return p++,[3,2];case 5:f=u.sort(i.clearOrderComparator),p=0,b.label=6;case 6:return p<f.length?[4,e.removeMessagesOfChannel(f[p].channel.url)]:[3,10];case 7:return b.sent(),[4,e._getGroupChannelPreferenceSize(f[p].channel.url)];case 8:if(_=b.sent(),m=l[f[p].channel.url]+_,(o-=m)<a)return[3,10];b.label=9;case 9:return p++,[3,6];case 10:return[2]}})})},t.prototype._handleEvent=function(e){var r,i;return g(this,void 0,void 0,function(){var s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k,O,x,Q,we,Ie,ze,$t,Gt,cr,qs,Ze,$s,ot,Yi,ht,Xn,er,Or,Zi,Ji,Hs,zn,bn,Zr,Jr,lr,Xr,Et,Mr,Tu,Be,Dn,Ei,Xi,es,ko,Ia,Rt,Sa,Ca,ts,zs,dr,bi,ns,Na,wu,ei,Gs,tr,Ut,rs,Iu,Vs,Ti,Oo,Rn,Aa,Dr,ti,hl,Rr,Bs,Mo,Su,is,ss,Un,js,as,Ur,ka,Do,Ee,q,te,pe,et,Vt,Ht,rn,ni,os,cn,Ro,Uo,Ph,wi,fl,Cu,Nu,Au,Oa,pl,_l,ml,vl,Ks,gl,dm,hm,fm,xh,Fh,qh,yl,El,$h,Hh,pm,zh,_m,Gh,mm,Vh,vm,Bh,gm,Ge=this;return v(this,function(Me){switch(Me.label){case 0:switch(Me.trys.push([0,80,,81]),e.code){case"MESG":case"FILE":case"ADMM":case"BRDM":return[3,1];case"MEDI":case"FEDI":case"AEDI":return[3,4];case"DELM":return[3,7];case"READ":return[3,10];case"DLVR":return[3,13];case"MRCT":return[3,15];case"MTHD":return[3,19];case"MCNT":return[3,23];case"PEDI":return[3,32];case"VOTE":return[3,35];case"SYEV":return[3,38];case"USEV":return[3,78]}return[3,79];case 1:return h=null,e.code==="MESG"?h=e.as(By):e.code==="FILE"?h=e.as(xy):e.code!=="ADMM"&&e.code!="BRDM"||(h=e.as(hN)),h?(s=h.message,a=h.isMentioned,o=h.forceUpdateLastMessage,s.channelType!==xe.GROUP?[3,3]:(this._disableMack||Tt(function(){return g(Ge,void 0,void 0,function(){var V;return v(this,function(F){return V=new iA(s),this._requestQueue.send(V),[2]})})}),Ie=this._groupChannelCache.isCachedInMemory(s.channelUrl),m=s instanceof kt&&s.sender.userId===this._sdkState.userId,[4,this.getChannel(s.channelUrl,!0)])):[3,3];case 2:if((u=Me.sent()).hiddenState===Cn.HIDDEN_ALLOW_AUTO_UNHIDE&&(u.hiddenState=Cn.UNHIDDEN),s instanceof kt){c=M.of(this._iid).useMemberInfoInMessage;try{for(l=Z(u.members),d=l.next();!d.done;d=l.next())if((Ur=d.value).userId===s.sender.userId){c||(s.sender.nickname=Ur.nickname,s.sender.plainProfileUrl=Ur.plainProfileUrl,s.sender.metaData=Ur.metaData,s.sender.isBlockedByMe=Ur.isBlockedByMe);break}}catch(V){Hh={error:V}}finally{try{d&&!d.done&&(pm=l.return)&&pm.call(l)}finally{if(Hh)throw Hh.error}}!c&&a&&((r=s.mentionedUsers)===null||r===void 0||r.forEach(function(V){var F,ge;try{for(var ue=Z(u.members),ye=ue.next();!ye.done;ye=ue.next()){var It=ye.value;if(V.userId===It.userId){V.nickname=It.nickname,V.plainProfileUrl=It.plainProfileUrl,V.metaData=It.metaData;break}}}catch(je){F={error:je}}finally{try{ye&&!ye.done&&(ge=ue.return)&&ge.call(ue)}finally{if(F)throw F.error}}})),m&&(E=this._sessionManager.currentUser)&&(E.nickname=s.sender.nickname,E.plainProfileUrl=s.sender.plainProfileUrl,E.metaData=s.sender.metaData)}s.silent&&!m||(u.isEphemeral||Ie)&&(u._updateLastMessage(s),m||u._updateUnreadCount(u.unreadMessageCount+1,u.unreadMentionCount+(a?1:0))),o&&u._updateLastMessage(s),this._dispatcher.dispatch(new Ne({channels:[u],source:z.EVENT_MESSAGE_RECEIVED})),s.silent&&!m||le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onChannelChanged&&ge.onChannelChanged(u)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),this._dispatcher.dispatch(new mt({messages:[s],source:z.EVENT_MESSAGE_RECEIVED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onMessageReceived&&ge.onMessageReceived(u,s),a&&ge.onMentionReceived&&ge.onMentionReceived(u,s)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),Me.label=3;case 3:return[3,79];case 4:return h=null,e.code==="MEDI"?h=e.as(Np):e.code==="FEDI"?h=e.as(Ap):e.code==="AEDI"&&(h=e.as(fN)),h?(f=h.message,p=h.mentionCountChange,f.channelType!==xe.GROUP?[3,6]:(Ie=this._groupChannelCache.isCachedInMemory(f.channelUrl),[4,this.getChannel(f.channelUrl,!0)])):[3,6];case 5:_=Me.sent(),m=f instanceof kt&&f.sender.userId===this._sdkState.userId,b=!1,m?(y=f.sender,(E=this._sessionManager.currentUser)&&(E.nickname=y.nickname,E.plainProfileUrl=y.plainProfileUrl,E.metaData=y.metaData)):_.isReadMessage(f)||p!==0&&!f.silent&&Ie&&(_._updateUnreadCount(_.unreadMessageCount,_.unreadMentionCount+p),b=!0),_._updateLastMessage(f)?b=!0:!((i=_.lastMessage)===null||i===void 0)&&i.isIdentical(f)&&(Ie?_._updateLastMessage(f)&&(b=!0):b=!0),T=!1,_.lastPinnedMessage&&_.lastPinnedMessage.messageId===f.messageId&&(_.lastPinnedMessage=f,b=!0,T=!0),b&&(this._dispatcher.dispatch(new Ne({channels:[_],source:T?z.EVENT_PINNED_MESSAGE_UPDATED:z.EVENT_MESSAGE_UPDATED})),f.silent&&!m||le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onChannelChanged&&ge.onChannelChanged(_)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),T&&le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onPinnedMessageUpdated&&ge.onPinnedMessageUpdated(_)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})})),this._dispatcher.dispatch(new mt({messages:[f],source:z.EVENT_MESSAGE_UPDATED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onMessageUpdated&&ge.onMessageUpdated(_,f),p>0&&ge.onMentionReceived&&ge.onMentionReceived(_,f)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),Me.label=6;case 6:return[3,79];case 7:return N=e.as(j1),Et=N.channelUrl,Mr=N.channelType,C=N.messageId,Mr!==xe.GROUP?[3,9]:[4,this.getChannel(Et,!0)];case 8:L=Me.sent(),this._dispatcher.dispatch(new N_({messageIds:[C],source:z.EVENT_MESSAGE_DELETED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onMessageDeleted&&ge.onMessageDeleted(L,C)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),Me.label=9;case 9:return[3,79];case 10:return(k=e.as(hE).readStatus).channelType!==xe.GROUP?[3,12]:(Ie=this._groupChannelCache.isCachedInMemory(k.channelUrl),[4,this.getChannel(k.channelUrl,!0)]);case 11:O=Me.sent(),Ie&&O._updateUnreadMemberState(k.reader.userId,k.readAt),k.reader.userId===this._sdkState.userId?Ie?(O.unreadMessageCount>0||O.unreadMentionCount>0)&&(O._updateUnreadCount(0,0),this._dispatcher.dispatch(new Ne({channels:[O],source:z.EVENT_CHANNEL_READ})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onChannelChanged&&ge.onChannelChanged(O)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})})):O.unreadMessageCount!==0&&O.unreadMentionCount!==0||(this._dispatcher.dispatch(new Ne({channels:[O],source:z.EVENT_CHANNEL_READ})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onChannelChanged&&ge.onChannelChanged(O)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})})):(this._dispatcher.dispatch(new Ne({channels:[O],source:z.EVENT_CHANNEL_READ})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onUnreadMemberStatusUpdated&&ge.onUnreadMemberStatusUpdated(O)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})})),Me.label=12;case 12:return[3,79];case 13:return x=e.as(uA),Et=x.channelUrl,Q=x.deliveredStateUpdate,we=Q===void 0?{}:Q,Ie=this._groupChannelCache.isCachedInMemory(Et),[4,this.getChannel(Et,!0)];case 14:if(ze=Me.sent(),Ie)for($t in we)ze._updateUndeliveredMemberState($t,we[$t]);return Object.keys(we).some(function(V){return V!==Ge._sdkState.userId})&&(this._dispatcher.dispatch(new Ne({channels:[ze],source:z.EVENT_CHANNEL_DELIVERED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onUndeliveredMemberStatusUpdated&&ge.onUndeliveredMemberStatusUpdated(ze)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})})),[3,79];case 15:return Gt=e.as(pN),Et=Gt.channelUrl,Mr=Gt.channelType,cr=Gt.event,Mr!==xe.GROUP?[3,18]:[4,this.getChannel(Et,!0)];case 16:return qs=Me.sent(),[4,this.getMessageFromCache(cr.messageId)];case 17:(ot=Me.sent())?ot instanceof Nn&&(ot.applyReactionEvent(cr),this._dispatcher.dispatch(new mt({messages:[ot],source:z.EVENT_MESSAGE_REACTION_UPDATED}))):this._dispatcher.dispatch(new Iy({event:cr,source:z.EVENT_MESSAGE_REACTION_UPDATED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onReactionUpdated&&ge.onReactionUpdated(qs,cr)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),Me.label=18;case 18:return[3,79];case 19:return(Ze=e.as(_N).event).channelType!==xe.GROUP?[3,22]:[4,this.getChannel(Ze.channelUrl,!0)];case 20:return $s=Me.sent(),[4,this.getMessageFromCache(Ze.targetMessageId)];case 21:(ot=Me.sent())?ot instanceof Nn&&(ot.applyThreadInfoUpdateEvent(Ze),this._dispatcher.dispatch(new mt({messages:[ot],source:z.EVENT_MESSAGE_THREADINFO_UPDATED}))):this._dispatcher.dispatch(new Sy({event:Ze,source:z.EVENT_MESSAGE_THREADINFO_UPDATED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onThreadInfoUpdated&&ge.onThreadInfoUpdated($s,Ze)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),Me.label=22;case 22:return[3,79];case 23:Yi=e.as(mN).groupChannelMemberCounts,ht=[],Me.label=24;case 24:Me.trys.push([24,29,30,31]),Xn=Z(Yi),er=Xn.next(),Me.label=25;case 25:return er.done?[3,28]:(Or=er.value,Et=Or.channelUrl,Dr=Or.memberCount,ti=Or.joinedMemberCount,Zi=Or.updatedAt,[4,this.getChannelFromCache(Et)]);case 26:(Ji=Me.sent())&&Ji._setLatestMemberCount(Dr,ti,Zi)&&ht.push(Ji),Me.label=27;case 27:return er=Xn.next(),[3,25];case 28:return[3,31];case 29:return Hs=Me.sent(),zh={error:Hs},[3,31];case 30:try{er&&!er.done&&(_m=Xn.return)&&_m.call(Xn)}finally{if(zh)throw zh.error}return[7];case 31:return ht.length>0&&(this._dispatcher.dispatch(new Ne({channels:ht,source:z.EVENT_CHANNEL_MEMBER_COUNT_UPDATED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onChannelMemberCountChanged&&ge.onChannelMemberCountChanged(ht)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})})),[3,79];case 32:return zn=e.as(vN),bn=zn.event,Zr=zn.status,Et=zn.channelUrl,Mr=zn.channelType,Et&&Mr===xe.GROUP?[4,this.getChannel(Et,!0)]:[3,34];case 33:Jr=Me.sent(),this._dispatcher.dispatch(new Ay({event:bn,source:z.EVENT_POLL_UPDATED})),le(Zr===SI?function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onPollDeleted&&ge.onPollDeleted(Jr,bn.pollId)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}:function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onPollUpdated&&ge.onPollUpdated(Jr,bn)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),Me.label=34;case 34:return[3,79];case 35:return lr=e.as(Ky),Xr=lr.event,Et=lr.channelUrl,Mr=lr.channelType,Et&&Mr===xe.GROUP?[4,this.getChannel(Et,!0)]:[3,37];case 36:Tu=Me.sent(),this._dispatcher.dispatch(new A_({event:Xr,source:z.EVENT_POLL_VOTED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onPollVoted&&ge.onPollVoted(Tu,Xr)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),Me.label=37;case 37:return[3,79];case 38:if(!(Be=e.as(hu).event).isGroupChannelEvent)return[3,77];switch(Be.category){case xt.CHANNEL_JOIN:return[3,39];case xt.CHANNEL_LEAVE:return[3,41];case xt.CHANNEL_OPERATOR_UPDATE:return[3,45];case xt.CHANNEL_INVITE:return[3,47];case xt.CHANNEL_DECLINE_INVITE:return[3,49];case xt.TYPING_START:case xt.TYPING_END:return[3,51];case xt.USER_CHANNEL_MUTE:case xt.USER_CHANNEL_UNMUTE:return[3,53];case xt.USER_CHANNEL_BAN:return[3,55];case xt.USER_CHANNEL_UNBAN:return[3,59];case xt.CHANNEL_FREEZE:case xt.CHANNEL_UNFREEZE:return[3,61];case xt.CHANNEL_HIDE:return[3,63];case xt.CHANNEL_UNHIDE:return[3,65];case xt.CHANNEL_DELETED:return[3,67];case xt.CHANNEL_PROP_CHANGED:return[3,69];case xt.CHANNEL_META_DATA_CHANGED:return[3,71];case xt.CHANNEL_META_COUNTERS_CHANGED:return[3,73];case xt.PINNED_MESSAGE_CHANGED:return[3,75]}return[3,77];case 39:return[4,this.getChannel(Be.channelUrl,!0)];case 40:return Dn=Me.sent(),Ei=e.as(GN),Xi=Ei.memberCount,es=Ei.joinedMemberCount,ko=Ei.members,Ia=!1,ko.forEach(function(V){Dn.isExclusive||Dn.isSuper||Dn.isBroadcast?Ia=Ia||Dn._setLatestMemberCount(Xi,es,Be.ts):(V.state=Nt.JOINED,Dn.addMember(V,Be.ts),Ge._updateJoinedMemberCount(Dn)),V.userId===Ge._sdkState.userId&&(Dn.myMemberState=Nt.JOINED)}),this._dispatcher.dispatch(new Ne({channels:[Dn],source:z.EVENT_CHANNEL_JOINED})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){var ge,ue;try{for(var ye=Z(ko),It=ye.next();!It.done;It=ye.next()){var je=It.value;F.onUserJoined&&F.onUserJoined(Dn,je)}}catch(hT){ge={error:hT}}finally{try{It&&!It.done&&(ue=ye.return)&&ue.call(ye)}finally{if(ge)throw ge.error}}Dn.isBroadcast&&Ia&&F.onChannelMemberCountChanged&&F.onChannelMemberCountChanged([Dn])}),[2]})})}),[3,77];case 41:return(ka=this._leftChannels.get(Be.channelUrl))?(Sa=ka.channel,[3,44]):[3,42];case 42:return[4,this.getChannel(Be.channelUrl,!0)];case 43:Sa=Me.sent(),Me.label=44;case 44:return Rt=Sa,Ca=e.as(BN),Dr=Ca.memberCount,ti=Ca.joinedMemberCount,ts=Ca.member,zs=!1,dr=M.of(this._iid).appInfo,Rt.isExclusive||Rt.isSuper||Rt.isBroadcast?zs=Rt._setLatestMemberCount(Dr,ti,Be.ts):(dr!=null&&dr.enabledChannelMemberShipHistory?((bi=Rt.members.find(function(V){return V.userId===bi.userId}))&&(bi.state=Nt.LEFT),Rt.memberCount=Dr):Rt.removeMember(ts),this._updateJoinedMemberCount(Rt)),ts.userId===this._sdkState.userId?(Rt.myMemberState=Nt.NONE,Rt.invitedAt=0,Rt.joinedAt=0,Rt._updateUnreadCount(0,0),Rt.isPublic?this._dispatcher.dispatch(new Ne({channels:[Rt],source:z.EVENT_CHANNEL_LEFT})):(this._markAsLeave(Rt),this._dispatcher.dispatch(new hs({channelUrls:[Rt.url],source:z.EVENT_CHANNEL_LEFT})))):this._dispatcher.dispatch(new Ne({channels:[Rt],source:z.EVENT_CHANNEL_LEFT})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onUserLeft&&F.onUserLeft(Rt,ts),Rt.isBroadcast&&zs&&F.onChannelMemberCountChanged&&F.onChannelMemberCountChanged([Rt])}),[2]})})}),[3,77];case 45:return[4,this.getChannel(Be.channelUrl,!0)];case 46:ns=Me.sent(),Na=e.as(lN).operators,wu=Na.map(function(V){return V.userId});try{for(ei=Z(ns.members),Gs=ei.next();!Gs.done;Gs=ei.next())(Ur=Gs.value).role=wu.includes(Ur.userId)?Gr.OPERATOR:Gr.NONE}catch(V){Gh={error:V}}finally{try{Gs&&!Gs.done&&(mm=ei.return)&&mm.call(ei)}finally{if(Gh)throw Gh.error}}return ns.myRole=wu.includes(this._sdkState.userId)?Gr.OPERATOR:Gr.NONE,this._dispatcher.dispatch(new Ne({channels:[ns],source:z.EVENT_CHANNEL_OPERATOR_UPDATED})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onOperatorUpdated&&F.onOperatorUpdated(ns,Na)}),[2]})})}),[3,77];case 47:return[4,this.getChannel(Be.channelUrl,!0)];case 48:tr=Me.sent(),Ut=e.as(QN),Dr=Ut.memberCount,ti=Ut.joinedMemberCount,rs=Ut.inviter,(Iu=Ut.invitees).forEach(function(V){return V.state=Nt.INVITED});try{for(Vs=Z(Iu),Ti=Vs.next();!Ti.done;Ti=Vs.next())Oo=Ti.value,tr.isExclusive||tr.isSuper||tr.isBroadcast?tr._setLatestMemberCount(Dr,ti,Be.ts):tr.addMember(Oo,Be.ts),this._sdkState.userId===Oo.userId&&(tr.hiddenState=Cn.UNHIDDEN,tr.myMemberState!==Nt.JOINED&&(tr.myMemberState=Nt.INVITED),tr.invitedAt=Be.ts)}catch(V){Vh={error:V}}finally{try{Ti&&!Ti.done&&(vm=Vs.return)&&vm.call(Vs)}finally{if(Vh)throw Vh.error}}return this._dispatcher.dispatch(new Ne({channels:[tr],source:z.EVENT_CHANNEL_INVITED})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onUserReceivedInvitation&&F.onUserReceivedInvitation(tr,rs,Iu)}),[2]})})}),[3,77];case 49:return[4,this.getChannel(Be.channelUrl,!0)];case 50:return Rn=Me.sent(),Aa=e.as(YN),Dr=Aa.memberCount,ti=Aa.joinedMemberCount,hl=Aa.inviter,Rr=Aa.invitee,Rn.isExclusive||Rn.isSuper||Rn.isBroadcast?Rn._setLatestMemberCount(Dr,ti,Be.ts):Rn.removeMember(Rr),this._sdkState.userId===Rr.userId?(Rn.invitedAt=0,Rn.myMemberState=Nt.NONE,Rn.isPublic?this._dispatcher.dispatch(new Ne({channels:[Rn],source:z.EVENT_CHANNEL_DECLINED_INVITE})):this._dispatcher.dispatch(new hs({channelUrls:[Rn.url],source:z.EVENT_CHANNEL_DECLINED_INVITE}))):this._dispatcher.dispatch(new Ne({channels:[Rn],source:z.EVENT_CHANNEL_DECLINED_INVITE})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onUserDeclinedInvitation&&F.onUserDeclinedInvitation(Rn,hl,Rr)}),[2]})})}),[3,77];case 51:return[4,this.getChannel(Be.channelUrl,!0)];case 52:return Bs=Me.sent(),Mo=Be.category===xt.TYPING_START,Su=e.as(Mo?tA:rA).user,Bs._updateTypingStatus(Su,Mo?Be.ts:0),this._dispatcher.dispatch(new Ne({channels:[Bs],source:z.EVENT_CHANNEL_TYPING_STATUS_UPDATE})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onTypingStatusUpdated&&F.onTypingStatusUpdated(Bs)}),[2]})})}),[3,77];case 53:return[4,this.getChannel(Be.channelUrl,!0)];case 54:is=Me.sent(),ss=Be.category===xt.USER_CHANNEL_MUTE,(Un=e.as(ss?R1:L1).user).userId===this._sdkState.userId&&(is.myMutedState=ss?Ri.MUTED:Ri.UNMUTED,is._myMutedRemainingTime=Un.restrictionInfo.remainingDuration);try{for(js=Z(is.members),as=js.next();!as.done;as=js.next())if((Ur=as.value).userId===Un.userId){Ur.isMuted=ss;break}}catch(V){Bh={error:V}}finally{try{as&&!as.done&&(gm=js.return)&&gm.call(js)}finally{if(Bh)throw Bh.error}}return this._dispatcher.dispatch(new Ne({channels:[is],source:ss?z.EVENT_CHANNEL_MUTED:z.EVENT_CHANNEL_UNMUTED,data:Un.userId})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){ss?F.onUserMuted&&F.onUserMuted(is,Un):F.onUserUnmuted&&F.onUserUnmuted(is,Un)}),[2]})})}),[3,77];case 55:return(ka=this._leftChannels.get(Be.channelUrl))?(Ee=ka.channel,[3,58]):[3,56];case 56:return[4,this.getChannel(Be.channelUrl,!0)];case 57:Ee=Me.sent(),Me.label=58;case 58:return Do=Ee,this._markAsLeave(Do),q=e.as(x1).user,q.userId===this._sdkState.userId&&this._dispatcher.dispatch(new hs({channelUrls:[Do.url],source:z.EVENT_CHANNEL_BANNED})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onUserBanned&&F.onUserBanned(Do,q)}),[2]})})}),[3,77];case 59:return[4,this.getChannel(Be.channelUrl,!0)];case 60:return te=Me.sent(),pe=e.as(q1).user,pe.userId===this._sdkState.userId&&this._dispatcher.dispatch(new hs({channelUrls:[te.url],source:z.EVENT_CHANNEL_UNBANNED})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onUserUnbanned&&F.onUserUnbanned(te,pe)}),[2]})})}),[3,77];case 61:return[4,this.getChannel(Be.channelUrl,!0)];case 62:return et=Me.sent(),Vt=e.as($1).freeze,et.isFrozen=Vt,this._dispatcher.dispatch(new Ne({channels:[et],source:Vt?z.EVENT_CHANNEL_FROZEN:z.EVENT_CHANNEL_UNFROZEN})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){Vt?F.onChannelFrozen&&F.onChannelFrozen(et):F.onChannelUnfrozen&&F.onChannelUnfrozen(et)}),[2]})})}),[3,77];case 63:return[4,this.getChannel(Be.channelUrl,!0)];case 64:return Ht=Me.sent(),rn=e.as(XN),ni=rn.allowAutoUnhide,os=rn.hidePreviousMessages,cn=rn.messageOffsetTimestamp,ni!==null&&(Ht.hiddenState=ni?Cn.HIDDEN_ALLOW_AUTO_UNHIDE:Cn.HIDDEN_PREVENT_AUTO_UNHIDE),os!==null&&os&&Ht._updateUnreadCount(0,0),cn!==null&&(Ht.messageOffsetTimestamp=cn),this._dispatcher.dispatch(new Ne({channels:[Ht],source:z.EVENT_CHANNEL_HIDDEN})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onChannelHidden&&F.onChannelHidden(Ht)}),[2]})})}),[3,77];case 65:return[4,this.getChannel(Be.channelUrl,!0)];case 66:return(Ro=Me.sent()).hiddenState=Cn.UNHIDDEN,this._dispatcher.dispatch(new Ne({channels:[Ro],source:z.EVENT_CHANNEL_UNHIDDEN})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onChannelChanged&&F.onChannelChanged(Ro)}),[2]})})}),[3,77];case 67:return[4,this.getChannel(Be.channelUrl,!0)];case 68:return Uo=Me.sent(),this._dispatcher.dispatch(new hs({channelUrls:[Be.channelUrl],source:z.EVENT_CHANNEL_DELETED})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onChannelDeleted&&F.onChannelDeleted(Uo.url,Uo.channelType)}),[2]})})}),[3,77];case 69:return[4,this.getChannelWithoutCache(Be.channelUrl,!0)];case 70:return Ph=Me.sent(),this._dispatcher.dispatch(new Ne({channels:[Ph],source:z.EVENT_CHANNEL_UPDATED})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onChannelChanged&&F.onChannelChanged(Ph)}),[2]})})}),[3,77];case 71:return[4,this.getChannel(Be.channelUrl,!0)];case 72:return wi=Me.sent(),fl=e.as(T1),Cu=fl.created,Nu=fl.updated,Au=fl.deleted,Cu&&(wi._upsertCachedMetaData(Cu,Be.ts),this._dispatcher.dispatch(new Ne({channels:[wi],source:z.EVENT_CHANNEL_METADATA_CREATED}))),Nu&&(wi._upsertCachedMetaData(Nu,Be.ts),this._dispatcher.dispatch(new Ne({channels:[wi],source:z.EVENT_CHANNEL_METADATA_UPDATED}))),Au&&(wi._removeFromCachedMetaData(Au,Be.ts),this._dispatcher.dispatch(new Ne({channels:[wi],source:z.EVENT_CHANNEL_METADATA_DELETED}))),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){Cu&&F.onMetaDataCreated&&F.onMetaDataCreated(wi,Cu),Nu&&F.onMetaDataUpdated&&F.onMetaDataUpdated(wi,Nu),Au&&F.onMetaDataDeleted&&F.onMetaDataDeleted(wi,Au)}),[2]})})}),[3,77];case 73:return[4,this.getChannel(Be.channelUrl,!0)];case 74:return Oa=Me.sent(),pl=e.as(k1),_l=pl.created,ml=pl.updated,vl=pl.deleted,_l&&this._dispatcher.dispatch(new Ne({channels:[Oa],source:z.EVENT_CHANNEL_METACOUNTER_CREATED})),ml&&this._dispatcher.dispatch(new Ne({channels:[Oa],source:z.EVENT_CHANNEL_METACOUNTER_UPDATED})),vl&&this._dispatcher.dispatch(new Ne({channels:[Oa],source:z.EVENT_CHANNEL_METACOUNTER_DELETED})),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){_l&&F.onMetaCounterCreated&&F.onMetaCounterCreated(Oa,_l),ml&&F.onMetaCounterUpdated&&F.onMetaCounterUpdated(Oa,ml),vl&&F.onMetaCounterDeleted&&F.onMetaCounterDeleted(Oa,vl)}),[2]})})}),[3,77];case 75:return[4,this.getChannel(Be.channelUrl,!0)];case 76:return Ks=Me.sent(),gl=e.as(sA),dm=gl.pinnedMessageIds,hm=gl.latestPinnedMessage,(fm=gl.ts)>Ks._pinnedMessagesUpdatedAt&&(Ks.pinnedMessageIds=dm,Ks.lastPinnedMessage=hm,Ks._pinnedMessagesUpdatedAt=fm,this._dispatcher.dispatch(new Ne({channels:[Ks],source:z.EVENT_PINNED_MESSAGE_UPDATED})),le(function(){return g(Ge,void 0,void 0,function(){var V,F,ge,ue,ye;return v(this,function(It){try{for(V=Z(this._groupChannelHandlers.values()),F=V.next();!F.done;F=V.next())(ge=F.value).onChannelChanged&&ge.onChannelChanged(Ks)}catch(je){ue={error:je}}finally{try{F&&!F.done&&(ye=V.return)&&ye.call(V)}finally{if(ue)throw ue.error}}return[2]})})}),le(function(){return g(Ge,void 0,void 0,function(){return v(this,function(V){return this._groupChannelHandlers.forEach(function(F){F.onPinnedMessageUpdated&&F.onPinnedMessageUpdated(Ks)}),[2]})})})),[3,77];case 77:return[3,79];case 78:switch((xh=e.as(iE).event).category){case qc.USER_BLOCK:Fh=Hd.getDataAsUserBlockEvent(this._iid,xh),yl=Fh.blocker,El=Fh.blockee,this._groupChannelCache.block(yl.userId,El.userId);break;case qc.USER_UNBLOCK:qh=Hd.getDataAsUserBlockEvent(this._iid,xh),yl=qh.blocker,El=qh.blockee,this._groupChannelCache.unblock(yl.userId,El.userId)}return[3,79];case 79:return[3,81];case 80:if($h=Me.sent(),ar($h))throw $h;return[3,81];case 81:return[2]}})})},t.prototype._markAsLeave=function(e){var r,i=this,s=(r=this._leftChannels.get(e.url))!==null&&r!==void 0?r:{channel:e,ref:0};s.ref++,this._leftChannels.set(e.url,s),setTimeout(function(){s.ref--,s.ref===0&&i._leftChannels.delete(e.url)},1e4)},t.prototype.addHandler=function(e,r){this._groupChannelHandlers.set(e,r)},t.prototype.removeHandler=function(e){this._groupChannelHandlers.delete(e)},t.prototype.clearHandler=function(){this._groupChannelHandlers.clear()},t.prototype.subscribeChannelEvent=function(e,r){this._groupChannelBroadcast.subscribe(e,r)},t.prototype.unsubscribeChannelEvent=function(e){this._groupChannelBroadcast.unsubscribe(e)},t.prototype._updateJoinedMemberCount=function(e){e.joinedMemberCount=e.members.filter(function(r){return r.state===Nt.JOINED}).length},t.prototype.getChannel=function(e,r){return r===void 0&&(r=!1),g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:B(R("string",e)).throw(U.invalidParameters),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.getChannelFromCache(e)];case 2:return(i=s.sent())?[2,i]:[3,4];case 3:return s.sent(),[3,4];case 4:return[4,this.getChannelWithoutCache(e,r)];case 5:return[2,s.sent()]}})})},t.prototype.getChannelWithoutCache=function(e,r){return r===void 0&&(r=!1),g(this,void 0,void 0,function(){var i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return B(R("string",e)).throw(U.invalidParameters),i=new Pp({channelUrl:e,isInternalCall:r}),[4,this._requestQueue.send(i)];case 1:switch(s=c.sent(),a=s.as(xp).channel,o=a.unreadMessageCount,u=a.unreadMentionCount,a.myCountPreference){case vr.UNREAD_MESSAGE_COUNT_ONLY:u=0;break;case vr.UNREAD_MENTION_COUNT_ONLY:o=0;break;case vr.OFF:o=0,u=0}return a._updateUnreadCount(o,u),[4,this.upsertChannelsToCache([a])];case 2:return[2,c.sent()[0]]}})})},t.prototype.refreshChannel=function(e,r,i){return r===void 0&&(r=!0),i===void 0&&(i=z.REFRESH_CHANNEL),g(this,void 0,void 0,function(){var s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return l.trys.push([0,5,,6]),s=new Pp({channelUrl:e,isInternalCall:r}),[4,this._requestQueue.send(s)];case 1:return a=l.sent(),(o=a.as(xp).channel).myMemberState!==Nt.NONE?[3,2]:(this._dispatcher.dispatch(new hs({channelUrls:[o.url],source:i})),[3,4]);case 2:return[4,this.upsertChannelsToCache([o])];case 3:u=l.sent(),this._dispatcher.dispatch(new Ne({channels:u,source:i})),l.label=4;case 4:return[3,6];case 5:return(c=l.sent()).code!==ae.NON_AUTHORIZED&&c.code!==ae.NOT_FOUND_IN_DATABASE||this._dispatcher.dispatch(new hs({channelUrls:[e],source:i})),[3,6];case 6:return[2]}})})},t.prototype.getMyGroupChannels=function(e,r,i,s){return s===void 0&&(s=z.REQUEST_CHANNEL),g(this,void 0,void 0,function(){var a,o,u,c,l;return v(this,function(d){switch(d.label){case 0:return r.createdAfter&&(r.createdAfter=Math.floor(r.createdAfter/1e3)),r.createdBefore&&(r.createdBefore=Math.floor(r.createdBefore/1e3)),a=new CN(A(A({},r),{userId:this._sdkState.userId,token:e,limit:i})),[4,this._requestQueue.send(a)];case 1:return o=d.sent(),u=o.as(NN),c=u.channels,l=u.token,this._dispatcher.dispatch(new Ne({channels:c,source:s})),[2,{channels:c,token:l}]}})})},t.prototype.getMyGroupChannelChangeLogs=function(e,r,i){return i===void 0&&(i=z.REQUEST_CHANNEL_CHANGELOGS),g(this,void 0,void 0,function(){var s,a,o,u,c,l,d,h;return v(this,function(f){switch(f.label){case 0:return s=A(A({},Gd),r),B((R("string",e)||R("number",e))&&Lp(s)).throw(U.invalidParameters),a=new IN(oe({userId:this._sdkState.userId,ts:typeof e=="number"?e:null,token:typeof e=="string"?e:null,filter:s})),[4,this._requestQueue.send(a)];case 1:return o=f.sent(),u=o.as(SN),c=u.updatedChannels,l=u.deletedChannelUrls,d=u.hasMore,h=u.ts,c.length>0&&this._dispatcher.dispatch(new Ne({channels:c,source:i,ts:h})),l.length>0&&this._dispatcher.dispatch(new hs({channelUrls:l,source:i})),[2,{updatedChannels:c,deletedChannelUrls:l,hasMore:d,token:u.token}]}})})},t.prototype.getGroupChannelCount=function(e){return g(this,void 0,void 0,function(){var r,i,s;return v(this,function(a){switch(a.label){case 0:return r=A(A({},cE),e),B(lE(r)).throw(U.invalidParameters),i=new AN({userId:this._sdkState.userId,filter:r}),[4,this._requestQueue.send(i)];case 1:return s=a.sent(),[2,s.as(kN).groupChannelCount]}})})},t.prototype.getUnreadItemCount=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h,f,p,_,m,b,y;return v(this,function(E){switch(E.label){case 0:return r=A(A({},yN),e),B(function(T){return Ae(Kt,T.keys)}(r)).throw(U.invalidParameters),i=M.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new ON({userId:s.userId,filter:r}),[4,a.send(o)];case 1:return u=E.sent(),c=u.as(MN),l=c.groupChannelUnreadMentionCount,d=c.groupChannelUnreadMessageCount,h=c.groupChannelInvitationCount,f=c.superGroupChannelUnreadMentionCount,p=c.superGroupChannelUnreadMessageCount,_=c.superGroupChannelInvitationCount,m=c.nonSuperGroupChannelUnreadMentionCount,b=c.nonSuperGroupChannelUnreadMessageCount,y=c.nonSuperGroupChannelInvitationCount,[2,re({groupChannelUnreadMentionCount:l,groupChannelUnreadMessageCount:d,groupChannelInvitationCount:h,superGroupChannelUnreadMentionCount:f,superGroupChannelUnreadMessageCount:p,superGroupChannelInvitationCount:_,nonSuperGroupChannelUnreadMentionCount:m,nonSuperGroupChannelUnreadMessageCount:b,nonSuperGroupChannelInvitationCount:y})]}})})},t.prototype.getTotalUnreadChannelCount=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new DN({userId:r.userId}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(RN).unreadCount]}})})},t.prototype.getTotalUnreadMessageCount=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return r=A(A({},EN),e),B(bN(r)).throw(U.invalidParameters),i=M.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new UN({userId:s.userId,filter:r}),[4,a.send(o)];case 1:return u=c.sent(),[2,u.as(LN).unreadCount]}})})},t.prototype.getTotalScheduledMessageCount=function(e){return e===void 0&&(e={}),g(this,void 0,void 0,function(){var r,i,s,a;return v(this,function(o){switch(o.label){case 0:return r=A(A({},TN),e),B(function(u){return R("string",u.channelUrl,!0)&&Ae(ia,u.scheduledStatus,!0)&&be(mn,u.messageTypeFilter)}(r)).throw(U.invalidParameters),i=M.of(this._iid).requestQueue,s=new PN(r),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(xN).count]}})})},t.prototype.getSubscribedTotalUnreadMessageCount=function(){var e=M.of(this._iid).subscribedUnreadMessageCount;return e.all>=0?e.all:0},t.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){var e=0,r=M.of(this._iid).subscribedUnreadMessageCount;for(var i in r.customTypes)e+=r.customTypes[i];return e},t.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){var r;return(r=M.of(this._iid).subscribedUnreadMessageCount.customTypes[e])!==null&&r!==void 0?r:0},t.prototype.createChannel=function(e){return g(this,void 0,void 0,function(){var r,i,s,a;return v(this,function(o){switch(o.label){case 0:return r=A(A({},md),e),B(Up(r)).throw(U.invalidParameters),r.isPublic||(r.accessCode=void 0),i=new qN(A({userId:this._sdkState.userId},r)),[4,this._requestQueue.send(i)];case 1:return s=o.sent(),a=s.as($N).channel,[4,this.upsertChannelsToCache([a])];case 2:return o.sent(),[2,a]}})})},t.prototype.markAsReadAll=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return e=Date.now(),B(e-this._markAsReadAllLastSentAt>=1e3).throw(U.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=e,r=new jv({userId:this._sdkState.userId}),[4,this._requestQueue.send(r)];case 1:l.sent(),i=this._groupChannelCache.channels;try{for(s=Z(i),a=s.next();!a.done;a=s.next())(o=a.value)._updateUnreadMemberState(this._sdkState.userId,e),o._updateUnreadCount(0,0)}catch(d){u={error:d}}finally{try{a&&!a.done&&(c=s.return)&&c.call(s)}finally{if(u)throw u.error}}return i.length>0?[4,this.upsertChannelsToCache(i)]:[3,3];case 2:l.sent(),l.label=3;case 3:return[2]}})})},t.prototype.markAsReadWithChannelUrls=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d;return v(this,function(h){switch(h.label){case 0:return r=Date.now(),B(Ae("string",e)&&r-this._markAsReadAllLastSentAt>=1e3).throw(U.markAsReadAllRateLimitExceeded),this._markAsReadAllLastSentAt=r,i=new jv({userId:this._sdkState.userId,channelUrls:e}),[4,this._requestQueue.send(i)];case 1:h.sent(),s=this._groupChannelCache.channels,a=[];try{for(o=Z(s),u=o.next();!u.done;u=o.next())c=u.value,e.includes(c.url)&&(c._updateUnreadMemberState(this._sdkState.userId,r),c._updateUnreadCount(0,0),a.push(c))}catch(f){l={error:f}}finally{try{u&&!u.done&&(d=o.return)&&d.call(o)}finally{if(l)throw l.error}}return a.length>0?[4,this.upsertChannelsToCache(a)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[2]}})})},t.prototype.markAsDelivered=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this.getChannel(e)];case 1:return[4,r.sent().markAsDelivered()];case 2:return r.sent(),[2]}})})},t.prototype.getMessageFromCache=function(e){var r;return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this._messageCache.get(e)];case 1:return[2,(r=i.sent())!==null&&r!==void 0?r:null]}})})},t.prototype.getExactlyMatchingMessagesForTokenFromCache=function(e,r,i){return g(this,void 0,void 0,function(){return v(this,function(s){switch(s.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:r,filter:i,exactMatch:!0})];case 1:return[2,s.sent()]}})})},t.prototype.getMessagesFromCache=function(e,r,i,s,a,o){return a===void 0&&(a=Yy),o===void 0&&(o=!0),g(this,void 0,void 0,function(){return v(this,function(u){switch(u.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:r,limit:a,filter:s,backward:i==="next",inclusive:o})];case 1:return[2,u.sent()]}})})},t.prototype.getPollMessagesFromCache=function(e,r,i,s){return g(this,void 0,void 0,function(){return v(this,function(a){switch(a.label){case 0:return[4,this._messageCache.fetch({channelUrl:e,token:r,limit:s,filter:i,backward:!1,isPollOnly:!0})];case 1:return[2,a.sent()]}})})},t.prototype.getCachedMessageCountBetween=function(e,r,i,s){return g(this,void 0,void 0,function(){return v(this,function(a){switch(a.label){case 0:return[4,this._messageCache.countBetween(e,r,new Pi({top:i,bottom:s}))];case 1:return[2,a.sent()]}})})},t.prototype.getUnsentMessagesFromCache=function(e,r){return g(this,void 0,void 0,function(){return v(this,function(i){switch(i.label){case 0:return[4,this._unsentMessageCache.fetch({channelUrl:e,filter:r})];case 1:return[2,i.sent()]}})})},t.prototype.removeFailedMessageFromCache=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._unsentMessageCache.remove([e])];case 1:return r.sent(),[2]}})})},t}(dN),fr=function(n,t){return t instanceof kt?n.findIndex(function(e){return e instanceof kt&&t.isIdentical(e)}):n.findIndex(function(e){return e.isIdentical(t)})},Lu=function(n,t){return n.findIndex(function(e){return e instanceof Nn?e.messageId===t:e instanceof _o?e.notificationId===t:void 0})},If=function(n,t){if(n.length>0){for(var e=0,r=n.length-1,i=Math.floor((e+r)/2);e<r;){var s=n[i].createdAt-t.createdAt;if(s>0)r=i,i=Math.floor((e+r)/2);else{if(!(s<0))return i;e=i+1,i=Math.floor((e+r)/2)}}return n[i].createdAt>t.createdAt?i:i+1}return n.length};(function(n){n[n.IDLE=0]="IDLE",n[n.RUNNING=1]="RUNNING",n[n.END=2]="END"})(_s||(_s={}));var Vd,Ea=function(n){function t(e,r,i,s){var a=n.call(this)||this;return a._state=_s.IDLE,a._retryCount=0,a._retryLimit=3,a.priority=0,a._worker=r,a}return w(t,n),Object.defineProperty(t.prototype,"isIdle",{get:function(){return this._state===_s.IDLE},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{get:function(){return this._state===_s.RUNNING},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDone",{get:function(){return this._state===_s.END},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return this._retryCount},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"retryLimit",{get:function(){return this._retryLimit},enumerable:!1,configurable:!0}),t.prototype._run=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:if(!this.isRunning)return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._worker(e)];case 2:return r=s.sent(),this._retryCount=0,this.dispatch("progress",r),r.hasNext?this._run(r.nextToken):this.end(),[3,4];case 3:return i=s.sent(),this.dispatch("error",i),this._retryCount<this._retryLimit?(this._retryCount++,this._run(e)):this.stop(),[3,4];case 4:return[2]}})})},t.prototype.start=function(e){this.isIdle&&(this._state=_s.RUNNING,this._run(e))},t.prototype.stop=function(){this._state=_s.IDLE,this.dispatch("stop")},t.prototype.end=function(){this._state=_s.END,this.dispatch("end")},t}(bo),ri={},cA=function(){function n(t){var e=t._iid,r=t.channel,i=t.limit,s=i===void 0?100:i,a=this;this.ref=0,this._iid=e,this._channel=r,this._limit=s,this._prevSyncLoopCount=0;var o,u,c=M.of(this._iid),l=c.sdkState,d=c.cacheContext,h=c.dispatcher,f=c.logger,p=c.statLogCollector;this._metadataKey=(o=l.userId,u=r.url,"sendbird:".concat(o,"@groupchannel/").concat(u,"/message/sync.meta"));var _=function(m,b){return"sendbird:".concat(m,"@groupchannel/").concat(b,"/message/sync")}(l.userId,r.url);this._prevSync=new Ea(_,function(m){return g(a,void 0,void 0,function(){var b,y,E,T,N,C,L,k,O,x,Q,we;return v(this,function(Ie){switch(Ie.label){case 0:return b={hasNext:!0,nextToken:0},this._prevSyncLoopCount++,[4,this.loadMetadata(m)];case 1:if(Ie.sent(),f.debug("message background prev sync from",(C=this._metadata)===null||C===void 0?void 0:C.range.top),(L=this._metadata)===null||L===void 0?void 0:L.previousComplete)return[3,10];Ie.label=2;case 2:return Ie.trys.push([2,5,8,9]),[4,Xt.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,!((O=(k=this._metadata)===null||k===void 0?void 0:k.range)===null||O===void 0)&&O.top?this._metadata.range.top:m,{prevResultSize:this._limit,nextResultSize:0,replyType:vn.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},z.SYNC_MESSAGE_BACKGROUND)];case 3:return(y=Ie.sent()).length>0&&(E=y.map(function(ze){return ze.createdAt}),!((x=this._metadata)===null||x===void 0)&&(N=x.range).intersect.apply(N,ce([],ie(E),!1))?this.extendRange(y):this._metadata={range:new Pi({top:Math.min.apply(Math,ce([],ie(E),!1)),bottom:Math.max.apply(Math,ce([],ie(E),!1))}),previousComplete:!1}),b.hasNext=y.length>=this._limit&&this._prevSyncLoopCount<1,this._metadata&&(b.nextToken=this._metadata.range.top,this._metadata.previousComplete=y.length<this._limit),f.debug("message background prev sync progress",b),[4,this.saveMetadata()];case 4:return Ie.sent(),[3,9];case 5:return T=Ie.sent(),f.debug("message background prev sync error",T),T instanceof U&&T.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:Ie.sent(),Ie.label=7;case 7:throw T;case 8:return p.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:r.url,measured_on:"back_sync",event:"cache_fetch",max_db_size:(we=(Q=d.localCacheConfig)===null||Q===void 0?void 0:Q.maxSize)!==null&&we!==void 0?we:0,use_local_cache:d.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 9:return[3,11];case 10:b.hasNext=!1,Ie.label=11;case 11:return[2,b]}})})}),this._nextSync=new Ea(_,function(m){return g(a,void 0,void 0,function(){var b,y,E,T,N,C,L,k,O,x,Q;return v(this,function(we){switch(we.label){case 0:return b={hasNext:!0,nextToken:0},[4,this.loadMetadata(m)];case 1:we.sent(),f.debug("message background next sync from",(C=this._metadata)===null||C===void 0?void 0:C.range.bottom),we.label=2;case 2:return we.trys.push([2,5,6,7]),[4,Xt.of(this._iid).getMessagesByTimestamp(this._channel.url,this._channel.channelType,!((k=(L=this._metadata)===null||L===void 0?void 0:L.range)===null||k===void 0)&&k.bottom?this._metadata.range.bottom:m,{prevResultSize:0,nextResultSize:this._limit,replyType:vn.ALL,includeReactions:!0,includeMetaArray:!0,includeParentMessageInfo:!0,includeThreadInfo:!0},z.SYNC_MESSAGE_BACKGROUND)];case 3:return(y=we.sent()).length>0&&(E=y.map(function(Ie){return Ie.createdAt}),!((O=this._metadata)===null||O===void 0)&&(N=O.range).intersect.apply(N,ce([],ie(E),!1))?this.extendRange(y):this._metadata={range:new Pi({top:Math.min.apply(Math,ce([],ie(E),!1)),bottom:Math.max.apply(Math,ce([],ie(E),!1))}),previousComplete:!1}),b.hasNext=y.length>=this._limit,this._metadata&&(b.nextToken=this._metadata.range.bottom),f.debug("message background next sync progress",b),[4,this.saveMetadata()];case 4:return we.sent(),[3,7];case 5:throw T=we.sent(),f.debug("message background next sync error",T),T;case 6:return p.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:r.url,measured_on:"back_sync",event:"cache_fetch",max_db_size:(Q=(x=d.localCacheConfig)===null||x===void 0?void 0:x.maxSize)!==null&&Q!==void 0?Q:0,use_local_cache:d.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 7:return[2,b]}})})}),this._connectionEventContext=h.on(function(m){m instanceof Ar&&(m.stateType===qe.CONNECTED?a.resume():a.pause())})}return n.of=function(t,e){return ri[t]||(ri[t]={}),ri[t][e.url]||(ri[t][e.url]=new n({_iid:t,channel:e})),ri[t][e.url].ref++,ri[t][e.url]},n.clear=function(t,e){ri[t]&&ri[t][e]&&(ri[t][e].close(),delete ri[t])},Object.defineProperty(n.prototype,"range",{get:function(){var t,e;return(e=(t=this._metadata)===null||t===void 0?void 0:t.range)!==null&&e!==void 0?e:new Pi({})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"previousComplete",{get:function(){var t;return!!(!((t=this._metadata)===null||t===void 0)&&t.previousComplete)},enumerable:!1,configurable:!0}),n.prototype.isWrappingMessages=function(t){var e;return(e=this.range)===null||e===void 0?void 0:e.includes.apply(e,ce([],ie(t.map(function(r){return r.createdAt})),!1))},n.prototype.extendRange=function(t){var e;this._metadata&&(e=this._metadata.range).extends.apply(e,ce([],ie(t.map(function(r){return r.createdAt})),!1))},n.prototype.loadMetadata=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:return this._metadata?[3,2]:[4,M.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:e=r.sent(),this._metadata=e?{range:new Pi(e.range),previousComplete:e.previousComplete}:{range:new Pi({}),previousComplete:!1},r.label=2;case 2:return[2,this._metadata]}})})},n.prototype.saveMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this._metadata?[4,M.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return t.sent(),[2,!0];case 2:return[2,!1]}})})},n.prototype.clearMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,M.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return t.sent(),this._metadata=void 0,[2]}})})},n.prototype.resume=function(t){var e,r,i,s;t===void 0&&(t=Date.now());var a=M.of(this._iid),o=a.logger;a.sessionManager.session.hasSession&&(o.debug("message background sync resume()"),this._prevSyncLoopCount=0,this._metadata&&this._metadata.previousComplete||this._prevSync.start((r=(e=this._metadata)===null||e===void 0?void 0:e.range.top)!==null&&r!==void 0?r:t),this._nextSync.start((s=(i=this._metadata)===null||i===void 0?void 0:i.range.bottom)!==null&&s!==void 0?s:t))},n.prototype.pause=function(){M.of(this._iid).logger.debug("message background sync stop()"),this._prevSync.stop(),this._nextSync.stop()},n.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete ri[this._iid][this._channel.url])},n}(),ii={},lA=function(){function n(t){var e=t._iid,r=t.channel,i=t.includeParams,s=this;this.ref=0,this._iid=e,this._channel=r,this._includeParams=i;var a,o,u=M.of(this._iid),c=u.logger,l=u.sdkState,d=u.dispatcher;this._metadataKey=(a=l.userId,o=r.url,"sendbird:".concat(a,"@groupchannel/").concat(o,"/message/changelogs.meta"));var h=function(f,p){return"sendbird:".concat(f,"@groupchannel/").concat(p,"/message/changelogs")}(l.userId,this._channel.url);this._sync=new Ea(h,function(){return g(s,void 0,void 0,function(){var f,p,_,m,b,y,E,T;return v(this,function(N){switch(N.label){case 0:return f={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:N.sent(),c.debug("message changelog sync from",(T=this._metadata)===null||T===void 0?void 0:T.token),N.label=2;case 2:return N.trys.push([2,5,,8]),[4,Xt.of(this._iid).getMessageChangelogs(this._channel.url,this._channel.channelType,this._metadata.token,A({replyType:vn.ALL},this._includeParams),z.SYNC_MESSAGE_CHANGELOGS)];case 3:return p=N.sent(),_=p.updatedMessages,m=p.deletedMessageIds,b=p.hasMore,y=p.token,f.hasNext=b,f.nextToken=y,(_.length>0||m.length>0)&&this._metadata&&(this._metadata.token=y),c.debug("message changelog sync progress",f),[4,this.saveMetadata()];case 4:return N.sent(),[3,8];case 5:return E=N.sent(),c.debug("message changelog sync error",E),E instanceof U&&E.isInvalidTokenError?[4,this.clearMetadata()]:[3,7];case 6:N.sent(),N.label=7;case 7:throw E;case 8:return[2,f]}})})}),this._connectionEventContext=d.on(function(f){f instanceof Ar&&(f.stateType===qe.CONNECTED?s.resume():s.pause())})}return n.of=function(t,e,r){return ii[t]||(ii[t]={}),ii[t][e.url]||(ii[t][e.url]=new n({_iid:t,channel:e,includeParams:r})),ii[t][e.url].ref++,ii[t][e.url]},n.clear=function(t,e){ii[t]&&ii[t][e]&&(ii[t][e].close(),delete ii[t])},n.prototype.loadMetadata=function(){return g(this,void 0,void 0,function(){var t,e,r,i;return v(this,function(s){switch(s.label){case 0:return this._metadata?[3,2]:(t=M.of(this._iid),e=t.cacheContext,r=t.firstConnectedAt,[4,e.preference.get(this._metadataKey)]);case 1:i=s.sent(),this._metadata={token:i?i.token:r},s.label=2;case 2:return[2,this._metadata]}})})},n.prototype.saveMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this._metadata?[4,M.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return t.sent(),[2,!0];case 2:return[2,!1]}})})},n.prototype.clearMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,M.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return t.sent(),this._metadata=void 0,[2]}})})},n.prototype.resume=function(){var t=M.of(this._iid),e=t.logger;t.sessionManager.session.hasSession&&(e.debug("message changelog sync resume()"),this._sync.start(0))},n.prototype.pause=function(){M.of(this._iid).logger.debug("message changelog sync pause()"),this._sync.stop()},n.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete ii[this._iid][this._channel.url])},n}(),Ra={},dA=function(){function n(t){var e=t._iid,r=t.channel,i=t.hasPollMessage,s=this;this.ref=0,this._iid=e,this._channel=r;var a,o,u=M.of(this._iid),c=u.logger,l=u.sdkState,d=u.dispatcher;this._metadataKey=(a=l.userId,o=r.url,"sendbird:".concat(a,"@groupchannel/").concat(o,"/poll/changelogs.meta"));var h=function(f,p){return"sendbird:".concat(f,"@groupchannel/").concat(p,"/poll/changelogs")}(l.userId,this._channel.url);this._sync=new Ea(h,function(){return g(s,void 0,void 0,function(){var f,p,_,m,b,y,E,T;return v(this,function(N){switch(N.label){case 0:return f={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return N.sent(),c.debug("poll changelog sync from",(T=this._metadata)===null||T===void 0?void 0:T.token),(p=!this._metadata||!this._metadata.token)?[4,i()]:[3,3];case 2:p=!N.sent(),N.label=3;case 3:if(p)return[2,{hasNext:!1,nextToken:0}];this._metadata||(_=M.of(this._iid).firstConnectedAt,this._metadata={token:_}),N.label=4;case 4:return N.trys.push([4,7,,10]),[4,Pd.of(this._iid).getPollChangeLogs(this._channel.url,this._channel.channelType,this._metadata.token)];case 5:return m=N.sent(),b=m.hasMore,y=m.token,f.hasNext=b,f.nextToken=y,this._metadata.token=y,c.debug("poll changelog sync progress",f),[4,this.saveMetadata()];case 6:return N.sent(),[3,10];case 7:return E=N.sent(),c.debug("poll changelog sync error",E),E instanceof U&&E.isInvalidTokenError?[4,this.clearMetadata()]:[3,9];case 8:N.sent(),N.label=9;case 9:throw E;case 10:return[2,f]}})})}),this._connectionEventContext=d.on(function(f){f instanceof Ar&&(f.stateType===qe.CONNECTED?s.resume():s.pause())})}return n.of=function(t,e,r){return Ra[t]||(Ra[t]={}),Ra[t][e.url]||(Ra[t][e.url]=new n({_iid:t,channel:e,hasPollMessage:r})),Ra[t][e.url].ref++,Ra[t][e.url]},n.prototype.loadMetadata=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return this._metadata?[3,2]:[4,M.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:t=e.sent(),this._metadata=t?{token:t.token}:void 0,e.label=2;case 2:return[2]}})})},n.prototype.saveMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this._metadata?[4,M.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},n.prototype.clearMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,M.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return t.sent(),this._metadata=void 0,[2]}})})},n.prototype.resume=function(){M.of(this._iid).logger.debug("poll changelog sync resume()"),this._sync.start(0)},n.prototype.pause=function(){M.of(this._iid).logger.debug("poll changelog sync pause()"),this._sync.stop()},n.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Ra[this._iid][this._channel.url])},n}(),hA=function(n){function t(e){var r=e.channels,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=e.data,u=o===void 0?null:o,c=n.call(this)||this;return c.channels=r,c.source=i,c.isWebSocketEventComing=a,c.data=u,c}return w(t,n),t}(rt);(function(n){function t(e){var r=e.channelUrls,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=n.call(this)||this;return o.channelUrls=r,o.source=i,o.isWebSocketEventComing=a,o}return w(t,n),t})(rt);var fA=function(n){function t(e){var r,i,s,a,o,u,c,l,d,h,f=this;return(f=n.call(this)||this).method=j.GET,f.path="".concat(Le(e.channelType),"/").concat(e.channelUrl,"/messages_gap"),f.params=re({prev_start_ts:e.prevStart,prev_end_ts:e.prevEnd,prev_cache_count:e.prevCount,next_start_ts:e.nextStart,next_end_ts:e.nextEnd,next_cache_count:e.nextCount,huge_gap_threshold:(r=e.threshold)!==null&&r!==void 0?r:null,reverse:!0,custom_types:(i=e.customTypes)!==null&&i!==void 0?i:["*"],message_type:(s=e.messageType)!==null&&s!==void 0?s:null,include_reply_type:(a=e.replyType)!==null&&a!==void 0?a:vn.NONE,include_reactions:(o=e.includeReactions)===null||o===void 0||o,include_meta_array:(u=e.includeMetaArray)===null||u===void 0||u,include_thread_info:(c=e.includeThreadInfo)===null||c===void 0||c,include_parent_message_info:(l=e.includeParentMessageInfo)===null||l===void 0||l,with_sorted_meta_array:(d=e.includeMetaArray)===null||d===void 0||d,show_subchannel_messages_only:(h=e.showSubchannelMessagesOnly)!==null&&h!==void 0&&h,include_poll_details:!0,checking_continuous_messages:e.checkingContinuousMessages}),f}return w(t,n),t}(K),pA=function(n){function t(e,r){var i,s,a,o,u,c,l=this;return(l=n.call(this,e,r)||this).isHugeGap=r.is_huge_gap,l.prevMessages=((i=r.prev_messages)!==null&&i!==void 0?i:[]).map(function(d){return $n(e,d)}),l.prevHasMore=(s=r.prev_hasmore)!==null&&s!==void 0&&s,l.isContinuousPrevMessages=(a=r.is_continuous_prev_messages)!==null&&a!==void 0&&a,l.nextMessages=((o=r.next_messages)!==null&&o!==void 0?o:[]).map(function(d){return $n(e,d)}),l.nextHasmore=(u=r.next_hasmore)!==null&&u!==void 0&&u,l.isContinuousNextMessages=(c=r.is_continuous_next_messages)!==null&&c!==void 0&&c,l}return w(t,n),t}(W),fE=function(n){this.source=n},qp=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(fE),_A=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(fE),pE=function(n){this.source=n},mA=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(pE),vA=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return w(t,n),t}(pE),Kv={includeMetaArray:!0,includeReactions:!0,includeThreadInfo:!0,includeParentMessageInfo:!0};(function(n){n.CACHE_AND_REPLACE_BY_API="cache_and_replace_by_api"})(Vd||(Vd={}));var fc,pc,_c,gA=function(){function n(){this._onCacheResult=Se,this._onApiResult=Se}return n.prototype._invokeResponse=function(t,e,r){var i=this;le(function(){return g(i,void 0,void 0,function(){return v(this,function(s){switch(t){case"local":this._onCacheResult(e,r);break;case"remote":this._onApiResult(e,r)}return[2]})})})},n.prototype.onCacheResult=function(t){return this._onCacheResult=t,this},n.prototype.onApiResult=function(t){return this._onApiResult=t,this},n}(),yA=function(){function n(t,e){var r=e.filter,i=e.startingPoint,s=e.limit,a=e.prevResultLimit,o=e.nextResultLimit,u=e.channel,c=e.channelManager,l=e.disableBackgroundSync,d=l!==void 0&&l,h=this;this._messages=[],this._unsentMessages=[],this._isLoadingPrevious=!1,this._isLoadingNext=!1,this._iid=t,this._key="mc-".concat(Rs()),this._isDisposed=!1,this.filter=r??new Us,this._channel=u,this._syncRange=new Pi({}),this._hasPrevious=!0,this._hasNext=!0,this._startingPoint=typeof i=="number"&&Number.isFinite(i)?i:Number.MAX_SAFE_INTEGER,this._limit=s||Yy,this._prevResultLimit=a??Math.floor(this._limit/2),this._nextResultLimit=o??Math.floor(this._limit/2),this._channelManager=c,this._channelManager.subscribeChannelEvent(this._key,{onUpdate:function(y,E,T){var N=y.findIndex(function(C){return C.isIdentical(h.channel)});N>=0&&(h._replaceChannelOfCollection(y[N]),h.channel._runIfHandleableWithGroupChannel(function(C){switch(E){case z.EVENT_CHANNEL_UPDATED:var L=!1;for(var k in h._messages)if(h._messages[k].createdAt>=C.messageOffsetTimestamp){L=!0;var O=parseInt(k);if(O>0){var x=h._messages.splice(0,O);h._removeMessagesFromView(x.map(function(ze){return h.keyOf(ze)}),z.EVENT_MESSAGE_OFFSET_UPDATED)}break}!L&&h._messages.length>0&&h._removeMessagesFromView(h._messages.map(function(ze){return h.keyOf(ze)}),z.EVENT_MESSAGE_OFFSET_UPDATED);break;case z.EVENT_CHANNEL_UNMUTED:var Q=M.of(h._iid).sdkState,we=T;Q.userId===we&&h._clearCheckMyMutedTimer();break;case z.EVENT_CHANNEL_MUTED:Q=M.of(h._iid).sdkState;var Ie=T;Q.userId===Ie&&C._myMutedRemainingTime!==-1&&h._startCheckMyMutedTimer(C._myMutedRemainingTime);break;case z.EVENT_CHANNEL_LEFT:C.isPublic&&h._clearCheckMyMutedTimer()}le(function(){return g(h,void 0,void 0,function(){var ze,$t;return v(this,function(Gt){return ze=this._createChannelEventContext(E),vd(E)&&(!(($t=this._handler)===null||$t===void 0)&&$t.onChannelUpdated)&&this._handler.onChannelUpdated(ze,this.channel),[2]})})})}),h._postprocessChannelUpdateEvent(y[N],E))},onRemove:function(y,E){var T=y.indexOf(h.channel.url);T>=0&&(h._clearCheckMyMutedTimer(),le(function(){return g(h,void 0,void 0,function(){var N,C;return v(this,function(L){return N=this._createChannelEventContext(E),!((C=this._handler)===null||C===void 0)&&C.onChannelDeleted&&this._handler.onChannelDeleted(N,this.channel.url),[2]})})}),h._postprocessChannelRemoveEvent(y[T]))}}),this._channelManager.subscribeMessageEvent(this._key,{onUpdate:function(y,E){var T,N,C=[],L=[];try{for(var k=Z(y),O=k.next();!O.done;O=k.next()){var x=O.value;x.channelUrl===h._channel.url&&(h.filter.match(x)?C.push(x):L.push(h.keyOf(x)))}}catch(Q){T={error:Q}}finally{try{O&&!O.done&&(N=k.return)&&N.call(k)}finally{if(T)throw T.error}}if(ps(E)){if(C.length>0)switch(E){case z.LOCAL_MESSAGE_CANCELED:case z.LOCAL_MESSAGE_RESEND_STARTED:case z.EVENT_MESSAGE_SENT_FAILED:case z.EVENT_MESSAGE_SENT_SUCCESS:case z.EVENT_MESSAGE_UPDATED:case z.EVENT_MESSAGE_THREADINFO_UPDATED:case z.EVENT_MESSAGE_REACTION_UPDATED:case z.EVENT_MESSAGE_FEEDBACK_ADDED:case z.EVENT_MESSAGE_FEEDBACK_UPDATED:case z.EVENT_MESSAGE_FEEDBACK_DELETED:case z.SYNC_MESSAGE_CHANGELOGS:h._updateMessagesToView(C,E);break;case z.EVENT_MESSAGE_SENT_PENDING:h._addMessagesToView(C,E);break;case z.EVENT_MESSAGE_RECEIVED:h.hasNext||h._addMessagesToView(C,E);break;case z.SYNC_MESSAGE_FILL:h._addMessagesToView(C,E)}L.length>0&&h._removeMessagesFromView(L,E)}h._postprocessMessageUpdateEvent(y,E)},onRemove:function(y,E){h._removeMessagesFromView(y,E),h._postprocessMessageRemoveEvent(y)},onRemoveUnsent:function(y,E){h._removeUnsentMessageFromView(y,E)},onPollChangeLogUpdate:function(y,E){h._updatePollsToView(y,E)},onPollUpdate:function(y,E){h._applyPollUpdateEventToView(y,E)},onPollVote:function(y,E){h._applyPollVoteEventToView(y,E)},onReactionUpdate:function(y,E){h._applyReactionEventToView(y,E)},onThreadInfoUpdate:function(y,E){h._applyThreadInfoEventToView(y,E)}});var f=M.of(this._iid),p=f.cacheContext,_=f.dispatcher;this._channel._updateMessageCollectionLastAccessedAt();var m=this._createChannelUpdateEventCommand(z.CHANNEL_LASTACCESSEDAT_UPDATED);m&&_.dispatch(m),!d&&this._shouldStartBackgroundSync()&&(this._backgroundSync=cA.of(this._iid,this._channel),this._backgroundSync.resume(this._startingPoint)),this._changelogSync=lA.of(this._iid,this._channel,this.changelogIncludeParams),this._changelogSync.resume(),this._pollChangelogSync=dA.of(this._iid,this._channel,this._hasPollMessage.bind(this)),this._pollChangelogSync.resume(),this._prevFill=new Ea(this._key,function(y){return g(h,void 0,void 0,function(){var E,T,N,C,L,k,O;return v(this,function(x){switch(x.label){case 0:return[4,this._getRemoteMessages(y,{prevLimit:this._prevResultLimit,source:z.SYNC_MESSAGE_FILL,checkingContinuousMessages:p.localCacheEnabled})];case 1:return E=x.sent(),T=E.messages,N=E.isContinuousMessages,T.length>0?(C=Math.min.apply(Math,ce([],ie(T.map(function(Q){return Q.createdAt})),!1)),this._syncRange.extends(C),N&&((L=this._backgroundSync)===null||L===void 0||L.range.extends(C)),[2,{hasNext:T.length>=this._prevResultLimit&&this.viewTop<C,nextToken:this._syncRange.top}]):(b.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:(O=(k=p.localCacheConfig)===null||k===void 0?void 0:k.maxSize)!==null&&O!==void 0?O:0,use_local_cache:p.localCacheEnabled,starting_point:0,message_init_policy:""}})),[2,{hasNext:!1,nextToken:0}])}})})}),this._nextFill=new Ea(this._key,function(y){return g(h,void 0,void 0,function(){var E,T,N,C,L,k,O;return v(this,function(x){switch(x.label){case 0:return[4,this._getRemoteMessages(y,{nextLimit:this._nextResultLimit,source:z.SYNC_MESSAGE_FILL,checkingContinuousMessages:p.localCacheEnabled})];case 1:return E=x.sent(),T=E.messages,N=E.isContinuousMessages,T.length>0?(C=Math.max.apply(Math,ce([],ie(T.map(function(Q){return Q.createdAt})),!1)),this._syncRange.extends(C),N&&((L=this._backgroundSync)===null||L===void 0||L.range.extends(C)),[2,{hasNext:!(T.length>=this._nextResultLimit&&this._hasNext)||this.viewBottom>C,nextToken:this._syncRange.bottom}]):(b.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:(O=(k=p.localCacheConfig)===null||k===void 0?void 0:k.maxSize)!==null&&O!==void 0?O:0,use_local_cache:p.localCacheEnabled,starting_point:0,message_init_policy:""}})),[2,{hasNext:!1,nextToken:0}])}})})}),this._connectionEventContext=_.on(function(y){if(y instanceof Ar)switch(y.stateType){case qe.CONNECTED:Tt(function(){return g(h,void 0,void 0,function(){return v(this,function(E){return this._activate(),[2]})})});break;case qe.LOGOUT:h.dispose();break;default:h._clearCheckMyMutedTimer(),h._prevFill.stop(),h._nextFill.stop()}});var b=M.of(this._iid).statLogCollector;b.put(new Ya({type:lt.FEATURE_LOCALCACHE,data:{use_local_cache:p.localCacheEnabled,collection_interface:{message:!0}}}))}return n.prototype.keyOf=function(t){return 0},Object.defineProperty(n.prototype,"changelogIncludeParams",{get:function(){return{includeReactions:!0,includeThreadInfo:!0,includeMetaArray:!0,includeParentMessageInfo:!0}},enumerable:!1,configurable:!0}),n.prototype._postprocessChannelUpdateEvent=function(t,e){},n.prototype._postprocessChannelRemoveEvent=function(t){},n.prototype._postprocessMessageUpdateEvent=function(t,e){},n.prototype._postprocessMessageRemoveEvent=function(t){},Object.defineProperty(n.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"succeededMessages",{get:function(){return ce([],ie(this._messages),!1)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"failedMessages",{get:function(){return this._unsentMessages.filter(function(t){return t.sendingStatus===tt.FAILED})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"pendingMessages",{get:function(){return this._unsentMessages.filter(function(t){return t.sendingStatus===tt.PENDING})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasPrevious",{get:function(){return this._hasPrevious},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"viewTop",{get:function(){return Math.min.apply(Math,ce(ce([],ie(this._messages.map(function(t){return t.createdAt})),!1),[Number.MAX_SAFE_INTEGER],!1))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"viewBottom",{get:function(){return Math.max.apply(Math,ce(ce([],ie(this._messages.map(function(t){return t.createdAt})),!1),[0],!1))},enumerable:!1,configurable:!0}),n.prototype._activate=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return M.of(this._iid).logger.debug("check huge gap"),this._checkHugeGap(),[4,this._refreshChannel(z.SYNC_CHANNEL_CHANGELOGS)];case 1:return t.sent(),[2]}})})},n.prototype._replaceChannelOfCollection=function(t){this._channel.isGroupChannel()?this._channel=t:this._channel.isFeedChannel()&&(this._channel._groupChannel=t._groupChannel)},n.prototype._shouldStartBackgroundSync=function(){var t=M.of(this._iid).cacheContext;return this.channel.isGroupChannel()?t.localCacheEnabled&&!this.channel.isSuper:t.localCacheEnabled},n.prototype._createChannelEventContext=function(t){switch(!0){case this.channel.isGroupChannel():return new qp(t);case this.channel.isFeedChannel():return new _A(t);default:throw new U({code:ae.WRONG_CHANNEL_TYPE,message:"Wrong channel type"})}},n.prototype._createMessageEventContext=function(t){switch(!0){case this.channel.isGroupChannel():return new mA(t);case this.channel.isFeedChannel():return new vA(t);default:throw new U({code:ae.WRONG_CHANNEL_TYPE,message:"Wrong channel type"})}},n.prototype._createChannelUpdateEventCommand=function(t){switch(!0){case this.channel.isGroupChannel():return new Ne({channels:[this._channel],source:t});case this.channel.isFeedChannel():return new hA({channels:[this._channel],source:t});default:return null}},n.prototype._setBaseMessageCollectionHandler=function(t){this._handler=t},n.prototype._filterUnderOffsetMessage=function(t){return t},n.prototype._updateChildMessagesInView=function(t){var e=[];return this._messages.forEach(function(r){r instanceof Nn&&r.parentMessageId===t.messageId&&r.applyParentMessage(t)&&e.push(r)}),e},n.prototype._updatePollsToView=function(t,e){var r,i,s=this,a=[];try{for(var o=Z(t),u=o.next();!u.done;u=o.next()){var c=u.value,l=Lu(this._messages,c.messageId);if(l>=0){var d=this._messages[l];d.isUserMessage()&&d.applyPoll(c),a.push(d)}}}catch(h){r={error:h}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a.length>0&&ps(e)&&le(function(){return g(s,void 0,void 0,function(){var h,f,p;return v(this,function(_){return h=this._createMessageEventContext(e),a.length>0&&((p=(f=this._handler).onMessagesUpdated)===null||p===void 0||p.call(f,h,this.channel,a)),[2]})})}),a},n.prototype._applyPollUpdateEventToView=function(t,e){var r=this,i=Lu(this._messages,t.messageId);if(i>=0){var s=this._messages[i];s&&s.isUserMessage()&&s.poll&&s.poll.applyPollUpdateEvent(t)&&ps(e)&&le(function(){return g(r,void 0,void 0,function(){var a,o,u;return v(this,function(c){return a=this._createMessageEventContext(e),(u=(o=this._handler)===null||o===void 0?void 0:o.onMessagesUpdated)===null||u===void 0||u.call(o,a,this.channel,[s]),[2]})})})}},n.prototype._applyPollVoteEventToView=function(t,e){var r=this,i=Lu(this._messages,t.messageId);if(i>=0){var s=this._messages[i];s&&s.isUserMessage()&&s.poll&&s.poll.applyPollVoteEvent(t)&&ps(e)&&le(function(){return g(r,void 0,void 0,function(){var a,o,u;return v(this,function(c){return a=this._createMessageEventContext(e),(u=(o=this._handler)===null||o===void 0?void 0:o.onMessagesUpdated)===null||u===void 0||u.call(o,a,this.channel,[s]),[2]})})})}},n.prototype._applyReactionEventToView=function(t,e){var r=this,i=Lu(this._messages,t.messageId);if(i>=0){var s=this._messages[i];s&&(s.isUserMessage()||s.isFileMessage()||s.isMultipleFilesMessage())&&ps(e)&&(s.applyReactionEvent(t),le(function(){return g(r,void 0,void 0,function(){var a,o,u;return v(this,function(c){return a=this._createMessageEventContext(e),(u=(o=this._handler)===null||o===void 0?void 0:o.onMessagesUpdated)===null||u===void 0||u.call(o,a,this.channel,[s]),[2]})})}))}},n.prototype._applyThreadInfoEventToView=function(t,e){var r=this,i=Lu(this._messages,t.targetMessageId);if(i>=0){var s=this._messages[i];s&&(s.isUserMessage()||s.isFileMessage()||s.isMultipleFilesMessage())&&ps(e)&&(s.applyThreadInfoUpdateEvent(t),le(function(){return g(r,void 0,void 0,function(){var a,o,u;return v(this,function(c){return a=this._createMessageEventContext(e),(u=(o=this._handler)===null||o===void 0?void 0:o.onMessagesUpdated)===null||u===void 0||u.call(o,a,this.channel,[s]),[2]})})}))}},n.prototype._removeMessagesFromView=function(t,e){var r,i,s=this,a=[],o=[],u=function(h){var f=c._messages.findIndex(function(_){return s.keyOf(_)===h});if(f>=0){var p=c._messages[f];a.push(c.keyOf(p)),o.push(p),c._messages.splice(f,1)}},c=this;try{for(var l=Z(t),d=l.next();!d.done;d=l.next())u(d.value)}catch(h){r={error:h}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}return ps(e)&&o.length>0&&le(function(){return g(s,void 0,void 0,function(){var h,f,p;return v(this,function(_){return h=this._createMessageEventContext(e),(p=(f=this._handler)===null||f===void 0?void 0:f.onMessagesDeleted)===null||p===void 0||p.call(f,h,this.channel,a,o),[2]})})}),a},n.prototype._removeUnsentMessageFromView=function(t,e){var r=this._unsentMessages.findIndex(function(i){return i.reqId===t});r>=0&&this._unsentMessages.splice(r,1)},n.prototype._getLocalMessages=function(t,e){var r=e.prevLimit,i=r===void 0?0:r,s=e.nextLimit,a=s===void 0?0:s,o=e.inclusive,u=o===void 0||o;return g(this,void 0,void 0,function(){var c,l,d,h,f;return v(this,function(p){switch(p.label){case 0:return c=[],u?[4,this._channelManager.getExactlyMatchingMessagesForTokenFromCache(this._channel.url,t,this.filter)]:[3,2];case 1:c=p.sent(),p.label=2;case 2:return i>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,t,"prev",this.filter,i,!1)]:[3,4];case 3:return d=p.sent(),[3,5];case 4:d=[],p.label=5;case 5:return l=d,a>0?[4,this._channelManager.getMessagesFromCache(this._channel.url,t,"next",this.filter,a,!1)]:[3,7];case 6:return f=p.sent(),[3,8];case 7:f=[],p.label=8;case 8:return h=f,[2,ce(ce(ce([],ie(c),!1),ie(l),!1),ie(h),!1).sort(function(_,m){return m.createdAt-_.createdAt})]}})})},n.prototype._getRemoteMessages=function(t,e){var r=e.prevLimit,i=r===void 0?0:r,s=e.nextLimit,a=s===void 0?0:s,o=e.source,u=o===void 0?z.REQUEST_MESSAGE:o,c=e.reverse,l=c!==void 0&&c,d=e.checkingHasNext,h=d!==void 0&&d,f=e.checkingContinuousMessages,p=f!==void 0&&f;return g(this,void 0,void 0,function(){var _,m;return v(this,function(b){switch(b.label){case 0:return _=Xt.of(this._iid),i>0||a>0?[4,_._getMessagesByTimestampForCollection(this._channel.url,this._channel.channelType,t,oe(A(A(A({},this.filter),Kv),{isInclusive:!0,reverse:l,prevResultSize:i,nextResultSize:a})),u,h,p)]:[3,2];case 1:return m=b.sent(),[3,3];case 2:m={messages:[],isContinuousMessages:!1},b.label=3;case 3:return[2,m]}})})},n.prototype._checkHugeGap=function(){var t,e,r,i,s;return g(this,void 0,void 0,function(){var a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k,O,x,Q,we,Ie,ze,$t=this;return v(this,function(Gt){switch(Gt.label){case 0:return a=M.of(this._iid),o=a.dispatcher,u=a.requestQueue,c=a.cacheContext,l=a.statLogCollector,d=a.logger,this._messages.length>0?(h=this._syncRange.top,f=this.viewTop,p=this._syncRange.bottom,_=this.hasNext?this.viewBottom:Number.MAX_SAFE_INTEGER,[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,f,h)]):[3,8];case 1:return m=Gt.sent(),[4,this._channelManager.getCachedMessageCountBetween(this._channel.url,this.filter,p,_)];case 2:b=Gt.sent(),Gt.label=3;case 3:return Gt.trys.push([3,5,6,7]),[4,dh(function(){return g($t,void 0,void 0,function(){var cr,qs,Ze,$s,ot,Yi,ht,Xn,er,Or,Zi,Ji,Hs,zn,bn,Zr,Jr,lr=this;return v(this,function(Xr){switch(Xr.label){case 0:return cr=new fA(A(A({channelUrl:this._channel.url,channelType:this._channel.channelType,prevStart:f,prevEnd:h,prevCount:m,nextStart:p,nextEnd:_,nextCount:b,checkingContinuousMessages:c.localCacheEnabled},this.filter),Kv)),[4,u.send(cr)];case 1:return qs=Xr.sent(),Ze=qs.as(pA),$s=Ze.isHugeGap,ot=Ze.prevMessages,Yi=ot===void 0?[]:ot,ht=Ze.prevHasMore,Xn=Ze.isContinuousPrevMessages,er=Ze.nextMessages,Or=er===void 0?[]:er,Zi=Ze.nextHasmore,Ji=Ze.isContinuousNextMessages,$s?le(function(){return g(lr,void 0,void 0,function(){var Et;return v(this,function(Mr){return!((Et=this._handler)===null||Et===void 0)&&Et.onHugeGapDetected&&this._handler.onHugeGapDetected(),[2]})})}):(Hs=this.viewTop,zn=this.viewBottom,bn=Math.min.apply(Math,ce([Number.MAX_SAFE_INTEGER,Hs],ie(Yi.map(function(Et){return Et.createdAt})),!1)),Zr=Math.max.apply(Math,ce([0,zn],ie(Or.map(function(Et){return Et.createdAt})),!1)),o.dispatch(new mt({messages:Yi,source:z.SYNC_MESSAGE_FILL})),o.dispatch(new mt({messages:Or,source:z.SYNC_MESSAGE_FILL})),this._syncRange.extends(bn,Zr),(Xn||Ji)&&((Jr=this._backgroundSync)===null||Jr===void 0||Jr.range.extends(bn,Zr)),ht&&this._prevFill.start(bn),Zi&&this._nextFill.start(Zr)),[2]}})})},1)];case 4:return Gt.sent(),[3,7];case 5:return y=Gt.sent(),d.debug("Failed HugeGap Check ",y),[3,7];case 6:return l.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:(e=(t=c.localCacheConfig)===null||t===void 0?void 0:t.maxSize)!==null&&e!==void 0?e:0,use_local_cache:c.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 7:return[3,13];case 8:E=Date.now(),Gt.label=9;case 9:return Gt.trys.push([9,11,12,13]),[4,this._getRemoteMessages(E,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit,source:z.SYNC_MESSAGE_FILL,checkingHasNext:!0,checkingContinuousMessages:c.localCacheEnabled})];case 10:if(T=Gt.sent(),N=T.messages,C=T.isContinuousMessages,L=T.hasNext,N.length>0){for(k=N.map(function(cr){return cr.createdAt}),O=0,x=0,Q=0;Q<k.length;Q++)(we=k[Q])<=E?O++:we>=E&&x++;this._hasPrevious=O>=this._prevResultLimit,this._hasNext=L??x>=this._nextResultLimit,(ze=this._syncRange).extends.apply(ze,ce([],ie(k),!1)),C&&((r=this._backgroundSync)===null||r===void 0||r.range.extends(this._syncRange.top,this._syncRange.bottom)),this._addMessagesToView(N,z.SYNC_MESSAGE_FILL)}else this._hasPrevious=!1,this._hasNext=!1;return[3,13];case 11:return(Ie=Gt.sent())instanceof U&&Ie.code===ae.NOT_FOUND_IN_DATABASE&&(this._hasPrevious=!1,this._hasNext=!1),[3,13];case 12:return l.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,measured_on:"gap_check",event:"cache_fetch",max_db_size:(s=(i=c.localCacheConfig)===null||i===void 0?void 0:i.maxSize)!==null&&s!==void 0?s:0,use_local_cache:c.localCacheEnabled,starting_point:0,message_init_policy:""}})),[7];case 13:return[2]}})})},n.prototype._loadUnsentMessages=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return t=this,[4,this._channelManager.getUnsentMessagesFromCache(this._channel.url,this.filter)];case 1:return t._unsentMessages=e.sent(),[2]}})})},n.prototype._hasPollMessage=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this._channelManager.getPollMessagesFromCache(this._channel.url,Date.now()+6e5,this.filter,1)];case 1:return t.sent().length>0?[2,!0]:[2,!1]}})})},n.prototype._refreshChannel=function(t){var e=this;Tt(function(){return g(e,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._channelManager.refreshChannel(this.channel.url,!0,t)];case 1:return r.sent(),[2]}})})})},n.prototype._startCheckMyMutedTimer=function(t){var e=this;this._clearCheckMyMutedTimer(),this._checkMyMutedStateTimer=setTimeout(function(){return g(e,void 0,void 0,function(){var r,i,s=this;return v(this,function(a){switch(a.label){case 0:this._checkMyMutedStateTimer=void 0,r=!0,a.label=1;case 1:return a.trys.push([1,3,4,5]),[4,this._channel.getMyMutedInfo()];case 2:return i=a.sent(),r=!i.isMuted,[3,5];case 3:return a.sent(),r=!0,[3,5];case 4:return r&&this.channel._runIfHandleableWithGroupChannel(function(o){var u,c;o.myMutedState=Ri.UNMUTED;var l=s._createChannelEventContext(z.EVENT_CHANNEL_UNMUTED);(c=(u=s._handler)===null||u===void 0?void 0:u.onChannelUpdated)===null||c===void 0||c.call(u,l,s.channel)}),[7];case 5:return[2]}})})},t+1e3)},n.prototype._clearCheckMyMutedTimer=function(){this._checkMyMutedStateTimer&&(clearTimeout(this._checkMyMutedStateTimer),this._checkMyMutedStateTimer=void 0)},n.prototype.initialize=function(t){var e=this,r=new gA;this._messages=[],this._unsentMessages=[],this._syncRange=new Pi({}),this._hasNext=!0,this._hasPrevious=!0,this._refreshChannel(z.REFRESH_CHANNEL);var i=M.of(this._iid),s=i.cacheContext,a=i.statLogCollector;return t===Vd.CACHE_AND_REPLACE_BY_API&&this._getLocalMessages(this._startingPoint,{prevLimit:this._prevResultLimit,nextLimit:this._nextResultLimit}).then(function(o){return g(e,void 0,void 0,function(){var u;return v(this,function(c){switch(c.label){case 0:return u=this._filterUnderOffsetMessage(o),this._addMessagesToView(u,z.REQUEST_MESSAGE),[4,this._loadUnsentMessages()];case 1:return c.sent(),r._invokeResponse("local",null,u),[2]}})})}).catch(function(o){if(ar(o))throw o;r._invokeResponse("local",o,null)}).finally(function(){var o=M.of(e._iid).cacheContext;e._getRemoteMessages(e._startingPoint,{prevLimit:e._prevResultLimit,nextLimit:e._nextResultLimit,reverse:!0,checkingHasNext:!0,checkingContinuousMessages:o.localCacheEnabled}).then(function(u){var c,l,d,h,f,p,_=u.messages,m=u.isContinuousMessages,b=u.hasNext,y=e._filterUnderOffsetMessage(_),E=!0;if(e._messages.length===y.length){var T=e._messages.map(function(x){return e.keyOf(x)});for(var N in y)if(!T.includes(e.keyOf(y[N]))){E=!1;break}}else E=!1;if(e._messages=[],y.length>0){var C=y.map(function(x){return x.createdAt}),L=0,k=0;for(N=0;N<C.length;N++){var O=C[N];O<e._startingPoint?L++:O>e._startingPoint&&k++}e._hasPrevious=L>=e._prevResultLimit,e._hasNext=b??k>=e._nextResultLimit,(c=e._syncRange).extends.apply(c,ce([],ie(y.map(function(x){return x.createdAt})),!1)),m&&((l=e._backgroundSync)===null||l===void 0||l.range.extends(e._syncRange.top,e._syncRange.bottom)),e._addMessagesToView(y,z.REQUEST_MESSAGE)}else e._hasPrevious=!1,e._hasNext=!1;a.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:e.channel.url,starting_point:e._startingPoint,measured_on:"initial_load",event:E?"cache_hit":"cache_miss",max_db_size:(h=(d=o.localCacheConfig)===null||d===void 0?void 0:d.maxSize)!==null&&h!==void 0?h:0,message_init_policy:t,use_local_cache:o.localCacheEnabled,collection_id:e._key}})),a.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:e.channel.url,starting_point:e._startingPoint,measured_on:"initial_load",event:"cache_fetch",max_db_size:(p=(f=o.localCacheConfig)===null||f===void 0?void 0:f.maxSize)!==null&&p!==void 0?p:0,message_init_policy:t,use_local_cache:o.localCacheEnabled,collection_id:e._key}})),r._invokeResponse("remote",null,y)}).catch(function(u){if(ar(u))throw u;r._invokeResponse("remote",u,null)})}),a.put(new Ya({type:lt.FEATURE_LOCALCACHE,data:{use_local_cache:s.localCacheEnabled,collection_interface:{message_init_policy:t}}})),r},n.prototype.loadPrevious=function(){var t,e,r;return g(this,void 0,void 0,function(){var i,s,a,o,u,c,l,d,h=this;return v(this,function(f){switch(f.label){case 0:if(this._isDisposed)throw new U({code:ae.COLLECTION_DISPOSED,message:"Collection has been disposed."});return i=M.of(this._iid),s=i.cacheContext,a=i.statLogCollector,o=i.logger,this._hasPrevious?this._isLoadingPrevious?(o.warn("Messages are already fetching."),[2,[]]):(this._isLoadingPrevious=!0,u=this.viewTop,c=[],[4,Tt(function(){return g(h,void 0,void 0,function(){var p;return v(this,function(_){switch(_.label){case 0:return p=this._filterUnderOffsetMessage,[4,this._getLocalMessages(u,{prevLimit:this._prevResultLimit,inclusive:!1})];case 1:return c=p.apply(this,[_.sent()]),[2]}})})})]):[2,[]];case 1:return f.sent(),l=c.length>=this._prevResultLimit,a.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_prev",event:s.localCacheEnabled&&l?"cache_hit":"cache_miss",max_db_size:(e=(t=s.localCacheConfig)===null||t===void 0?void 0:t.maxSize)!==null&&e!==void 0?e:0,use_local_cache:s.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),l&&(!((r=this._backgroundSync)===null||r===void 0)&&r.isWrappingMessages(c))?[3,3]:(d=!1,[4,Tt(function(){return g(h,void 0,void 0,function(){var p,_,m,b,y,E,T,N=this;return v(this,function(C){switch(C.label){case 0:return p=M.of(this._iid).cacheContext,[4,this._getRemoteMessages(u,{prevLimit:this._prevResultLimit,reverse:!0,checkingContinuousMessages:p.localCacheEnabled})];case 1:return _=C.sent(),(c=this._filterUnderOffsetMessage(_.messages)).length>0&&((m=this._syncRange).extends.apply(m,ce([],ie(c.map(function(L){return L.createdAt})),!1)),!((b=this._backgroundSync)===null||b===void 0)&&b.range.overlap(this._syncRange)&&_.isContinuousMessages&&(d=!0,(y=this._backgroundSync)===null||y===void 0||y.range.extends(this._syncRange.top))),c=c.filter(function(L){return fr(N._messages,L)<0}),this._hasPrevious=c.length>=this._prevResultLimit,d&&a.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_prev",event:"cache_fetch",max_db_size:(T=(E=p.localCacheConfig)===null||E===void 0?void 0:E.maxSize)!==null&&T!==void 0?T:0,use_local_cache:p.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),[2]}})})})]);case 2:return f.sent(),this._addMessagesToView(c,z.REQUEST_MESSAGE),[3,4];case 3:this._hasPrevious=c.length>=this._prevResultLimit,c.length>0&&this._addMessagesToView(c,z.REQUEST_MESSAGE),f.label=4;case 4:return this._isLoadingPrevious=!1,[2,c]}})})},n.prototype.loadNext=function(){var t,e,r;return g(this,void 0,void 0,function(){var i,s,a,o,u,c,l,d,h=this;return v(this,function(f){switch(f.label){case 0:if(this._isDisposed)throw new U({code:ae.COLLECTION_DISPOSED,message:"Collection has been disposed."});return i=M.of(this._iid),s=i.cacheContext,a=i.statLogCollector,o=i.logger,this._hasNext?this._isLoadingNext?(o.warn("Messages are already fetching."),[2,[]]):(this._isLoadingNext=!0,u=this.viewBottom,c=[],[4,Tt(function(){return g(h,void 0,void 0,function(){var p;return v(this,function(_){switch(_.label){case 0:return p=this._filterUnderOffsetMessage,[4,this._getLocalMessages(u,{nextLimit:this._nextResultLimit,inclusive:!1})];case 1:return c=p.apply(this,[_.sent()]),[2]}})})})]):[2,[]];case 1:return f.sent(),l=c.length>=this._nextResultLimit,a.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_next",event:s.localCacheEnabled&&l?"cache_hit":"cache_miss",max_db_size:(e=(t=s.localCacheConfig)===null||t===void 0?void 0:t.maxSize)!==null&&e!==void 0?e:0,use_local_cache:s.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),l&&(!((r=this._backgroundSync)===null||r===void 0)&&r.isWrappingMessages(c))?[3,3]:(d=!1,[4,Tt(function(){return g(h,void 0,void 0,function(){var p,_,m,b,y,E,T,N,C=this;return v(this,function(L){switch(L.label){case 0:return p=M.of(this._iid).cacheContext,[4,this._getRemoteMessages(u,{nextLimit:this._nextResultLimit,reverse:!0,checkingHasNext:!0,checkingContinuousMessages:p.localCacheEnabled})];case 1:return _=L.sent(),(c=this._filterUnderOffsetMessage(_.messages)).length>0&&((m=this._syncRange).extends.apply(m,ce([],ie(c.map(function(k){return k.createdAt})),!1)),!((b=this._backgroundSync)===null||b===void 0)&&b.range.overlap(this._syncRange)&&_.isContinuousMessages&&(d=!0,(y=this._backgroundSync)===null||y===void 0||y.range.extends(this._syncRange.bottom))),c=c.filter(function(k){return fr(C._messages,k)<0}),this._hasNext=(E=_.hasNext)!==null&&E!==void 0?E:c.length>=this._nextResultLimit,d&&a.put(new dn({type:lt.FEATURE_LOCALCACHE_EVENT,ts:Date.now(),data:{channel_url:this.channel.url,starting_point:this._startingPoint,measured_on:"load_next",event:"cache_fetch",max_db_size:(N=(T=p.localCacheConfig)===null||T===void 0?void 0:T.maxSize)!==null&&N!==void 0?N:0,use_local_cache:p.localCacheEnabled,collection_id:this._key,message_init_policy:""}})),[2]}})})})]);case 2:return f.sent(),this._addMessagesToView(c,z.REQUEST_MESSAGE),[3,4];case 3:this._hasNext=c.length>=this._nextResultLimit,c.length>0&&this._addMessagesToView(c,z.REQUEST_MESSAGE),f.label=4;case 4:return this._isLoadingNext=!1,[2,c]}})})},n.prototype.removeFailedMessage=function(t){return g(this,void 0,void 0,function(){var e;return v(this,function(r){switch(r.label){case 0:if(this._isDisposed)throw new U({code:ae.COLLECTION_DISPOSED,message:"Collection has been disposed."});return[4,this._channelManager.removeFailedMessageFromCache(t)];case 1:return r.sent(),(e=this._unsentMessages.findIndex(function(i){return i.reqId===t}))>-1&&this._unsentMessages.splice(e,1),[2]}})})},n.prototype.dispose=function(){var t,e,r,i=this;if(!this._isDisposed){this._isDisposed=!0;var s=M.of(this._iid),a=s.cacheContext,o=s.dispatcher;this._messages=[],this._clearCheckMyMutedTimer(),this._channel._runIfHandleableWithGroupChannel(function(u){if(u.myMemberState!==Nt.NONE){i._channel._updateMessageCollectionLastAccessedAt();var c=i._createChannelUpdateEventCommand(z.CHANNEL_LASTACCESSEDAT_UPDATED);c&&o.dispatch(c)}}),a.localCacheEnabled&&(this._prevFill.stop(),this._nextFill.stop()),(t=this._backgroundSync)===null||t===void 0||t.close(),(e=this._changelogSync)===null||e===void 0||e.close(),(r=this._pollChangelogSync)===null||r===void 0||r.close(),this._channelManager.unsubscribeChannelEvent(this._key),this._channelManager.unsubscribeMessageEvent(this._key),this._connectionEventContext&&this._connectionEventContext.close()}},n}(),EA=function(n){function t(e,r){return n.call(this,e,A(A({},r),{channelManager:Wt.of(e)}))||this}return w(t,n),t.prototype.keyOf=function(e){return e.messageId},t.prototype.initialize=function(e){var r=this;return Tt(function(){return g(r,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return[4,this.channel.getMyMutedInfo()];case 1:return(i=s.sent()).isMuted&&i.remainingDuration!==-1&&this._startCheckMyMutedTimer(i.remainingDuration),[2]}})})}),n.prototype.initialize.call(this,e)},t.prototype.setMessageCollectionHandler=function(e){this._setBaseMessageCollectionHandler(e)},t.prototype._activate=function(){return g(this,void 0,void 0,function(){var e=this;return v(this,function(r){switch(r.label){case 0:return[4,n.prototype._activate.call(this)];case 1:return r.sent(),[4,Tt(function(){return g(e,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return[4,this.channel.getMyMutedInfo()];case 1:return(i=s.sent()).isMuted&&i.remainingDuration!==-1&&this._startCheckMyMutedTimer(i.remainingDuration),[2]}})})})];case 2:return r.sent(),[2]}})})},t.prototype._addMessagesToView=function(e,r){var i,s,a=this,o=this._filterUnderOffsetMessage(e),u=[],c=[];try{for(var l=Z(o),d=l.next();!d.done;d=l.next()){var h=d.value;if(r===z.SYNC_MESSAGE_FILL)if(h.messageId>0){if((m=fr(this._messages,h))<0){fr(this._unsentMessages,h)<0&&u.push(h);var f=If(this._messages,h);this._messages.splice(f,0,h)}}else h instanceof kt&&(m=fr(this._unsentMessages,h))<0&&fr(this._messages,h)<0&&(this._unsentMessages.push(h),u.push(h));else if(h.messageId>0){if((m=fr(this._messages,h))<0){var p=fr(this._unsentMessages,h);p<0?u.push(h):(this._unsentMessages.splice(p,1),c.push(h)),f=If(this._messages,h),this._messages.splice(f,0,h)}else c.push(h),this._messages[m]=h;if(h.updatedAt>0){var _=this._updateChildMessagesInView(h);c.push.apply(c,ce([],ie(_),!1))}}else if(h instanceof kt){var m;(m=fr(this._unsentMessages,h))<0?fr(this._messages,h)<0&&(this._unsentMessages.push(h),u.push(h)):(c.push(h),this._unsentMessages[m]=h)}}}catch(b){i={error:b}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}ps(r)&&le(function(){return g(a,void 0,void 0,function(){var b,y,E,T,N;return v(this,function(C){return b=this._createMessageEventContext(r),u.length>0&&((E=(y=this._handler)===null||y===void 0?void 0:y.onMessagesAdded)===null||E===void 0||E.call(y,b,this.channel,u)),c.length>0&&((N=(T=this._handler)===null||T===void 0?void 0:T.onMessagesUpdated)===null||N===void 0||N.call(T,b,this.channel,c)),[2]})})})},t.prototype._updateMessagesToView=function(e,r){var i,s,a=this,o=[],u=[],c=[];try{for(var l=Z(e),d=l.next();!d.done;d=l.next()){var h,f=d.value;if(f.messageId>0)if((h=fr(this._messages,f))>=0)u.push(f),this._messages[h]=f;else{var p=fr(this._unsentMessages,f);if(p>=0){var _=ie(this._unsentMessages.splice(p,1),1)[0];if(this.hasNext&&_)c.push(_);else{u.push(f);var m=If(this._messages,f);this._messages.splice(m,0,f)}}else{var b=this._messages.map(function(y){return y.createdAt});(f.createdAt<Math.min.apply(Math,ce([],ie(b),!1))&&!this._hasPrevious||f.createdAt>Math.max.apply(Math,ce([],ie(b),!1))&&!this._hasNext)&&o.push(f)}}else f instanceof kt&&(h=fr(this._unsentMessages,f))>=0&&(u.push(f),this._unsentMessages[h]=f)}}catch(y){i={error:y}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}return ps(r)&&le(function(){return g(a,void 0,void 0,function(){var y,E,T,N,C;return v(this,function(L){return y=this._createMessageEventContext(r),u.length>0?(T=(E=this._handler)===null||E===void 0?void 0:E.onMessagesUpdated)===null||T===void 0||T.call(E,y,this.channel,u):c.length>0?(C=(N=this._handler)===null||N===void 0?void 0:N.onMessagesDeleted)===null||C===void 0||C.call(N,y,this.channel,[],c):o.length>0&&this._addMessagesToView(o,r),[2]})})}),u},t}(yA),bA={coverUrl:void 0,coverImage:void 0,isDistinct:void 0,isPublic:void 0,isDiscoverable:void 0,accessCode:void 0,name:void 0,data:void 0,customType:void 0,operatorUserIds:void 0,messageSurvivalSeconds:void 0},TA=function(n){function t(e){var r=this,i=e.channelUrl,s=e.token,a=e.limit,o=e.order,u=e.mutedMemberFilter,c=e.memberStateFilter,l=e.nicknameStartsWithFilter,d=e.operatorFilter;return(r=n.call(this)||this).method=j.GET,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/members"),r.params={token:s,limit:a,order:o,muted_member_filter:u,member_state_filter:c,nickname_startswith:l,operator_filter:d,show_member_is_muted:!0,show_read_receipt:!0,show_delivery_receipt:!0},r}return w(t,n),t}(K),wA=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.members=[];var s=r.next,a=r.members;return i.token=s,a&&a.length>0&&(i.members=a.map(function(o){return new Tr(e,o)})),i}return w(t,n),t}(W);(function(n){n.ALL="all",n.MUTED="muted",n.UNMUTED="unmuted"})(fc||(fc={})),function(n){n.MEMBER_NICKNAME_ALPHABETICAL="member_nickname_alphabetical",n.OPERATOR_THEN_MEMBER_ALPHABETICAL="operator_then_member_alphabetical"}(pc||(pc={})),function(n){n.ALL="all",n.JOINED="joined_only",n.INVITED="invited_only",n.INVITED_BY_FRIEND="invited_by_friend",n.INVITED_BY_NON_FRIEND="invited_by_non_friend"}(_c||(_c={}));var IA=function(n){function t(e,r,i){var s,a,o,u,c=this;return(c=n.call(this,e,r,xe.GROUP,i)||this).mutedMemberFilter=fc.ALL,c.memberStateFilter=_c.ALL,c.nicknameStartsWithFilter=null,c.operatorFilter=zd.ALL,c.order=pc.MEMBER_NICKNAME_ALPHABETICAL,c.mutedMemberFilter=(s=i.mutedMemberFilter)!==null&&s!==void 0?s:fc.ALL,c.memberStateFilter=(a=i.memberStateFilter)!==null&&a!==void 0?a:_c.ALL,c.nicknameStartsWithFilter=(o=i.nicknameStartsWithFilter)!==null&&o!==void 0?o:null,c.order=(u=i.order)!==null&&u!==void 0?u:pc.MEMBER_NICKNAME_ALPHABETICAL,c}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&be(fc,this.mutedMemberFilter)&&be(_c,this.memberStateFilter)&&(R("string",this.nicknameStartsWithFilter)||this.nicknameStartsWithFilter===null)&&be(zd,this.operatorFilter)&&be(pc,this.order)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new TA(oe(A(A({},this),{token:this._token}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(wA),a=s.members,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(wa),SA=function(n){function t(e){var r=this,i=e.channelUrl,s=e.userId,a=e.accessCode;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/accept"),r.params={user_id:s,access_code:a},r}return w(t,n),t}(K),CA=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new Nr(e,r),i.channel.myMemberState=Nt.JOINED,i}return w(t,n),t}(W),NA=function(n){function t(e){var r=this,i=e.channelUrl,s=e.isDistinct,a=e.isPublic,o=e.isDiscoverable,u=e.coverUrl,c=e.coverImage,l=e.accessCode,d=e.name,h=e.data,f=e.customType,p=e.operatorUserIds,_=e.messageSurvivalSeconds;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Mn,"/").concat(encodeURIComponent(i)),r.params=re({is_distinct:s,is_public:a,is_discoverable:o,name:d,data:h,custom_type:f,cover_url:u,cover_file:c,access_code:l,operator_ids:p,message_survival_seconds:_}),r}return w(t,n),t}(K),AA=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.channel=new Nr(e,r),i}return w(t,n),t}(W),kA=function(n){function t(e){var r=this,i=e.channelUrl;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Mn,"/").concat(encodeURIComponent(i)),r}return w(t,n),t}(K);(function(n){function t(e,r){return n.call(this,e,r)||this}w(t,n)})(W);var OA=function(n){function t(e){var r=this,i=e.channelUrl;return(r=n.call(this)||this).method=j.DELETE,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/hide"),r}return w(t,n),t}(K);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}w(t,n)})(W);var MA=function(n){function t(e){var r=e.userId,i=e.channelUrl,s=e.countPreference,a=n.call(this)||this;return a.method=j.PUT,a.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/count_preference/").concat(encodeURIComponent(i)),a.params={count_preference:s},a}return w(t,n),t}(K),DA=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.countPreference=r.count_preference,i}return w(t,n),t}(W),RA=function(n){function t(e){var r=this,i=e.channelUrl;return(r=n.call(this)||this).method=j.PUT,r.path="".concat(Mn,"/").concat(encodeURIComponent(i),"/reset_user_history"),r}return w(t,n),t}(K),UA=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.ts_message_offset;return i.messageOffsetTimestamp=s,i}return w(t,n),t}(W),LA=A(A({},O_),{scheduledAt:void 0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1}),PA=A(A({},Gy),{scheduledAt:void 0}),xA=function(n){function t(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===gn.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map(function(c){return c.userId})));var a=e.channelType,o=e.channelUrl,u=e.scheduledMessageId;return i.method=j.PUT,i.path="".concat(Le(a),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(u)),i.params=re(oe({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:tu.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(c){return Io.payloadify(c)}):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:(r=e.metaArrays)===null||r===void 0?void 0:r.map(function(c){return Kn.payloadify(c)}),apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption})),i}return w(t,n),t}(K),FA=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new qt(e,r),i}return w(t,n),t}(W),qA=function(n){function t(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===gn.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map(function(c){return c.userId})));var a=e.channelType,o=e.channelUrl,u=e.scheduledMessageId;return i.method=j.PUT,i.path="".concat(Le(a),"/").concat(encodeURIComponent(o),"/scheduled_messages/").concat(encodeURIComponent(u)),i.params=re(oe({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:tu.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:(r=e.metaArrays)===null||r===void 0?void 0:r.map(function(c){return Kn.payloadify(c)}),apple_critical_alert_options:e.appleCriticalAlertOptions?Kr.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),i}return w(t,n),t}(K);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new _n(e,r),i}w(t,n)})(W);var $A=function(n){function t(e){var r=n.call(this)||this,i=e.channelType,s=e.channelUrl,a=e.scheduledMessageId;return r.method=j.DELETE,r.path="".concat(Le(i),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(a)),r}return w(t,n),t}(K),HA=function(n){function t(e){var r=n.call(this)||this,i=e.channelType,s=e.channelUrl,a=e.scheduledMessageId;return r.method=j.POST,r.path="".concat(Le(i),"/").concat(encodeURIComponent(s),"/scheduled_messages/").concat(encodeURIComponent(a),"/send_now"),r}return w(t,n),t}(K),zA=function(n){function t(e){var r=e.userId,i=e.channelUrl,s=e.pushTriggerOption,a=n.call(this)||this;return a.method=j.PUT,a.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push_preference/").concat(encodeURIComponent(i)),a.params={push_trigger_option:s},a}return w(t,n),t}(K),GA=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i.enabled=r.enable,i}return w(t,n),t}(W),VA=function(n){function t(e){var r=e.userId,i=e.channelUrl,s=n.call(this)||this;return s.method=j.GET,s.path="".concat(Ue,"/").concat(encodeURIComponent(r),"/push_preference/").concat(encodeURIComponent(i)),s}return w(t,n),t}(K),BA=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i.enabled=r.enable,i}return w(t,n),t}(W),jA=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=n.call(this)||this;return a.method=j.POST,a.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/pin"),a}return w(t,n),t}(K);(function(n){function t(e,r){return n.call(this,e,r)||this}w(t,n)})(W);var KA=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=n.call(this)||this;return a.method=j.DELETE,a.path="".concat(Le(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/pin"),a}return w(t,n),t}(K);(function(n){function t(e,r){return n.call(this,e,r)||this}w(t,n)})(W);var vr,Cn,QA=function(n){function t(e,r){var i=n.call(this,e)||this;return i.message=null,i.message=$n(e,r.message),i}return w(t,n),t}(yn),WA=function(n){function t(e){var r=this,i=e.channelType,s=e.channelUrl,a=e.limit,o=e.token,u=e.includeReactions,c=e.includeMetaArray,l=e.includeParentMessageInfo,d=e.includeThreadInfo,h=e.includePollDetails;return(r=n.call(this)||this).method=j.GET,r.path="".concat(Le(i),"/").concat(encodeURIComponent(s),"/pinned_messages"),r.params=re({limit:a,token:o,include_reactions:u,with_sorted_meta_array:c,include_thread_info:d,include_parent_message_info:l,include_poll_details:h}),r}return w(t,n),t}(K),YA=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.pinned_messages,a=r.has_more,o=r.next;return i.pinnedMessages=s.map(function(u){return new QA(e,u)}),i.hasMore=a,i.token=o,i}return w(t,n),t}(W),ZA=function(n){function t(e,r,i,s){var a=n.call(this,e,r,i,s)||this;return a.includeMetaArray=s.includeMetaArray,a.includeReactions=s.includeReactions,a.includeParentMessageInfo=s.includeParentMessageInfo,a.includeThreadInfo=s.includeThreadInfo,a.includePollDetails=s.includePollDetails,a}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&R("boolean",this.includeMetaArray,!0)&&R("boolean",this.includeReactions,!0)&&R("boolean",this.includeParentMessageInfo,!0)&&R("boolean",this.includeThreadInfo,!0)&&R("boolean",this.includePollDetails,!0)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new WA(A(A({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=c.sent(),s=i.as(YA),a=s.pinnedMessages,o=s.hasMore,u=s.token,this._token=u,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(wa),JA=function(n){function t(e,r){var i,s,a=this;return(a=n.call(this,e)||this).channelUrl=(i=r.channel_url)!==null&&i!==void 0?i:"",a.channelType=(s=r.channel_type)!==null&&s!==void 0?s:xe.GROUP,a.member=new Oe(a._iid,r.user),a.deliveryAt=r.ts,a}return w(t,n),t}(yn);(function(n){n.ALL="all",n.UNREAD_MESSAGE_COUNT_ONLY="unread_message_count_only",n.UNREAD_MENTION_COUNT_ONLY="unread_mention_count_only",n.OFF="off"})(vr||(vr={})),function(n){n.UNHIDDEN="unhidden",n.HIDDEN_ALLOW_AUTO_UNHIDE="hidden_allow_auto_unhide",n.HIDDEN_PREVENT_AUTO_UNHIDE="hidden_prevent_auto_unhide"}(Cn||(Cn={}));var Nr=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k=this;return(k=n.call(this,e,r)||this)._unreadMemberStateMap=new Map,k._undeliveredMemberStateMap=new Map,k._typingStatus=new Map,k._lastMemberCountUpdated=0,k._typingStarted=0,k._typingEnded=0,k.isDistinct=!1,k.isSuper=!1,k.isBroadcast=!1,k.isExclusive=!1,k.isPublic=!1,k.isDiscoverable=!0,k.isChatNotification=!1,k.isAccessCodeRequired=!1,k.isPushEnabled=!1,k.unreadMessageCount=0,k.unreadMentionCount=0,k.members=[],k.memberCount=0,k.joinedMemberCount=0,k.hiddenState=Cn.UNHIDDEN,k.lastMessage=null,k.messageOffsetTimestamp=0,k.messageSurvivalSeconds=-1,k.myMemberState=Nt.NONE,k.myRole=Gr.NONE,k.myMutedState=Ri.UNMUTED,k.myLastRead=0,k.myCountPreference=vr.ALL,k.myPushTriggerOption=Ka.DEFAULT,k.inviter=null,k.invitedAt=0,k.joinedAt=0,k.pinnedMessageIds=[],k.lastPinnedMessage=null,k._pinnedMessagesUpdatedAt=0,k._myMutedRemainingTime=-1,k.channelType=xe.GROUP,k.isDistinct=(s=r.is_distinct)!==null&&s!==void 0&&s,k.isSuper=(a=r.is_super)!==null&&a!==void 0&&a,k.isBroadcast=(o=r.is_broadcast)!==null&&o!==void 0&&o,k.isExclusive=(u=r.is_exclusive)!==null&&u!==void 0&&u,k.isPublic=(c=r.is_public)!==null&&c!==void 0&&c,k.isDiscoverable=(l=r.is_discoverable)!==null&&l!==void 0?l:k.isPublic,k.isChatNotification=(d=r.is_chat_notification)!==null&&d!==void 0&&d,k.isAccessCodeRequired=(h=r.is_access_code_required)!==null&&h!==void 0&&h,k.isPushEnabled=(f=r.is_push_enabled)!==null&&f!==void 0&&f,Array.isArray(r.members)&&(i=k.members).push.apply(i,ce([],ie(r.members.map(function(O){return new Tr(k._iid,O)})),!1)),k.memberCount=(p=r.member_count)!==null&&p!==void 0?p:0,k.joinedMemberCount=(_=r.joined_member_count)!==null&&_!==void 0?_:0,k.hiddenState=be(Cn,r.hidden_state)?r.hidden_state:Cn.UNHIDDEN,k.messageOffsetTimestamp=(m=r.ts_message_offset)!==null&&m!==void 0?m:0,k.messageSurvivalSeconds=(b=r.message_survival_seconds)!==null&&b!==void 0?b:-1,k.lastMessage=r.last_message?$n(k._iid,A({channel_type:k.channelType},r.last_message)):null,r.read_receipt&&Object.keys(r.read_receipt).forEach(function(O){R("number",r.read_receipt[O])&&k._updateUnreadMemberState(O,r.read_receipt[O])}),r.delivery_receipt&&Object.keys(r.delivery_receipt).forEach(function(O){R("number",r.delivery_receipt[O])&&k._updateUndeliveredMemberState(O,r.delivery_receipt[O])}),k.myMemberState=be(Nt,r.member_state)?r.member_state:Nt.NONE,k.myRole=be(Gr,r.my_role)?r.my_role:Gr.NONE,be(Ri,r.is_muted)?k.myMutedState=r.is_muted:R("boolean",r.is_muted)?k.myMutedState=r.is_muted?Ri.MUTED:Ri.UNMUTED:k.myMutedState=Ri.UNMUTED,k.myCountPreference=be(vr,r.count_preference)?r.count_preference:vr.ALL,k.myPushTriggerOption=be(Ka,r.push_trigger_option)?r.push_trigger_option:Ka.ALL,k.myLastRead=(y=r.user_last_read)!==null&&y!==void 0?y:0,k.inviter=r.inviter?new Oe(k._iid,r.inviter):null,k.invitedAt=(E=r.invited_at)!==null&&E!==void 0?E:0,k.joinedAt=(T=r.joined_ts)!==null&&T!==void 0?T:0,k._updateUnreadCount((N=r.unread_message_count)!==null&&N!==void 0?N:0,(C=r.unread_mention_count)!==null&&C!==void 0?C:0),k.pinnedMessageIds=(L=r.pinned_message_ids)!==null&&L!==void 0?L:[],k.lastPinnedMessage=r.latest_pinned_message?$n(k._iid,A({channel_type:k.channelType},r.latest_pinned_message)):null,k}return w(t,n),Object.defineProperty(t.prototype,"isHidden",{get:function(){return this.hiddenState!==Cn.UNHIDDEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTyping",{get:function(){return this._typingStatus.size>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedUnreadMemberState",{get:function(){var e,r,i={};try{for(var s=Z(this._unreadMemberStateMap),a=s.next();!a.done;a=s.next()){var o=ie(a.value,2),u=o[0],c=o[1];i[u]=c}}catch(l){e={error:l}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cachedUndeliveredMemberState",{get:function(){var e,r,i={};try{for(var s=Z(this._undeliveredMemberStateMap),a=s.next();!a.done;a=s.next()){var o=ie(a.value,2),u=o[0],c=o[1];i[u]=c}}catch(l){e={error:l}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),t.payloadify=function(e){return re(oe(A(A({},n.payloadify.call(this,e)),{is_access_code_required:e.isAccessCodeRequired,is_distinct:e.isDistinct,is_super:e.isSuper,is_broadcast:e.isBroadcast,is_exclusive:e.isExclusive,is_public:e.isPublic,is_discoverable:e.isDiscoverable,is_muted:e.myMutedState,is_push_enabled:e.isPushEnabled,unread_message_count:e.unreadMessageCount,unread_mention_count:e.unreadMentionCount,push_trigger_option:e.myPushTriggerOption,count_preference:e.myCountPreference,hidden_state:e.hiddenState,member_count:e.memberCount,joined_member_count:e.joinedMemberCount,member_state:e.myMemberState,my_role:e.myRole,user_last_read:e.myLastRead,ts_message_offset:e.messageOffsetTimestamp,message_survival_seconds:e.messageSurvivalSeconds,read_receipt:e.cachedUnreadMemberState,delivery_receipt:e.cachedUndeliveredMemberState,members:e.members.map(function(r){return Tr.payloadify(r)}),last_message:e.lastMessage?mv(e.lastMessage):null,inviter:e.inviter?Oe.payloadify(e.inviter):null,invited_at:e.invitedAt,joined_ts:e.joinedAt,pinned_message_ids:e.pinnedMessageIds,latest_pinned_message:e.lastPinnedMessage?mv(e.lastPinnedMessage):null})))},t.prototype._shouldUpdateLastMessageWith=function(e){return!(e instanceof kt&&e.parentMessageId>0&&!e.replyToChannel)&&!e.silent&&(!this.lastMessage||this.lastMessage.createdAt<e.createdAt||this.lastMessage.createdAt===e.createdAt&&this.lastMessage.messageId===e.messageId&&this.lastMessage.updatedAt<e.updatedAt)},t.prototype._tryUpdateLastMessageAndCallEvents=function(e,r){var i=M.of(this._iid).dispatcher,s=Wt.of(this._iid);this._updateLastMessage(r),s.handlers.map(function(a){a.onChannelChanged&&a.onChannelChanged(e)}),i.dispatch(new Ne({channels:[e],source:z.EVENT_MESSAGE_SENT}))},t.prototype._updateLastMessage=function(e){return!!this._shouldUpdateLastMessageWith(e)&&(this.lastMessage=e,!0)},t.prototype._updateUnreadCount=function(e,r){if(typeof e=="number"&&e>=0)if(this.myCountPreference===vr.ALL||this.myCountPreference===vr.UNREAD_MESSAGE_COUNT_ONLY)if(this.isExclusive||this.isSuper||this.isBroadcast){var i=M.of(this._iid).maxSuperGroupChannelUnreadCount;this.unreadMessageCount=i&&e>=i?i:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;else this.unreadMessageCount=0;typeof r=="number"&&r>=0&&(this.myCountPreference===vr.ALL||this.myCountPreference===vr.UNREAD_MENTION_COUNT_ONLY)?this.unreadMentionCount=r:this.unreadMentionCount=0},t.prototype._updateUnreadMemberState=function(e,r){var i=this._unreadMemberStateMap.get(e);return(!i||i<r)&&(this._unreadMemberStateMap.set(e,r),M.of(this._iid).sdkState.userId===e&&(this.myLastRead=r),!0)},t.prototype._updateUndeliveredMemberState=function(e,r){var i=this._undeliveredMemberStateMap.get(e);return(!i||i<r)&&(this._undeliveredMemberStateMap.set(e,r),!0)},t.prototype._updateTypingStatus=function(e,r){r===void 0&&(r=new Date().getTime()),r>0?this._typingStatus.set(e.userId,{user:e,ts:r}):this._typingStatus.delete(e.userId)},t.prototype._clearTypingStatus=function(){this._typingStatus.clear(),this._typingStarted=0,this._typingEnded=0},t.prototype._setLatestMemberCount=function(e,r,i){var s=!1;return i>=this._lastMemberCountUpdated&&(this._lastMemberCountUpdated=i,s=e!==this.memberCount||r!==this.joinedMemberCount,this.memberCount=e,this.joinedMemberCount=r),s},t.prototype.isReadMessage=function(e){var r=M.of(this._iid).sdkState,i=this._unreadMemberStateMap.get(r.userId);return!!i&&i>=e.createdAt},t.prototype.serialize=function(){var e=this;return Xc(this,function(r){r.cachedUnreadMemberState=e.cachedUnreadMemberState,r.cachedUndeliveredMemberState=e.cachedUndeliveredMemberState})},t.prototype.createMessageCollection=function(e){return e===void 0&&(e={}),new EA(this._iid,A(A({},e),{channel:this}))},t.prototype.createMemberListQuery=function(e){return e===void 0&&(e={}),new IA(this._iid,this.url,e)},t.prototype.createPinnedMessageListQuery=function(e){return e===void 0&&(e={}),new ZA(this._iid,this.url,this.channelType,e)},t.prototype.addMember=function(e,r){if(r===void 0&&(r=0),!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var i=this.members.findIndex(function(a){return a.userId===e.userId});if(i>-1){var s=this.members[i];s.state===Nt.JOINED&&(e.state=s.state),this.members.splice(i,1),this.memberCount--}this.members.push(e),this.memberCount++,this._updateUnreadMemberState(e.userId,r),this._updateUndeliveredMemberState(e.userId,r)}},t.prototype.removeMember=function(e){if(!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var r=e instanceof Tr?e.userId:e,i=this.members.findIndex(function(s){return s.userId===r});if(i>-1)return this.members.splice(i,1),this.memberCount--,!0}return!1},t.prototype.getUnreadMemberCount=function(e){var r,i;if(e instanceof kt&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var s=M.of(this._iid).sdkState,a=e.createdAt,o=0;try{for(var u=Z(this.members),c=u.next();!c.done;c=u.next()){var l=c.value;s.userId!==l.userId&&l.state===Nt.JOINED&&e.sender.userId!==l.userId&&(this.cachedUnreadMemberState[l.userId]||0)<a&&o++}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return o}return 0},t.prototype.getUndeliveredMemberCount=function(e){var r,i;if(e instanceof kt&&!this.isExclusive&&!this.isSuper&&!this.isBroadcast){var s=M.of(this._iid).sdkState,a=e.createdAt,o=0;try{for(var u=Z(this.members),c=u.next();!c.done;c=u.next()){var l=c.value;s.userId!==l.userId&&l.state===Nt.JOINED&&e.sender.userId!==l.userId&&(this.cachedUndeliveredMemberState[l.userId]||0)<a&&o++}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return o}return 0},t.prototype.getReadMembers=function(e,r){var i=this;r===void 0&&(r=!1);var s=M.of(this._iid).sdkState;if(!s.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var a=e instanceof kt?e.sender:null,o=[];return this.members.forEach(function(u){if(r||u.userId!==s.userId&&u.userId!==(a==null?void 0:a.userId)){var c=i._unreadMemberStateMap.get(u.userId);c&&c>=e.createdAt&&o.push(u)}}),o},t.prototype.getUnreadMembers=function(e,r){var i=this;r===void 0&&(r=!1);var s=M.of(this._iid).sdkState;if(!s.userId||this.isExclusive||this.isSuper||this.isBroadcast)return[];var a=e instanceof kt?e.sender:null,o=[];return this.members.forEach(function(u){if(r||u.userId!==s.userId&&u.userId!==(a==null?void 0:a.userId)){var c=i._unreadMemberStateMap.get(u.userId);c&&c<e.createdAt&&o.push(u)}}),o},t.prototype.getReadStatus=function(e){var r=this;e===void 0&&(e=!1);var i=M.of(this._iid).sdkState;if(!i.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var s={};return this.members.forEach(function(a){if(e||a.userId!==i.userId){var o=r._unreadMemberStateMap.get(a.userId);s[a.userId]=new oE(r._iid,{channel_url:r.url,channel_type:r.channelType,user:Tr.payloadify(a),ts:o??0})}}),s},t.prototype.getDeliveryStatus=function(e){var r=this;e===void 0&&(e=!0);var i=M.of(this._iid).sdkState;if(!i.userId||this.isExclusive||this.isSuper||this.isBroadcast)return null;var s={};return this.members.forEach(function(a){if(e||a.userId!==i.userId){var o=r._undeliveredMemberStateMap.get(a.userId);s[a.userId]=new JA(r._iid,{channel_url:r.url,channel_type:r.channelType,user:Tr.payloadify(a),ts:o??0})}}),s},t.prototype.getTypingUsers=function(){var e=[];return this._typingStatus.forEach(function(r){var i=r.user;e.push(i)}),e},t.prototype.invalidateTypingStatus=function(){var e=this,r=M.of(this._iid).typingIndicatorInvalidateTime,i=Date.now(),s=!1;return this._typingStatus.forEach(function(a,o){var u=a.ts;i-u>=r&&(e._typingStatus.delete(o),s=!0)}),s},t.prototype.refresh=function(){return g(this,void 0,void 0,function(){return v(this,function(e){return[2,this._refresh()]})})},t.prototype._refresh=function(e){return e===void 0&&(e=!1),g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return r=M.of(this._iid),i=r.requestQueue,s=r.dispatcher,a=new Pp({channelUrl:this.url}),[4,i.send(a)];case 1:return o=c.sent(),u=o.as(xp).channel,this._update(u),e||s.dispatch(new Ne({channels:[u],source:z.REFRESH_CHANNEL})),[2,this]}})})},t.prototype.freeze=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,n.prototype.freeze.call(this)];case 1:return e.sent(),M.of(this._iid).dispatcher.dispatch(new Ne({channels:[this],source:z.EVENT_CHANNEL_FROZEN,isWebSocketEventComing:!0})),[2]}})})},t.prototype.unfreeze=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,n.prototype.unfreeze.call(this)];case 1:return e.sent(),M.of(this._iid).dispatcher.dispatch(new Ne({channels:[this],source:z.EVENT_CHANNEL_UNFROZEN,isWebSocketEventComing:!0})),[2]}})})},t.prototype.updateChannel=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return r=A(A({},bA),e),B(function(d){return R("string",d.coverUrl,!0)&&(On(d.coverImage)||R("string",d.coverImage,!0))&&R("boolean",d.isDistinct,!0)&&R("boolean",d.isPublic,!0)&&R("boolean",d.isDiscoverable,!0)&&R("string",d.accessCode,!0)&&R("string",d.name,!0)&&R("string",d.data,!0)&&R("string",d.customType,!0)&&Ae("string",d.operatorUserIds,!0)&&R("number",d.messageSurvivalSeconds,!0)}(r)).throw(U.invalidParameters),i=M.of(this._iid),s=i.dispatcher,a=i.requestQueue,o=new NA(A({channelUrl:this.url},r)),[4,a.send(o)];case 1:return u=l.sent(),c=u.as(AA).channel,this._update(c),s.dispatch(new Ne({channels:[c],source:z.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),[2,this]}})})},t.prototype.invite=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return B(e.every(function(i){return i instanceof Oe})).throw(U.invalidParameters),[2,this.inviteWithUserIds(e.map(function(i){return i.userId}))]})})},t.prototype.inviteWithUserIds=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return B(Ae("string",e)).throw(U.invalidParameters),r=M.of(this._iid),i=r.dispatcher,s=r.requestQueue,a=new jN({channelUrl:this.url,userIds:e}),[4,s.send(a)];case 1:return o=c.sent(),u=o.as(KN).channel,this._update(u),i.dispatch(new Ne({channels:[u],source:z.EVENT_CHANNEL_INVITED,isWebSocketEventComing:!0})),[2,this]}})})},t.prototype.join=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return B(R("string",e,!0)).throw(U.invalidParameters),r=M.of(this._iid),i=r.dispatcher,s=r.sdkState,a=r.requestQueue,o=new HN({channelUrl:this.url,userId:s.userId,accessCode:e}),[4,a.send(o)];case 1:return u=l.sent(),(c=u.as(zN).channel).myMemberState=this.myMemberState=Nt.JOINED,this._update(c),i.dispatch(new Ne({channels:[c],source:z.EVENT_CHANNEL_JOINED,isWebSocketEventComing:!0})),[2,this]}})})},t.prototype.leave=function(e){return e===void 0&&(e=!1),g(this,void 0,void 0,function(){var r,i,s,a;return v(this,function(o){switch(o.label){case 0:return r=M.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new VN({channelUrl:this.url,userId:i.userId,shouldRemoveOperatorStatus:e}),[4,s.send(a)];case 1:return o.sent(),this.myMemberState=Nt.NONE,[2]}})})},t.prototype.acceptInvitation=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return B(R("string",e,!0)).throw(U.invalidParameters),r=M.of(this._iid),i=r.dispatcher,s=r.sdkState,a=r.requestQueue,o=new SA({channelUrl:this.url,userId:s.userId,accessCode:e}),[4,a.send(o)];case 1:return u=l.sent(),(c=u.as(CA).channel).myMemberState=this.myMemberState=Nt.JOINED,this._update(c),i.dispatch(new Ne({channels:[c],source:z.EVENT_CHANNEL_ACCEPTED_INVITE,isWebSocketEventComing:!0})),[2,this]}})})},t.prototype.declineInvitation=function(){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new WN({channelUrl:this.url,userId:r.userId}),[4,i.send(s)];case 1:return a.sent(),this.myMemberState=Nt.NONE,[2,this]}})})},t.prototype.sendUserMessage=function(e){var r=this,i=new rr,s=M.of(this._iid).dispatcher,a=Bu.of(this._iid);return n.prototype.sendUserMessage.call(this,e).onPending(function(o){a.completeCurrentAndProcessNextAutoResend(o),i._trigger(o)}).onFailed(function(o,u){u&&a.completeCurrentAndProcessNextAutoResend(u),i._triggerFailed(o,u)}).onSucceeded(function(o){r.hiddenState===Cn.HIDDEN_ALLOW_AUTO_UNHIDE&&(r.hiddenState=Cn.UNHIDDEN),a.completeCurrentAndProcessNextAutoResend(o),r._updateLastMessage(o),Wt.of(r._iid).handlers.map(function(u){u.onChannelChanged&&u.onChannelChanged(r)}),s.dispatch(new Ne({channels:[r],source:z.EVENT_MESSAGE_SENT})),i._trigger(o)}),i},t.prototype.updateUserMessage=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o,u=this;return v(this,function(c){switch(c.label){case 0:return i=M.of(this._iid).dispatcher,[4,n.prototype.updateUserMessage.call(this,e,r)];case 1:return s=c.sent(),a=this._updateLastMessage(s),o=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===s.messageId&&(this.lastPinnedMessage=s,a=!0,o=!0),a&&(Wt.of(this._iid).handlers.map(function(l){l.onChannelChanged&&l.onChannelChanged(u)}),i.dispatch(new Ne({channels:[this],source:o?z.EVENT_PINNED_MESSAGE_UPDATED:z.EVENT_MESSAGE_UPDATED}))),o&&Wt.of(this._iid).handlers.map(function(l){l.onPinnedMessageUpdated&&l.onPinnedMessageUpdated(u)}),i.dispatch(new mt({messages:[s],source:z.EVENT_MESSAGE_UPDATED})),[2,s]}})})},t.prototype._autoResendUserMessage=function(e){var r=this,i=new rr,s=M.of(this._iid).dispatcher,a=Bu.of(this._iid);return n.prototype._autoResendUserMessage.call(this,e).onPending(function(o){a.completeCurrentAndProcessNextAutoResend(o),i._trigger(o)}).onFailed(function(o,u){a.completeCurrentAndProcessNextAutoResend(u),i._triggerFailed(o,u)}).onSucceeded(function(o){var u=Wt.of(r._iid);a.completeCurrentAndProcessNextAutoResend(o),r._updateLastMessage(o),u.handlers.map(function(c){c.onChannelChanged&&c.onChannelChanged(r)}),s.dispatch(new Ne({channels:[r],source:z.EVENT_MESSAGE_SENT})),i._trigger(o)}),i},t.prototype.sendFileMessage=function(e){var r=this,i=new rr,s=M.of(this._iid).dispatcher,a=Bu.of(this._iid);return n.prototype.sendFileMessage.call(this,e).onPending(function(o){a.completeCurrentAndProcessNextAutoResend(o),i._trigger(o)}).onFailed(function(o,u){u&&a.completeCurrentAndProcessNextAutoResend(u),i._triggerFailed(o,u)}).onSucceeded(function(o){var u=Wt.of(r._iid);a.completeCurrentAndProcessNextAutoResend(o),r._updateLastMessage(o),u.handlers.map(function(c){c.onChannelChanged&&c.onChannelChanged(r)}),s.dispatch(new Ne({channels:[r],source:z.EVENT_MESSAGE_SENT})),i._trigger(o)}),i},t.prototype.sendMultipleFilesMessage=function(e){var r=this,i=new fd,s=M.of(this._iid).dispatcher;return n.prototype.sendMultipleFilesMessage.call(this,e).onPending(function(a){i._trigger(a)}).onFailed(function(a,o){i._triggerFailed(a,o)}).onSucceeded(function(a){var o=Wt.of(r._iid);r._updateLastMessage(a),o.handlers.map(function(u){u.onChannelChanged&&u.onChannelChanged(r)}),s.dispatch(new Ne({channels:[r],source:z.EVENT_MESSAGE_SENT})),i._trigger(a)}).onFileUploaded(function(a,o,u,c){i._triggerOnFileUploaded(a,o,u,c)}),i},t.prototype.updateFileMessage=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o,u=this;return v(this,function(c){switch(c.label){case 0:return i=M.of(this._iid).dispatcher,[4,n.prototype.updateFileMessage.call(this,e,r)];case 1:return s=c.sent(),a=this._updateLastMessage(s),o=!1,this.lastPinnedMessage&&this.lastPinnedMessage.messageId===s.messageId&&(this.lastPinnedMessage=s,a=!0,o=!0),a&&(Wt.of(this._iid).handlers.map(function(l){l.onChannelChanged&&l.onChannelChanged(u)}),i.dispatch(new Ne({channels:[this],source:o?z.EVENT_PINNED_MESSAGE_UPDATED:z.EVENT_MESSAGE_UPDATED}))),o&&Wt.of(this._iid).handlers.map(function(l){l.onPinnedMessageUpdated&&l.onPinnedMessageUpdated(u)}),i.dispatch(new mt({messages:[s],source:z.EVENT_MESSAGE_UPDATED})),[2,s]}})})},t.prototype._autoResendFileMessage=function(e){var r=this,i=new rr,s=M.of(this._iid).dispatcher,a=Bu.of(this._iid);return n.prototype._autoResendFileMessage.call(this,e).onPending(function(o){a.completeCurrentAndProcessNextAutoResend(o),i._trigger(o)}).onFailed(function(o,u){a.completeCurrentAndProcessNextAutoResend(u),i._triggerFailed(o,u)}).onSucceeded(function(o){var u=Wt.of(r._iid);a.completeCurrentAndProcessNextAutoResend(o),r._updateLastMessage(o),u.handlers.map(function(c){c.onChannelChanged&&c.onChannelChanged(r)}),s.dispatch(new Ne({channels:[r],source:z.EVENT_MESSAGE_SENT})),i._trigger(o)}),i},t.prototype.deleteMessage=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,n.prototype.deleteMessage.call(this,e)];case 1:return r.sent(),e.messageId===0&&e instanceof kt&&M.of(this._iid).dispatcher.dispatch(new Cy({reqId:e.reqId,source:z.EVENT_MESSAGE_DELETED})),[2]}})})},t.prototype.hide=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l;return v(this,function(d){switch(d.label){case 0:return r=A(A({},Fp),e),B(function(h){return R("boolean",h.hidePreviousMessages,!0)&&R("boolean",h.allowAutoUnhide,!0)}(r)).throw(U.invalidParameters),i=M.of(this._iid),s=i.dispatcher,a=i.sdkState,o=i.requestQueue,u=new ZN(A({channelUrl:this.url,userId:a.userId},r)),[4,o.send(u)];case 1:return c=d.sent(),l=c.as(JN).messageOffsetTimestamp,this.hiddenState=r.allowAutoUnhide?Cn.HIDDEN_ALLOW_AUTO_UNHIDE:Cn.HIDDEN_PREVENT_AUTO_UNHIDE,r.hidePreviousMessages&&this._updateUnreadCount(0,0),l&&(this.messageOffsetTimestamp=l),s.dispatch(new Ne({channels:[this],source:z.EVENT_CHANNEL_HIDDEN,isWebSocketEventComing:!0})),[2,this]}})})},t.prototype.unhide=function(){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return e=M.of(this._iid),r=e.dispatcher,i=e.requestQueue,s=new OA({channelUrl:this.url}),[4,i.send(s)];case 1:return a.sent(),this.hiddenState=Cn.UNHIDDEN,r.dispatch(new Ne({channels:[this],source:z.EVENT_CHANNEL_UNHIDDEN,isWebSocketEventComing:!0})),[2,this]}})})},t.prototype.delete=function(){return g(this,void 0,void 0,function(){var e,r;return v(this,function(i){switch(i.label){case 0:return e=M.of(this._iid).requestQueue,r=new kA({channelUrl:this.url}),[4,e.send(r)];case 1:return i.sent(),[2]}})})},t.prototype.markAsRead=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c=this;return v(this,function(l){switch(l.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.dispatcher,s=e.requestQueue,a=new aA({channelUrl:this.url}),[4,s.send(a)];case 1:return o=l.sent(),u=o.as(hE).readStatus,this._updateUnreadMemberState(r.userId,u.readAt),(this.unreadMessageCount>0||this.unreadMentionCount>0)&&(this._updateUnreadCount(0,0),Wt.of(this._iid).handlers.map(function(d){d.onChannelChanged&&d.onChannelChanged(c)})),i.dispatch(new Ne({channels:[this],source:z.EVENT_CHANNEL_READ})),[2]}})})},t.prototype.markAsDelivered=function(){return g(this,void 0,void 0,function(){var e,r,i,s;return v(this,function(a){switch(a.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new oA({channelUrl:this.url,userId:r.userId}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},t.prototype.startTyping=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return e=M.of(this._iid),r=e.requestQueue,i=e.typingIndicatorThrottle,(s=new Date().getTime())-this._typingStarted>=i?(this._typingStarted=s,this._typingEnded=0,a=new eA({channelUrl:this.url,time:this._typingStarted}),[4,r.send(a)]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},t.prototype.endTyping=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a;return v(this,function(o){switch(o.label){case 0:return e=M.of(this._iid),r=e.requestQueue,i=e.typingIndicatorThrottle,(s=new Date().getTime())-this._typingEnded>=i?(this._typingStarted=0,this._typingEnded=s,a=new nA({channelUrl:this.url,time:this._typingStarted}),[4,r.send(a)]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},t.prototype.createScheduledUserMessage=function(e){e=A(A({},jS),e),B(KS(e)).throw(U.invalidParameters);var r=new rr;return this._createScheduledUserMessage(e,r),r},t.prototype.updateScheduledUserMessage=function(e,r){return g(this,void 0,void 0,function(){var i,s,a,o;return v(this,function(u){switch(u.label){case 0:return i=A(A({},PA),r),B(function(c){return Vy(c)&&R("number",c.scheduledAt,!0)}(i)).throw(U.invalidParameters),s=M.of(this._iid).requestQueue,a=new qA(A({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},i)),[4,s.send(a)];case 1:return o=u.sent(),[2,o.as(jy).message]}})})},t.prototype.createScheduledFileMessage=function(e){var r=this;e=A(A({},QS),e),B(WS(e)).throw(U.invalidParameters);var i=Date.now(),s=this._generateRequestId(),a=new rr;return mr(wS).then(function(){var o=r._createPendingScheduledFileMessage(e,s,i);le(function(){return g(r,void 0,void 0,function(){return v(this,function(u){return[2,a._trigger(o)]})})})}),On(e.file)?this._uploadFileAndUpdateParams(e).then(function(){return r._createScheduledFileMessage(e,a,s,i)}):this._createScheduledFileMessage(e,a,s,i),a},t.prototype.updateScheduledFileMessage=function(e,r){return g(this,void 0,void 0,function(){var i,s,a;return v(this,function(o){switch(o.label){case 0:return i=A(A({},LA),r),B(function(u){return M_(u)&&R("number",u.scheduledAt,!0)&&(On(u.file)||R("string",u.fileUrl))&&R("string",u.fileName,!0)&&R("string",u.mimeType,!0)&&R("number",u.fileSize,!0)&&(u.thumbnailSizes===null||u.thumbnailSizes===void 0||u.thumbnailSizes.every(function(c){return R("object",c)&&c.maxWidth>0&&c.maxHeight>0}))}(i)).throw(U.invalidParameters),On(i.file)?[4,this._uploadFileAndUpdateParams(i)]:[3,2];case 1:o.sent(),o.label=2;case 2:return s=new xA(A({reqId:this._generateRequestId(),scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url},i)),[4,M.of(this._iid).requestQueue.send(s)];case 3:return a=o.sent(),[2,a.as(FA).message]}})})},t.prototype.cancelScheduledMessage=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=new $A({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,M.of(this._iid).requestQueue.send(r)];case 1:return i.sent(),[2]}})})},t.prototype.sendScheduledMessageNow=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){switch(i.label){case 0:return r=new HA({scheduledMessageId:e,channelType:this.channelType,channelUrl:this.url}),[4,M.of(this._iid).requestQueue.send(r)];case 1:return i.sent(),[2]}})})},t.prototype.getMyPushTriggerOption=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return e=M.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new VA({userId:r.userId,channelUrl:this.url}),[4,i.send(s)];case 1:return a=u.sent(),o=a.as(BA).pushTriggerOption,this.myPushTriggerOption=o,[2,o]}})})},t.prototype.setMyPushTriggerOption=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return B(be(Ka,e)).throw(U.invalidParameters),r=M.of(this._iid),i=r.dispatcher,s=r.sdkState,a=r.requestQueue,o=new zA({userId:s.userId,channelUrl:this.url,pushTriggerOption:e}),[4,a.send(o)];case 1:return u=l.sent(),c=u.as(GA).pushTriggerOption,this.myPushTriggerOption=c,i.dispatch(new Ne({channels:[this],source:z.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),[2,c]}})})},t.prototype.setMyCountPreference=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return v(this,function(l){switch(l.label){case 0:return B(be(vr,e)).throw(U.invalidParameters),r=M.of(this._iid),i=r.dispatcher,s=r.sdkState,a=r.requestQueue,o=new MA({channelUrl:this.url,userId:s.userId,countPreference:e}),[4,a.send(o)];case 1:return u=l.sent(),c=u.as(DA).countPreference,this.myCountPreference=c,this._updateUnreadCount(this.unreadMessageCount,this.unreadMentionCount),i.dispatch(new Ne({channels:[this],source:z.EVENT_CHANNEL_UPDATED,isWebSocketEventComing:!0})),[2,c]}})})},t.prototype.resetMyHistory=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return e=M.of(this._iid),r=e.dispatcher,i=e.requestQueue,s=new RA({channelUrl:this.url}),[4,i.send(s)];case 1:return a=u.sent(),o=a.as(UA).messageOffsetTimestamp,this.messageOffsetTimestamp=o,this.lastMessage&&this.lastMessage.createdAt<o&&(this.lastMessage=null),r.dispatch(new Ne({channels:[this],source:z.EVENT_CHANNEL_RESET_HISTORY,isWebSocketEventComing:!0})),[2,this]}})})},t.prototype.pinMessage=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return B(R("number",e)&&e>0).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new jA({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.unpinMessage=function(e){return g(this,void 0,void 0,function(){var r,i;return v(this,function(s){switch(s.label){case 0:return B(R("number",e)&&e>0).throw(U.invalidParameters),r=M.of(this._iid).requestQueue,i=new KA({channelType:this.channelType,channelUrl:this.url,messageId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype._uploadFileAndUpdateParams=function(e){return g(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h;return v(this,function(f){switch(f.label){case 0:return On(e.file)?(r=M.of(this._iid).requestQueue,i=new xd({file:e.file,channelUrl:this.url,thumbnailSizes:e.thumbnailSizes,requestId:this._generateRequestId()}),[4,r.send(i)]):[3,2];case 1:s=f.sent(),a=s.as(Fd),o=a.url,u=a.fileSize,c=u===void 0?e.fileSize:u,l=a.thumbnails,d=a.requireAuth,h=d!==void 0&&d,e.fileUrl=o,e.fileSize=c,e.thumbnailSizes=l==null?void 0:l.map(function(p){return{maxWidth:p.width,maxHeight:p.height}}),e.requireAuth=h,f.label=2;case 2:return[2]}})})},t.prototype.resendMessage=function(e,r){var i,s=this;if(B(e instanceof kt&&!e.scheduledInfo&&e.isResendable).throw(U.invalidParameters),e.isUserMessage()){var a=(i=e.messageParams)!==null&&i!==void 0?i:Sp(e),o=new rr;return this._sendUserMessage(a,ln.RESEND,e.reqId).onPending(function(d){o._trigger(d)}).onFailed(function(d,h){o._triggerFailed(d,h)}).onSucceeded(function(d){s._tryUpdateLastMessageAndCallEvents(s,d),o._trigger(d)}),o}if(e.isFileMessage()){var u=this._validateFailedFileMessageHasFile(e,r);B(u).throw(U.invalidParameters),a=Cp(e,r);var c=new rr;return this._sendFileMessage(a,ln.RESEND,e.reqId).onPending(function(d){c._trigger(d)}).onFailed(function(d,h){c._triggerFailed(d,h)}).onSucceeded(function(d){s._tryUpdateLastMessageAndCallEvents(s,d),c._trigger(d)}),c}if(e.isMultipleFilesMessage()){a=e.messageParams;var l=new fd;return this._sendMultipleFilesMessage(a,ln.RESEND,e.reqId).onPending(function(d){l._trigger(d)}).onFailed(function(d,h){l._triggerFailed(d,h)}).onSucceeded(function(d){s._tryUpdateLastMessageAndCallEvents(s,d),l._trigger(d)}).onFileUploaded(function(d,h,f,p){l._triggerOnFileUploaded(d,h,f,p)}),l}},t.prototype.copyMessage=function(e,r){var i=this;if(B(e instanceof Mv&&r instanceof kt&&r.sendingStatus===tt.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(U.invalidParameters),r.isUserMessage()){B(!r.poll).throw(U.notSupportedError);var s=$y(r),a=new rr;return e._sendUserMessage(s).onPending(function(c){a._trigger(c)}).onFailed(function(c,l){a._triggerFailed(c,l)}).onSucceeded(function(c){e.isGroupChannel()&&i._tryUpdateLastMessageAndCallEvents(e,c),a._trigger(c)}),a}if(r.isFileMessage()){s=zy(r);var o=new rr;return e._sendFileMessage(s).onPending(function(c){o._trigger(c)}).onFailed(function(c,l){o._triggerFailed(c,l)}).onSucceeded(function(c){e.isGroupChannel()&&i._tryUpdateLastMessageAndCallEvents(e,c),o._trigger(c)}),o}if(r.isMultipleFilesMessage()){if(e.isGroupChannel()){s=ES(r);var u=new fd;return e._sendMultipleFilesMessage(s,ln.COPY).onPending(function(c){u._trigger(c)}).onFailed(function(c,l){u._triggerFailed(c,l)}).onSucceeded(function(c){i._tryUpdateLastMessageAndCallEvents(e,c),u._trigger(c)}).onFileUploaded(function(c,l,d,h){u._triggerOnFileUploaded(c,l,d,h)}),u}throw U.channelTypeNotSupportedError}},t}(Mv),XA=function(){this.onUserMuted=Se,this.onUserUnmuted=Se,this.onUserBanned=Se,this.onUserUnbanned=Se,this.onChannelChanged=Se,this.onChannelDeleted=Se,this.onChannelFrozen=Se,this.onChannelUnfrozen=Se,this.onOperatorUpdated=Se,this.onChannelMemberCountChanged=Se,this.onMetaDataCreated=Se,this.onMetaDataUpdated=Se,this.onMetaDataDeleted=Se,this.onMetaCounterCreated=Se,this.onMetaCounterUpdated=Se,this.onMetaCounterDeleted=Se,this.onMessageReceived=Se,this.onMessageUpdated=Se,this.onMessageDeleted=Se,this.onMentionReceived=Se,this.onReactionUpdated=Se,this.onThreadInfoUpdated=Se},mc,Ws={},ek=function(){function n(t){var e=t._iid,r=t.limit,i=r===void 0?100:r,s=this;this.ref=0,this._iid=e,this._limit=i;var a,o=M.of(this._iid),u=o.sdkState,c=o.dispatcher,l=o.logger,d=o.cacheContext;this._metadataKey=(a=u.userId,"sendbird:".concat(a,"@groupchannel/sync.meta"));var h=function(f){return"sendbird:".concat(f,"@groupchannel/sync")}(u.userId);this._sync=new Ea(h,function(){return g(s,void 0,void 0,function(){var f,p,_,m,b,y,E,T,N,C,L,k;return v(this,function(O){switch(O.label){case 0:return f={hasNext:!0,nextToken:""},[4,this.loadMetadata()];case 1:if(O.sent(),l.debug("channel background sync from",(N=this._metadata)===null||N===void 0?void 0:N.token),(C=this._metadata)===null||C===void 0?void 0:C.completed)return[3,13];O.label=2;case 2:if(O.trys.push([2,9,,12]),(p={includeEmpty:!0,order:At.CHRONOLOGICAL}).order!==At.LATEST_LAST_MESSAGE)return[3,6];O.label=3;case 3:return O.trys.push([3,5,,6]),[4,d.preference.get(I_(u.appId))];case 4:return _=O.sent(),p.includeChatNotification=!!_,[3,6];case 5:return O.sent(),p.includeChatNotification=!1,[3,6];case 6:return[4,Wt.of(this._iid).getMyGroupChannels((k=(L=this._metadata)===null||L===void 0?void 0:L.token)!==null&&k!==void 0?k:"",p,this._limit,z.SYNC_CHANNEL_BACKGROUND)];case 7:return m=O.sent(),b=m.channels,y=m.token,f.hasNext=b.length>=this._limit&&!!y,f.nextToken=y,this._metadata&&(this._metadata.token=y,(T=this._metadata.range).extends.apply(T,ce([],ie(b.map(function(x){return x.createdAt})),!1)),this._metadata.completed=!f.hasNext),l.debug("channel background sync progress",f),[4,this.saveMetadata()];case 8:return O.sent(),[3,12];case 9:return E=O.sent(),l.debug("channel background sync error",E),E instanceof U&&E.isInvalidTokenError?[4,this.clearMetaData()]:[3,11];case 10:O.sent(),O.label=11;case 11:throw E;case 12:return[3,14];case 13:f.hasNext=!1,f.nextToken="",O.label=14;case 14:return[2,f]}})})}),this._connectionEventContext=c.on(function(f){f instanceof Ar&&(f.stateType===qe.CONNECTED?s.resume():s.pause())})}return n.of=function(t){return Ws[t]||(Ws[t]=new n({_iid:t})),Ws[t].ref++,Ws[t]},n.clear=function(t){Ws[t]&&(Ws[t].close(),delete Ws[t])},Object.defineProperty(n.prototype,"range",{get:function(){var t,e;return(e=(t=this._metadata)===null||t===void 0?void 0:t.range)!==null&&e!==void 0?e:new Pi({})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"completed",{get:function(){var t;return!!(!((t=this._metadata)===null||t===void 0)&&t.completed)},enumerable:!1,configurable:!0}),n.prototype.loadMetadata=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:return this._metadata?[3,2]:[4,M.of(this._iid).cacheContext.preference.get(this._metadataKey)];case 1:t=e.sent(),this._metadata={token:t?t.token:"",range:new Pi(t?t.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!t&&t.completed},e.label=2;case 2:return[2,this._metadata]}})})},n.prototype.saveMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this._metadata?[4,M.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return t.sent(),[2,!0];case 2:return[2,!1]}})})},n.prototype.clearMetaData=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,M.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return t.sent(),this._metadata=void 0,[2]}})})},n.prototype.resume=function(){var t,e,r=M.of(this._iid),i=r.logger;r.sessionManager.session.hasSession&&(i.debug("channel background sync resume()"),this._sync.start((e=(t=this._metadata)===null||t===void 0?void 0:t.token)!==null&&e!==void 0?e:""))},n.prototype.pause=function(){M.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()},n.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Ws[this._iid])},n}(),Ys={},tk=function(){function n(t){var e=t._iid,r=this;this.ref=0,this._iid=e;var i,s=M.of(this._iid),a=s.logger,o=s.sdkState,u=s.dispatcher,c=s.cacheContext;this._metadataKey=(i=o.userId,"sendbird:".concat(i,"@groupchannel/changelogs.meta"));var l=function(d){return"sendbird:".concat(d,"@groupchannel/changelogs")}(o.userId);this._sync=new Ea(l,function(){return g(r,void 0,void 0,function(){var d,h,f,p,_,m,b,y,E,T;return v(this,function(N){switch(N.label){case 0:return d={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:N.sent(),a.debug("channel changelog sync from",(y=this._metadata)===null||y===void 0?void 0:y.token),N.label=2;case 2:N.trys.push([2,9,,12]),h={includeEmpty:!0},N.label=3;case 3:return N.trys.push([3,5,,6]),[4,c.preference.get(I_(o.appId))];case 4:return f=N.sent(),h.includeChatNotification=!!f,[3,6];case 5:return N.sent(),h.includeChatNotification=!1,[3,6];case 6:return[4,Wt.of(this._iid).getMyGroupChannelChangeLogs((T=(E=this._metadata)===null||E===void 0?void 0:E.token)!==null&&T!==void 0?T:"",h,z.SYNC_CHANNEL_CHANGELOGS)];case 7:return p=N.sent(),_=p.hasMore,m=p.token,d.hasNext=_,d.nextToken=m,this._metadata&&(this._metadata.token=m),a.debug("channel changelog sync progress",d),[4,this.saveMetadata()];case 8:return N.sent(),[3,12];case 9:return b=N.sent(),a.debug("channel changelog sync error",b),b instanceof U&&b.isInvalidTokenError?[4,this.clearMetadata()]:[3,11];case 10:N.sent(),N.label=11;case 11:throw b;case 12:return[2,d]}})})}),this._connectionEventContext=u.on(function(d){d instanceof Ar&&(d.stateType===qe.CONNECTED?r.resume():r.pause())})}return n.of=function(t){return Ys[t]||(Ys[t]=new n({_iid:t})),Ys[t].ref++,Ys[t]},n.clear=function(t){Ys[t]&&(Ys[t].close(),delete Ys[t])},n.prototype.loadMetadata=function(){return g(this,void 0,void 0,function(){var t,e,r,i;return v(this,function(s){switch(s.label){case 0:return this._metadata?[3,2]:(t=M.of(this._iid),e=t.cacheContext,r=t.firstConnectedAt,[4,e.preference.get(this._metadataKey)]);case 1:i=s.sent(),this._metadata={token:i?i.token:r},s.label=2;case 2:return[2,this._metadata]}})})},n.prototype.saveMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this._metadata?[4,M.of(this._iid).cacheContext.preference.set(this._metadataKey,this._metadata)]:[3,2];case 1:return t.sent(),[2,!0];case 2:return[2,!1]}})})},n.prototype.clearMetadata=function(){return g(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,M.of(this._iid).cacheContext.preference.remove(this._metadataKey)];case 1:return t.sent(),this._metadata=void 0,[2]}})})},n.prototype.resume=function(){M.of(this._iid).sessionManager.session.hasSession&&this._sync.start(0)},n.prototype.pause=function(){this._sync.stop()},n.prototype.close=function(){this.ref--,this.ref<=0&&(this.ref=0,this.pause(),this._connectionEventContext.close(),delete Ys[this._iid])},n}(),$p=function(n,t){return n.findIndex(function(e){return e.isIdentical(t)})},nk=function(n,t,e){if(n.length>0){for(var r=$p(n,t),i=0,s=n.length-1,a=Math.floor((i+s)/2);i<s;){var o=Qv(n[a],t,e);if(o>0)s=a,a=Math.floor((i+s)/2);else{if(!(o<0))return{place:a,oldPosition:r};i=a+1,a=Math.floor((i+s)/2)}}return{place:Qv(n[a],t,e)>=0?a:a+1,oldPosition:r}}return{place:n.length,oldPosition:-1}},Qv=function(n,t,e){switch(e){case At.LATEST_LAST_MESSAGE:return n.lastMessage&&t.lastMessage?t.lastMessage.createdAt-n.lastMessage.createdAt:n.lastMessage?-1:t.lastMessage?1:t.createdAt-n.createdAt;case At.CHRONOLOGICAL:return t.createdAt-n.createdAt;case At.CHANNEL_NAME_ALPHABETICAL:var r=n.name.localeCompare(t.name);return r===0?n.createdAt-t.createdAt:r;default:return 0}},rk=function(){function n(t,e){var r=e.filter,i=e.order,s=e.limit,a=this;this.channels=[],this._iid=t,this._key="gcc-".concat(Rs()),this._isDisposed=!1,this._isGetRemoteChannelsSucceeded=!0,this.filter=r??new uE,this.order=i??At.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=s??Qy;var o=M.of(this._iid),u=o.sdkState,c=o.cacheContext,l=o.dispatcher;c.localCacheEnabled&&(this._backgroundSync=ek.of(t),this._backgroundSync.resume()),this._changelogSync=tk.of(t),this._changelogSync.resume(),Wt.of(this._iid).subscribeChannelEvent(this._key,{onUpdate:function(d,h){if(vd(h)){var f=d.filter(function(_){return a.filter.match(_,u.userId)}),p=d.filter(function(_){return!a.filter.match(_,u.userId)}).map(function(_){return _.url});f.length>0&&a._addChannelsToView(f,h),p.length>0&&a._removeChannelsFromView(p,h)}},onRemove:function(d,h){a._removeChannelsFromView(d,h)}}),M.of(this._iid).statLogCollector.put(new Ya({type:lt.FEATURE_LOCALCACHE,data:{use_local_cache:c.localCacheEnabled,collection_interface:{group_channel:!0}}})),l.on(function(d){d instanceof Ar&&(d.stateType===qe.CONNECTED?a._isGetRemoteChannelsSucceeded||g(a,void 0,void 0,function(){return v(this,function(h){switch(h.label){case 0:return[4,this._revokeLoadMore()];case 1:return h.sent(),[2]}})}):d.stateType===qe.LOGOUT&&a.dispose())})}return Object.defineProperty(n.prototype,"hasMore",{get:function(){return!this._isDisposed&&this._hasMore},enumerable:!1,configurable:!0}),n.prototype.setGroupChannelCollectionHandler=function(t){this._handler=t},n.prototype._addChannelsToView=function(t,e,r){var i,s,a,o,u=this;r===void 0&&(r=!1);var c=[],l=[],d=[];try{for(var h=Z(t),f=h.next();!f.done;f=h.next()){var p=f.value,_=$p(this.channels,p);_>=0&&this.channels.splice(_,1);var m=nk(this.channels,p,this.order).place;if(_<0)m===this.channels.length?!r&&this._hasMore||(c.push(p),this.channels.push(p)):(c.push(p),this.channels.splice(m,0,p));else switch(e){case z.EVENT_CHANNEL_UPDATED:case z.EVENT_MESSAGE_RECEIVED:case z.SYNC_CHANNEL_CHANGELOGS:case z.EVENT_MESSAGE_SENT:this.order===At.CHANNEL_NAME_ALPHABETICAL&&this._hasMore&&m===this.channels.length?d.push(p):(this.channels.splice(m,0,p),l.push(p));break;default:this.channels.splice(m,0,p),l.push(p)}}}catch(T){i={error:T}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}if(d.length>0)try{for(var b=Z(d),y=b.next();!y.done;y=b.next()){p=y.value;var E=$p(this.channels,p);E!==-1&&this.channels.splice(E,1)}}catch(T){a={error:T}}finally{try{y&&!y.done&&(o=b.return)&&o.call(b)}finally{if(a)throw a.error}}vd(e)&&le(function(){return g(u,void 0,void 0,function(){var T,N,C,L;return v(this,function(k){return T=new qp(e),c.length>0&&(!((N=this._handler)===null||N===void 0)&&N.onChannelsAdded)&&this._handler.onChannelsAdded(T,c),l.length>0&&(!((C=this._handler)===null||C===void 0)&&C.onChannelsUpdated)&&this._handler.onChannelsUpdated(T,l),d.length>0&&(!((L=this._handler)===null||L===void 0)&&L.onChannelsDeleted)&&this._handler.onChannelsDeleted(T,d.map(function(O){return O.url})),[2]})})})},n.prototype._removeChannelsFromView=function(t,e){var r,i,s=this,a=[],o=function(d){var h=u.channels.findIndex(function(f){return f.url===d});h>=0&&(a.push(u.channels[h].url),u.channels.splice(h,1))},u=this;try{for(var c=Z(t),l=c.next();!l.done;l=c.next())o(l.value)}catch(d){r={error:d}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}return vd(e)&&a.length>0&&le(function(){return g(s,void 0,void 0,function(){var d,h;return v(this,function(f){return d=new qp(e),!((h=this._handler)===null||h===void 0)&&h.onChannelsDeleted&&this._handler.onChannelsDeleted(d,a),[2]})})}),a},n.prototype._getLocalChannels=function(){return g(this,void 0,void 0,function(){var t,e;return v(this,function(r){switch(r.label){case 0:return t=Wt.of(this._iid),e=this.channels.length>0?function(i,s){var a,o,u,c;switch(s){case At.LATEST_LAST_MESSAGE:return(o=(a=i.lastMessage)===null||a===void 0?void 0:a.createdAt)!==null&&o!==void 0?o:i.createdAt;case At.CHRONOLOGICAL:return i.createdAt;case At.CHANNEL_NAME_ALPHABETICAL:return i.name;default:return(c=(u=i.lastMessage)===null||u===void 0?void 0:u.createdAt)!==null&&c!==void 0?c:i.createdAt}}(this.channels[this.channels.length-1],this.order):null,[4,t.getChannelsFromCache(e,this.filter,this.order,this._limit,e?this.channels[this.channels.length-1].url:void 0)];case 1:return[2,r.sent()]}})})},n.prototype._getRemoteChannels=function(){return g(this,void 0,void 0,function(){var t,e,r;return v(this,function(i){switch(i.label){case 0:return[4,Wt.of(this._iid).getMyGroupChannels(this._token,oe(A(A({},this.filter),{order:this.order})),this._limit)];case 1:return t=i.sent(),e=t.channels,r=t.token,this._token=r,this._hasMore=!!r,[2,e]}})})},n.prototype._revokeLoadMore=function(){return g(this,void 0,void 0,function(){var t;return v(this,function(e){switch(e.label){case 0:if(this._isDisposed)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this._getRemoteChannels()];case 2:return t=e.sent(),this._isGetRemoteChannelsSucceeded=!0,this._addChannelsToView(t,z.REQUEST_CHANNEL,!0),[3,4];case 3:return e.sent(),this._isGetRemoteChannelsSucceeded=!1,[3,4];case 4:return[2]}})})},n.prototype.loadMore=function(){return g(this,void 0,void 0,function(){var t,e,r,i,s=this;return v(this,function(a){switch(a.label){case 0:if(this._isDisposed)throw new U({code:ae.COLLECTION_DISPOSED,message:"Collection has been disposed."});return this._hasMore?(t=M.of(this._iid),e=t.cacheContext,r=t.connectionManager,i=[],!e.localCacheEnabled||r.isConnected&&!this._backgroundSync.completed?[3,2]:[4,Tt(function(){return g(s,void 0,void 0,function(){return v(this,function(o){switch(o.label){case 0:return[4,this._getLocalChannels()];case 1:return i=o.sent(),[2]}})})})]):[3,6];case 1:return a.sent(),this._hasMore=i.length>=this._limit,[3,5];case 2:return a.trys.push([2,4,,5]),[4,this._getRemoteChannels()];case 3:return i=a.sent(),this._isGetRemoteChannelsSucceeded=!0,[3,5];case 4:return a.sent(),this._isGetRemoteChannelsSucceeded=!1,[3,5];case 5:return this._addChannelsToView(i,z.REQUEST_CHANNEL,!0),[2,i];case 6:return[2,[]]}})})},n.prototype.dispose=function(){var t,e;this._isDisposed||(this._isDisposed=!0,this.channels.length>0&&this.channels.splice(0,this.channels.length),(t=this._backgroundSync)===null||t===void 0||t.close(),(e=this._changelogSync)===null||e===void 0||e.close(),Wt.of(this._iid).unsubscribeChannelEvent(this._key))},n}(),ik=function(n){function t(e){var r=this,i=e.token,s=e.limit,a=e.order,o=e.includeEmpty,u=e.membershipFilter,c=e.channelNameContainsFilter,l=e.channelUrlsFilter,d=e.customTypesFilter,h=e.customTypeStartsWithFilter,f=e.superChannelFilter,p=e.metadataOrderKeyFilter,_=e.metadataKey,m=e.metadataValues,b=e.metadataValueStartsWith,y=e.includeFrozen,E=e.includeMetaData;return(r=n.call(this)||this).method=j.GET,r.path=Mn,r.params=re(oe({token:i,limit:s,order:a,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:o,public_mode:zi.PUBLIC,public_membership_mode:u,name_contains:c,channel_urls:l,custom_types:d,custom_type_startswith:h,super_mode:f,metadata_order_key:p,metadata_key:_,metadata_values:m,metadata_value_startswith:b,show_frozen:y,show_metadata:E})),r}return w(t,n),t}(K),sk=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.channels=[];var s=r.next,a=r.channels,o=r.ts;return i.token=s,a&&a.length>0&&(i.channels=a.map(function(u){return u.ts=o,new Nr(e,u)})),i.ts=typeof o=="number"?o:0,i}return w(t,n),t}(W);(function(n){n.ALL="all",n.JOINED="joined"})(mc||(mc={}));var ak=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m,b,y=this;return(y=n.call(this,e,r)||this).includeEmpty=!1,y.includeFrozen=!0,y.includeMetaData=!0,y.channelUrlsFilter=null,y.customTypesFilter=null,y.customTypeStartsWithFilter=null,y.channelNameContainsFilter=null,y.membershipFilter=mc.ALL,y.superChannelFilter=Zn.ALL,y.metadataKey=null,y.metadataValues=null,y.metadataOrderKeyFilter=null,y.metadataValueStartsWith=null,y.order=hc.CHRONOLOGICAL,y.includeEmpty=(i=r.includeEmpty)!==null&&i!==void 0&&i,y.includeFrozen=(s=r.includeFrozen)===null||s===void 0||s,y.includeMetaData=(a=r.includeMetaData)===null||a===void 0||a,y.channelUrlsFilter=(o=r.channelUrlsFilter)!==null&&o!==void 0?o:null,y.customTypesFilter=(u=r.customTypesFilter)!==null&&u!==void 0?u:null,y.customTypeStartsWithFilter=(c=r.customTypeStartsWithFilter)!==null&&c!==void 0?c:null,y.channelNameContainsFilter=(l=r.channelNameContainsFilter)!==null&&l!==void 0?l:null,y.membershipFilter=(d=r.membershipFilter)!==null&&d!==void 0?d:mc.ALL,y.superChannelFilter=(h=r.superChannelFilter)!==null&&h!==void 0?h:Zn.ALL,y.metadataKey=(f=r.metadataKey)!==null&&f!==void 0?f:null,y.metadataValues=(p=r.metadataValues)!==null&&p!==void 0?p:null,y.metadataOrderKeyFilter=(_=r.metadataOrderKeyFilter)!==null&&_!==void 0?_:null,y.metadataValueStartsWith=(m=r.metadataValueStartsWith)!==null&&m!==void 0?m:null,y.order=(b=r.order)!==null&&b!==void 0?b:hc.CHRONOLOGICAL,y}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&R("boolean",this.includeEmpty)&&R("boolean",this.includeFrozen)&&R("boolean",this.includeMetaData)&&R("string",this.channelNameContainsFilter,!0)&&Ae("string",this.channelUrlsFilter,!0)&&Ae("string",this.customTypesFilter,!0)&&R("string",this.customTypeStartsWithFilter,!0)&&be(mc,this.membershipFilter)&&be(Zn,this.superChannelFilter)&&be(hc,this.order)&&R("string",this.metadataOrderKeyFilter,!0)&&R("string",this.metadataKey,!0)&&Ae("string",this.metadataValues,!0)&&R("string",this.metadataValueStartsWith,!0)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o,u;return v(this,function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,r=M.of(this._iid).requestQueue,i=new ik(oe(A(A({},this),{token:this._token}))),[4,r.send(i)]):[3,2]):[3,5];case 1:return s=c.sent(),a=s.as(sk),o=a.channels,u=a.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,[2,o];case 2:return[2,e];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(Ta),_E=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return w(t,n),t}(function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.onUserJoined=Se,e.onUserLeft=Se,e.onUserReceivedInvitation=Se,e.onUserDeclinedInvitation=Se,e.onChannelHidden=Se,e.onUnreadMemberStatusUpdated=Se,e.onUndeliveredMemberStatusUpdated=Se,e.onTypingStatusUpdated=Se,e.onPollUpdated=Se,e.onPollVoted=Se,e.onPollDeleted=Se,e.onPinnedMessageUpdated=Se,e}return w(t,n),t}(XA)),ok=function(n){function t(e){var r=this,i=e.token,s=e.limit,a=e.order,o=e.reverse,u=e.channelUrl,c=e.messageTypeFilter,l=e.scheduledStatus;return(r=n.call(this)||this).method=j.GET,r.path="".concat(j0),r.params=re(oe({token:i,limit:s,reverse:o,channel_url:u,order:a,message_type:c,status:l})),r}return w(t,n),t}(K),uk=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.scheduledMessages=[];var s=r.next,a=r.scheduled_messages;return i.token=s,i.scheduledMessages=a.map(function(o){return $n(e,o)}),i}return w(t,n),t}(W),ck=function(n){function t(e,r){var i,s,a,o,u,c=this;return(c=n.call(this,e,r)||this).channelUrl=null,c.order=null,c.reverse=!1,c.scheduledStatus=null,c.messageTypeFilter=mn.ALL,c.channelUrl=(i=r.channelUrl)!==null&&i!==void 0?i:null,c.order=(s=r.order)!==null&&s!==void 0?s:null,c.reverse=(a=r.reverse)!==null&&a!==void 0&&a,c.scheduledStatus=(o=r.scheduledStatus)!==null&&o!==void 0?o:null,c.messageTypeFilter=(u=r.messageTypeFilter)!==null&&u!==void 0?u:mn.ALL,c}return w(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&R("string",this.channelUrl,!0)&&(be(Rp,this.order)||this.order===null)&&R("boolean",this.reverse)&&(Ae(ia,this.scheduledStatus)||this.scheduledStatus===null)&&be(mn,this.messageTypeFilter)},t.prototype.next=function(){return g(this,void 0,void 0,function(){var e,r,i,s,a,o;return v(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=M.of(this._iid).requestQueue,r=new ok(oe(A(A({},this),{token:this._token}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(uk),a=s.scheduledMessages,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw U.queryInProgress;case 4:return[3,6];case 5:throw U.invalidParameters;case 6:return[2]}})})},t}(Ta),lk=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.name="groupChannel",e}return w(t,n),t.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,a=r.sessionManager,o=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;n.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:a,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Wt(e,{sdkState:i,cacheContext:l,dispatcher:s,sessionManager:a,requestQueue:o,logger:u})},t.prototype.createGroupChannelCollection=function(e){return e===void 0&&(e={}),new rk(this._iid,e)},t.prototype.createMyGroupChannelListQuery=function(e){return e===void 0&&(e={}),new dE(this._iid,e)},t.prototype.createPublicGroupChannelListQuery=function(e){return e===void 0&&(e={}),new ak(this._iid,e)},t.prototype.createScheduledMessageListQuery=function(e){return e===void 0&&(e={}),new ck(this._iid,e)},t.prototype.addGroupChannelHandler=function(e,r){B(R("string",e)&&r instanceof _E).throw(U.invalidParameters),this._manager.addHandler(e,r)},t.prototype.removeGroupChannelHandler=function(e){B(R("string",e)).throw(U.invalidParameters),this._manager.removeHandler(e)},t.prototype.removeAllGroupChannelHandlers=function(){this._manager.clearHandler()},t.prototype.buildGroupChannelFromSerializedData=function(e){return this._manager.buildGroupChannelFromSerializedData(e)},t.prototype.buildGroupChannelListQueryFromSerializedData=function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)},t.prototype.buildMemberFromSerializedData=function(e){return this._manager.buildMemberFromSerializedData(e)},t.prototype.getChannel=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return B(R("string",e)).throw(U.invalidParameters),[2,this._manager.getChannel(e)]})})},t.prototype.getChannelWithoutCache=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return B(R("string",e)).throw(U.invalidParameters),[2,this._manager.getChannelWithoutCache(e)]})})},t.prototype.getMyGroupChannelChangeLogsByToken=function(e,r){return r===void 0&&(r={}),g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},Gd),r),B(R("string",e)&&Lp(i)).throw(U.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMyGroupChannelChangeLogsByTimestamp=function(e,r){return r===void 0&&(r={}),g(this,void 0,void 0,function(){var i;return v(this,function(s){switch(s.label){case 0:return i=A(A({},Gd),r),B(R("number",e)&&Lp(i)).throw(U.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getGroupChannelCount=function(e){return g(this,void 0,void 0,function(){var r;return v(this,function(i){return r=A(A({},cE),e),B(lE(r)).throw(U.invalidParameters),[2,this._manager.getGroupChannelCount(r)]})})},t.prototype.getUnreadItemCount=function(e){return e===void 0&&(e={}),g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._manager.getUnreadItemCount(e)];case 1:return[2,r.sent()]}})})},t.prototype.getTotalUnreadChannelCount=function(){return g(this,void 0,void 0,function(){return v(this,function(e){switch(e.label){case 0:return[4,this._manager.getTotalUnreadChannelCount()];case 1:return[2,e.sent()]}})})},t.prototype.getTotalUnreadMessageCount=function(e){return e===void 0&&(e={}),g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._manager.getTotalUnreadMessageCount(e)];case 1:return[2,r.sent()]}})})},t.prototype.getTotalScheduledMessageCount=function(e){return e===void 0&&(e={}),g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return[4,this._manager.getTotalScheduledMessageCount(e)];case 1:return[2,r.sent()]}})})},t.prototype.getSubscribedTotalUnreadMessageCount=function(){return this._manager.getSubscribedTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeTotalUnreadMessageCount=function(){return this._manager.getSubscribedCustomTypeTotalUnreadMessageCount()},t.prototype.getSubscribedCustomTypeUnreadMessageCount=function(e){return this._manager.getSubscribedCustomTypeUnreadMessageCount(e)},t.prototype.createChannel=function(e){return e===void 0&&(e={}),g(this,void 0,void 0,function(){var r;return v(this,function(i){return r=A(A({},md),e),B(Up(r)).throw(U.invalidParameters),[2,this._manager.createChannel(r)]})})},t.prototype.createDistinctChannelIfNotExist=function(e){return e===void 0&&(e={}),g(this,void 0,void 0,function(){var r;return v(this,function(i){return r=A(A({},md),e),B(Up(r)).throw(U.invalidParameters),r&&(r.isDistinct=!0),[2,this.createChannel(r)]})})},t.prototype.createChannelWithUserIds=function(e,r,i,s,a,o){return r===void 0&&(r=!1),a===void 0&&(a=""),o===void 0&&(o=""),g(this,void 0,void 0,function(){var u;return v(this,function(c){return u=A(A({},md),{invitedUserIds:e,isDistinct:r,name:i,data:a,customType:o}),typeof s=="string"?u.coverUrl=s:u.coverImage=s,[2,this.createChannel(u)]})})},t.prototype.markAsReadAll=function(){return g(this,void 0,void 0,function(){return v(this,function(e){return this._manager.markAsReadAll(),[2]})})},t.prototype.markAsReadWithChannelUrls=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){return B(Ae("string",e)).throw(U.invalidParameters),this._manager.markAsReadWithChannelUrls(e),[2]})})},t.prototype.markAsDelivered=function(e){return g(this,void 0,void 0,function(){return v(this,function(r){switch(r.label){case 0:return B(R("string",e)).throw(U.invalidParameters),[4,this.getChannel(e)];case 1:return[4,r.sent().markAsDelivered()];case 2:return r.sent(),[2]}})})},t}(C_),Hp=function(n,t){return Hp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},Hp(n,t)};function dk(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Hp(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var vt=function(){return vt=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++){e=arguments[r];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},vt.apply(this,arguments)};function tn(n,t,e,r){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(l){try{c(r.next(l))}catch(d){a(d)}}function u(l){try{c(r.throw(l))}catch(d){a(d)}}function c(l){l.done?s(l.value):i(l.value).then(o,u)}c((r=r.apply(n,t||[])).next())})}function nn(n,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(e=0)),e;)try{if(r=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,i=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){e.label=c[1];break}if(c[0]===6&&e.label<s[1]){e.label=s[1],s=c;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(c);break}s[2]&&e.ops.pop(),e.trys.pop();continue}c=t.call(n,e)}catch(l){c=[6,l],i=0}finally{r=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function hk(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ui(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r=e.call(n),i,s=[],a;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(a)throw a.error}}return s}function Wv(n,t,e){if(e||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return n.concat(s||Array.prototype.slice.call(t))}var zp=function(n,t){return zp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])},zp(n,t)};function D(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=n}zp(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var P=function(){return P=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},P.apply(this,arguments)};function fk(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]])}return e}function S(n,t,e,r){return new(e||(e=Promise))(function(i,s){function a(c){try{u(r.next(c))}catch(l){s(l)}}function o(c){try{u(r.throw(c))}catch(l){s(l)}}function u(c){var l;c.done?i(c.value):(l=c.value,l instanceof e?l:new e(function(d){d(l)})).then(a,o)}u((r=r.apply(n,t||[])).next())})}function I(n,t){var e,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(u){return function(c){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(a=0)),a;)try{if(e=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!((i=i.length>0&&i[i.length-1])||l[0]!==6&&l[0]!==2)){a=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(l[0]===6&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(n,a)}catch(d){l=[6,d],r=0}finally{e=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([u,c])}}}function ke(n){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&n[t],r=0;if(e)return e.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Re(n,t){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var r,i,s=e.call(n),a=[];try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(o){i={error:o}}finally{try{r&&!r.done&&(e=s.return)&&e.call(s)}finally{if(i)throw i.error}}return a}function Ve(n,t,e){if(e||arguments.length===2)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return n.concat(r||Array.prototype.slice.call(t))}var ve,mE="4.9.6",fa=function(){function n(){}return Object.defineProperty(n,"OS_VERSION",{get:function(){return typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(n,"SDK_VERSION",{get:function(){return mE},enumerable:!1,configurable:!0}),Object.defineProperty(n,"SDK_MAJOR_VERSION",{get:function(){return n.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(n,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),n}();(function(n){n[n.STAT_LOG_NOT_ALLOWED=400108]="STAT_LOG_NOT_ALLOWED",n[n.NON_AUTHORIZED=400108]="NON_AUTHORIZED",n[n.INVALID_TOKEN=400111]="INVALID_TOKEN",n[n.NOT_FOUND_IN_DATABASE=400201]="NOT_FOUND_IN_DATABASE",n[n.USER_AUTH_DEACTIVATED=400300]="USER_AUTH_DEACTIVATED",n[n.USER_AUTH_DELETED_OR_NOT_FOUND=400301]="USER_AUTH_DELETED_OR_NOT_FOUND",n[n.SESSION_TOKEN_EXPIRED=400302]="SESSION_TOKEN_EXPIRED",n[n.SESSION_KEY_EXPIRED=400309]="SESSION_KEY_EXPIRED",n[n.SESSION_REVOKED=400310]="SESSION_REVOKED",n[n.STAT_UPLOAD_NOT_ALLOWED=403200]="STAT_UPLOAD_NOT_ALLOWED",n[n.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",n[n.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",n[n.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",n[n.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",n[n.LOST_INSTANCE=700100]="LOST_INSTANCE",n[n.CONNECTION_RENEW=700102]="CONNECTION_RENEW",n[n.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",n[n.INVALID_COMMAND=700700]="INVALID_COMMAND",n[n.UNKNOWN_ERROR=77e4]="UNKNOWN_ERROR",n[n.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",n[n.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",n[n.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",n[n.INVALID_PARAMETER=800110]="INVALID_PARAMETER",n[n.NOT_SUPPORTED_ERROR=800111]="NOT_SUPPORTED_ERROR",n[n.NETWORK_ERROR=800120]="NETWORK_ERROR",n[n.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",n[n.MALFORMED_DATA=800130]="MALFORMED_DATA",n[n.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",n[n.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",n[n.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",n[n.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",n[n.ACK_TIMEOUT=800180]="ACK_TIMEOUT",n[n.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",n[n.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",n[n.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",n[n.REQUEST_FAILED=800220]="REQUEST_FAILED",n[n.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",n[n.REQUEST_CANCELED=800240]="REQUEST_CANCELED",n[n.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",n[n.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",n[n.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",n[n.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",n[n.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED",n[n.COLLECTION_DISPOSED=800600]="COLLECTION_DISPOSED",n[n.DATABASE_ERROR=800700]="DATABASE_ERROR"})(ve||(ve={}));var Pn,Gp,Zt,Vp,vc,za=function(n){return!(n instanceof H&&!n.shouldThrowOutside)},H=function(n){function t(e){var r=e.code,i=r===void 0?0:r,s=e.message,a=s===void 0?"":s,o=n.call(this,a)||this;return o.shouldThrowOutside=!1,o.name="SendbirdError",o.code=i,Object.setPrototypeOf(o,t.prototype),o}return D(t,n),Object.defineProperty(t.prototype,"isInvalidTokenError",{get:function(){return this.code===ve.INVALID_TOKEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===ve.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===ve.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSessionRevokedError",{get:function(){return this.code===ve.SESSION_REVOKED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUserAuthDeactivedError",{get:function(){return this.code===ve.USER_AUTH_DEACTIVATED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUserAuthDeletedOrNotFoundError",{get:function(){return this.code===ve.USER_AUTH_DELETED_OR_NOT_FOUND},enumerable:!1,configurable:!0}),Object.defineProperty(t,"debugModeRequired",{get:function(){return new t({code:ve.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"lostInstance",{get:function(){return new t({code:ve.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidCommand",{get:function(){return new t({code:ve.INVALID_COMMAND,message:"Cannot send invalid command."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"unknown",{get:function(){return new t({code:ve.UNKNOWN_ERROR,message:"Unknown error occurred."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRenew",{get:function(){return new t({code:ve.CONNECTION_RENEW,message:"Connection restarts."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidConnectionStateTransition",{get:function(){return new t({code:ve.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionRequired",{get:function(){return new t({code:ve.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionCanceled",{get:function(){return new t({code:ve.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"invalidParameters",{get:function(){return new t({code:ve.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"notSupportedError",{get:function(){return new t({code:ve.NOT_SUPPORTED_ERROR,message:"Given parameters are not supported."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"networkError",{get:function(){return new t({code:ve.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"markAsReadAllRateLimitExceeded",{get:function(){return new t({code:ve.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"queryInProgress",{get:function(){return new t({code:ve.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"noAckTimeout",{get:function(){return new t({code:ve.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"loginTimeout",{get:function(){return new t({code:ve.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"connectionClosed",{get:function(){return new t({code:ve.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestFailed",{get:function(){return new t({code:ve.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileUploadCanceled",{get:function(){return new t({code:ve.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"requestCanceled",{get:function(){return new t({code:ve.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRefreshFailed",{get:function(){return new t({code:ve.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"sessionTokenRequestFailed",{get:function(){return new t({code:ve.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseError",{get:function(){return new t({code:ve.DATABASE_ERROR,message:"Database error."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"fileSizeLimitExceededError",{get:function(){return new t({code:ve.FILE_SIZE_LIMIT_EXCEEDED,message:"File size exceeds the file size limit."})},enumerable:!1,configurable:!0}),t.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},t}(Error),pk=[ve.CONNECTION_REQUIRED,ve.NETWORK_ERROR,ve.ACK_TIMEOUT,ve.WEBSOCKET_CONNECTION_CLOSED,ve.WEBSOCKET_CONNECTION_FAILED,ve.FILE_UPLOAD_CANCEL_FAILED,ve.REQUEST_CANCELED,ve.INTERNAL_SERVER_ERROR,ve.RATE_LIMIT_EXCEEDED,ve.UNKNOWN_SERVER_ERROR],_k=[ve.WEBSOCKET_CONNECTION_CLOSED,ve.WEBSOCKET_CONNECTION_FAILED,ve.CONNECTION_REQUIRED],vE=function(n,t){if(n!==t){var e=P({},n),r=P({},t);return(!e.hasOwnProperty("messageId")||!r.hasOwnProperty("messageId")||e.messageId===r.messageId)&&(!e.hasOwnProperty("reqId")||!r.hasOwnProperty("reqId")||e.reqId===r.reqId)&&(e.hasOwnProperty("messageId")&&delete e.messageId,e.hasOwnProperty("reqId")&&delete e.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(e)===JSON.stringify(r))}return!0},$=function(n,t,e){return e===void 0&&(e=!1),!(!e||t!=null)||(typeof n!="string"?typeof n=="object"?yt(n,t):mk(n,t):typeof t===n)},yt=function(n,t,e){return e===void 0&&(e=!1),!(!e||t!=null)||Object.values(n).includes(t)},mk=function(n,t){return t instanceof n},We=function(n,t,e){return e===void 0&&(e=!1),!(!e||t!=null)||Array.isArray(t)&&t.every(function(r){return $(n,r)})},vk=function(n){return n>0&&pk.indexOf(n)>=0},Bd=function(n){return n>0&&_k.indexOf(n)>=0},Gi=function(n,t){if(t===void 0&&(t=!1),t&&n==null)return!0;var e=typeof n=="object"&&n!==null&&n.hasOwnProperty("name")&&typeof n.name=="string"&&n.hasOwnProperty("uri")&&typeof n.uri=="string"&&n.hasOwnProperty("type")&&typeof n.type=="string";if(!e){if(typeof Blob<"u")return n instanceof Blob;if(typeof File<"u")return n instanceof File}return e},gE=function(){function n(t){var e=t===void 0?{}:t,r=e.useMemberInfoInMessage,i=r===void 0||r,s=e.typingIndicatorInvalidateTime,a=s===void 0?1e4:s,o=e.typingIndicatorThrottle,u=o===void 0?1e3:o,c=e.websocketResponseTimeout,l=c===void 0?1e4:c,d=e.websocketPayloadDecompression,h=d===void 0||d,f=e.sessionTokenRefreshTimeout,p=f===void 0?60:f;this._useMemberInfoInMessage=!0,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._sessionTokenRefreshTimeout=60,this._useMemberInfoInMessage=i,this._typingIndicatorInvalidateTime=a,this._typingIndicatorThrottle=u,this._websocketResponseTimeout=l,this._sessionTokenRefreshTimeout=p,this.websocketPayloadDecompression=h}return Object.defineProperty(n.prototype,"useMemberInfoInMessage",{get:function(){return this._useMemberInfoInMessage},set:function(t){$("boolean",t)&&(this._useMemberInfoInMessage=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(t){$("number",t)&&(this._typingIndicatorInvalidateTime=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(t){$("number",t)&&t>=1e3&&t<=9e3&&(this._typingIndicatorThrottle=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(t){$("number",t)&&t>=5e3&&t<=3e4&&(this._websocketResponseTimeout=t)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sessionTokenRefreshTimeout",{get:function(){return this._sessionTokenRefreshTimeout},set:function(t){$("number",t)&&(t<60?t=60:t>1800&&(t=1800),this._sessionTokenRefreshTimeout=t)},enumerable:!1,configurable:!0}),n}(),yE={encrypt:function(n){return n},decrypt:function(n){return n}},Yv=function(){function n(t){var e=t.store;this._preference=new Map,this._store=e}return n.prototype._savePreferenceKeys=function(){return S(this,void 0,void 0,function(){return I(this,function(t){switch(t.label){case 0:return[4,this._store.set({key:this._keysAddress,value:Ve([],Re(this._preference.keys()),!1)})];case 1:return t.sent(),[2]}})})},n.prototype.init=function(t,e){var r;return e===void 0&&(e=1),S(this,void 0,void 0,function(){var i,s,a,o,u,c,l,d,h,f;return I(this,function(p){switch(p.label){case 0:return this._version=e,this._keysAddress=t,i="".concat(t,".metadata.version"),[4,this._store.get(i)];case 1:return s=p.sent(),[4,this._store.get(t)];case 2:return a=(r=p.sent())!==null&&r!==void 0?r:[],!s||s.version<this._version?[4,this._resetPreferenceData(a,i)]:[3,4];case 3:return p.sent(),[3,11];case 4:p.trys.push([4,9,10,11]),o=ke(a),u=o.next(),p.label=5;case 5:return u.done?[3,8]:(c=u.value,[4,this._store.get(c)]);case 6:(l=p.sent())&&this._preference.set(c,l),p.label=7;case 7:return u=o.next(),[3,5];case 8:return[3,11];case 9:return d=p.sent(),h={error:d},[3,11];case 10:try{u&&!u.done&&(f=o.return)&&f.call(o)}finally{if(h)throw h.error}return[7];case 11:return[2]}})})},n.prototype._resetPreferenceData=function(t,e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return this._preference=new Map,[4,this._store.removeMany(t)];case 1:return r.sent(),[4,this._store.set({key:e,value:{version:this._version}})];case 2:return r.sent(),[2]}})})},n.prototype.get=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return[2,this._preference.get(t)]})})},n.prototype.set=function(t,e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=!this._preference.has(t),[4,this._store.set({key:t,value:e})];case 1:return i.sent(),this._preference.set(t,e),r?[4,this._savePreferenceKeys()]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},n.prototype.remove=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this._store.remove(t)];case 1:return e.sent(),this._preference.delete(t),[4,this._savePreferenceKeys()];case 2:return e.sent(),[2]}})})},n.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(t){switch(t.label){case 0:return[4,this._store.removeMany(Ve([],Re(this._preference.keys()),!1))];case 1:return t.sent(),this._preference.clear(),[4,this._savePreferenceKeys()];case 2:return t.sent(),[2]}})})},n}(),gk=function(){function n(t){var e=t.encryption,r=t.store,i=t.localCacheEnabled,s=t.localCacheConfig;this.store=r,this.preference=new Yv({store:r}),this.encryption=e??yE,this.localCacheEnabled=i,this.localCacheConfig=s}return n.prototype.replaceStore=function(t){this.store=t,this.preference=new Yv({store:t})},n}();(function(n){n.SUCCESS="success",n.PENDING="pending",n.ERROR="error"})(Pn||(Pn={})),function(n){n.DEFAULT="default",n.ALL="all",n.MENTION_ONLY="mention_only",n.OFF="off"}(Gp||(Gp={})),function(n){n.FCM="gcm",n.APNS="apns",n.UNKNOWN="unknown"}(Zt||(Zt={})),function(n){n.ALTERNATIVE="alternative",n.DEFAULT="default"}(Vp||(Vp={})),function(n){n.CUSTOM="custom",n.MESSAGE_COLLECTION_ACCESSED_AT="messagecollection_accessed_at"}(vc||(vc={}));var zt,jd,Zv,Ot,Sr,Kd,Hn,Cr,ba,St,EE=function(){function n(t){var e=t===void 0?{}:t,r=e.maxSize,i=r===void 0?256:r,s=e.clearOrder,a=s===void 0?vc.MESSAGE_COLLECTION_ACCESSED_AT:s,o=e.customClearOrderComparator;this._clearOrderComparatorUseMessageCollectionAccessedAt=function(u,c){return u.channel.messageCollectionLastAccessedAt===c.channel.messageCollectionLastAccessedAt?u.channel.lastMessage&&!c.channel.lastMessage?1:!u.channel.lastMessage&&c.channel.lastMessage?-1:u.channel.lastMessage||c.channel.lastMessage?u.channel.lastMessage.createdAt-c.channel.lastMessage.createdAt:0:u.channel.messageCollectionLastAccessedAt>c.channel.messageCollectionLastAccessedAt?1:-1},this._maxSize=Math.max(i,64),o?(this._clearOrder=a,this._customClearOrderComparator=o):this._clearOrder=vc.MESSAGE_COLLECTION_ACCESSED_AT}return Object.defineProperty(n.prototype,"maxSize",{get:function(){return this._maxSize},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"clearOrder",{get:function(){return this._clearOrder},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"clearOrderComparator",{get:function(){var t;return this._clearOrder===vc.MESSAGE_COLLECTION_ACCESSED_AT?this._clearOrderComparatorUseMessageCollectionAccessedAt:(t=this._customClearOrderComparator)!==null&&t!==void 0?t:this._clearOrderComparatorUseMessageCollectionAccessedAt},enumerable:!1,configurable:!0}),n}(),yk=function(){function n(){}return Object.defineProperty(n.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),n.prototype.clear=function(){this.authToken=void 0,this.sessionKey=void 0},n}(),fu=function(){var n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(t==="x"?e:3&e|8).toString(16)})},Jv=function(){function n(t){var e=t.container;this._container={},this._container=e,this.key=fu()}return n.prototype._register=function(t,e,r){var i;return t in this._container||(this._container[t]=new Map),(i=this._container[t])===null||i===void 0||i.set(this.key,{occurence:e,handler:r}),this},n.prototype.on=function(t,e){return this._register(t,-1,e)},n.prototype.once=function(t,e){return this._register(t,1,e)},n.prototype.close=function(){var t;for(var e in this._container)(t=this._container[e])===null||t===void 0||t.delete(this.key)},n}(),pu=function(){function n(){this._container={}}return n.prototype.on=function(t,e){return new Jv({container:this._container}).on(t,e)},n.prototype.once=function(t,e){return new Jv({container:this._container}).once(t,e)},n.prototype.dispatch=function(t,e){var r,i,s=this._container[t];if(s){var a=[];try{for(var o=ke(s.keys()),u=o.next();!u.done;u=o.next()){var c=u.value,l=s.get(c);l.handler(e),l.occurence>0&&(l.occurence--,l.occurence===0&&a.push(c))}}catch(d){r={error:d}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}a.forEach(function(d){return s.delete(d)})}},n}(),Ek=function(){function n(){this._dispatcher=new pu}return n.prototype.on=function(t){return this._dispatcher.on("event",t)},n.prototype.once=function(t){return this._dispatcher.once("event",t)},n.prototype.dispatch=function(t){this._dispatcher.dispatch("event",t)},n}(),en=function(){},me=function(n){var t={};return n&&Object.keys(n).forEach(function(e){n[e]===void 0||Number.isNaN(n[e])||n[e]===null||(t[e]=n[e])}),t},Te=function(n){if(n!=null){if(typeof n=="object"){if(Array.isArray(n)){var t=Ve([],Re(n),!1);for(var e in t)t[e]=Te(t[e]);return t}for(var r in n)n[r]===null&&delete n[r];return n}return n}};(function(n){n.BASE="base",n.GROUP="group",n.OPEN="open",n.FEED="feed"})(zt||(zt={})),function(n){n.OPERATOR="operator",n.NONE="none"}(jd||(jd={})),function(n){n.MUTED="muted",n.UNMUTED="unmuted"}(Zv||(Zv={})),function(n){n.BASE="base",n.USER="user",n.FILE="file",n.ADMIN="admin"}(Ot||(Ot={})),function(n){n.ALL="",n.USER="MESG",n.FILE="FILE",n.ADMIN="ADMM"}(Sr||(Sr={})),function(n){n.USER="MESG",n.FILE="FILE",n.ADMIN="ADMM"}(Kd||(Kd={})),function(n){n.USERS="users",n.CHANNEL="channel"}(Hn||(Hn={})),function(n){n.ALL="all",n.NONE="none",n.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(Cr||(Cr={})),function(n){n.DEFAULT="default",n.SUPPRESS="suppress"}(ba||(ba={})),function(n){n.PENDING="pending",n.SCHEDULED="scheduled",n.SUCCEEDED="succeeded",n.FAILED="failed",n.CANCELED="canceled"}(St||(St={}));var J,mi="v3",Ye="/".concat(mi,"/users"),bk="/".concat(mi,"/storage/file"),bE="/".concat(mi,"/group_channels"),Tk="/".concat(mi,"/open_channels"),wk="/".concat(mi,"/search"),Bp="/".concat(mi,"/report"),Ik="/".concat(mi,"/emojis"),TE="/".concat(mi,"/emoji_categories"),vi="/".concat(mi,"/polls"),Sk="/".concat(mi,"/sdk/ui_kit/configuration"),Ck="/".concat(mi,"/sdk/statistics"),st=function(n){switch(n){case zt.FEED:case zt.GROUP:return bE;case zt.OPEN:return Tk;default:return null}},wE=function(n){switch(n){case zt.GROUP:return"".concat(Bp,"/group_channels");case zt.OPEN:return"".concat(Bp,"/open_channels");default:return null}},Hc=function(n,t,e){var r,i;switch(n){case Hn.CHANNEL:return!0;case Hn.USERS:if(t)try{for(var s=ke(t),a=s.next();!a.done;a=s.next())if(a.value===e)return!0}catch(o){r={error:o}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return!1},IE=function(n,t,e){var r,i,s,a,o=Hc((r=n.mentionType)!==null&&r!==void 0?r:null,(i=n.mentionedUserIds)!==null&&i!==void 0?i:[],e),u=Hc((s=t.mentionType)!==null&&s!==void 0?s:null,(a=t.mentionedUserIds)!==null&&a!==void 0?a:[],e);return!o&&u?1:o&&!u?-1:0},SE=function(n,t,e){var r,i=t||new FormData;for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s)){var a=n[s],o=e?"".concat(e,"[").concat(s,"]"):s;Gi(a)?i.append(o,a,(r=a.name)!==null&&r!==void 0?r:"filename"):typeof a!="object"||a===null||Array.isArray(a)||a instanceof Blob?i.append(o,String(a)):i=SE(a,i,o)}return i};(function(n){n.GET="GET",n.POST="POST",n.PUT="PUT",n.DELETE="DELETE"})(J||(J={}));var oo,X=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.params={},e.requireAuth=!0,e.headers={},e.requestId=fu(),e}return D(t,n),t.prototype.encodeParams=function(e){var r=this;return e==null||e===""?encodeURIComponent(""):Array.isArray(e)?e.map(function(i){return r.encodeParams(i)}).join(","):encodeURIComponent(typeof e=="object"?JSON.stringify(e):String(e))},Object.defineProperty(t.prototype,"query",{get:function(){var e=this,r=me(this.params);return"?".concat(Object.keys(r).map(function(i){return"".concat(encodeURIComponent(i),"=").concat(e.encodeParams(r[i]))}).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){var e=me(this.params);return Object.keys(e).some(function(r){return Gi(e[r])})?SE(e):JSON.stringify(e)},enumerable:!1,configurable:!0}),t}(en),se=function(n){function t(e,r){var i=n.call(this)||this;return i._iid=e,i._payload=r,i}return D(t,n),Object.defineProperty(t.prototype,"payload",{get:function(){return P({},this._payload)},enumerable:!1,configurable:!0}),t.prototype.as=function(e){return new e(this._iid,this.payload)},t}(en),Nk=function(n){function t(e){var r=n.call(this)||this;return r.requestId=e,r}return D(t,n),t}(en),nl=function(n){function t(e){var r=e.expires_in,i=e.reason,s=i===void 0?ve.SESSION_KEY_EXPIRED:i,a=n.call(this)||this;switch(a.expiresIn=r??0,s){case ve.SESSION_KEY_EXPIRED:case ve.SESSION_TOKEN_EXPIRED:case ve.SESSION_REVOKED:case ve.USER_AUTH_DEACTIVATED:case ve.USER_AUTH_DELETED_OR_NOT_FOUND:a.error=new H({code:s})}return a}return D(t,n),Object.defineProperty(t.prototype,"invalidateSessionToken",{get:function(){var e;return!!(!((e=this.error)===null||e===void 0)&&e.isSessionTokenExpiredError)},enumerable:!1,configurable:!0}),t}(en),R_=function(n){function t(e){var r=n.call(this)||this;return r.statLog=e,r}return D(t,n),t}(en);(function(n){n.FEATURE_LOCALCACHE="feature:local_cache",n.WEBSOCKET_CONNECT="ws:connect",n.API_RESULT="api:result"})(oo||(oo={}));var jp,zc,Kp,uu=function(){function n(t){var e=t.type,r=t.data,i=t.ts,s=i===void 0?Date.now():i;this.type=e,this.createdAt=s,this.data=r}return n.payloadify=function(t){return me({stat_type:t.type,ts:t.createdAt,data:me(t.data)})},n}(),Qp=function(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product=="ReactNative"},Xv=function(){return!(typeof navigator>"u"||!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Windows Phone/i.test(navigator.userAgent))};(function(n){n.CHAT="chat",n.CALLS="calls",n.DESK="desk",n.LIVE="live",n.UIKIT_CHAT="uikit-chat",n.UIKIT_LIVE="uikit-live"})(jp||(jp={})),function(n){n.ANDROID="android",n.IOS="ios",n.JS="js",n.UNREAL="unreal",n.UNITY="unity",n.REACT_NATIVE="react-native",n.FLUTTER="flutter"}(zc||(zc={})),function(n){n.ANDROID="android",n.IOS="ios",n.WEB="web",n.MOBILE_WEB="mobile_web",n.WINDOWS="windows"}(Kp||(Kp={}));var Ak="^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",Qd=function(){function n(){}return n.sendbirdSdkUserAgentWithExtension=function(t){var e=Qp()?zc.REACT_NATIVE:zc.JS,r={main_sdk_info:"chat/".concat(e,"/").concat(fa.SDK_VERSION),device_os_platform:Xv()?"mobile-web":"web",os_version:fa.OS_VERSION};if(t){var i=t.sendbirdExtensions,s=t.deviceOS,a=t.customData,o=a===void 0?{}:a;s.version&&(r.os_version=s.version),s.platform&&(r.device_os_platform=s.platform),i.length>0&&(r.extension_sdk_info=i.map(function(u){var c=u.product,l=u.platform,d=u.version;return"".concat(c,"/").concat(l,"/").concat(d)}).join(",")),Object.keys(r).forEach(function(u){return delete o[u]}),Object.keys(o).length>0&&(r=P(P({},r),o))}return Object.entries(r).map(function(u){var c=Re(u,2),l=c[0],d=c[1];return"".concat(l,"=").concat(d)}).join("&")},n.userAgentWithExtension=function(t){var e=Qp()?"reactnative":"JS",r=t.sb_syncmanager?"s".concat(t.sb_syncmanager):"",i=t.sb_uikit?"u".concat(t.sb_uikit):"",s=t["device-os-platform"]?"o".concat(t["device-os-platform"]):Xv()?"omobile-web":"oweb";return"".concat(e,"/c").concat(fa.SDK_VERSION,"/").concat(r,"/").concat(i,"/").concat(s)},n}(),kk=function(){function n(t,e){var r=e.auth,i=e.sdkState,s=e.dispatcher,a=e.logger,o=e.useFetchCompat,u=o!==void 0&&o,c=this;this._abortControl=new Map,this._shouldImportFetchCompat=!1,this._iid=t,this._auth=r,this._sdkState=i,this._dispatcher=s,this._dispatcher.on(function(l){l instanceof Nk&&c.cancel(l.requestId)}),this._logger=a,this._shouldImportFetchCompat=u}return n.prototype._createHeader=function(t,e){var r=this._sdkState,i=r.appId,s=r.appVersion,a=r.sendbirdRuntimeEnvironment,o=P(P({},t.headers),{SendBird:"JS,".concat(fa.OS_VERSION,",").concat(fa.SDK_VERSION,",").concat(i).concat(s?",".concat(s):""),"SB-User-Agent":Qd.userAgentWithExtension(this._sdkState.extensions),"Request-Sent-Timestamp":Date.now().toString(),"SB-SDK-User-Agent":Qd.sendbirdSdkUserAgentWithExtension(a)});return e||(o["Content-Type"]="application/json; charset=utf-8"),t.requireAuth&&this._auth.hasSession&&(o["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(o["App-Id"]=i,o["Access-Token"]=this._auth.authToken),o},n.prototype._statLogApiResult=function(t,e,r){this._dispatcher.dispatch(new R_(new uu({type:oo.API_RESULT,data:{endpoint:t.path,method:t.method,success:!r,latency:Date.now()-e,error_code:r==null?void 0:r.code,error_description:r==null?void 0:r.message}})))},n.prototype.send=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h,f,p,_,m;return I(this,function(b){switch(b.label){case 0:e=t.path,r=t.method,i=![J.GET,J.DELETE].includes(r),s=this._sdkState.api,a="".concat(s.host).concat(e).concat(i?"":t.query),o=i?t.payload:null,u=this._createHeader(t,o instanceof FormData?o:void 0),c=new AbortController,l=c.signal,this._abortControl.set(t.requestId,c),d=Date.now(),b.label=1;case 1:return b.trys.push([1,8,,9]),this._shouldImportFetchCompat&&(this._shouldImportFetchCompat=!1,(typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{fetch:null}).fetch=null),typeof AbortController<"u"?[3,3]:[4,Yu(()=>import("./__bundle-2aa1a987-2089789d-6d477eff.js").then(y=>y._),["assets/__bundle-2aa1a987-2089789d-6d477eff.js","assets/_commonjsHelpers-28e086c5.js"])];case 2:b.sent(),b.label=3;case 3:return typeof fetch=="function"?[3,5]:[4,Yu(()=>import("./__bundle-57274663-46b49d56-b2f7cf25.js"),[])];case 4:b.sent(),b.label=5;case 5:return[4,fetch(a,{method:r,body:o,headers:u,signal:l})];case 6:return[4,(h=b.sent()).json()];case 7:if(f=b.sent(),h.ok||h.redirected)return this._logger.debug("receive api response",t.requestId),this._statLogApiResult(t,d),[2,new se(this._iid,f)];throw f?(((p=new H(f)).isSessionKeyExpiredError||p.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new nl({reason:p.code})),this._statLogApiResult(t,d,p),p):(p=H.requestFailed,this._statLogApiResult(t,d,p),p);case 8:throw _=b.sent(),this._statLogApiResult(t,d,_),_ instanceof H?(this._logger.debug("fail api request",_),_):_.name==="AbortError"?H.requestCanceled:(m=H.networkError,this._logger.debug("fail api request",m),m);case 9:return[2]}})})},n.prototype.cancel=function(t){this._abortControl.has(t)&&(this._abortControl.get(t).abort(),this._abortControl.delete(t))},n.prototype.cancelAll=function(){var t,e;try{for(var r=ke(this._abortControl.values()),i=r.next();!i.done;i=r.next())i.value.abort()}catch(s){t={error:s}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this._abortControl.clear()},n}(),En=function(n){function t(e,r,i,s){s===void 0&&(s="");var a,o=this;return(o=n.call(this)||this)._iid=e,o.code=r,o.payload=i,o.requestId=(a=i.req_id)!==null&&a!==void 0?a:s,o}return D(t,n),t.createFromRawMessage=function(e,r){var i=r.substring(0,4),s={};try{s=JSON.parse(r.substring(4))}catch{i="NOOP"}finally{return new t(e,i,s)}},t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),`
`)},t.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},t}(en),on=function(){};function _u(n){let t=n.length;for(;--t>=0;)n[t]=0}const U_=256,CE=286,gc=30,yc=15,Wp=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),gd=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ok=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),eg=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ms=new Array(576);_u(ms);const Ec=new Array(60);_u(Ec);const Gc=new Array(512);_u(Gc);const bc=new Array(256);_u(bc);const L_=new Array(29);_u(L_);const Wd=new Array(gc);function Sf(n,t,e,r,i){this.static_tree=n,this.extra_bits=t,this.extra_base=e,this.elems=r,this.max_length=i,this.has_stree=n&&n.length}let tg,ng,rg;function Cf(n,t){this.dyn_tree=n,this.max_code=0,this.stat_desc=t}_u(Wd);const NE=n=>n<256?Gc[n]:Gc[256+(n>>>7)],Vc=(n,t)=>{n.pending_buf[n.pending++]=255&t,n.pending_buf[n.pending++]=t>>>8&255},sr=(n,t,e)=>{n.bi_valid>16-e?(n.bi_buf|=t<<n.bi_valid&65535,Vc(n,n.bi_buf),n.bi_buf=t>>16-n.bi_valid,n.bi_valid+=e-16):(n.bi_buf|=t<<n.bi_valid&65535,n.bi_valid+=e)},xi=(n,t,e)=>{sr(n,e[2*t],e[2*t+1])},AE=(n,t)=>{let e=0;do e|=1&n,n>>>=1,e<<=1;while(--t>0);return e>>>1},kE=(n,t,e)=>{const r=new Array(16);let i,s,a=0;for(i=1;i<=yc;i++)a=a+e[i-1]<<1,r[i]=a;for(s=0;s<=t;s++){let o=n[2*s+1];o!==0&&(n[2*s]=AE(r[o]++,o))}},OE=n=>{let t;for(t=0;t<CE;t++)n.dyn_ltree[2*t]=0;for(t=0;t<gc;t++)n.dyn_dtree[2*t]=0;for(t=0;t<19;t++)n.bl_tree[2*t]=0;n.dyn_ltree[512]=1,n.opt_len=n.static_len=0,n.sym_next=n.matches=0},ME=n=>{n.bi_valid>8?Vc(n,n.bi_buf):n.bi_valid>0&&(n.pending_buf[n.pending++]=n.bi_buf),n.bi_buf=0,n.bi_valid=0},ig=(n,t,e,r)=>{const i=2*t,s=2*e;return n[i]<n[s]||n[i]===n[s]&&r[t]<=r[e]},Nf=(n,t,e)=>{const r=n.heap[e];let i=e<<1;for(;i<=n.heap_len&&(i<n.heap_len&&ig(t,n.heap[i+1],n.heap[i],n.depth)&&i++,!ig(t,r,n.heap[i],n.depth));)n.heap[e]=n.heap[i],e=i,i<<=1;n.heap[e]=r},sg=(n,t,e)=>{let r,i,s,a,o=0;if(n.sym_next!==0)do r=255&n.pending_buf[n.sym_buf+o++],r+=(255&n.pending_buf[n.sym_buf+o++])<<8,i=n.pending_buf[n.sym_buf+o++],r===0?xi(n,i,t):(s=bc[i],xi(n,s+U_+1,t),a=Wp[s],a!==0&&(i-=L_[s],sr(n,i,a)),r--,s=NE(r),xi(n,s,e),a=gd[s],a!==0&&(r-=Wd[s],sr(n,r,a)));while(o<n.sym_next);xi(n,256,t)},Af=(n,t)=>{const e=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems;let a,o,u,c=-1;for(n.heap_len=0,n.heap_max=573,a=0;a<s;a++)e[2*a]!==0?(n.heap[++n.heap_len]=c=a,n.depth[a]=0):e[2*a+1]=0;for(;n.heap_len<2;)u=n.heap[++n.heap_len]=c<2?++c:0,e[2*u]=1,n.depth[u]=0,n.opt_len--,i&&(n.static_len-=r[2*u+1]);for(t.max_code=c,a=n.heap_len>>1;a>=1;a--)Nf(n,e,a);u=s;do a=n.heap[1],n.heap[1]=n.heap[n.heap_len--],Nf(n,e,1),o=n.heap[1],n.heap[--n.heap_max]=a,n.heap[--n.heap_max]=o,e[2*u]=e[2*a]+e[2*o],n.depth[u]=(n.depth[a]>=n.depth[o]?n.depth[a]:n.depth[o])+1,e[2*a+1]=e[2*o+1]=u,n.heap[1]=u++,Nf(n,e,1);while(n.heap_len>=2);n.heap[--n.heap_max]=n.heap[1],((l,d)=>{const h=d.dyn_tree,f=d.max_code,p=d.stat_desc.static_tree,_=d.stat_desc.has_stree,m=d.stat_desc.extra_bits,b=d.stat_desc.extra_base,y=d.stat_desc.max_length;let E,T,N,C,L,k,O=0;for(C=0;C<=yc;C++)l.bl_count[C]=0;for(h[2*l.heap[l.heap_max]+1]=0,E=l.heap_max+1;E<573;E++)T=l.heap[E],C=h[2*h[2*T+1]+1]+1,C>y&&(C=y,O++),h[2*T+1]=C,T>f||(l.bl_count[C]++,L=0,T>=b&&(L=m[T-b]),k=h[2*T],l.opt_len+=k*(C+L),_&&(l.static_len+=k*(p[2*T+1]+L)));if(O!==0){do{for(C=y-1;l.bl_count[C]===0;)C--;l.bl_count[C]--,l.bl_count[C+1]+=2,l.bl_count[y]--,O-=2}while(O>0);for(C=y;C!==0;C--)for(T=l.bl_count[C];T!==0;)N=l.heap[--E],N>f||(h[2*N+1]!==C&&(l.opt_len+=(C-h[2*N+1])*h[2*N],h[2*N+1]=C),T--)}})(n,t),kE(e,c,n.bl_count)},ag=(n,t,e)=>{let r,i,s=-1,a=t[1],o=0,u=7,c=4;for(a===0&&(u=138,c=3),t[2*(e+1)+1]=65535,r=0;r<=e;r++)i=a,a=t[2*(r+1)+1],++o<u&&i===a||(o<c?n.bl_tree[2*i]+=o:i!==0?(i!==s&&n.bl_tree[2*i]++,n.bl_tree[32]++):o<=10?n.bl_tree[34]++:n.bl_tree[36]++,o=0,s=i,a===0?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4))},og=(n,t,e)=>{let r,i,s=-1,a=t[1],o=0,u=7,c=4;for(a===0&&(u=138,c=3),r=0;r<=e;r++)if(i=a,a=t[2*(r+1)+1],!(++o<u&&i===a)){if(o<c)do xi(n,i,n.bl_tree);while(--o!=0);else i!==0?(i!==s&&(xi(n,i,n.bl_tree),o--),xi(n,16,n.bl_tree),sr(n,o-3,2)):o<=10?(xi(n,17,n.bl_tree),sr(n,o-3,3)):(xi(n,18,n.bl_tree),sr(n,o-11,7));o=0,s=i,a===0?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4)}};let ug=!1;const DE=(n,t,e,r)=>{sr(n,0+(r?1:0),3),ME(n),Vc(n,e),Vc(n,~e),e&&n.pending_buf.set(n.window.subarray(t,t+e),n.pending),n.pending+=e};var Mk=(n,t,e,r)=>{let i,s,a=0;n.level>0?(n.strm.data_type===2&&(n.strm.data_type=(o=>{let u,c=4093624447;for(u=0;u<=31;u++,c>>>=1)if(1&c&&o.dyn_ltree[2*u]!==0)return 0;if(o.dyn_ltree[18]!==0||o.dyn_ltree[20]!==0||o.dyn_ltree[26]!==0)return 1;for(u=32;u<U_;u++)if(o.dyn_ltree[2*u]!==0)return 1;return 0})(n)),Af(n,n.l_desc),Af(n,n.d_desc),a=(o=>{let u;for(ag(o,o.dyn_ltree,o.l_desc.max_code),ag(o,o.dyn_dtree,o.d_desc.max_code),Af(o,o.bl_desc),u=18;u>=3&&o.bl_tree[2*eg[u]+1]===0;u--);return o.opt_len+=3*(u+1)+5+5+4,u})(n),i=n.opt_len+3+7>>>3,s=n.static_len+3+7>>>3,s<=i&&(i=s)):i=s=e+5,e+4<=i&&t!==-1?DE(n,t,e,r):n.strategy===4||s===i?(sr(n,2+(r?1:0),3),sg(n,ms,Ec)):(sr(n,4+(r?1:0),3),((o,u,c,l)=>{let d;for(sr(o,u-257,5),sr(o,c-1,5),sr(o,l-4,4),d=0;d<l;d++)sr(o,o.bl_tree[2*eg[d]+1],3);og(o,o.dyn_ltree,u-1),og(o,o.dyn_dtree,c-1)})(n,n.l_desc.max_code+1,n.d_desc.max_code+1,a+1),sg(n,n.dyn_ltree,n.dyn_dtree)),OE(n),r&&ME(n)},Dk={_tr_init:n=>{ug||((()=>{let t,e,r,i,s;const a=new Array(16);for(r=0,i=0;i<28;i++)for(L_[i]=r,t=0;t<1<<Wp[i];t++)bc[r++]=i;for(bc[r-1]=i,s=0,i=0;i<16;i++)for(Wd[i]=s,t=0;t<1<<gd[i];t++)Gc[s++]=i;for(s>>=7;i<gc;i++)for(Wd[i]=s<<7,t=0;t<1<<gd[i]-7;t++)Gc[256+s++]=i;for(e=0;e<=yc;e++)a[e]=0;for(t=0;t<=143;)ms[2*t+1]=8,t++,a[8]++;for(;t<=255;)ms[2*t+1]=9,t++,a[9]++;for(;t<=279;)ms[2*t+1]=7,t++,a[7]++;for(;t<=287;)ms[2*t+1]=8,t++,a[8]++;for(kE(ms,287,a),t=0;t<gc;t++)Ec[2*t+1]=5,Ec[2*t]=AE(t,5);tg=new Sf(ms,Wp,257,CE,yc),ng=new Sf(Ec,gd,0,gc,yc),rg=new Sf(new Array(0),Ok,0,19,7)})(),ug=!0),n.l_desc=new Cf(n.dyn_ltree,tg),n.d_desc=new Cf(n.dyn_dtree,ng),n.bl_desc=new Cf(n.bl_tree,rg),n.bi_buf=0,n.bi_valid=0,OE(n)},_tr_stored_block:DE,_tr_flush_block:Mk,_tr_tally:(n,t,e)=>(n.pending_buf[n.sym_buf+n.sym_next++]=t,n.pending_buf[n.sym_buf+n.sym_next++]=t>>8,n.pending_buf[n.sym_buf+n.sym_next++]=e,t===0?n.dyn_ltree[2*e]++:(n.matches++,t--,n.dyn_ltree[2*(bc[e]+U_+1)]++,n.dyn_dtree[2*NE(t)]++),n.sym_next===n.sym_end),_tr_align:n=>{sr(n,2,3),xi(n,256,ms),(t=>{t.bi_valid===16?(Vc(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(n)}},Tc=(n,t,e,r)=>{let i=65535&n|0,s=n>>>16&65535|0,a=0;for(;e!==0;){a=e>2e3?2e3:e,e-=a;do i=i+t[r++]|0,s=s+i|0;while(--a);i%=65521,s%=65521}return i|s<<16|0};const Rk=new Uint32Array((()=>{let n,t=[];for(var e=0;e<256;e++){n=e;for(var r=0;r<8;r++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t})());var fn=(n,t,e,r)=>{const i=Rk,s=r+e;n^=-1;for(let a=r;a<s;a++)n=n>>>8^i[255&(n^t[a])];return-1^n},go={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Co={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Uk,_tr_stored_block:Yp,_tr_flush_block:Lk,_tr_tally:pa,_tr_align:Pk}=Dk,{Z_NO_FLUSH:_a,Z_PARTIAL_FLUSH:xk,Z_FULL_FLUSH:Fk,Z_FINISH:Hr,Z_BLOCK:cg,Z_OK:In,Z_STREAM_END:lg,Z_STREAM_ERROR:ki,Z_DATA_ERROR:qk,Z_BUF_ERROR:kf,Z_DEFAULT_COMPRESSION:$k,Z_FILTERED:Hk,Z_HUFFMAN_ONLY:Hl,Z_RLE:zk,Z_FIXED:Gk,Z_DEFAULT_STRATEGY:Vk,Z_UNKNOWN:Bk,Z_DEFLATED:Yd}=Co,Xa=258,Vi=262,Zo=42,Ga=113,ju=666,Va=(n,t)=>(n.msg=go[t],t),dg=n=>2*n-(n>4?9:0),na=n=>{let t=n.length;for(;--t>=0;)n[t]=0},jk=n=>{let t,e,r,i=n.w_size;t=n.hash_size,r=t;do e=n.head[--r],n.head[r]=e>=i?e-i:0;while(--t);t=i,r=t;do e=n.prev[--r],n.prev[r]=e>=i?e-i:0;while(--t)};let ma=(n,t,e)=>(t<<n.hash_shift^e)&n.hash_mask;const _r=n=>{const t=n.state;let e=t.pending;e>n.avail_out&&(e=n.avail_out),e!==0&&(n.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+e),n.next_out),n.next_out+=e,t.pending_out+=e,n.total_out+=e,n.avail_out-=e,t.pending-=e,t.pending===0&&(t.pending_out=0))},br=(n,t)=>{Lk(n,n.block_start>=0?n.block_start:-1,n.strstart-n.block_start,t),n.block_start=n.strstart,_r(n.strm)},ct=(n,t)=>{n.pending_buf[n.pending++]=t},Pu=(n,t)=>{n.pending_buf[n.pending++]=t>>>8&255,n.pending_buf[n.pending++]=255&t},Zp=(n,t,e,r)=>{let i=n.avail_in;return i>r&&(i=r),i===0?0:(n.avail_in-=i,t.set(n.input.subarray(n.next_in,n.next_in+i),e),n.state.wrap===1?n.adler=Tc(n.adler,t,i,e):n.state.wrap===2&&(n.adler=fn(n.adler,t,i,e)),n.next_in+=i,n.total_in+=i,i)},RE=(n,t)=>{let e,r,i=n.max_chain_length,s=n.strstart,a=n.prev_length,o=n.nice_match;const u=n.strstart>n.w_size-Vi?n.strstart-(n.w_size-Vi):0,c=n.window,l=n.w_mask,d=n.prev,h=n.strstart+Xa;let f=c[s+a-1],p=c[s+a];n.prev_length>=n.good_match&&(i>>=2),o>n.lookahead&&(o=n.lookahead);do if(e=t,c[e+a]===p&&c[e+a-1]===f&&c[e]===c[s]&&c[++e]===c[s+1]){s+=2,e++;do;while(c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&c[++s]===c[++e]&&s<h);if(r=Xa-(h-s),s=h-Xa,r>a){if(n.match_start=t,a=r,r>=o)break;f=c[s+a-1],p=c[s+a]}}while((t=d[t&l])>u&&--i!=0);return a<=n.lookahead?a:n.lookahead},Vo=n=>{const t=n.w_size;let e,r,i;do{if(r=n.window_size-n.lookahead-n.strstart,n.strstart>=t+(t-Vi)&&(n.window.set(n.window.subarray(t,t+t-r),0),n.match_start-=t,n.strstart-=t,n.block_start-=t,n.insert>n.strstart&&(n.insert=n.strstart),jk(n),r+=t),n.strm.avail_in===0)break;if(e=Zp(n.strm,n.window,n.strstart+n.lookahead,r),n.lookahead+=e,n.lookahead+n.insert>=3)for(i=n.strstart-n.insert,n.ins_h=n.window[i],n.ins_h=ma(n,n.ins_h,n.window[i+1]);n.insert&&(n.ins_h=ma(n,n.ins_h,n.window[i+3-1]),n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,n.insert--,!(n.lookahead+n.insert<3)););}while(n.lookahead<Vi&&n.strm.avail_in!==0)},UE=(n,t)=>{let e,r,i,s=n.pending_buf_size-5>n.w_size?n.w_size:n.pending_buf_size-5,a=0,o=n.strm.avail_in;do{if(e=65535,i=n.bi_valid+42>>3,n.strm.avail_out<i||(i=n.strm.avail_out-i,r=n.strstart-n.block_start,e>r+n.strm.avail_in&&(e=r+n.strm.avail_in),e>i&&(e=i),e<s&&(e===0&&t!==Hr||t===_a||e!==r+n.strm.avail_in)))break;a=t===Hr&&e===r+n.strm.avail_in?1:0,Yp(n,0,0,a),n.pending_buf[n.pending-4]=e,n.pending_buf[n.pending-3]=e>>8,n.pending_buf[n.pending-2]=~e,n.pending_buf[n.pending-1]=~e>>8,_r(n.strm),r&&(r>e&&(r=e),n.strm.output.set(n.window.subarray(n.block_start,n.block_start+r),n.strm.next_out),n.strm.next_out+=r,n.strm.avail_out-=r,n.strm.total_out+=r,n.block_start+=r,e-=r),e&&(Zp(n.strm,n.strm.output,n.strm.next_out,e),n.strm.next_out+=e,n.strm.avail_out-=e,n.strm.total_out+=e)}while(a===0);return o-=n.strm.avail_in,o&&(o>=n.w_size?(n.matches=2,n.window.set(n.strm.input.subarray(n.strm.next_in-n.w_size,n.strm.next_in),0),n.strstart=n.w_size,n.insert=n.strstart):(n.window_size-n.strstart<=o&&(n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,n.insert>n.strstart&&(n.insert=n.strstart)),n.window.set(n.strm.input.subarray(n.strm.next_in-o,n.strm.next_in),n.strstart),n.strstart+=o,n.insert+=o>n.w_size-n.insert?n.w_size-n.insert:o),n.block_start=n.strstart),n.high_water<n.strstart&&(n.high_water=n.strstart),a?4:t!==_a&&t!==Hr&&n.strm.avail_in===0&&n.strstart===n.block_start?2:(i=n.window_size-n.strstart,n.strm.avail_in>i&&n.block_start>=n.w_size&&(n.block_start-=n.w_size,n.strstart-=n.w_size,n.window.set(n.window.subarray(n.w_size,n.w_size+n.strstart),0),n.matches<2&&n.matches++,i+=n.w_size,n.insert>n.strstart&&(n.insert=n.strstart)),i>n.strm.avail_in&&(i=n.strm.avail_in),i&&(Zp(n.strm,n.window,n.strstart,i),n.strstart+=i,n.insert+=i>n.w_size-n.insert?n.w_size-n.insert:i),n.high_water<n.strstart&&(n.high_water=n.strstart),i=n.bi_valid+42>>3,i=n.pending_buf_size-i>65535?65535:n.pending_buf_size-i,s=i>n.w_size?n.w_size:i,r=n.strstart-n.block_start,(r>=s||(r||t===Hr)&&t!==_a&&n.strm.avail_in===0&&r<=i)&&(e=r>i?i:r,a=t===Hr&&n.strm.avail_in===0&&e===r?1:0,Yp(n,n.block_start,e,a),n.block_start+=e,_r(n.strm)),a?3:1)},Of=(n,t)=>{let e,r;for(;;){if(n.lookahead<Vi){if(Vo(n),n.lookahead<Vi&&t===_a)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=ma(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),e!==0&&n.strstart-e<=n.w_size-Vi&&(n.match_length=RE(n,e)),n.match_length>=3)if(r=pa(n,n.strstart-n.match_start,n.match_length-3),n.lookahead-=n.match_length,n.match_length<=n.max_lazy_match&&n.lookahead>=3){n.match_length--;do n.strstart++,n.ins_h=ma(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart;while(--n.match_length!=0);n.strstart++}else n.strstart+=n.match_length,n.match_length=0,n.ins_h=n.window[n.strstart],n.ins_h=ma(n,n.ins_h,n.window[n.strstart+1]);else r=pa(n,0,n.window[n.strstart]),n.lookahead--,n.strstart++;if(r&&(br(n,!1),n.strm.avail_out===0))return 1}return n.insert=n.strstart<2?n.strstart:2,t===Hr?(br(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(br(n,!1),n.strm.avail_out===0)?1:2},Fo=(n,t)=>{let e,r,i;for(;;){if(n.lookahead<Vi){if(Vo(n),n.lookahead<Vi&&t===_a)return 1;if(n.lookahead===0)break}if(e=0,n.lookahead>=3&&(n.ins_h=ma(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart),n.prev_length=n.match_length,n.prev_match=n.match_start,n.match_length=2,e!==0&&n.prev_length<n.max_lazy_match&&n.strstart-e<=n.w_size-Vi&&(n.match_length=RE(n,e),n.match_length<=5&&(n.strategy===Hk||n.match_length===3&&n.strstart-n.match_start>4096)&&(n.match_length=2)),n.prev_length>=3&&n.match_length<=n.prev_length){i=n.strstart+n.lookahead-3,r=pa(n,n.strstart-1-n.prev_match,n.prev_length-3),n.lookahead-=n.prev_length-1,n.prev_length-=2;do++n.strstart<=i&&(n.ins_h=ma(n,n.ins_h,n.window[n.strstart+3-1]),e=n.prev[n.strstart&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=n.strstart);while(--n.prev_length!=0);if(n.match_available=0,n.match_length=2,n.strstart++,r&&(br(n,!1),n.strm.avail_out===0))return 1}else if(n.match_available){if(r=pa(n,0,n.window[n.strstart-1]),r&&br(n,!1),n.strstart++,n.lookahead--,n.strm.avail_out===0)return 1}else n.match_available=1,n.strstart++,n.lookahead--}return n.match_available&&(r=pa(n,0,n.window[n.strstart-1]),n.match_available=0),n.insert=n.strstart<2?n.strstart:2,t===Hr?(br(n,!0),n.strm.avail_out===0?3:4):n.sym_next&&(br(n,!1),n.strm.avail_out===0)?1:2};function Ci(n,t,e,r,i){this.good_length=n,this.max_lazy=t,this.nice_length=e,this.max_chain=r,this.func=i}const Ku=[new Ci(0,0,0,0,UE),new Ci(4,4,8,4,Of),new Ci(4,5,16,8,Of),new Ci(4,6,32,32,Of),new Ci(4,4,16,16,Fo),new Ci(8,16,32,32,Fo),new Ci(8,16,128,128,Fo),new Ci(8,32,128,256,Fo),new Ci(32,128,258,1024,Fo),new Ci(32,258,258,4096,Fo)];function Kk(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Yd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),na(this.dyn_ltree),na(this.dyn_dtree),na(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),na(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),na(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Qu=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.status!==Zo&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Ga&&t.status!==ju?1:0},LE=n=>{if(Qu(n))return Va(n,ki);n.total_in=n.total_out=0,n.data_type=Bk;const t=n.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Zo:Ga,n.adler=t.wrap===2?0:1,t.last_flush=-2,Uk(t),In},PE=n=>{const t=LE(n);var e;return t===In&&((e=n.state).window_size=2*e.w_size,na(e.head),e.max_lazy_match=Ku[e.level].max_lazy,e.good_match=Ku[e.level].good_length,e.nice_match=Ku[e.level].nice_length,e.max_chain_length=Ku[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),t},hg=(n,t,e,r,i,s)=>{if(!n)return ki;let a=1;if(t===$k&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||e!==Yd||r<8||r>15||t<0||t>9||s<0||s>Gk||r===8&&a!==1)return Va(n,ki);r===8&&(r=9);const o=new Kk;return n.state=o,o.strm=n,o.status=Zo,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=s,o.method=e,PE(n)};var wc={deflateInit:(n,t)=>hg(n,t,Yd,15,8,Vk),deflateInit2:hg,deflateReset:PE,deflateResetKeep:LE,deflateSetHeader:(n,t)=>Qu(n)||n.state.wrap!==2?ki:(n.state.gzhead=t,In),deflate:(n,t)=>{if(Qu(n)||t>cg||t<0)return n?Va(n,ki):ki;const e=n.state;if(!n.output||n.avail_in!==0&&!n.input||e.status===ju&&t!==Hr)return Va(n,n.avail_out===0?kf:ki);const r=e.last_flush;if(e.last_flush=t,e.pending!==0){if(_r(n),n.avail_out===0)return e.last_flush=-1,In}else if(n.avail_in===0&&dg(t)<=dg(r)&&t!==Hr)return Va(n,kf);if(e.status===ju&&n.avail_in!==0)return Va(n,kf);if(e.status===Zo&&e.wrap===0&&(e.status=Ga),e.status===Zo){let i=Yd+(e.w_bits-8<<4)<<8,s=-1;if(s=e.strategy>=Hl||e.level<2?0:e.level<6?1:e.level===6?2:3,i|=s<<6,e.strstart!==0&&(i|=32),i+=31-i%31,Pu(e,i),e.strstart!==0&&(Pu(e,n.adler>>>16),Pu(e,65535&n.adler)),n.adler=1,e.status=Ga,_r(n),e.pending!==0)return e.last_flush=-1,In}if(e.status===57){if(n.adler=0,ct(e,31),ct(e,139),ct(e,8),e.gzhead)ct(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),ct(e,255&e.gzhead.time),ct(e,e.gzhead.time>>8&255),ct(e,e.gzhead.time>>16&255),ct(e,e.gzhead.time>>24&255),ct(e,e.level===9?2:e.strategy>=Hl||e.level<2?4:0),ct(e,255&e.gzhead.os),e.gzhead.extra&&e.gzhead.extra.length&&(ct(e,255&e.gzhead.extra.length),ct(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(n.adler=fn(n.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=69;else if(ct(e,0),ct(e,0),ct(e,0),ct(e,0),ct(e,0),ct(e,e.level===9?2:e.strategy>=Hl||e.level<2?4:0),ct(e,3),e.status=Ga,_r(n),e.pending!==0)return e.last_flush=-1,In}if(e.status===69){if(e.gzhead.extra){let i=e.pending,s=(65535&e.gzhead.extra.length)-e.gzindex;for(;e.pending+s>e.pending_buf_size;){let o=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+o),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>i&&(n.adler=fn(n.adler,e.pending_buf,e.pending-i,i)),e.gzindex+=o,_r(n),e.pending!==0)return e.last_flush=-1,In;i=0,s-=o}let a=new Uint8Array(e.gzhead.extra);e.pending_buf.set(a.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending+=s,e.gzhead.hcrc&&e.pending>i&&(n.adler=fn(n.adler,e.pending_buf,e.pending-i,i)),e.gzindex=0}e.status=73}if(e.status===73){if(e.gzhead.name){let i,s=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(n.adler=fn(n.adler,e.pending_buf,e.pending-s,s)),_r(n),e.pending!==0)return e.last_flush=-1,In;s=0}i=e.gzindex<e.gzhead.name.length?255&e.gzhead.name.charCodeAt(e.gzindex++):0,ct(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>s&&(n.adler=fn(n.adler,e.pending_buf,e.pending-s,s)),e.gzindex=0}e.status=91}if(e.status===91){if(e.gzhead.comment){let i,s=e.pending;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>s&&(n.adler=fn(n.adler,e.pending_buf,e.pending-s,s)),_r(n),e.pending!==0)return e.last_flush=-1,In;s=0}i=e.gzindex<e.gzhead.comment.length?255&e.gzhead.comment.charCodeAt(e.gzindex++):0,ct(e,i)}while(i!==0);e.gzhead.hcrc&&e.pending>s&&(n.adler=fn(n.adler,e.pending_buf,e.pending-s,s))}e.status=103}if(e.status===103){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(_r(n),e.pending!==0))return e.last_flush=-1,In;ct(e,255&n.adler),ct(e,n.adler>>8&255),n.adler=0}if(e.status=Ga,_r(n),e.pending!==0)return e.last_flush=-1,In}if(n.avail_in!==0||e.lookahead!==0||t!==_a&&e.status!==ju){let i=e.level===0?UE(e,t):e.strategy===Hl?((s,a)=>{let o;for(;;){if(s.lookahead===0&&(Vo(s),s.lookahead===0)){if(a===_a)return 1;break}if(s.match_length=0,o=pa(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,o&&(br(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,a===Hr?(br(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(br(s,!1),s.strm.avail_out===0)?1:2})(e,t):e.strategy===zk?((s,a)=>{let o,u,c,l;const d=s.window;for(;;){if(s.lookahead<=Xa){if(Vo(s),s.lookahead<=Xa&&a===_a)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(c=s.strstart-1,u=d[c],u===d[++c]&&u===d[++c]&&u===d[++c])){l=s.strstart+Xa;do;while(u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&u===d[++c]&&c<l);s.match_length=Xa-(l-c),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(o=pa(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(o=pa(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),o&&(br(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,a===Hr?(br(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(br(s,!1),s.strm.avail_out===0)?1:2})(e,t):Ku[e.level].func(e,t);if(i!==3&&i!==4||(e.status=ju),i===1||i===3)return n.avail_out===0&&(e.last_flush=-1),In;if(i===2&&(t===xk?Pk(e):t!==cg&&(Yp(e,0,0,!1),t===Fk&&(na(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),_r(n),n.avail_out===0))return e.last_flush=-1,In}return t!==Hr?In:e.wrap<=0?lg:(e.wrap===2?(ct(e,255&n.adler),ct(e,n.adler>>8&255),ct(e,n.adler>>16&255),ct(e,n.adler>>24&255),ct(e,255&n.total_in),ct(e,n.total_in>>8&255),ct(e,n.total_in>>16&255),ct(e,n.total_in>>24&255)):(Pu(e,n.adler>>>16),Pu(e,65535&n.adler)),_r(n),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?In:lg)},deflateEnd:n=>{if(Qu(n))return ki;const t=n.state.status;return n.state=null,t===Ga?Va(n,qk):In},deflateSetDictionary:(n,t)=>{let e=t.length;if(Qu(n))return ki;const r=n.state,i=r.wrap;if(i===2||i===1&&r.status!==Zo||r.lookahead)return ki;if(i===1&&(n.adler=Tc(n.adler,t,e,0)),r.wrap=0,e>=r.w_size){i===0&&(na(r.head),r.strstart=0,r.block_start=0,r.insert=0);let u=new Uint8Array(r.w_size);u.set(t.subarray(e-r.w_size,e),0),t=u,e=r.w_size}const s=n.avail_in,a=n.next_in,o=n.input;for(n.avail_in=e,n.next_in=0,n.input=t,Vo(r);r.lookahead>=3;){let u=r.strstart,c=r.lookahead-2;do r.ins_h=ma(r,r.ins_h,r.window[u+3-1]),r.prev[u&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=u,u++;while(--c);r.strstart=u,r.lookahead=2,Vo(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,n.next_in=a,n.input=o,n.avail_in=s,r.wrap=i,In},deflateInfo:"pako deflate (from Nodeca project)"};const Qk=(n,t)=>Object.prototype.hasOwnProperty.call(n,t);var vh={assign:function(n){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const r in e)Qk(e,r)&&(n[r]=e[r])}}return n},flattenChunks:n=>{let t=0;for(let r=0,i=n.length;r<i;r++)t+=n[r].length;const e=new Uint8Array(t);for(let r=0,i=0,s=n.length;r<s;r++){let a=n[r];e.set(a,i),i+=a.length}return e}};let xE=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{xE=!1}const Bc=new Uint8Array(256);for(let n=0;n<256;n++)Bc[n]=n>=252?6:n>=248?5:n>=240?4:n>=224?3:n>=192?2:1;Bc[254]=Bc[254]=1;var jc={string2buf:n=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(n);let t,e,r,i,s,a=n.length,o=0;for(i=0;i<a;i++)e=n.charCodeAt(i),(64512&e)==55296&&i+1<a&&(r=n.charCodeAt(i+1),(64512&r)==56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(o),s=0,i=0;s<o;i++)e=n.charCodeAt(i),(64512&e)==55296&&i+1<a&&(r=n.charCodeAt(i+1),(64512&r)==56320&&(e=65536+(e-55296<<10)+(r-56320),i++)),e<128?t[s++]=e:e<2048?(t[s++]=192|e>>>6,t[s++]=128|63&e):e<65536?(t[s++]=224|e>>>12,t[s++]=128|e>>>6&63,t[s++]=128|63&e):(t[s++]=240|e>>>18,t[s++]=128|e>>>12&63,t[s++]=128|e>>>6&63,t[s++]=128|63&e);return t},buf2string:(n,t)=>{const e=t||n.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(n.subarray(0,t));let r,i;const s=new Array(2*e);for(i=0,r=0;r<e;){let a=n[r++];if(a<128){s[i++]=a;continue}let o=Bc[a];if(o>4)s[i++]=65533,r+=o-1;else{for(a&=o===2?31:o===3?15:7;o>1&&r<e;)a=a<<6|63&n[r++],o--;o>1?s[i++]=65533:a<65536?s[i++]=a:(a-=65536,s[i++]=55296|a>>10&1023,s[i++]=56320|1023&a)}}return((a,o)=>{if(o<65534&&a.subarray&&xE)return String.fromCharCode.apply(null,a.length===o?a:a.subarray(0,o));let u="";for(let c=0;c<o;c++)u+=String.fromCharCode(a[c]);return u})(s,i)},utf8border:(n,t)=>{(t=t||n.length)>n.length&&(t=n.length);let e=t-1;for(;e>=0&&(192&n[e])==128;)e--;return e<0||e===0?t:e+Bc[n[e]]>t?e:t}},FE=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const qE=Object.prototype.toString,{Z_NO_FLUSH:Wk,Z_SYNC_FLUSH:Yk,Z_FULL_FLUSH:Zk,Z_FINISH:Jk,Z_OK:Zd,Z_STREAM_END:Xk,Z_DEFAULT_COMPRESSION:eO,Z_DEFAULT_STRATEGY:tO,Z_DEFLATED:nO}=Co;function Ic(n){this.options=vh.assign({level:eO,method:nO,chunkSize:16384,windowBits:15,memLevel:8,strategy:tO},n||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new FE,this.strm.avail_out=0;let e=wc.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(e!==Zd)throw new Error(go[e]);if(t.header&&wc.deflateSetHeader(this.strm,t.header),t.dictionary){let r;if(r=typeof t.dictionary=="string"?jc.string2buf(t.dictionary):qE.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,e=wc.deflateSetDictionary(this.strm,r),e!==Zd)throw new Error(go[e]);this._dict_set=!0}}function Mf(n,t){const e=new Ic(t);if(e.push(n,!0),e.err)throw e.msg||go[e.err];return e.result}Ic.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=t===~~t?t:t===!0?Jk:Wk,typeof n=="string"?e.input=jc.string2buf(n):qE.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;)if(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),(s===Yk||s===Zk)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(i=wc.deflate(e,s),i===Xk)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),i=wc.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Zd;if(e.avail_out!==0){if(s>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(e.avail_in===0)break}else this.onData(e.output)}return!0},Ic.prototype.onData=function(n){this.chunks.push(n)},Ic.prototype.onEnd=function(n){n===Zd&&(this.result=vh.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var rO={Deflate:Ic,deflate:Mf,deflateRaw:function(n,t){return(t=t||{}).raw=!0,Mf(n,t)},gzip:function(n,t){return(t=t||{}).gzip=!0,Mf(n,t)},constants:Co};const zl=16209;var iO=function(n,t){let e,r,i,s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k,O;const x=n.state;e=n.next_in,k=n.input,r=e+(n.avail_in-5),i=n.next_out,O=n.output,s=i-(t-n.avail_out),a=i+(n.avail_out-257),o=x.dmax,u=x.wsize,c=x.whave,l=x.wnext,d=x.window,h=x.hold,f=x.bits,p=x.lencode,_=x.distcode,m=(1<<x.lenbits)-1,b=(1<<x.distbits)-1;e:do{f<15&&(h+=k[e++]<<f,f+=8,h+=k[e++]<<f,f+=8),y=p[h&m];t:for(;;){if(E=y>>>24,h>>>=E,f-=E,E=y>>>16&255,E===0)O[i++]=65535&y;else{if(!(16&E)){if(!(64&E)){y=p[(65535&y)+(h&(1<<E)-1)];continue t}if(32&E){x.mode=16191;break e}n.msg="invalid literal/length code",x.mode=zl;break e}T=65535&y,E&=15,E&&(f<E&&(h+=k[e++]<<f,f+=8),T+=h&(1<<E)-1,h>>>=E,f-=E),f<15&&(h+=k[e++]<<f,f+=8,h+=k[e++]<<f,f+=8),y=_[h&b];n:for(;;){if(E=y>>>24,h>>>=E,f-=E,E=y>>>16&255,!(16&E)){if(!(64&E)){y=_[(65535&y)+(h&(1<<E)-1)];continue n}n.msg="invalid distance code",x.mode=zl;break e}if(N=65535&y,E&=15,f<E&&(h+=k[e++]<<f,f+=8,f<E&&(h+=k[e++]<<f,f+=8)),N+=h&(1<<E)-1,N>o){n.msg="invalid distance too far back",x.mode=zl;break e}if(h>>>=E,f-=E,E=i-s,N>E){if(E=N-E,E>c&&x.sane){n.msg="invalid distance too far back",x.mode=zl;break e}if(C=0,L=d,l===0){if(C+=u-E,E<T){T-=E;do O[i++]=d[C++];while(--E);C=i-N,L=O}}else if(l<E){if(C+=u+l-E,E-=l,E<T){T-=E;do O[i++]=d[C++];while(--E);if(C=0,l<T){E=l,T-=E;do O[i++]=d[C++];while(--E);C=i-N,L=O}}}else if(C+=l-E,E<T){T-=E;do O[i++]=d[C++];while(--E);C=i-N,L=O}for(;T>2;)O[i++]=L[C++],O[i++]=L[C++],O[i++]=L[C++],T-=3;T&&(O[i++]=L[C++],T>1&&(O[i++]=L[C++]))}else{C=i-N;do O[i++]=O[C++],O[i++]=O[C++],O[i++]=O[C++],T-=3;while(T>2);T&&(O[i++]=O[C++],T>1&&(O[i++]=O[C++]))}break}}break}}while(e<r&&i<a);T=f>>3,e-=T,f-=T<<3,h&=(1<<f)-1,n.next_in=e,n.next_out=i,n.avail_in=e<r?r-e+5:5-(e-r),n.avail_out=i<a?a-i+257:257-(i-a),x.hold=h,x.bits=f};const Gl=15,sO=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),aO=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),oO=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),uO=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Sc=(n,t,e,r,i,s,a,o)=>{const u=o.bits;let c,l,d,h,f,p,_=0,m=0,b=0,y=0,E=0,T=0,N=0,C=0,L=0,k=0,O=null;const x=new Uint16Array(16),Q=new Uint16Array(16);let we,Ie,ze,$t=null;for(_=0;_<=Gl;_++)x[_]=0;for(m=0;m<r;m++)x[t[e+m]]++;for(E=u,y=Gl;y>=1&&x[y]===0;y--);if(E>y&&(E=y),y===0)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(b=1;b<y&&x[b]===0;b++);for(E<b&&(E=b),C=1,_=1;_<=Gl;_++)if(C<<=1,C-=x[_],C<0)return-1;if(C>0&&(n===0||y!==1))return-1;for(Q[1]=0,_=1;_<Gl;_++)Q[_+1]=Q[_]+x[_];for(m=0;m<r;m++)t[e+m]!==0&&(a[Q[t[e+m]]++]=m);if(n===0?(O=$t=a,p=20):n===1?(O=sO,$t=aO,p=257):(O=oO,$t=uO,p=0),k=0,m=0,_=b,f=s,T=E,N=0,d=-1,L=1<<E,h=L-1,n===1&&L>852||n===2&&L>592)return 1;for(;;){we=_-N,a[m]+1<p?(Ie=0,ze=a[m]):a[m]>=p?(Ie=$t[a[m]-p],ze=O[a[m]-p]):(Ie=96,ze=0),c=1<<_-N,l=1<<T,b=l;do l-=c,i[f+(k>>N)+l]=we<<24|Ie<<16|ze|0;while(l!==0);for(c=1<<_-1;k&c;)c>>=1;if(c!==0?(k&=c-1,k+=c):k=0,m++,--x[_]==0){if(_===y)break;_=t[e+a[m]]}if(_>E&&(k&h)!==d){for(N===0&&(N=E),f+=b,T=_-N,C=1<<T;T+N<y&&(C-=x[T+N],!(C<=0));)T++,C<<=1;if(L+=1<<T,n===1&&L>852||n===2&&L>592)return 1;d=k&h,i[d]=E<<24|T<<16|f-s|0}}return k!==0&&(i[f+k]=_-N<<24|64<<16|0),o.bits=E,0};const{Z_FINISH:fg,Z_BLOCK:cO,Z_TREES:Vl,Z_OK:Ba,Z_STREAM_END:lO,Z_NEED_DICT:dO,Z_STREAM_ERROR:xr,Z_DATA_ERROR:pg,Z_MEM_ERROR:_g,Z_BUF_ERROR:hO,Z_DEFLATED:mg}=Co,gh=16180,Bl=16190,cs=16191,Df=16192,Rf=16194,jl=16199,Kl=16200,Uf=16206,Pt=16209,vg=n=>(n>>>24&255)+(n>>>8&65280)+((65280&n)<<8)+((255&n)<<24);function fO(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const eo=n=>{if(!n)return 1;const t=n.state;return!t||t.strm!==n||t.mode<gh||t.mode>16211?1:0},$E=n=>{if(eo(n))return xr;const t=n.state;return n.total_in=n.total_out=t.total=0,n.msg="",t.wrap&&(n.adler=1&t.wrap),t.mode=gh,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ba},HE=n=>{if(eo(n))return xr;const t=n.state;return t.wsize=0,t.whave=0,t.wnext=0,$E(n)},zE=(n,t)=>{let e;if(eo(n))return xr;const r=n.state;return t<0?(e=0,t=-t):(e=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?xr:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=e,r.wbits=t,HE(n))},gg=(n,t)=>{if(!n)return xr;const e=new fO;n.state=e,e.strm=n,e.window=null,e.mode=gh;const r=zE(n,t);return r!==Ba&&(n.state=null),r};let Lf,Pf,yg=!0;const pO=n=>{if(yg){Lf=new Int32Array(512),Pf=new Int32Array(32);let t=0;for(;t<144;)n.lens[t++]=8;for(;t<256;)n.lens[t++]=9;for(;t<280;)n.lens[t++]=7;for(;t<288;)n.lens[t++]=8;for(Sc(1,n.lens,0,288,Lf,0,n.work,{bits:9}),t=0;t<32;)n.lens[t++]=5;Sc(2,n.lens,0,32,Pf,0,n.work,{bits:5}),yg=!1}n.lencode=Lf,n.lenbits=9,n.distcode=Pf,n.distbits=5},Eg=(n,t,e,r)=>{let i;const s=n.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(t.subarray(e-r,e-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(e-r,e),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var bs={inflateReset:HE,inflateReset2:zE,inflateResetKeep:$E,inflateInit:n=>gg(n,15),inflateInit2:gg,inflate:(n,t)=>{let e,r,i,s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T,N,C,L,k=0;const O=new Uint8Array(4);let x,Q;const we=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(eo(n)||!n.output||!n.input&&n.avail_in!==0)return xr;e=n.state,e.mode===cs&&(e.mode=Df),a=n.next_out,i=n.output,u=n.avail_out,s=n.next_in,r=n.input,o=n.avail_in,c=e.hold,l=e.bits,d=o,h=u,L=Ba;e:for(;;)switch(e.mode){case gh:if(e.wrap===0){e.mode=Df;break}for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(2&e.wrap&&c===35615){e.wbits===0&&(e.wbits=15),e.check=0,O[0]=255&c,O[1]=c>>>8&255,e.check=fn(e.check,O,2,0),c=0,l=0,e.mode=16181;break}if(e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&c)<<8)+(c>>8))%31){n.msg="incorrect header check",e.mode=Pt;break}if((15&c)!==mg){n.msg="unknown compression method",e.mode=Pt;break}if(c>>>=4,l-=4,C=8+(15&c),e.wbits===0&&(e.wbits=C),C>15||C>e.wbits){n.msg="invalid window size",e.mode=Pt;break}e.dmax=1<<e.wbits,e.flags=0,n.adler=e.check=1,e.mode=512&c?16189:cs,c=0,l=0;break;case 16181:for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(e.flags=c,(255&e.flags)!==mg){n.msg="unknown compression method",e.mode=Pt;break}if(57344&e.flags){n.msg="unknown header flags set",e.mode=Pt;break}e.head&&(e.head.text=c>>8&1),512&e.flags&&4&e.wrap&&(O[0]=255&c,O[1]=c>>>8&255,e.check=fn(e.check,O,2,0)),c=0,l=0,e.mode=16182;case 16182:for(;l<32;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.head&&(e.head.time=c),512&e.flags&&4&e.wrap&&(O[0]=255&c,O[1]=c>>>8&255,O[2]=c>>>16&255,O[3]=c>>>24&255,e.check=fn(e.check,O,4,0)),c=0,l=0,e.mode=16183;case 16183:for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.head&&(e.head.xflags=255&c,e.head.os=c>>8),512&e.flags&&4&e.wrap&&(O[0]=255&c,O[1]=c>>>8&255,e.check=fn(e.check,O,2,0)),c=0,l=0,e.mode=16184;case 16184:if(1024&e.flags){for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.length=c,e.head&&(e.head.extra_len=c),512&e.flags&&4&e.wrap&&(O[0]=255&c,O[1]=c>>>8&255,e.check=fn(e.check,O,2,0)),c=0,l=0}else e.head&&(e.head.extra=null);e.mode=16185;case 16185:if(1024&e.flags&&(f=e.length,f>o&&(f=o),f&&(e.head&&(C=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(r.subarray(s,s+f),C)),512&e.flags&&4&e.wrap&&(e.check=fn(e.check,r,f,s)),o-=f,s+=f,e.length-=f),e.length))break e;e.length=0,e.mode=16186;case 16186:if(2048&e.flags){if(o===0)break e;f=0;do C=r[s+f++],e.head&&C&&e.length<65536&&(e.head.name+=String.fromCharCode(C));while(C&&f<o);if(512&e.flags&&4&e.wrap&&(e.check=fn(e.check,r,f,s)),o-=f,s+=f,C)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=16187;case 16187:if(4096&e.flags){if(o===0)break e;f=0;do C=r[s+f++],e.head&&C&&e.length<65536&&(e.head.comment+=String.fromCharCode(C));while(C&&f<o);if(512&e.flags&&4&e.wrap&&(e.check=fn(e.check,r,f,s)),o-=f,s+=f,C)break e}else e.head&&(e.head.comment=null);e.mode=16188;case 16188:if(512&e.flags){for(;l<16;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(4&e.wrap&&c!==(65535&e.check)){n.msg="header crc mismatch",e.mode=Pt;break}c=0,l=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),n.adler=e.check=0,e.mode=cs;break;case 16189:for(;l<32;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}n.adler=e.check=vg(c),c=0,l=0,e.mode=Bl;case Bl:if(e.havedict===0)return n.next_out=a,n.avail_out=u,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=l,dO;n.adler=e.check=1,e.mode=cs;case cs:if(t===cO||t===Vl)break e;case Df:if(e.last){c>>>=7&l,l-=7&l,e.mode=Uf;break}for(;l<3;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}switch(e.last=1&c,c>>>=1,l-=1,3&c){case 0:e.mode=16193;break;case 1:if(pO(e),e.mode=jl,t===Vl){c>>>=2,l-=2;break e}break;case 2:e.mode=16196;break;case 3:n.msg="invalid block type",e.mode=Pt}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){n.msg="invalid stored block lengths",e.mode=Pt;break}if(e.length=65535&c,c=0,l=0,e.mode=Rf,t===Vl)break e;case Rf:e.mode=16195;case 16195:if(f=e.length,f){if(f>o&&(f=o),f>u&&(f=u),f===0)break e;i.set(r.subarray(s,s+f),a),o-=f,s+=f,u-=f,a+=f,e.length-=f;break}e.mode=cs;break;case 16196:for(;l<14;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(e.nlen=257+(31&c),c>>>=5,l-=5,e.ndist=1+(31&c),c>>>=5,l-=5,e.ncode=4+(15&c),c>>>=4,l-=4,e.nlen>286||e.ndist>30){n.msg="too many length or distance symbols",e.mode=Pt;break}e.have=0,e.mode=16197;case 16197:for(;e.have<e.ncode;){for(;l<3;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.lens[we[e.have++]]=7&c,c>>>=3,l-=3}for(;e.have<19;)e.lens[we[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,x={bits:e.lenbits},L=Sc(0,e.lens,0,19,e.lencode,0,e.work,x),e.lenbits=x.bits,L){n.msg="invalid code lengths set",e.mode=Pt;break}e.have=0,e.mode=16198;case 16198:for(;e.have<e.nlen+e.ndist;){for(;k=e.lencode[c&(1<<e.lenbits)-1],m=k>>>24,b=k>>>16&255,y=65535&k,!(m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(y<16)c>>>=m,l-=m,e.lens[e.have++]=y;else{if(y===16){for(Q=m+2;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(c>>>=m,l-=m,e.have===0){n.msg="invalid bit length repeat",e.mode=Pt;break}C=e.lens[e.have-1],f=3+(3&c),c>>>=2,l-=2}else if(y===17){for(Q=m+3;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}c>>>=m,l-=m,C=0,f=3+(7&c),c>>>=3,l-=3}else{for(Q=m+7;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}c>>>=m,l-=m,C=0,f=11+(127&c),c>>>=7,l-=7}if(e.have+f>e.nlen+e.ndist){n.msg="invalid bit length repeat",e.mode=Pt;break}for(;f--;)e.lens[e.have++]=C}}if(e.mode===Pt)break;if(e.lens[256]===0){n.msg="invalid code -- missing end-of-block",e.mode=Pt;break}if(e.lenbits=9,x={bits:e.lenbits},L=Sc(1,e.lens,0,e.nlen,e.lencode,0,e.work,x),e.lenbits=x.bits,L){n.msg="invalid literal/lengths set",e.mode=Pt;break}if(e.distbits=6,e.distcode=e.distdyn,x={bits:e.distbits},L=Sc(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,x),e.distbits=x.bits,L){n.msg="invalid distances set",e.mode=Pt;break}if(e.mode=jl,t===Vl)break e;case jl:e.mode=Kl;case Kl:if(o>=6&&u>=258){n.next_out=a,n.avail_out=u,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=l,iO(n,h),a=n.next_out,i=n.output,u=n.avail_out,s=n.next_in,r=n.input,o=n.avail_in,c=e.hold,l=e.bits,e.mode===cs&&(e.back=-1);break}for(e.back=0;k=e.lencode[c&(1<<e.lenbits)-1],m=k>>>24,b=k>>>16&255,y=65535&k,!(m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(b&&!(240&b)){for(E=m,T=b,N=y;k=e.lencode[N+((c&(1<<E+T)-1)>>E)],m=k>>>24,b=k>>>16&255,y=65535&k,!(E+m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}c>>>=E,l-=E,e.back+=E}if(c>>>=m,l-=m,e.back+=m,e.length=y,b===0){e.mode=16205;break}if(32&b){e.back=-1,e.mode=cs;break}if(64&b){n.msg="invalid literal/length code",e.mode=Pt;break}e.extra=15&b,e.mode=16201;case 16201:if(e.extra){for(Q=e.extra;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=16202;case 16202:for(;k=e.distcode[c&(1<<e.distbits)-1],m=k>>>24,b=k>>>16&255,y=65535&k,!(m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(!(240&b)){for(E=m,T=b,N=y;k=e.distcode[N+((c&(1<<E+T)-1)>>E)],m=k>>>24,b=k>>>16&255,y=65535&k,!(E+m<=l);){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}c>>>=E,l-=E,e.back+=E}if(c>>>=m,l-=m,e.back+=m,64&b){n.msg="invalid distance code",e.mode=Pt;break}e.offset=y,e.extra=15&b,e.mode=16203;case 16203:if(e.extra){for(Q=e.extra;l<Q;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,l-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){n.msg="invalid distance too far back",e.mode=Pt;break}e.mode=16204;case 16204:if(u===0)break e;if(f=h-u,e.offset>f){if(f=e.offset-f,f>e.whave&&e.sane){n.msg="invalid distance too far back",e.mode=Pt;break}f>e.wnext?(f-=e.wnext,p=e.wsize-f):p=e.wnext-f,f>e.length&&(f=e.length),_=e.window}else _=i,p=a-e.offset,f=e.length;f>u&&(f=u),u-=f,e.length-=f;do i[a++]=_[p++];while(--f);e.length===0&&(e.mode=Kl);break;case 16205:if(u===0)break e;i[a++]=e.length,u--,e.mode=Kl;break;case Uf:if(e.wrap){for(;l<32;){if(o===0)break e;o--,c|=r[s++]<<l,l+=8}if(h-=u,n.total_out+=h,e.total+=h,4&e.wrap&&h&&(n.adler=e.check=e.flags?fn(e.check,i,h,a-h):Tc(e.check,i,h,a-h)),h=u,4&e.wrap&&(e.flags?c:vg(c))!==e.check){n.msg="incorrect data check",e.mode=Pt;break}c=0,l=0}e.mode=16207;case 16207:if(e.wrap&&e.flags){for(;l<32;){if(o===0)break e;o--,c+=r[s++]<<l,l+=8}if(4&e.wrap&&c!==(4294967295&e.total)){n.msg="incorrect length check",e.mode=Pt;break}c=0,l=0}e.mode=16208;case 16208:L=lO;break e;case Pt:L=pg;break e;case 16210:return _g;default:return xr}return n.next_out=a,n.avail_out=u,n.next_in=s,n.avail_in=o,e.hold=c,e.bits=l,(e.wsize||h!==n.avail_out&&e.mode<Pt&&(e.mode<Uf||t!==fg))&&Eg(n,n.output,n.next_out,h-n.avail_out),d-=n.avail_in,h-=n.avail_out,n.total_in+=d,n.total_out+=h,e.total+=h,4&e.wrap&&h&&(n.adler=e.check=e.flags?fn(e.check,i,h,n.next_out-h):Tc(e.check,i,h,n.next_out-h)),n.data_type=e.bits+(e.last?64:0)+(e.mode===cs?128:0)+(e.mode===jl||e.mode===Rf?256:0),(d===0&&h===0||t===fg)&&L===Ba&&(L=hO),L},inflateEnd:n=>{if(eo(n))return xr;let t=n.state;return t.window&&(t.window=null),n.state=null,Ba},inflateGetHeader:(n,t)=>{if(eo(n))return xr;const e=n.state;return 2&e.wrap?(e.head=t,t.done=!1,Ba):xr},inflateSetDictionary:(n,t)=>{const e=t.length;let r,i,s;return eo(n)?xr:(r=n.state,r.wrap!==0&&r.mode!==Bl?xr:r.mode===Bl&&(i=1,i=Tc(i,t,e,0),i!==r.check)?pg:(s=Eg(n,t,e,e),s?(r.mode=16210,_g):(r.havedict=1,Ba)))},inflateInfo:"pako inflate (from Nodeca project)"},_O=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const GE=Object.prototype.toString,{Z_NO_FLUSH:mO,Z_FINISH:vO,Z_OK:Cc,Z_STREAM_END:xf,Z_NEED_DICT:Ff,Z_STREAM_ERROR:gO,Z_DATA_ERROR:bg,Z_MEM_ERROR:yO}=Co;function Nc(n){this.options=vh.assign({chunkSize:65536,windowBits:15,to:""},n||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||n&&n.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new FE,this.strm.avail_out=0;let e=bs.inflateInit2(this.strm,t.windowBits);if(e!==Cc)throw new Error(go[e]);if(this.header=new _O,bs.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=jc.string2buf(t.dictionary):GE.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=bs.inflateSetDictionary(this.strm,t.dictionary),e!==Cc)))throw new Error(go[e])}function qf(n,t){const e=new Nc(t);if(e.push(n),e.err)throw e.msg||go[e.err];return e.result}Nc.prototype.push=function(n,t){const e=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(a=t===~~t?t:t===!0?vO:mO,GE.call(n)==="[object ArrayBuffer]"?e.input=new Uint8Array(n):e.input=n,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(r),e.next_out=0,e.avail_out=r),s=bs.inflate(e,a),s===Ff&&i&&(s=bs.inflateSetDictionary(e,i),s===Cc?s=bs.inflate(e,a):s===bg&&(s=Ff));e.avail_in>0&&s===xf&&e.state.wrap>0&&n[e.next_in]!==0;)bs.inflateReset(e),s=bs.inflate(e,a);switch(s){case gO:case bg:case Ff:case yO:return this.onEnd(s),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||s===xf))if(this.options.to==="string"){let u=jc.utf8border(e.output,e.next_out),c=e.next_out-u,l=jc.buf2string(e.output,u);e.next_out=c,e.avail_out=r-c,c&&e.output.set(e.output.subarray(u,u+c),0),this.onData(l)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(s!==Cc||o!==0){if(s===xf)return s=bs.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0},Nc.prototype.onData=function(n){this.chunks.push(n)},Nc.prototype.onEnd=function(n){n===Cc&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=vh.flattenChunks(this.chunks)),this.chunks=[],this.err=n,this.msg=this.strm.msg};var EO={Inflate:Nc,inflate:qf,inflateRaw:function(n,t){return(t=t||{}).raw=!0,qf(n,t)},ungzip:qf,constants:Co};const{Deflate:bO,deflate:TO,deflateRaw:wO,gzip:IO}=rO,{Inflate:SO,inflate:CO,inflateRaw:NO,ungzip:AO}=EO;var Fi,kO={Deflate:bO,deflate:TO,deflateRaw:wO,gzip:IO,Inflate:SO,inflate:CO,inflateRaw:NO,ungzip:AO,constants:Co};(function(n){n.CONNECTING="CONNECTING",n.OPEN="OPEN",n.CLOSED="CLOSED"})(Fi||(Fi={}));var dt,OO=function(n){function t(e,r){var i=r.sdkState,s=r.dispatcher,a=r.logger,o=n.call(this)||this;return o.lastActive=0,o._iid=e,o._sdkState=i,o._dispatcher=s,o._logger=a,o}return D(t,n),Object.defineProperty(t.prototype,"isOpen",{get:function(){return this.connectionState===Fi.OPEN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return Fi.CONNECTING;case 1:return Fi.OPEN}return Fi.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ws",{get:function(){var e;return(e=this._ws)!==null&&e!==void 0?e:null},enumerable:!1,configurable:!0}),t.prototype._handleMessage=function(e){var r=this;e.split(`
`).forEach(function(i){if(i){var s=En.createFromRawMessage(r._iid,i);if(r._logger.debug("receive websocket event",s),s.code==="LOGI")r.dispatch("message",s);else if(s.code==="PONG")r.dispatch("pong");else if(s.code==="EXPR"){if(s.payload){var a=new nl(s.payload);a.expiresIn>=0&&r._dispatcher.dispatch(a)}}else s.code==="NOOP"||r.dispatch("message",s)}})},t.prototype.connect=function(e){var r=this;this._ws=new WebSocket(e),this._ws.onopen=function(){r._logger.debug("websocket open"),r.dispatch("open")},this._ws.onmessage=function(i){return S(r,void 0,void 0,function(){var s,a,o=this;return I(this,function(u){return!((a=this._sdkState.websocket)===null||a===void 0)&&a.compression?i.data instanceof Blob?((s=new FileReader).readAsArrayBuffer(i.data),s.onloadend=function(){return S(o,void 0,void 0,function(){var c;return I(this,function(l){switch(l.label){case 0:return[4,(d=s.result,S(void 0,void 0,void 0,function(){var h;return I(this,function(f){return h=kO.ungzip(d),[2,String.fromCharCode.apply(null,h)]})}))];case 1:return c=l.sent(),this._handleMessage(c),[2]}var d})})}):typeof i.data=="string"&&this._handleMessage(i.data):this._handleMessage(i.data),[2]})})},this._ws.onerror=function(){r._logger.debug("websocket error"),r.dispatch("error",H.networkError)},this._ws.onclose=function(){r._logger.debug("websocket close"),r.dispatch("close")},this.lastActive=Date.now()},t.prototype.disconnect=function(){var e=this;return new Promise(function(r){e._logger.debug("websocket disconnect"),e._ws&&e.connectionState!==Fi.CLOSED?(e._ws.onopen=on,e._ws.onmessage=on,e._ws.onerror=on,e._ws.onclose=function(){e.dispatch("close"),r()},e._ws.close(),e._ws=void 0):r()})},t.prototype.send=function(e){if(!this._ws)throw H.connectionClosed;e.code!=="PING"?this.dispatch("ping-refresh"):this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},t.prototype.error=function(e){this._logger.debug("websocket error",e),this.dispatch("error",e)},t}(pu),Bi=function(n){function t(e){var r,i=e.code,s=e.ackRequired,a=e.payload,o=a===void 0?{}:a,u=this;return(u=n.call(this)||this).code=i,u.payload=o,u.requestId=(r=u.payload.req_id)!==null&&r!==void 0?r:fu(),u.ackRequired=s,u.payload.req_id=u.requestId,u}return D(t,n),t.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),`
`)},t}(en),VE=function(n){function t(e){var r=e.all,i=e.feed,s=e.custom_types,a=e.ts,o=n.call(this)||this;return o.all=r,o.feed=i,o.customTypes=s,o.ts=a,o}return D(t,n),t}(en),Wn=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},MO=function(){function n(t,e){var r=e.auth,i=e.sdkState,s=e.dispatcher,a=e.logger,o=e.useFetchCompat,u=o!==void 0&&o,c=this;this._ackStateMap=new Map,this._sdkState=i,this._dispatcher=s,this._logger=a,this.apiClient=new kk(t,{auth:r,sdkState:i,dispatcher:s,logger:a,useFetchCompat:u}),this.websocketClient=new OO(t,{sdkState:i,dispatcher:s,logger:a}),this.websocketClient.on("message",function(l){if(l.payload.unread_cnt&&c._dispatcher.dispatch(new VE(l.payload.unread_cnt)),l.requestId){if(c._ackStateMap.has(l.requestId)){var d=c._ackStateMap.get(l.requestId);l.code!=="EROR"?d.resolve(l):d.reject(new H({code:l.payload.code,message:l.payload.message}))}}else c._dispatcher.dispatch(l)}).on("close",function(){c._ackStateMap.forEach(function(l){l.reject(H.connectionClosed)}),c._ackStateMap.clear()})}return n.prototype._sendApiRequest=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this.apiClient.send(t)];case 1:return[2,e.sent()]}})})},n.prototype._sendWebsocketRequest=function(t){return S(this,void 0,void 0,function(){var e,r,i,s=this;return I(this,function(a){if(!this._sdkState.websocket)throw H.connectionRequired;if(e=new Wn,t.ackRequired){i=function(o,u){s._ackStateMap.has(t.requestId)&&(s._ackStateMap.delete(t.requestId),r&&(clearTimeout(r),r=null),o?(s._logger.debug("fail websocket request",o),e.reject(o)):(s._logger.debug("receive websocket ack",t.requestId),e.resolve(u)))};try{r=setTimeout(function(){return i(H.noAckTimeout)},this._sdkState.websocket.responseTimeout),this._ackStateMap.set(t.requestId,{resolve:function(o){return i(void 0,o)},reject:function(o){return i(o)}}),this.websocketClient.send(t)}catch(o){i(o)}}else try{this.websocketClient.send(t),e.resolve()}catch(o){e.reject(o)}return[2,e.promise]})})},n.prototype.send=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return t instanceof X?[4,this._sendApiRequest(t)]:[3,2];case 1:case 3:return[2,e.sent()];case 2:return t instanceof Bi?[4,this._sendWebsocketRequest(t)]:[3,4];case 4:throw H.invalidParameters}})})},n.prototype.cancel=function(t){this.apiClient.cancel(t)},n.prototype.cancelAll=function(){this.apiClient.cancelAll()},n}();(function(n){n[n.NONE=0]="NONE",n[n.INITIALIZED=1]="INITIALIZED",n[n.CONNECTING=2]="CONNECTING",n[n.CONNECTED=3]="CONNECTED",n[n.RECONNECTING=4]="RECONNECTING",n[n.INTERNAL_DISCONNECTED=5]="INTERNAL_DISCONNECTED",n[n.EXTERNAL_DISCONNECTED=6]="EXTERNAL_DISCONNECTED",n[n.LOGOUT=7]="LOGOUT"})(dt||(dt={}));var mu=function(n){function t(e){var r=e.stateType,i=n.call(this)||this;return i.stateType=r,i}return D(t,n),t}(en),DO=function(){function n(t,e){var r=e.auth,i=e.sdkState,s=e.dispatcher,a=e.logger,o=e.useFetchCompat,u=o!==void 0&&o,c=this;this._currentConnectionStateType=dt.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new MO(t,{auth:r,sdkState:i,dispatcher:s,logger:a,useFetchCompat:u}),this._auth=r,this._logger=a,this._dispatcher=s,this._dispatcher.on(function(l){if(l instanceof mu){var d=l.stateType;switch(c._currentConnectionStateType=d,d){case dt.CONNECTED:var h=c._lazyCallQueue;c._lazyCallQueue=[],h.forEach(function(f){return S(c,void 0,void 0,function(){var p,_,m,b,y;return I(this,function(E){switch(E.label){case 0:p=f.command,_=f.deferred,m=f.timeout,clearTimeout(m),E.label=1;case 1:return E.trys.push([1,3,,4]),[4,this.send(p)];case 2:return b=E.sent(),_.resolve(b),[3,4];case 3:return y=E.sent(),_.reject(y),[3,4];case 4:return[2]}})})});break;case dt.INITIALIZED:case dt.INTERNAL_DISCONNECTED:case dt.EXTERNAL_DISCONNECTED:case dt.LOGOUT:h=c._lazyCallQueue,c._lazyCallQueue=[],h.forEach(function(f){return S(c,void 0,void 0,function(){var p,_;return I(this,function(m){return p=f.deferred,_=f.timeout,clearTimeout(_),this._auth&&this._auth.hasSession?p.reject(H.connectionClosed):p.reject(H.connectionRequired),[2]})})})}}})}return Object.defineProperty(n.prototype,"isReady",{get:function(){return this._currentConnectionStateType===dt.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===dt.CONNECTING||this._currentConnectionStateType===dt.RECONNECTING},enumerable:!1,configurable:!0}),n.prototype.send=function(t){return S(this,void 0,void 0,function(){var e,r,i=this;return I(this,function(s){switch(s.label){case 0:return t instanceof Bi?this.isReady?(this._logger.debug("send websocket request",t),[4,this.commandRouter.send(t)]):[3,2]:[3,4];case 1:case 5:return[2,s.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",t),e=new Wn,this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout(function(){return i.timeout(t.requestId)},1e4)}),[2,e.promise];throw this._logger.debug("fail websocket request"),H.connectionRequired;case 3:case 7:return[3,9];case 4:return t instanceof X?this._auth.hasSession?(this._logger.debug("send api request",t),[4,this.commandRouter.send(t)]):[3,6]:[3,8];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",t),e=new Wn,this._lazyCallQueue.push({command:t,deferred:e,timeout:setTimeout(function(){return i.timeout(t.requestId)},1e4)}),[2,e.promise];throw r=H.connectionRequired,this._logger.debug("fail api request",r),r;case 8:throw H.invalidCommand;case 9:return[2]}})})},n.prototype.forceSend=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return this._logger.debug("send forced request",t),t instanceof Bi||t instanceof X?[4,this.commandRouter.send(t)]:[3,2];case 1:return[2,e.sent()];case 2:throw H.invalidCommand}})})},n.prototype.timeout=function(t){this._logger.debug("timeout request",t);var e=this._lazyCallQueue.findIndex(function(r){return r.command.requestId===t});e>-1&&(this._lazyCallQueue[e].deferred.reject(H.connectionRequired),this._lazyCallQueue.splice(e,1))},n.prototype.cancel=function(t){this._logger.debug("cancel api request",t),this.commandRouter.cancel(t)},n.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},n}(),$f="sendbird@devicetokens",Hf=function(){function n(t){var e=t.type,r=t.token;this.type=e,this.token=r}return n.payloadify=function(t){return me(Te({type:t.type,token:t.token}))},n}(),RO=function(n){function t(e){var r=e.userId,i=e.authToken,s=e.expiringSession,a=s===void 0||s,o=n.call(this)||this;return o.path="".concat(Ye,"/").concat(r,"/session_key"),o.method=J.POST,o.params={token:i,expiring_session:!!a},o.requireAuth=!1,o}return D(t,n),t}(X),UO=function(n){function t(e){var r=e.authToken,i=e.expiringSession,s=i===void 0||i,a=e.requestId,o=a===void 0?"":a;return n.call(this,{code:"LOGI",payload:{token:r,expiring_session:s?1:0,req_id:o},ackRequired:!0})||this}return D(t,n),t}(Bi),LO=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.key;return i.key=s,i}return D(t,n),t}(se),PO=function(n){function t(e,r,i){var s,a=this;return(a=n.call(this,e,"LOGI",i)||this).error=null,a.newKey=null,a.newKey=(s=i.new_key)!==null&&s!==void 0?s:null,a.error=i.error?new H(i.error):null,a}return D(t,n),t}(En),Tg=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return D(t,n),t}(en),Lr=function(n){return S(void 0,void 0,void 0,function(){return I(this,function(t){return[2,new Promise(function(e){return setTimeout(e,n)})]})})},BE=function(){function n(){}return n.prototype.calcTimeout=function(){return 0},n}(),P_=function(n,t,e){return e===void 0&&(e=new BE),S(void 0,void 0,void 0,function(){var r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:r=0,i=null,s=function(l){return i=l??new Error("Halted")},a=function(){r=0},c.label=1;case 1:if(!(t===-1||r<t))return[3,9];c.label=2;case 2:return c.trys.push([2,4,,8]),[4,n(s,a)];case 3:if(o=c.sent(),i)throw i;return[2,o];case 4:if(u=c.sent(),i)return[3,6];if(++r===t)throw u;return[4,Lr(e.calcTimeout(r))];case 5:return c.sent(),[3,7];case 6:throw i;case 7:return[3,8];case 8:return[3,1];case 9:throw"It should not happen."}})})},Ct=function(n){return S(void 0,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,n()];case 1:return e.sent(),[3,3];case 2:if(!((t=e.sent())instanceof H))throw t;return t.throwOutside(),[3,3];case 3:return[2]}})})},gr=function(n){return S(void 0,void 0,void 0,function(){return I(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}})})},zf=new WeakMap,xO=function(n){function t(e){var r=e.auth,i=e.cacheContext,s=e.sdkState,a=e.dispatcher,o=e.requestQueue,u=e.logger,c=n.call(this)||this;return c._currentConnectionStateType=dt.INITIALIZED,c._isRefreshingAuthToken=!1,c._isRefreshingSessionKey=!1,c.currentUser=null,c.auth=r,c._cacheContext=i,c._sdkState=s,c._dispatcher=a,c._requestQueue=o,c._logger=u,c._deviceTokens=[],c._dispatcher.on(function(l){var d;if(l instanceof mu){var h=l.stateType;c._currentConnectionStateType=h}else l instanceof nl&&c.handler&&(l.invalidateSessionToken&&(c.auth.authToken=void 0),l.error&&(l.error.isSessionKeyExpiredError||l.error.isSessionTokenExpiredError)&&(c._logger.debug("session expired"),!((d=c.handler)===null||d===void 0)&&d.onSessionExpired&&c.handler.onSessionExpired(),c.refresh()))}),c}return D(t,n),Object.defineProperty(t.prototype,"ekey",{get:function(){return zf.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceTokens",{get:function(){return this._deviceTokens},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceTokenLastDeletedAt",{get:function(){return this._deviceTokenLastDeletedAt},enumerable:!1,configurable:!0}),t.prototype.indexOfDeviceToken=function(e,r){return this._deviceTokens.findIndex(function(i){return i.type===e&&i.token===r})},t.prototype.hasDeviceToken=function(e,r){return this.indexOfDeviceToken(e,r)>=0},t.prototype.createRefreshWebsocketCommand=function(e,r){return new UO({authToken:e,expiringSession:!0,requestId:r})},t.prototype._refreshSessionKeyByWebSocket=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return r=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(r)];case 1:if(i=u.sent(),s=i.as(PO),a=s.newKey,o=s.error)throw o;return this.auth.sessionKey=a??this.auth.sessionKey,[2]}})})},t.prototype._refreshSessionKeyByApi=function(e){return S(this,void 0,void 0,function(){var r,i=this;return I(this,function(s){switch(s.label){case 0:return r=new RO({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),[4,P_(function(a){return S(i,void 0,void 0,function(){var o,u,c;return I(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(r)];case 1:return o=l.sent(),u=o.as(LO).key,this.auth.sessionKey=u,[3,3];case 2:if(c=l.sent(),!this._isSessionRelatedError(c))throw c;return a(c),[3,3];case 3:return[2]}})})},3)];case 1:return s.sent(),[2]}})})},t.prototype._refreshSessionKey=function(e,r){return r===void 0&&(r=!0),S(this,void 0,void 0,function(){var i,s,a;return I(this,function(o){switch(o.label){case 0:if(this._currentConnectionStateType!==dt.CONNECTED)return[3,10];o.label=1;case 1:return o.trys.push([1,3,,10]),[4,this._refreshSessionKeyByWebSocket(e)];case 2:return o.sent(),this.complete(),[2];case 3:return i=o.sent(),this._isSessionRelatedError(i)&&r?[4,this._receiveNewAuthToken()]:[3,9];case 4:return(a=o.sent())?(this.auth.authToken=a,[4,this._refreshSessionKey(this.auth.authToken,!1)]):[3,6];case 5:return o.sent(),this.complete(),[3,8];case 6:return[4,this.clear()];case 7:o.sent(),this.close(),o.label=8;case 8:return[2];case 9:return[3,10];case 10:return o.trys.push([10,12,,22]),[4,this._refreshSessionKeyByApi(e)];case 11:return o.sent(),this.complete(),[3,22];case 12:return s=o.sent(),this._isSessionRelatedError(s)?r?[4,this._receiveNewAuthToken()]:[3,18]:[3,20];case 13:return(a=o.sent())?(this.auth.authToken=a,[4,this._refreshSessionKeyByApi(this.auth.authToken)]):[3,15];case 14:return o.sent(),this.complete(),[3,17];case 15:return[4,this.clear()];case 16:o.sent(),this.close(),o.label=17;case 17:return[3,19];case 18:throw s;case 19:return[3,21];case 20:throw s;case 21:return[3,22];case 22:return[2]}})})},t.prototype._receiveNewAuthToken=function(){var e=this,r=new Wn;return Ct(function(){return S(e,void 0,void 0,function(){var i,s,a,o,u=this;return I(this,function(c){return this._isRefreshingAuthToken=!0,this.auth.clear(),this.handler.onSessionTokenRequired?(i=null,s=function(){i&&(clearTimeout(i),i=null)},a=function(l){s(),u._isRefreshingAuthToken&&(u._isRefreshingAuthToken=!1,u.dispatch("refresh-authtoken"),r.resolve(l))},o=function(l){s(),u._isRefreshingAuthToken&&(u._isRefreshingAuthToken=!1,r.reject(l))},i=setTimeout(function(){return o()},1e3*this._sdkState.sessionTokenRefreshTimeout),this.handler.onSessionTokenRequired(a,o)):r.resolve(null),[2]})})}),r.promise},t.prototype._isSessionRelatedError=function(e){return e instanceof H&&(e.isSessionKeyExpiredError||e.isSessionTokenExpiredError||e.isSessionRevokedError)},Object.defineProperty(t.prototype,"isSessionKeyRefreshing",{get:function(){return this._isRefreshingSessionKey},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRefreshingAuthToken",{get:function(){return this._isRefreshingAuthToken},enumerable:!1,configurable:!0}),t.prototype.login=function(e){var r;return S(this,void 0,void 0,function(){var i,s,a,o,u,c,l;return I(this,function(d){switch(d.label){case 0:return i=e.key,s=e.ekey,a=e.userProfile,o=e.deviceTokenLastDeletedAt,u=o===void 0?0:o,this.auth.sessionKey=i,zf.set(this,s),this._deviceTokenCacheEnabled=(r=a==null?void 0:a.appInfo)===null||r===void 0?void 0:r.deviceTokenCache,c=this._cacheContext.preference,this._deviceTokenCacheEnabled?[4,c.get($f)]:[3,5];case 1:return!(l=d.sent())||l.lastDeletedAt<u?(this._deviceTokens=[],this._deviceTokenLastDeletedAt=u,[4,this.saveDeviceToken()]):[3,3];case 2:return d.sent(),[3,4];case 3:this._deviceTokens=l.tokens.map(function(h){return new Hf(Hf.payloadify(h))}),this._deviceTokenLastDeletedAt=l.lastDeletedAt,d.label=4;case 4:return[3,7];case 5:return[4,c.remove($f)];case 6:d.sent(),d.label=7;case 7:return[2]}})})},t.prototype.complete=function(){var e=this;this.dispatch("refresh"),Ct(function(){return S(e,void 0,void 0,function(){var r;return I(this,function(i){return this._logger.debug("session refreshed"),!((r=this.handler)===null||r===void 0)&&r.onSessionRefreshed&&this.handler.onSessionRefreshed(),[2]})})})},t.prototype.error=function(e){var r=this;Ct(function(){return S(r,void 0,void 0,function(){var i;return I(this,function(s){return!((i=this.handler)===null||i===void 0)&&i.onSessionError&&this.handler.onSessionError(e),[2]})})})},t.prototype.close=function(){var e=this;this.dispatch("close"),Ct(function(){return S(e,void 0,void 0,function(){var r;return I(this,function(i){return this._logger.debug("session closed"),!((r=this.handler)===null||r===void 0)&&r.onSessionClosed&&this.handler.onSessionClosed(),[2]})})})},t.prototype.refresh=function(){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:if(!this.handler)return[3,10];if(this._isRefreshingSessionKey)return[3,10];if(this._isRefreshingSessionKey=!0,this.auth.authToken)return[3,7];i.label=1;case 1:return i.trys.push([1,6,,7]),[4,this._receiveNewAuthToken()];case 2:return(e=i.sent())?(this._logger.debug("session refreshing.."),this.auth.authToken=e,[3,5]):[3,3];case 3:return[4,this.clear()];case 4:return i.sent(),this._isRefreshingSessionKey=!1,[2];case 5:return[3,7];case 6:throw i.sent(),r=H.sessionTokenRequestFailed,this._dispatcher.dispatch(new Tg),this.error(r),this._isRefreshingSessionKey=!1,r;case 7:return i.trys.push([7,9,,10]),[4,this._refreshSessionKey(this.auth.authToken)];case 8:return i.sent(),this._isRefreshingSessionKey=!1,[3,10];case 9:throw i.sent(),r=H.sessionTokenRefreshFailed,this._dispatcher.dispatch(new Tg),this.error(r),this._isRefreshingSessionKey=!1,r;case 10:return[2]}})})},t.prototype.setDeviceToken=function(e,r){return this._deviceTokenCacheEnabled&&this.indexOfDeviceToken(e,r)<0?(this._deviceTokens.push(new Hf({type:e,token:r})),!0):!1},t.prototype.unsetDeviceToken=function(e,r){if(this._deviceTokenCacheEnabled){var i=this.indexOfDeviceToken(e,r);i>=0&&this._deviceTokens.splice(i,1)}},t.prototype.unsetDeviceTokens=function(e){this._deviceTokenCacheEnabled&&(this._deviceTokens=e?this._deviceTokens.filter(function(r){return r.type!==e}):[])},t.prototype.setDeviceTokenDeletedAt=function(e){e>0&&(this._deviceTokenLastDeletedAt=e)},t.prototype.saveDeviceToken=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return this._deviceTokenCacheEnabled?[4,this._cacheContext.preference.set($f,{tokens:this._deviceTokens,lastDeletedAt:this._deviceTokenLastDeletedAt})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return this.currentUser=null,this.auth.clear(),this.close(),zf.delete(this),this._deviceTokens=[],this._deviceTokenLastDeletedAt=0,[4,this.saveDeviceToken()];case 1:return e.sent(),[2]}})})},t}(pu),No=function(){function n(){this.type=dt.NONE,this.name="none"}return n.prototype.run=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return[2]})})},n.prototype.onConnect=function(t,e){return S(this,void 0,void 0,function(){return I(this,function(r){return[2]})})},n.prototype.onReconnect=function(t,e){return e.resetReconnectCount,S(this,void 0,void 0,function(){return I(this,function(r){return[2]})})},n.prototype.onDisconnect=function(t,e){return e.error,e.autoReconnect,S(this,void 0,void 0,function(){return I(this,function(r){return[2]})})},n.prototype.onDisconnectWebSocket=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return[2]})})},n.prototype.onLogout=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return[2]})})},n}(),uo=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=dt.LOGOUT,e.name="logout",e}return D(t,n),t.prototype.run=function(e){return S(this,void 0,void 0,function(){var r,i,s=this;return I(this,function(a){switch(a.label){case 0:return r=Date.now(),i=e.sdkState.userId,[4,e.logout()];case 1:return a.sent(),[4,e.changeState(new x_,r)];case 2:return a.sent(),Ct(function(){return S(s,void 0,void 0,function(){return I(this,function(o){return e.connectionHandlers.forEach(function(u){u.onDisconnected&&u.onDisconnected(i)}),[2]})})}),[2]}})})},t}(No),yh=function(n){function t(){var e=n.call(this)||this;return e.type=dt.EXTERNAL_DISCONNECTED,e.name="externaldisconnected",e}return D(t,n),t.prototype.run=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return[4,e.disconnect()];case 1:return r.sent(),[2]}})})},t.prototype.onConnect=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.disconnect()];case 1:return s.sent(),[4,e.changeState(new Eh({authToken:r}),i)];case 2:return s.sent(),[2]}})})},t.prototype.onReconnect=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new Xd,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new uo,r)];case 1:return i.sent(),[2]}})})},t}(No),Jd=function(n){function t(e){var r=e.autoReconnect,i=n.call(this)||this;return i.type=dt.INTERNAL_DISCONNECTED,i.name="internaldisconnected",i._autoReconnect=!1,i._autoReconnect=r,i}return D(t,n),t.prototype.run=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.disconnect()];case 1:return i.sent(),this._autoReconnect?[4,e.changeState(new Xd,r)]:[3,3];case 2:i.sent(),i.label=3;case 3:return[2]}})})},t.prototype.onConnect=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.disconnect()];case 1:return s.sent(),[4,e.changeState(new Eh({authToken:r}),i)];case 2:return s.sent(),[2]}})})},t.prototype.onReconnect=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new Xd,r)];case 1:return i.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new yh,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new uo,r)];case 1:return i.sent(),[2]}})})},t}(No),Xd=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=dt.RECONNECTING,e.name="reconnecting",e._callbacks=[],e}return D(t,n),t.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},t.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._resetConnect=void 0,this._callbacks.forEach(function(r){return r(e)})},t.prototype.run=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c=this;return I(this,function(l){switch(l.label){case 0:r=Date.now(),i=new Wn,this._callbacks.push(function(d){return d?i.reject(d):i.resolve()}),Ct(function(){return S(c,void 0,void 0,function(){return I(this,function(d){return e.connectionHandlers.forEach(function(h){h.onReconnectStarted&&h.onReconnectStarted()}),[2]})})}),l.label=1;case 1:return l.trys.push([1,4,,9]),s=e.sdkState.websocket,a=s.reconnectMaxRetry,o=s.reconnectRetryStrategy,[4,P_(function(d,h){return S(c,void 0,void 0,function(){var f;return I(this,function(p){switch(p.label){case 0:this._haltConnect=d,this._resetConnect=h,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,e.connect()];case 2:return p.sent(),[3,4];case 3:if(f=p.sent(),e.clearLoginTimer(),f instanceof H&&f.code===ve.CONNECTION_CANCELED)return d(f),[2];throw f;case 4:return[2]}})})},a,o)];case 2:return l.sent(),[4,e.changeState(new jE,r)];case 3:return l.sent(),Ct(function(){return S(c,void 0,void 0,function(){return I(this,function(d){return this._flushCallbacks(),e.connectionHandlers.forEach(function(h){h.onReconnectSucceeded&&h.onReconnectSucceeded()}),[2]})})}),[3,9];case 4:return u=l.sent(),za(u)?[3,7]:u instanceof H?u.code===ve.CONNECTION_CANCELED?[3,6]:[4,e.changeState(new Jd({autoReconnect:!1}),r)]:[3,6];case 5:l.sent(),l.label=6;case 6:return Ct(function(){return S(c,void 0,void 0,function(){return I(this,function(d){return this._flushCallbacks(u),e.connectionHandlers.forEach(function(h){h.onReconnectFailed&&h.onReconnectFailed()}),[2]})})}),[3,8];case 7:throw u;case 8:return[3,9];case 9:return[2,i.promise]}})})},t.prototype.onConnect=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){return i=new Wn,this._halt(H.connectionCanceled),e.cancelConnectForRetry(),this._callbacks.push(function(){var a=Date.now();e.changeState(new Eh({authToken:r}),a).then(function(){i.resolve()}).catch(function(o){i.reject(o)})}),[2,i.promise]})})},t.prototype.onReconnect=function(e,r){var i=r.resetReconnectCount,s=i!==void 0&&i;return S(this,void 0,void 0,function(){var a;return I(this,function(o){return a=new Wn,this._resetConnect&&s&&this._resetConnect(),this._callbacks.push(function(u){return u?a.reject(u):a.resolve()}),[2,a.promise]})})},t.prototype.onDisconnect=function(e,r){r.error;var i=r.autoReconnect,s=i===void 0||i;return S(this,void 0,void 0,function(){var a;return I(this,function(o){switch(o.label){case 0:return a=Date.now(),this._halt(H.connectionCanceled),[4,e.changeState(new Jd({autoReconnect:s}),a)];case 1:return o.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(H.connectionCanceled),[4,e.changeState(new yh,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(H.connectionCanceled),[4,e.changeState(new uo,r)];case 1:return i.sent(),[2]}})})},t}(No),jE=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=dt.CONNECTED,e.name="connected",e}return D(t,n),t.prototype.onReconnect=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.disconnect()];case 1:return i.sent(),[4,e.changeState(new Xd,r)];case 2:return i.sent(),[2]}})})},t.prototype.onDisconnect=function(e,r){var i=r.autoReconnect;return S(this,void 0,void 0,function(){var s;return I(this,function(a){switch(a.label){case 0:return s=Date.now(),[4,e.changeState(new Jd({autoReconnect:i}),s)];case 1:return a.sent(),[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new yh,r)];case 1:return i.sent(),[2]}})})},t.prototype.onLogout=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),[4,e.changeState(new uo,r)];case 1:return i.sent(),[2]}})})},t}(No),Eh=function(n){function t(e){var r=e.authToken,i=n.call(this)||this;return i.type=dt.CONNECTING,i.name="connecting",i._authToken="",i._callbacks=[],i._authToken=r,i}return D(t,n),t.prototype._halt=function(e){this._haltConnect&&(this._haltConnect(e),this._haltConnect=void 0)},t.prototype._flushCallbacks=function(e){this._haltConnect=void 0,this._callbacks.forEach(function(r){return r(e)})},t.prototype.run=function(e){return S(this,void 0,void 0,function(){var r,i,s,a=this;return I(this,function(o){switch(o.label){case 0:r=Date.now(),i=new Wn,this._callbacks.push(function(u){return u?i.reject(u):i.resolve()}),o.label=1;case 1:return o.trys.push([1,4,,10]),[4,P_(function(u){return S(a,void 0,void 0,function(){var c;return I(this,function(l){switch(l.label){case 0:this._haltConnect=u,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return l.sent(),[3,4];case 3:if(c=l.sent(),e.clearLoginTimer(),c instanceof H&&c.code===ve.CONNECTION_CANCELED)return u(c),[2];throw c;case 4:return[2]}})})},e.sdkState.websocket.connectMaxRetry)];case 2:return o.sent(),[4,e.changeState(new jE,r)];case 3:return o.sent(),Ct(function(){return S(a,void 0,void 0,function(){return I(this,function(u){return this._flushCallbacks(),e.connectionHandlers.forEach(function(c){c.onConnected&&c.onConnected(e.sdkState.userId)}),[2]})})}),[3,10];case 4:return s=o.sent(),za(s)?[3,8]:[4,e.disconnect()];case 5:return o.sent(),s instanceof H?s.code===ve.CONNECTION_CANCELED?[3,7]:[4,e.changeState(new x_,r)]:[3,7];case 6:o.sent(),o.label=7;case 7:return Ct(function(){return S(a,void 0,void 0,function(){return I(this,function(u){return this._flushCallbacks(s),[2]})})}),[3,9];case 8:throw s;case 9:return[3,10];case 10:return[2,i.promise]}})})},t.prototype.onConnect=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){return r=new Wn,this._callbacks.push(function(s){return s?r.reject(s):r.resolve()}),[2,r.promise]})})},t.prototype.onDisconnect=function(e,r){var i=r.error,s=i===void 0?null:i,a=r.autoReconnect,o=a!==void 0&&a;return S(this,void 0,void 0,function(){var u;return I(this,function(c){switch(c.label){case 0:return u=Date.now(),this._halt(s??H.connectionCanceled),e.hasSession?[4,e.changeState(new Jd({autoReconnect:o}),u)]:[3,2];case 1:return c.sent(),[3,4];case 2:return[4,e.changeState(new uo,u)];case 3:c.sent(),c.label=4;case 4:return[2]}})})},t.prototype.onDisconnectWebSocket=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(H.connectionCanceled),e.hasSession?[4,e.changeState(new yh,r)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,e.changeState(new uo,r)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},t.prototype.onLogout=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return r=Date.now(),this._halt(H.connectionCanceled),[4,e.changeState(new uo,r)];case 1:return i.sent(),[2]}})})},t}(No),x_=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.type=dt.INITIALIZED,e.name="initialized",e}return D(t,n),t.prototype.onConnect=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=Date.now(),[4,e.changeState(new Eh({authToken:r}),i)];case 1:return s.sent(),[2]}})})},t}(No),FO=function(n){function t(){return n.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return D(t,n),t}(Bi),qO=function(){function n(t){var e=t.pingDelegate,r=t.sdkState,i=t.logger;this.pingDelegate=e,this.sdkState=r,this._logger=i}return Object.defineProperty(n.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),n.prototype.ping=function(){var t,e=this;if(!this.sdkState.websocket)throw H.connectionRequired;var r=new FO;try{var i=(t=this.sdkState.websocket.pongTimeout)!==null&&t!==void 0?t:5e3;this._pingTimeoutTimer=setTimeout(function(){e._logger.debug("pinger.ping() timeout"),e.pingDelegate.error()},i),this.pingDelegate.send(r),this._logger.debug("pinger.ping()")}catch(s){this._logger.debug("pinger.ping() error",s),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0),this.pingDelegate.error()}return r},n.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},n.prototype.refreshTimer=function(){var t,e=this;if(!this.sdkState.websocket)throw H.connectionRequired;this._logger.debug("pinger.refreshTimer()");var r=(t=this.sdkState.websocket.pingInterval)!==null&&t!==void 0?t:15e3;this.stop(),this._pingTimer=setInterval(function(){e.ping()},r)},n.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},n.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=void 0),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=void 0)},n}(),wg=function(){function n(t){var e,r,i,s;this.isEnabled=(e=t.enabled)!==null&&e!==void 0&&e,this.feedChannels=(r=t.feed_channels)!==null&&r!==void 0?r:{},this.templateListToken=(i=t.template_list_token)!==null&&i!==void 0?i:null,this.settingsUpdatedAt=(s=t.settings_updated_at)!==null&&s!==void 0?s:0}return n.payloadify=function(t){return me(Te({enabled:t.isEnabled,feed_channels:t.feedChannels,template_list_token:t.templateListToken,settings_updated_at:t.settingsUpdatedAt}))},n}(),$O=function(n){return"sendbird@".concat(n,"/changelog_include_chat_notifications")},Ig=function(){function n(t){var e;this.lastUpdatedAt=(e=t.last_updated_at)!==null&&e!==void 0?e:0}return n.payloadify=function(t){return me(Te({last_updated_at:t.lastUpdatedAt}))},n}(),Sg=1048576,HO=5,Cg=function(){function n(t){var e,r,i,s,a;t===void 0&&(t={}),this.emojiHash=t.emoji_hash||"",this.uploadSizeLimit=t.file_upload_size_limit?t.file_upload_size_limit*Sg:Number.MAX_SAFE_INTEGER,this.useReaction=!!t.use_reaction,this.applicationAttributes=(e=t.application_attributes)!==null&&e!==void 0?e:[],this.premiumFeatureList=(r=t.premium_feature_list)!==null&&r!==void 0?r:[],this.deviceTokenCache=this.applicationAttributes.includes("sdk_device_token_cache"),this.enabledChannelMemberShipHistory=this.applicationAttributes.includes("channel_membership_history"),this.multipleFilesMessageFileCountLimit=(i=t.multiple_file_send_max_size)!==null&&i!==void 0?i:5,this.allowSdkStatsUpload=(s=t.allow_sdk_log_ingestion)===null||s===void 0||s,this.uikitConfigInfo=new Ig((a=t.uikit_config)!==null&&a!==void 0?a:{}),this.notificationInfo=t.notifications?new wg(t.notifications):null}return n.payloadify=function(t){return me(Te({emoji_hash:t.emojiHash,file_upload_size_limit:t.uploadSizeLimit/Sg,application_attributes:t.applicationAttributes,premium_feature_list:t.premiumFeatureList,use_reaction:t.useReaction,allow_sdk_log_ingestion:t.allowSdkStatsUpload,uikit_config:t.uikitConfigInfo?Ig.payloadify(t.uikitConfigInfo):null,notifications:t.notificationInfo?wg.payloadify(t.notificationInfo):null}))},n}(),gi=function(){function n(t){this._iid="",this._iid=t}return n.payloadify=function(t){return{}},n}(),zO=function(n){function t(e){var r=e.userId,i=e.metadata,s=n.call(this)||this;return s.method=J.POST,s.path="".concat(Ye,"/").concat(r,"/metadata"),s.params={metadata:i},s}return D(t,n),t}(X),GO=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaData=r,i}return D(t,n),t}(se),VO=function(n){function t(e){var r=e.userId,i=e.metadata,s=e.upsert,a=n.call(this)||this;return a.method=J.PUT,a.path="".concat(Ye,"/").concat(r,"/metadata"),a.params={metadata:i,upsert:s},a}return D(t,n),t}(X),BO=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metadata=r,i}return D(t,n),t}(se),jO=function(n){function t(e){var r=e.userId,i=e.metadataKey,s=n.call(this)||this;return s.method=J.DELETE,s.path="".concat(Ye,"/").concat(r,"/metadata/").concat(i),s}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var KO=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.DELETE,i.path="".concat(Ye,"/").concat(r,"/metadata"),i}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var Bo,F_=function(n,t){var e=JSON.parse(JSON.stringify(n));return e._iid&&delete e._iid,t&&t(e),e},eh=function(n,t){var e=JSON.parse(JSON.stringify(n));return t&&t(e),e},ne=function(n){return{do:function(t){n||t()},throw:function(t){if(!n)throw t}}};(function(n){n.ONLINE="online",n.OFFLINE="offline",n.NON_AVAILABLE="nonavailable"})(Bo||(Bo={}));var ai,$e=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m=this;return(m=n.call(this,e)||this).userId=(s=(i=r.guest_id)!==null&&i!==void 0?i:r.user_id)!==null&&s!==void 0?s:"",m.nickname=(o=(a=r.nickname)!==null&&a!==void 0?a:r.name)!==null&&o!==void 0?o:"",m.plainProfileUrl=(c=(u=r.profile_url)!==null&&u!==void 0?u:r.image)!==null&&c!==void 0?c:"",m.requireAuth=(l=r.require_auth_for_profile_image)!==null&&l!==void 0&&l,m.metaData=(d=r.metadata)!==null&&d!==void 0?d:{},m.connectionStatus=Bo.NON_AVAILABLE,yt(Bo,r.is_online)?m.connectionStatus=r.is_online:$("boolean",r.is_online)&&(m.connectionStatus=r.is_online?Bo.ONLINE:Bo.OFFLINE),m.isActive=(h=r.is_active)===null||h===void 0||h,m.lastSeenAt=(f=r.last_seen_at)!==null&&f!==void 0?f:null,m.preferredLanguages=r.preferred_languages?Ve([],Re(r.preferred_languages),!1):null,m.friendDiscoveryKey=(p=r.friend_discovery_key)!==null&&p!==void 0?p:null,m.friendName=(_=r.friend_name)!==null&&_!==void 0?_:null,m}return D(t,n),t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{user_id:e.userId,nickname:e.nickname,profile_url:e.plainProfileUrl,require_auth_for_profile_image:e.requireAuth,metadata:e.metaData,is_online:e.connectionStatus,is_active:e.isActive,last_seen_at:e.lastSeenAt,preferred_languages:e.preferredLanguages,friend_discovery_key:e.friendDiscoveryKey,friend_name:e.friendName})))},Object.defineProperty(t.prototype,"profileUrl",{get:function(){var e=G.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(e.ekey):this.plainProfileUrl},enumerable:!1,configurable:!0}),t.prototype.serialize=function(){return F_(this)},t.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map(function(r){return e[r]}).every(function(r){return $("string",r)})},t.prototype._applyMetaData=function(e,r){var i=this;r===void 0&&(r=!1),Object.keys(e).forEach(function(s){r?delete i.metaData[s]:i.metaData[s]=e[s]})},t.prototype.createMetaData=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:return ne(this._isValidMetaData(e)).throw(H.invalidParameters),r=G.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new zO({userId:i.userId,metadata:e}),[4,s.send(a)];case 1:return o=c.sent(),u=o.as(GO).metaData,this._applyMetaData(u),[2,this.metaData]}})})},t.prototype.updateMetaData=function(e,r){return r===void 0&&(r=!1),S(this,void 0,void 0,function(){var i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:return ne(this._isValidMetaData(e)).throw(H.invalidParameters),i=G.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new VO({userId:s.userId,metadata:e,upsert:r}),[4,a.send(o)];case 1:return u=l.sent(),c=u.as(BO).metadata,this._applyMetaData(c),[2,this.metaData]}})})},t.prototype.deleteMetaData=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return ne($("string",e)).throw(H.invalidParameters),r=G.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new jO({userId:i.userId,metadataKey:e}),[4,s.send(a)];case 1:return u.sent(),this._applyMetaData(((o={})[e]=!0,o),!0),[2,this.metaData]}})})},t.prototype.deleteAllMetaData=function(){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new KO({userId:r.userId}),[4,i.send(s)];case 1:return a.sent(),this.metaData={},[2]}})})},t}(gi),KE=function(n){function t(e){var r=e.userProfile,i=n.call(this)||this;return i.userProfile=r,i}return D(t,n),t}(en),Jp=function(){function n(t,e){var r,i,s,a,o,u,c,l,d,h,f,p,_,m;this._iid=t,this.appInfo=new Cg(e),this.user=new $e(t,e),this.connectedAt=(r=e.login_ts)!==null&&r!==void 0?r:0,this.firstConnectedAt=0,this.pingInterval=(i=e.ping_interval)!==null&&i!==void 0?i:15e3,this.pongTimeout=(s=e.pong_timeout)!==null&&s!==void 0?s:5e3,this.reconnectInterval=(o=(a=e.reconnect)===null||a===void 0?void 0:a.interval)!==null&&o!==void 0?o:3e3,this.reconnectMaxInterval=(c=(u=e.reconnect)===null||u===void 0?void 0:u.max_interval)!==null&&c!==void 0?c:6e4,this.reconnectRetryCount=(d=(l=e.reconnect)===null||l===void 0?void 0:l.retry_cnt)!==null&&d!==void 0?d:5,this.reconnectIntervalMultiple=(f=(h=e.reconnect)===null||h===void 0?void 0:h.mul)!==null&&f!==void 0?f:2,this.maxUnreadCountOnSuperGroup=(p=e.max_unread_cnt_on_super_group)!==null&&p!==void 0?p:100,this.profileImageEncryption=!!e.profile_image_encryption,this.concurrentCallLimit=(_=e.concurrent_call_limit)!==null&&_!==void 0?_:5,this.backOffDelay=(m=e.back_off_delay)!==null&&m!==void 0?m:100}return n.payloadify=function(t){return me(Te(P(P(P({},$e.payloadify(t.user)),Cg.payloadify(t.appInfo)),{login_ts:t.connectedAt,ping_interval:t.pingInterval,pong_timeout:t.pongTimeout,reconnect:{interval:t.reconnectInterval,max_interval:t.reconnectMaxInterval,retry_cnt:t.reconnectRetryCount,mul:t.reconnectIntervalMultiple},max_unread_cnt_on_super_group:t.maxUnreadCountOnSuperGroup,profile_image_encryption:t.profileImageEncryption,concurrent_call_limit:t.concurrentCallLimit,back_off_delay:t.backOffDelay})))},n.prototype.apply=function(){var t=this.reconnectInterval,e=this.reconnectMaxInterval,r=this.reconnectIntervalMultiple,i=G.of(this._iid);i.sdkState.websocket&&(i.sdkState.websocket.pingInterval=1e3*this.pingInterval,i.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,i.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,i.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(s){return s>0?1e3*Math.min(t*Math.pow(r,s-1),e):10}}),i.appInfo=this.appInfo,i.sessionManager.currentUser=this.user,i.connectedAt=this.connectedAt,this.firstConnectedAt||(i.firstConnectedAt=this.connectedAt),i.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,i.concurrentCallLimit=this.concurrentCallLimit,i.backOffDelay=this.backOffDelay,i.dispatcher.dispatch(new KE({userProfile:this}))},n}(),Gf=function(n){function t(e,r,i){var s,a,o,u=this;return(u=n.call(this,e,r,i)||this).error=null,u.userProfile=new Jp(e,i),u.deviceTokenLastDeletedAt=(s=i.device_token_last_deleted_at)!==null&&s!==void 0?s:0,u.key=(a=i.key)!==null&&a!==void 0?a:"",u.ekey=(o=i.ekey)!==null&&o!==void 0?o:"",u.error=i.error?new H(i):null,u}return D(t,n),t.asError=function(e){return new t("","LOGI",P({user_id:"",error:!0},e))},t.prototype.applyTo=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return this.error?[3,4]:(r=G.of(e))?[4,r.sessionManager.login(this)]:[3,2];case 1:return i.sent(),this.userProfile.apply(),[3,3];case 2:throw H.lostInstance;case 3:return[3,5];case 4:throw this.error;case 5:return[2]}})})},t}(En),QE=function(n){function t(e){var r=e.request,i=r===void 0||r,s=e.features,a=s===void 0?{}:s,o=e.options,u=o===void 0?{}:o,c=n.call(this)||this;return c.request=i,c.features=P({localCache:!0},a),c.options=P({ingestion:!0},u),c}return D(t,n),t}(en),QO=function(n){function t(e,r){var i,s=r.sdkState,a=r.cacheContext,o=r.connectionHandlers,u=r.sessionManager,c=r.websocketClient,l=r.dispatcher,d=r.logger,h=r.entryState,f=h===void 0?new x_:h,p=this;return(p=n.call(this)||this)._stateUpdatedAt=0,p._connectingAt=0,p._connectionRequestQueue=[],p._iid=e,p.sdkState=s,p.cacheContext=a,p.connectionHandlers=o,p._sessionManager=u,p._websocketClient=c,p._dispatcher=l,p._logger=d,p._currentState=f,!((i=p.sdkState.websocket)===null||i===void 0)&&i.pingerDisabled||(p._pinger=new qO({pingDelegate:{send:function(_){return p._websocketClient.send(_)},error:function(_){return p._websocketClient.error(_)}},sdkState:p.sdkState,logger:d})),p._websocketClient.on("open",function(){p._tryResolveConnectionRequest()}).on("message",function(_){_.code==="LOGI"&&(p.clearLoginTimer(),p._dispatcher.dispatch(_.as(Gf)))}).on("ping-refresh",function(){var _;return(_=p._pinger)===null||_===void 0?void 0:_.refreshTimer()}).on("pong",function(){var _;return(_=p._pinger)===null||_===void 0?void 0:_.pong()}).on("error",function(){var _;return(_=p._pinger)===null||_===void 0?void 0:_.stop()}).on("close",function(){p._logiProcessingTimer=setTimeout(function(){p._logiProcessingTimer=void 0,p._unresolvedLogi||p._rejectConnectionRequest(H.networkError)},500)}),p._dispatcher.on(function(_){_ instanceof Gf&&(p._unresolvedLogi=_,p._tryResolveConnectionRequest())}),p}return D(t,n),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasSession",{get:function(){return this._sessionManager.auth.hasSession},enumerable:!1,configurable:!0}),t.prototype.changeState=function(e,r){return S(this,void 0,void 0,function(){return I(this,function(i){switch(i.label){case 0:return r>=this._stateUpdatedAt?(this._currentState=e,this._stateUpdatedAt=r,this._dispatcher.dispatch(new mu({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)]):[3,2];case 1:return i.sent(),[2,!0];case 2:return[2,!1]}})})},t.prototype._tryResolveConnectionRequest=function(){var e;return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){switch(s.label){case 0:return r=this._unresolvedLogi,this._websocketClient.isOpen&&r?(this._unresolvedLogi=void 0,r.error?[3,2]:[4,r.applyTo(this._iid)]):[3,3];case 1:return s.sent(),i=r.userProfile,this._enableStatLog({request:i.appInfo.applicationAttributes.includes("allow_sdk_request_log_publish"),features:{localCache:i.appInfo.applicationAttributes.includes("allow_sdk_feature_local_cache_log_publish")},options:{ingestion:i.appInfo.allowSdkStatsUpload}}),this._statLogConnection(),(e=this._pinger)===null||e===void 0||e.start(),this._connectionRequestQueue.forEach(function(a){return a.resolve()}),this._connectionRequestQueue=[],this.sdkState.appState="foreground",[3,3];case 2:this._sessionManager.auth.authToken=void 0,(r.error.isSessionKeyExpiredError||r.error.isSessionTokenExpiredError)&&this._dispatcher.dispatch(new nl({reason:r.error.code})),this._rejectConnectionRequest(r.error),s.label=3;case 3:return[2]}})})},t.prototype._rejectConnectionRequest=function(e){var r;if((r=this._pinger)===null||r===void 0||r.stop(),this.clearLoginTimer(),this._connectionRequestQueue.length>0){var i=this._connectionRequestQueue;this._connectionRequestQueue=[],i.forEach(function(s){return s.reject(e)}),this._statLogConnection(e)}},t.prototype._url=function(e){var r,i;e===void 0&&(e="");var s=this.sdkState,a=s.appId,o=s.appVersion,u=s.userId,c=s.extensions,l=s.sendbirdRuntimeEnvironment,d=this.cacheContext.localCacheEnabled,h=this._sessionManager.auth,f=(r=this.sdkState.websocket)===null||r===void 0?void 0:r.compression,p=!!((i=this.sdkState.extensions)!==null&&i!==void 0?i:{}).sb_uikit,_=Qd.userAgentWithExtension(c);return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(fa.OS_VERSION),"&sv=").concat(encodeURIComponent(fa.SDK_VERSION),"&ai=").concat(a).concat(o?"&av=".concat(o):"").concat(h.hasSession?"&key=".concat(encodeURIComponent(h.sessionKey)):"&user_id=".concat(encodeURIComponent(u),"&access_token=").concat(encodeURIComponent(e)),"&pmce=").concat(f?1:0,"&active=1&device_token_types=").concat(encodeURIComponent(["gcm","huawei","apns"].join(",")),"&SB-User-Agent=").concat(_,"&SB-SDK-User-Agent=").concat(encodeURIComponent(Qd.sendbirdSdkUserAgentWithExtension(l)),"&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash","multiple_file_send_max_size","notifications"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=").concat(d?1:0,"&include_poll_details=1").concat(p?"&uikit_config=1":"")},t.prototype._enableStatLog=function(e){var r=e.request,i=e.features,s=e.options,a=s===void 0?{}:s;this._dispatcher.dispatch(new QE({request:r,features:i,options:a}))},t.prototype._statLogConnection=function(e){var r;this._dispatcher.dispatch(new R_(new uu({type:oo.WEBSOCKET_CONNECT,data:{host_url:(r=this.sdkState.websocket)===null||r===void 0?void 0:r.host,success:!e,latency:Date.now()-this._connectingAt,error_code:e==null?void 0:e.code,error_description:e==null?void 0:e.message}})))},t.prototype.connect=function(e){var r;return e===void 0&&(e=""),S(this,void 0,void 0,function(){var i,s,a=this;return I(this,function(o){return this._logiProcessingTimer&&(clearTimeout(this._logiProcessingTimer),this._logiProcessingTimer=void 0,this._rejectConnectionRequest(H.connectionCanceled)),i=this._url(e),s=new Wn,this._connectionRequestQueue.push(s),this._connectionRequestQueue.length===1&&(this._connectingAt=Date.now(),this._loginTimer=setTimeout(function(){a._loginTimer=void 0,a._rejectConnectionRequest(H.loginTimeout)},(r=this.sdkState.websocket)===null||r===void 0?void 0:r.responseTimeout),e&&(this._sessionManager.auth.authToken=e),this._websocketClient.connect(i)),[2,s.promise]})})},t.prototype.cancelConnectForRetry=function(){this._dispatcher.dispatch(Gf.asError(H.connectionRenew))},t.prototype.disconnect=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this._websocketClient.disconnect()];case 1:return e.sent(),[2]}})})},t.prototype.logout=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return this.sdkState.userId=void 0,this._unresolvedLogi=void 0,[4,this._sessionManager.clear()];case 1:return e.sent(),[4,this.disconnect()];case 2:return e.sent(),[2]}})})},t.prototype.clearLoginTimer=function(){this._loginTimer&&(clearTimeout(this._loginTimer),this._loginTimer=void 0)},t}(pu),WO=function(){function n(t,e){var r=e.sdkState,i=e.cacheContext,s=e.connectionHandlers,a=e.sessionManager,o=e.websocketClient,u=e.dispatcher,c=e.logger,l=e.disableWebSocketCloseEventHandling,d=l!==void 0&&l;this._disableWebSocketCloseEventHandling=!1,this._externalCalledWebSocketClose=!1,this._logger=c,this._disableWebSocketCloseEventHandling=d,this._context=new QO(t,{sdkState:r,cacheContext:i,connectionHandlers:s,sessionManager:a,websocketClient:o,dispatcher:u,logger:c}),this._sdkState=r,this._sessionManager=a,this._websocketClient=o}return n.prototype._registerEventDispatcher=function(){var t=this;this._disableWebSocketCloseEventHandling||(this._clearEventDispatcher(),this._sessionEventDispatcherContext=this._sessionManager.on("refresh-authtoken",function(){t.isConnected||(t._logger.debug("try reconnect by session token refresh"),t.reconnect())}).on("refresh",function(){t.isConnecting||t.isConnected||(t._logger.debug("try reconnect by session key refresh"),t.reconnect())}),this._websocketEventDispatcherContext=this._websocketClient.on("close",function(){t._sdkState.appState!=="foreground"||t._externalCalledWebSocketClose||t._sessionManager.isRefreshingAuthToken||(t._logger.debug("try reconnect by websocket connection closed"),t.reconnect())}))},n.prototype._clearEventDispatcher=function(){this._sessionEventDispatcherContext&&(this._sessionEventDispatcherContext.close(),this._sessionEventDispatcherContext=void 0),this._websocketEventDispatcherContext&&(this._websocketEventDispatcherContext.close(),this._websocketEventDispatcherContext=void 0)},Object.defineProperty(n.prototype,"isConnected",{get:function(){return this._context.currentState.type===dt.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isConnecting",{get:function(){var t=this._context.currentState;return t.type===dt.CONNECTING||t.type===dt.RECONNECTING},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"websocketClient",{get:function(){return this._websocketClient},enumerable:!1,configurable:!0}),n.prototype.connect=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return e=this._context.currentState,this._externalCalledWebSocketClose=!1,[4,e.onConnect(this._context,t)];case 1:return r.sent(),this._registerEventDispatcher(),[2]}})})},n.prototype.reconnect=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._externalCalledWebSocketClose=!1,[4,t.onReconnect(this._context,{})];case 1:return e.sent(),[2]}})})},n.prototype.resetAndReconnect=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._externalCalledWebSocketClose=!1,[4,t.onReconnect(this._context,{resetReconnectCount:!0})];case 1:return e.sent(),[2]}})})},n.prototype.background=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._externalCalledWebSocketClose=!0,[4,t.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}})})},n.prototype.disconnect=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:t,autoReconnect:!0})];case 1:return e.sent(),[2]}})})},n.prototype.disconnectWebSocket=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._externalCalledWebSocketClose=!0,[4,t.onDisconnectWebSocket(this._context)];case 1:return e.sent(),[2]}})})},n.prototype.logout=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return t=this._context.currentState,this._clearEventDispatcher(),[4,t.onLogout(this._context)];case 1:return e.sent(),[2]}})})},n}(),Ql=function(n){function t(e){var r,i,s,a,o=e.type,u=e.data,c=e.ts,l=c===void 0?Date.now():c,d=n.call(this,{type:o,data:u,ts:l})||this;return d.date=new Date(l),d.key="".concat((r=d.date,i=r.getFullYear(),s=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),"".concat(i).concat(s).concat(a)),"_").concat(o),d}return D(t,n),t}(uu),YO=function(n){function t(e){var r=e.deviceId,i=e.statLogs,s=n.call(this)||this;return s.method=J.POST,s.path="".concat(Ck),s.params={device_id:r,log_entries:i.map(function(a){return uu.payloadify(a)})},s}return D(t,n),t}(X),WE=function(n,t){var e,r;if(n!==null&&t!==null){var i=Object.keys(n),s=Object.keys(t),a=Ve([],Re(new Set(Ve(Ve([],Re(i),!1),Re(s),!1))),!1),o={};try{for(var u=ke(a),c=u.next();!c.done;c=u.next()){var l=c.value,d=typeof n[l],h=typeof t[l];d==="undefined"?o[l]=t[l]:h==="undefined"?o[l]=n[l]:d!==h?o[l]=t[l]:d==="object"&&n[l]&&t[l]?o[l]=WE(n[l],t[l]):o[l]=t[l]}}catch(f){e={error:f}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return o}return t};(function(n){n[n.PENDING=0]="PENDING",n[n.COLLECT_ONLY=1]="COLLECT_ONLY",n[n.ENABLED=2]="ENABLED",n[n.DISABLED=3]="DISABLED"})(ai||(ai={}));var Ts,ZO=function(n){function t(e){var r=e.cacheContext,i=e.requestQueue,s=e.dispatcher,a=e.baseLimit,o=a===void 0?100:a,u=e.maxLimit,c=u===void 0?1e3:u,l=e.minLimit,d=l===void 0?10:l,h=n.call(this)||this;return h.queue=[],h.enabledState=ai.PENDING,h.isFlushing=!1,h.generation=1,h.lastFlushedAt=0,h._collectRequestStat=!0,h._collectFeatureLocalCacheStat=!0,h.deviceId=fu(),h.cacheContext=r,h.requestQueue=i,h.dispatcher=s,h.baseLimit=o,h.limit=o,h.maxLimit=c,h.minLimit=d,h}return D(t,n),Object.defineProperty(t.prototype,"isEnabled",{get:function(){return this.enabledState===ai.ENABLED},enumerable:!1,configurable:!0}),t.prototype._arrangeStat=function(){var e=[];this._collectRequestStat&&e.push.apply(e,Ve([],Re(this.queue.filter(function(r){return r.type===oo.API_RESULT||r.type===oo.WEBSOCKET_CONNECT})),!1)),this._collectFeatureLocalCacheStat&&e.push.apply(e,Ve([],Re(this.queue.filter(function(r){return r.type===oo.FEATURE_LOCALCACHE})),!1)),this.queue=e},t.prototype._save=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return this.enabledState!==ai.ENABLED?[3,2]:[4,this.cacheContext.preference.set(this.key,{deviceId:this.deviceId,statLogs:this.queue.map(function(r){return uu.payloadify(r)}),generation:this.generation++,lastFlushedAt:this.lastFlushedAt})];case 1:e.sent(),this.dispatch("save",Ve([],Re(this.queue),!1)),e.label=2;case 2:return[2]}})})},t.prototype._flush=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a;return I(this,function(o){switch(o.label){case 0:if(!this.isEnabled)return[3,10];if(this.isFlushing)return[3,10];this.isFlushing=!0,o.label=1;case 1:return o.trys.push([1,5,9,10]),this._arrangeStat(),e=this.queue.filter(function(u){if(u instanceof Ql){var c=new Date,l=Re([u.date.getFullYear(),c.getFullYear()],2),d=l[0],h=l[1];if(d<h)return!0;if(d===h){var f=Re([u.date.getMonth(),c.getMonth()],2),p=f[0],_=f[1];if(p<_)return!0;if(p===_){var m=Re([u.date.getDate(),c.getDate()],2);return m[0]<m[1]}}}return!1}),r=this.queue.filter(function(u){return!(u instanceof Ql)}),(i=Ve(Ve([],Re(e),!1),Re(r),!1).slice(0,Math.min(this.limit,this.maxLimit))).length>0?(s=new YO({deviceId:this.deviceId,statLogs:i}),[4,this.requestQueue.send(s)]):[3,4];case 2:return o.sent(),this.dispatch("flush",i),this.queue=Ve(Ve([],Re(e),!1),Re(r),!1).slice(i.length),[4,this._save()];case 3:o.sent(),o.label=4;case 4:return this.limit=this.baseLimit,this.lastFlushedAt=Date.now(),[3,10];case 5:return(a=o.sent())instanceof H?a.code!==ve.STAT_LOG_NOT_ALLOWED?[3,7]:[4,this.clear()]:[3,8];case 6:return o.sent(),this.enabledState=ai.DISABLED,[3,8];case 7:a.code===ve.STAT_UPLOAD_NOT_ALLOWED&&(this.enabledState=ai.COLLECT_ONLY),o.label=8;case 8:return this.limit=this.limit+20,[3,10];case 9:return this.isFlushing=!1,[7];case 10:return[2]}})})},t.prototype.init=function(e){return S(this,void 0,void 0,function(){var r,i,s=this;return I(this,function(a){switch(a.label){case 0:return this.key=e,[4,this.cacheContext.preference.get(this.key)];case 1:return(r=a.sent())?(this.deviceId=r.deviceId,this.queue=r.statLogs.map(function(o){return new uu({type:o.stat_type,ts:o.ts,data:o.data})}),this.generation=r.generation,this.lastFlushedAt=r.lastFlushedAt,Date.now()-this.lastFlushedAt>=108e5&&this.queue.length>=this.minLimit?(i=Math.min(Math.floor(18e4*Math.random()),100),[4,Lr(i)]):[3,4]):[3,4];case 2:return a.sent(),[4,this._flush()];case 3:a.sent(),a.label=4;case 4:return this.commandEventContext||(this.commandEventContext=this.dispatcher.on(function(o){if(o instanceof R_){var u=o.statLog;s.put(u)}else if(o instanceof QE){var c=o.request,l=o.features,d=o.options;s._collectRequestStat=c,s._collectFeatureLocalCacheStat=l==null?void 0:l.localCache,s._arrangeStat(),s._collectRequestStat||s._collectFeatureLocalCacheStat?s.enabledState=d.ingestion?ai.ENABLED:ai.COLLECT_ONLY:s.enabledState=ai.DISABLED,s.isEnabled?s.queue.length>=s.limit&&s._flush():s.clear()}})),[2]}})})},t.prototype.put=function(e){return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){switch(s.label){case 0:return this.enabledState===ai.DISABLED?[3,3]:(e instanceof Ql?this._collectFeatureLocalCacheStat&&(r=Re(this.queue.filter(function(a){return a instanceof Ql&&a.key===e.key}),1),(i=r[0])?i.data=WE(i.data,e.data):this.queue.push(e)):this._collectRequestStat&&this.queue.push(e),[4,this._save()]);case 1:return s.sent(),this.queue.length>=this.limit?[4,this._flush()]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2]}})})},t.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return this.queue=[],this.generation=1,[4,this._save()];case 1:return e.sent(),[2]}})})},t.prototype.close=function(){this.commandEventContext&&(this.commandEventContext.close(),this.commandEventContext=void 0)},t}(pu);(function(n){n[n.NONE=0]="NONE",n[n.VERBOSE=1]="VERBOSE",n[n.DEBUG=2]="DEBUG",n[n.INFO=3]="INFO",n[n.WARN=4]="WARN",n[n.ERROR=5]="ERROR"})(Ts||(Ts={}));var cu,JO=function(){function n(){this.level=Ts.WARN}return n.prototype.verbose=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Ts.VERBOSE&&console.log.apply(console,Ve(["[verbose]"],Re(t),!1))},n.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Ts.DEBUG&&console.log.apply(console,Ve(["[debug]"],Re(t),!1))},n.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Ts.INFO&&console.log.apply(console,Ve(["[info]"],Re(t),!1))},n.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Ts.WARN&&console.warn.apply(console,Ve(["[warn]"],Re(t),!1))},n.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.level<=Ts.ERROR&&console.error.apply(console,Ve(["[error]"],Re(t),!1))},n}(),Ua={},G=function(){function n(t,e){var r,i,s,a,o,u,c,l,d,h;if(this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!Ua[t]){Ua[t]=this;var f=(r=e.options)!==null&&r!==void 0?r:new gE,p=this.sdkState={appId:e.appId,appVersion:(i=e.appVersion)!==null&&i!==void 0?i:"",appState:"foreground",userId:void 0,extensions:{},api:{host:(s=e.apiHost)!==null&&s!==void 0?s:"https://api-".concat(e.appId,".sendbird.com")},websocket:{host:(a=e.websocketHost)!==null&&a!==void 0?a:"wss://ws-".concat(e.appId,".sendbird.com"),pingerDisabled:!!e.noPingpong,pingInterval:void 0,pongTimeout:void 0,connectMaxRetry:2,compression:!0,reconnectMaxRetry:-1,reconnectRetryStrategy:new BE,responseTimeout:f.websocketResponseTimeout},sessionTokenRefreshTimeout:f.sessionTokenRefreshTimeout};this.appInfo=void 0,this.subscribedUnreadMessageCount={all:0,feed:0,customTypes:{},ts:0};var _=this.logger=new JO;this.logger.level=(o=e.logLevel)!==null&&o!==void 0?o:Ts.WARN,this.connectedAt=0,this.firstConnectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map;var m=this.cacheContext=new gk({encryption:e.encryption,store:e.store,localCacheEnabled:(u=e.localCacheEnabled)!==null&&u!==void 0&&u,localCacheConfig:(c=e.localCacheConfig)!==null&&c!==void 0?c:new EE});this.debugMode=(l=e.debugMode)!==null&&l!==void 0&&l,this.maxSuperGroupChannelUnreadCount=fa.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberInfoInMessage=f.useMemberInfoInMessage,this.typingIndicatorInvalidateTime=f.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=f.typingIndicatorThrottle,this.concurrentCallLimit=void 0,this.backOffDelay=void 0;var b=this.dispatcher=new Ek,y=new yk;this.requestQueue=new DO(t,{auth:y,sdkState:p,dispatcher:b,logger:_,useFetchCompat:e.useFetchCompat}),this.sessionManager=new xO({auth:y,cacheContext:m,sdkState:p,dispatcher:b,requestQueue:this.requestQueue,logger:_}),this.connectionManager=new WO(t,{sdkState:p,cacheContext:this.cacheContext,connectionHandlers:this.connectionHandlers,dispatcher:b,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,disableWebSocketCloseEventHandling:(d=e.disableWebSocketCloseEventHandling)!==null&&d!==void 0&&d,logger:_}),this.statLogCollector=new ZO({cacheContext:this.cacheContext,requestQueue:this.requestQueue,dispatcher:b}),this.appStateToggleEnabled=(h=e.appStateToggleEnabled)===null||h===void 0||h}return Ua[t]}return n.of=function(t){if(Ua[t])return Ua[t];throw H.lostInstance},n.clear=function(t){Ua[t]&&delete Ua[t]},n.prototype.hasExtension=function(t){return this.sdkState.extensions&&this.sdkState.extensions[t]},n}(),YE=function(){function n(){}return n.prototype.init=function(t,e){var r=e.sdkState,i=e.dispatcher,s=e.sessionManager,a=e.requestQueue,o=e.logger;e.onlineDetector;var u=e.cacheContext;this._iid=t,this._cacheContext=u,this._sdkState=r,this._dispatcher=i,this._sessionManager=s,this._requestQueue=a,this._logger=o},n}();(function(n){n.OPEN="open",n.CLOSED="closed"})(cu||(cu={}));var bt,Ng=function(n){switch(n){case"open":return cu.OPEN;case"closed":return cu.CLOSED;default:return null}},ZE=function(n){return!n||!!n.text&&$("string",n.text)},yd=function(n){function t(e,r){var i,s,a,o,u,c,l,d=this;return(d=n.call(this,e)||this).pollId=0,d.id=0,d.text=null,d.voteCount=0,d.createdBy=null,d.createdAt=0,d.updatedAt=0,d._lastVotedAt=0,d.pollId=(i=r.poll_id)!==null&&i!==void 0?i:0,d.id=(s=r.id)!==null&&s!==void 0?s:0,d.text=(a=r.text)!==null&&a!==void 0?a:null,d.voteCount=(o=r.vote_count)!==null&&o!==void 0?o:0,d.createdBy=(u=r.created_by)!==null&&u!==void 0?u:null,d.createdAt=(c=r.created_at)!==null&&c!==void 0?c:0,d.updatedAt=(l=r.updated_at)!==null&&l!==void 0?l:0,d}return D(t,n),t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{vote_count:e.voteCount,poll_id:e.pollId,text:e.text,created_at:e.createdAt,id:e.id,created_by:e.createdBy,updated_at:e.updatedAt})))},t}(gi),Qr=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m,b=this;return(b=n.call(this,e)||this).id=0,b.title=null,b.createdAt=0,b.updatedAt=0,b.closeAt=-1,b.status=cu.CLOSED,b.messageId=0,b.data=null,b.voterCount=-1,b.options=[],b.createdBy=null,b.allowUserSuggestion=!1,b.allowMultipleVotes=!1,b.votedPollOptionIds=[],b.id=(i=r.id)!==null&&i!==void 0?i:0,b.title=(s=r.title)!==null&&s!==void 0?s:null,b.createdAt=(a=r.created_at)!==null&&a!==void 0?a:0,b.updatedAt=(o=r.updated_at)!==null&&o!==void 0?o:0,b.closeAt=(u=r.close_at)!==null&&u!==void 0?u:-1,b.status=(c=Ng(r.status))!==null&&c!==void 0?c:cu.CLOSED,b.messageId=(l=r.message_id)!==null&&l!==void 0?l:0,b.data=(d=r.data)!==null&&d!==void 0?d:null,b.voterCount=(h=r.voter_count)!==null&&h!==void 0?h:-1,b.options=r.options?r.options.map(function(y){return new yd(b._iid,y)}):[],b.createdBy=(f=r.created_by)!==null&&f!==void 0?f:null,b.allowUserSuggestion=(p=r.allow_user_suggestion)!==null&&p!==void 0&&p,b.allowMultipleVotes=(_=r.allow_multiple_votes)!==null&&_!==void 0&&_,b.votedPollOptionIds=(m=r.voted_option_ids)!==null&&m!==void 0?m:[],b}return D(t,n),t.prototype._applyPollUpdatePayload=function(e){var r,i,s,a,o,u,c,l,d=this;this.title=(r=e.title)!==null&&r!==void 0?r:this.title,this.updatedAt=(i=e.updated_at)!==null&&i!==void 0?i:this.updatedAt,this.closeAt=(s=e.close_at)!==null&&s!==void 0?s:this.closeAt,this.status=(a=Ng(e.status))!==null&&a!==void 0?a:this.status,this.data=(o=e.data)!==null&&o!==void 0?o:this.data,this.voterCount=(u=e.voter_count)!==null&&u!==void 0?u:this.voterCount,e.options&&(this.options=e.options.map(function(h){return new yd(d._iid,h)}),this.votedPollOptionIds=e.options.filter(function(h){return h.vote_count>0}).map(function(h){return h.id})),this.allowUserSuggestion=(c=e.allow_user_suggestion)!==null&&c!==void 0?c:this.allowUserSuggestion,this.allowMultipleVotes=(l=e.allow_multiple_votes)!==null&&l!==void 0?l:this.allowMultipleVotes},t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{id:e.id,title:e.title,created_at:e.createdAt,updated_at:e.updatedAt,close_at:e.closeAt,status:e.status,message_id:e.messageId,data:e.data,voter_count:e.voterCount,options:e.options.map(function(r){return yd.payloadify(r)}),created_by:e.createdBy,allow_user_suggestion:e.allowUserSuggestion,allow_multiple_votes:e.allowMultipleVotes,voted_option_ids:e.votedPollOptionIds})))},t.prototype.applyPollUpdateEvent=function(e){var r=e._payload.poll;return!(!r||this.id!==r.id||r.updated_at<this.updatedAt)&&(this._applyPollUpdatePayload(r),!0)},t.prototype.applyPollVoteEvent=function(e){if(this.id!==e.pollId)return!1;var r=this.options,i=r.map(function(o){return o.id}),s=e._payload,a=Math.floor(s.ts/1e3);return s.updated_vote_counts.forEach(function(o){var u=i.indexOf(o.option_id);if(u>-1){var c=r[u];a>=c._lastVotedAt&&(c.voteCount=o.vote_count,c._lastVotedAt=a)}}),s.req_id&&s.voted_option_ids&&(this.votedPollOptionIds=s.voted_option_ids),typeof s.voter_count=="number"&&(this.voterCount=s.voter_count),!0},t.prototype.serialize=function(){return F_(this)},t}(gi);(function(n){n.UNKNOWN="UNKNOWN",n.EVENT_CHANNEL_CREATED="EVENT_CHANNEL_CREATED",n.EVENT_CHANNEL_UPDATED="EVENT_CHANNEL_UPDATED",n.EVENT_CHANNEL_DELETED="EVENT_CHANNEL_DELETED",n.EVENT_CHANNEL_READ="EVENT_CHANNEL_READ",n.EVENT_CHANNEL_DELIVERED="EVENT_CHANNEL_DELIVERED",n.EVENT_CHANNEL_INVITED="EVENT_CHANNEL_INVITED",n.EVENT_CHANNEL_JOINED="EVENT_CHANNEL_JOINED",n.EVENT_CHANNEL_LEFT="EVENT_CHANNEL_LEFT",n.EVENT_CHANNEL_ACCEPTED_INVITE="EVENT_CHANNEL_ACCEPTED_INVITE",n.EVENT_CHANNEL_DECLINED_INVITE="EVENT_CHANNEL_DECLINED_INVITE",n.EVENT_CHANNEL_OPERATOR_UPDATED="EVENT_CHANNEL_OPERATOR_UPDATED",n.EVENT_CHANNEL_BANNED="EVENT_CHANNEL_BANNED",n.EVENT_CHANNEL_UNBANNED="EVENT_CHANNEL_UNBANNED",n.EVENT_CHANNEL_MUTED="EVENT_CHANNEL_MUTED",n.EVENT_CHANNEL_UNMUTED="EVENT_CHANNEL_UNMUTED",n.EVENT_CHANNEL_FROZEN="EVENT_CHANNEL_FROZEN",n.EVENT_CHANNEL_UNFROZEN="EVENT_CHANNEL_UNFROZEN",n.EVENT_CHANNEL_HIDDEN="EVENT_CHANNEL_HIDDEN",n.EVENT_CHANNEL_UNHIDDEN="EVENT_CHANNEL_UNHIDDEN",n.EVENT_CHANNEL_RESET_HISTORY="EVENT_CHANNEL_RESET_HISTORY",n.EVENT_CHANNEL_TYPING_STATUS_UPDATE="EVENT_CHANNEL_TYPING_STATUS_UPDATE",n.EVENT_CHANNEL_MEMBER_COUNT_UPDATED="EVENT_CHANNEL_MEMBER_COUNT_UPDATED",n.EVENT_CHANNEL_METADATA_CREATED="EVENT_CHANNEL_METADATA_CREATED",n.EVENT_CHANNEL_METADATA_UPDATED="EVENT_CHANNEL_METADATA_UPDATED",n.EVENT_CHANNEL_METADATA_DELETED="EVENT_CHANNEL_METADATA_DELETED",n.EVENT_CHANNEL_METACOUNTER_CREATED="EVENT_CHANNEL_METACOUNTER_CREATED",n.EVENT_CHANNEL_METACOUNTER_UPDATED="EVENT_CHANNEL_METACOUNTER_UPDATED",n.EVENT_CHANNEL_METACOUNTER_DELETED="EVENT_CHANNEL_METACOUNTER_DELETED",n.EVENT_MESSAGE_SENT="EVENT_MESSAGE_SENT",n.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",n.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",n.EVENT_PINNED_MESSAGE_UPDATED="EVENT_PINNED_MESSAGE_UPDATED",n.REQUEST_CHANNEL="REQUEST_CHANNEL",n.REQUEST_CHANNEL_CHANGELOGS="REQUEST_CHANNEL_CHANGELOGS",n.REFRESH_CHANNEL="REFRESH_CHANNEL",n.CHANNEL_LASTACCESSEDAT_UPDATED="CHANNEL_LASTACCESSEDAT_UPDATED",n.SYNC_CHANNEL_BACKGROUND="SYNC_CHANNEL_BACKGROUND",n.SYNC_CHANNEL_CHANGELOGS="SYNC_CHANNEL_CHANGELOGS",n.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",n.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",n.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",n.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",n.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",n.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",n.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",n.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",n.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",n.REQUEST_MESSAGE="REQUEST_MESSAGE",n.EVENT_POLL_UPDATED="EVENT_POLL_UPDATED",n.EVENT_POLL_VOTED="EVENT_POLL_VOTED",n.SYNC_POLL_CHANGELOGS="SYNC_POLL_CHANGELOGS",n.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",n.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",n.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",n.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",n.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",n.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",n.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",n.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",n.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",n.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"})(bt||(bt={}));P({},bt);var sn=function(n){function t(e){var r=e.messages,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=n.call(this)||this;return o.messages=r,o.source=i,o.isWebSocketEventComing=a,o}return D(t,n),t}(en),JE=function(n){function t(e){var r=e.messageIds,i=e.source,s=e.isWebSocketEventComing,a=s!==void 0&&s,o=n.call(this)||this;return o.messageIds=r,o.source=i,o.isWebSocketEventComing=a,o}return D(t,n),t}(en),XO=function(n){function t(e){var r=e.reqId,i=e.source,s=n.call(this)||this;return s.reqId=r,s.source=i,s}return D(t,n),t}(en),XE=function(n){function t(e){var r=e.polls,i=e.source,s=n.call(this)||this;return s.polls=r,s.source=i,s}return D(t,n),t}(en),eM=function(n){function t(e){var r=e.event,i=e.source,s=n.call(this)||this;return s.event=r,s.source=i,s}return D(t,n),t}(en),eb=function(n){function t(e){var r=e.event,i=e.source,s=n.call(this)||this;return s.event=r,s.source=i,s}return D(t,n),t}(en),rl=function(){function n(t,e){var r;this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=t,this.limit=(r=e.limit)!==null&&r!==void 0?r:20}return Object.defineProperty(n.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),n.prototype._validate=function(){return $("number",this.limit)&&this.limit>0},n}(),vu=function(n){function t(e,r,i,s){var a=n.call(this,e,s)||this;return a.channelUrl=r,a.channelType=i,a}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&$("string",this.channelUrl)&&yt(zt,this.channelType)},t}(rl),tM=function(n){this.pollId=0,this.messageId=0,this.pollId=n.poll_id,this.messageId=n.message_id,this._payload=n},nM=function(n){function t(e){var r=e.title,i=e.optionTexts,s=e.data,a=e.allowUserSuggestion,o=e.allowMultipleVotes,u=e.closeAt,c=n.call(this)||this;return c.method=J.POST,c.path=vi,c.params={title:r,options:i,data:s,allow_user_suggestion:a,allow_multiple_votes:o,close_at:u},c}return D(t,n),t}(X),rM=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new Qr(e,r),i}return D(t,n),t}(se),iM=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=n.call(this)||this;return a.method=J.GET,a.path="".concat(vi,"/").concat(encodeURIComponent(s)),a.params={channel_url:r,channel_type:i},a}return D(t,n),t}(X),sM=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new Qr(e,r),i}return D(t,n),t}(se),aM=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=e.pollOptionId,o=n.call(this)||this;return o.method=J.GET,o.path="".concat(vi,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(a)),o.params={channel_url:r,channel_type:i},o}return D(t,n),t}(X),oM=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pollOption=new yd(e,r),i}return D(t,n),t}(se),uM=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,a=e.token,o=n.call(this)||this;return o.method=J.GET,o.path="".concat(st(r),"/").concat(encodeURIComponent(i),"/polls/changelogs"),o.params=me({change_ts:s,token:a}),o}return D(t,n),t}(X),cM=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.updatedPolls=r.updated.map(function(s){return function(a,o){return new Qr(a,o)}(e,s)}),i.deletedPollIds=r.deleted.map(function(s){return s}),i.hasMore=r.has_more,i.nextToken=r.next,i}return D(t,n),t}(se),lM={title:"",optionTexts:[],data:void 0,allowUserSuggestion:void 0,allowMultipleVotes:void 0,closeAt:-1},tb=function(n){return $("string",n.title)&&(t=n.optionTexts,We("string",t)&&t.every(function(e){return e.trim()!==""}))&&ZE(n.data)&&$("boolean",n.allowUserSuggestion,!0)&&$("boolean",n.allowMultipleVotes,!0)&&$("number",n.closeAt,!0);var t},dM={channelUrl:"",channelType:zt.BASE,pollId:0,pollOptionId:0},nb=function(n){return $("string",n.channelUrl)&&n.channelUrl!==""&&yt(zt,n.channelType)&&$("number",n.pollId)&&n.pollId>0&&$("number",n.pollOptionId)&&n.pollOptionId>0},hM={channelUrl:"",channelType:zt.BASE,pollId:0},rb=function(n){return $("string",n.channelUrl)&&n.channelUrl!==""&&yt(zt,n.channelType)&&$("number",n.pollId)},Ag={},Xp=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.sessionManager,a=e.requestQueue,o=e.logger;this._iid=t,this._sdkState=r,this._sessionManager=s,this._requestQueue=a,this._dispatcher=i,this._logger=o,Ag[t]=this}return n.of=function(t){return Ag[t]},n.prototype.buildPollFromSerializedData=function(t){var e=eh(t);return new Qr(this._iid,Qr.payloadify(e))},n.prototype.get=function(t){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return ne(rb(t)).throw(H.invalidParameters),e=new iM(P({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(sM).poll]}})})},n.prototype.create=function(t){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return ne(tb(t)).throw(H.invalidParameters),e=new nM(P({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(rM).poll]}})})},n.prototype.getOption=function(t){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return ne(nb(t)).throw(H.invalidParameters),e=new aM(P({},t)),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(oM).pollOption]}})})},n.prototype.getPollChangeLogs=function(t,e,r,i){return i===void 0&&(i=bt.SYNC_POLL_CHANGELOGS),S(this,void 0,void 0,function(){var s,a,o,u,c,l,d;return I(this,function(h){switch(h.label){case 0:return s=new uM(Te({channelType:e,channelUrl:t,timestamp:typeof r=="number"?r:null,token:typeof r=="string"?r:null})),[4,this._requestQueue.send(s)];case 1:return a=h.sent(),o=a.as(cM),u=o.updatedPolls,c=o.deletedPollIds,l=o.hasMore,d=o.nextToken,u.length>0&&this._dispatcher.dispatch(new XE({polls:u,source:i})),[2,{updatedPolls:u,deletedPollIds:c,hasMore:l,token:d}]}})})},n}(),fM=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.token,a=e.limit,o=n.call(this)||this;return o.method=J.GET,o.path=vi,o.params={channel_url:r,channel_type:i,token:s,limit:a},o}return D(t,n),t}(X),pM=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).polls=((i=r.polls)!==null&&i!==void 0?i:[]).map(function(a){return new Qr(e,a)}),s.token=r.next,s}return D(t,n),t}(se),ib=function(n){function t(e,r){return n.call(this,e,r.channelUrl,r.channelType,r)||this}return D(t,n),t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=G.of(this._iid).requestQueue,r=new fM(P(P({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(pM),a=s.polls,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(vu),_M=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=e.pollOptionId,o=e.token,u=e.limit,c=n.call(this)||this;return c.method=J.GET,c.path="".concat(vi,"/").concat(encodeURIComponent(s),"/options/").concat(encodeURIComponent(a),"/voters"),c.params={channel_url:r,channel_type:i,token:o,limit:u},c}return D(t,n),t}(X),mM=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).voters=((i=r.voters)!==null&&i!==void 0?i:[]).map(function(a){return new $e(e,a)}),s.token=r.next,s}return D(t,n),t}(se),sb=function(n){function t(e,r){var i=n.call(this,e,r.channelUrl,r.channelType,r)||this;return i.pollId=r.pollId,i.pollOptionId=r.pollOptionId,i}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&$("number",this.pollId)&&$("number",this.pollOptionId)},t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=G.of(this._iid).requestQueue,r=new _M(P(P({},this),{pollId:this.pollId,pollOptionId:this.pollOptionId,token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(mM),a=s.voters,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(vu),Kc,kg=function(n){function t(e){var r=n.call(this)||this;if(r.method=J.POST,r.path="".concat(bk),r.params=me({file:e.file,channel_url:e.channelUrl}),e.thumbnailSizes)for(var i=0;i<e.thumbnailSizes.length;i++){var s=e.thumbnailSizes[i],a=s.maxWidth,o=s.maxHeight;r.params["thumbnail".concat(i+1)]="".concat(a,",").concat(o)}return r.requestId=e.requestId,r}return D(t,n),t}(X),Og=function(n){function t(e,r){var i,s,a,o=this;return(o=n.call(this,e,r)||this).url=r.url,o.fileSize=(i=r.file_size)!==null&&i!==void 0?i:0,o.thumbnailSizes=(s=r.thumbnails)!==null&&s!==void 0?s:[],o.requireAuth=(a=r.require_auth)!==null&&a!==void 0&&a,o}return D(t,n),t}(se),e_=function(n){function t(e,r){var i,s,a,o=this;return(o=n.call(this,e)||this).replyCount=0,o.lastRepliedAt=0,o.updatedAt=0,o.replyCount=(i=r.reply_count)!==null&&i!==void 0?i:0,o.mostRepliedUsers=r.most_replies&&We("object",r.most_replies)?r.most_replies.map(function(u){return new $e(o._iid,u)}):[],o.lastRepliedAt=(s=r.last_replied_at)!==null&&s!==void 0?s:0,o.updatedAt=(a=r.updated_at)!==null&&a!==void 0?a:0,o}return D(t,n),t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{reply_count:e.replyCount,most_replies:Array.isArray(e.mostRepliedUsers)?e.mostRepliedUsers.map(function(r){return $e.payloadify(r)}):[],last_replied_at:e.lastRepliedAt,updated_at:e.updatedAt})))},t}(gi);(function(n){n.ADD="add",n.DELETE="delete"})(Kc||(Kc={}));var Mg,ea,ab=function(n){this.messageId=0,this.operation=null,this.updatedAt=0;var t=$("string",n.msg_id)?parseInt(n.msg_id):n.msg_id,e=n.user_id,r=n.operation?n.operation.toLowerCase():null,i=n.reaction,s=n.updated_at;t&&$("string",e)&&$("string",r)&&yt(Kc,r)&&$("string",i)&&i&&$("number",s)&&(this.messageId=t,this.userId=e,this.key=i,this.operation=r,this.updatedAt=s)},Wl=function(){function n(t){var e,r,i,s=t.key,a=(i=Ve([],Re(t.user_ids),!1))!==null&&i!==void 0?i:[],o=t.updated_at;$("string",s)&&s&&We("string",a)&&a.length>0&&$("number",o)&&(this.key=s,this.userIds=a,this.updatedAt=o);var u={};try{for(var c=ke(this.userIds),l=c.next();!l.done;l=c.next())u[l.value]=this.updatedAt}catch(d){e={error:d}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}this._version=u}return Object.defineProperty(n.prototype,"isEmpty",{get:function(){return this.userIds.length===0},enumerable:!1,configurable:!0}),n.payloadify=function(t){return me(Te({key:t.key,user_ids:t.userIds,updated_at:t.updatedAt}))},n.prototype.applyEvent=function(t){if(t.key===this.key&&this.updatedAt<=t.updatedAt){if(!this._version[t.userId]||this._version[t.userId]<=t.updatedAt){var e=this.userIds.indexOf(t.userId);switch(t.operation){case Kc.ADD:e<0&&this.userIds.push(t.userId);break;case Kc.DELETE:e>=0&&this.userIds.splice(e,1)}this._version[t.userId]=t.updatedAt}this.updatedAt=Math.max(this.updatedAt,t.updatedAt)}},n}(),wr=function(){function n(t){this.key=t.key,this.value=We("string",t.value)?Ve([],Re(t.value),!1):[]}return n.payloadify=function(t){var e;return me(Te({key:t.key,value:(e=t.value)!==null&&e!==void 0?e:[]}))},n}(),Dg=function(){function n(t){this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=t.url,t.secure_url&&(this.secureUrl=t.secure_url),t.type&&(this.type=t.type),t.width&&(this.width=t.width),t.height&&(this.height=t.height),t.alt&&(this.alt=t.alt)}return n.payloadify=function(t){var e,r;return me(Te({url:t.url,secure_url:t.secureUrl,type:t.type,width:(e=t.width)!==null&&e!==void 0?e:0,height:(r=t.height)!==null&&r!==void 0?r:0,alt:t.alt}))},n}(),Rg=function(){function n(t){this.title=null,this.url=null,this.description=null,this.defaultImage=null,t["og:title"]&&(this.title=t["og:title"]),t["og:url"]&&(this.url=t["og:url"]),t["og:description"]&&(this.description=t["og:description"]),t["og:image"]&&(this.defaultImage=new Dg(t["og:image"]))}return n.payloadify=function(t){return me(Te({"og:title":t.title,"og:url":t.url,"og:description":t.description,"og:image":t.defaultImage?Dg.payloadify(t.defaultImage):null}))},n}(),ji=function(){function n(t){var e,r;this.volume=0,this.name=(e=t.name)!==null&&e!==void 0?e:"default",this.volume=(r=t.volume)!==null&&r!==void 0?r:1}return n.prototype.serialize=function(){return{name:this.name,volume:this.volume}},n.payloadify=function(t){return me(Te({name:t.name,volume:t.volume}))},n}(),lu=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).isBlockedByMe=!1,s.role=yt(jd,r.role)?r.role:jd.NONE,s.isBlockedByMe=(i=r.is_blocked_by_me)!==null&&i!==void 0&&i,s}return D(t,n),t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{role:e.role,is_blocked_by_me:e.isBlockedByMe})))},t}($e);(function(n){n.PENDING="pending",n.SENT="sent",n.FAILED="failed",n.CANCELED="canceled"})(Mg||(Mg={})),function(n){n.PENDING="pending",n.IN_QUEUE="in_queue",n.SENT="sent",n.FAILED="failed",n.CANCELED="canceled",n.REMOVED="removed"}(ea||(ea={}));var Ug=function(n){switch(n){case Ot.BASE:return"";case Ot.USER:return"MESG";case Ot.FILE:return"FILE";case Ot.ADMIN:return"ADMM"}},vs=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m,b,y,E,T=this;(T=n.call(this,e)||this).channelType=zt.BASE,T.parentMessage=null,T.silent=!1,T.isOperatorMessage=!1,T.messageType=Ot.BASE,T.mentionType=null,T.threadInfo=null,T.reactions=[],T.metaArrays=[],T.appleCriticalAlertOptions=null,T.createdAt=0,T.updatedAt=0,T.scheduledInfo=null,T.extendedMessage={},T._isContinuousMessages=!1,T._scheduledStatus=null,T.messageId=(s=(i=r.msg_id)!==null&&i!==void 0?i:r.message_id)!==null&&s!==void 0?s:0,T.channelUrl=r.channel_url,T.channelType=yt(zt,r.channel_type)?r.channel_type:zt.GROUP,r.channel&&(r.channel.channel_url&&(T.channelUrl=r.channel.channel_url),r.channel.channel_type&&(T.channelType=r.channel.channel_type)),T.parentMessageId=(a=typeof r.parent_message_id=="string"?parseInt(r.parent_message_id):r.parent_message_id)!==null&&a!==void 0?a:0,T.data=(o=r.data)!==null&&o!==void 0?o:"",T.customType=(u=r.custom_type)!==null&&u!==void 0?u:"",T.mentionType=yt(Hn,r.mention_type)?r.mention_type:null,T.mentionedUsers=r.mentioned_users?r.mentioned_users.map(function(O){return new $e(T._iid,O)}):null,T.mentionedUserIds=(c=r.mentioned_user_ids)!==null&&c!==void 0?c:null,T.mentionedUsers&&!T.mentionedUserIds&&(T.mentionedUserIds=T.mentionedUsers.map(function(O){return O.userId})),T.mentionedMessageTemplate=(l=r.mentioned_message_template)!==null&&l!==void 0?l:"",T.threadInfo=r.thread_info?new e_(T._iid,r.thread_info):null,T.reactions=r.reactions?r.reactions.map(function(O){return new Wl(O)}):[];var N=(d=r.metaarray)!==null&&d!==void 0?d:{},C=(h=r.metaarray_key_order)!==null&&h!==void 0?h:Object.keys(N).sort(function(O,x){return O.localeCompare(x)});T.metaArrays=[];for(var L=0;L<C.length;L++){var k=C[L];T.metaArrays.push(new wr({key:k,value:N[k]||[]}))}return r.sorted_metaarray&&(T.metaArrays=r.sorted_metaarray.map(function(O){return new wr(O)})),T.ogMetaData=r.og_tag?new Rg(r.og_tag):null,T.silent=(f=r.silent)!==null&&f!==void 0&&f,T.isOperatorMessage=(p=r.is_op_msg)!==null&&p!==void 0&&p,T.appleCriticalAlertOptions=r.apple_critical_alert_options?new ji(r.apple_critical_alert_options):null,T.createdAt=(m=(_=r.created_at)!==null&&_!==void 0?_:r.ts)!==null&&m!==void 0?m:0,T.updatedAt=(b=r.updated_at)!==null&&b!==void 0?b:0,typeof r.scheduled_message_id=="number"&&typeof r.scheduled_at=="number"&&r.scheduled_status&&(T.scheduledInfo={scheduledMessageId:r.scheduled_message_id,scheduledAt:r.scheduled_at},T._scheduledStatus=r.scheduled_status),T.extendedMessage=(y=r.extended_message)!==null&&y!==void 0?y:{},T._isContinuousMessages=(E=r.is_continuous_messages)!==null&&E!==void 0&&E,T}return D(t,n),t.payloadify=function(e){var r,i,s,a;return me(Te(P(P({},n.payloadify.call(this,e)),{channel_url:e.channelUrl,channel_type:e.channelType,message_id:e.messageId,type:Ug(e.messageType),parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,mentioned_user_ids:e.mentionedUserIds,mentioned_users:(r=e.mentionedUsers)===null||r===void 0?void 0:r.map(function(o){return $e.payloadify(o)}),mentioned_message_template:e.mentionedMessageTemplate,thread_info:e.threadInfo?e_.payloadify(e.threadInfo):null,reactions:e.reactions.map(function(o){return Wl.payloadify(o)}),sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(o){return wr.payloadify(o)}),og_tag:e.ogMetaData?Rg.payloadify(e.ogMetaData):null,silent:e.silent,is_op_msg:e.isOperatorMessage,apple_critical_alert_options:e.appleCriticalAlertOptions?ji.payloadify(e.appleCriticalAlertOptions):null,created_at:e.createdAt,updated_at:e.updatedAt,scheduled_message_id:(s=e.scheduledInfo)===null||s===void 0?void 0:s.scheduledMessageId,scheduled_at:(a=e.scheduledInfo)===null||a===void 0?void 0:a.scheduledAt,scheduled_status:e._scheduledStatus,extended_message:e.extendedMessage})))},t._getParentMessageInfoPayload=function(e){return me(Te({type:Ug(e.messageType),ts:e.createdAt,user:e.sender?lu.payloadify(e.sender):null,message:e.message,file:{url:e.plainUrl,name:e.name,type:e.type,require_auth:e.requireAuth}}))},t.prototype.isIdentical=function(e){return this.messageId===e.messageId},t.prototype.isEqual=function(e){return vE(this,e)},t.prototype.isUserMessage=function(){return this.messageType===Ot.USER},t.prototype.isFileMessage=function(){return this.messageType===Ot.FILE&&!Object.prototype.hasOwnProperty.call(this,"fileInfoList")},t.prototype.isMultipleFilesMessage=function(){return this.messageType===Ot.FILE&&Object.prototype.hasOwnProperty.call(this,"fileInfoList")},t.prototype.isAdminMessage=function(){return this.messageType===Ot.ADMIN},t.prototype.serialize=function(){return F_(this)},t.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter(function(r){return e.includes(r.key)})},t.prototype.applyThreadInfoUpdateEvent=function(e){return this.messageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},t.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var r=!1,i=0;i<this.reactions.length;i++)if(this.reactions[i].key===e.key){this.reactions[i].applyEvent(e),this.reactions[i].isEmpty&&this.reactions.splice(i,1),r=!0;break}r||e.operation!=="add"||this.reactions.push(new Wl(Wl.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},t.prototype.applyParentMessage=function(e){if(!this.parentMessage)return this.parentMessage=e,!0;if(this.parentMessageId===e.messageId){var r=this.parentMessage.updatedAt;if(e.updatedAt>=r)return this.parentMessage=e,!0}return!1},t}(gi),yo=function(n){function t(e,r){var i,s,a,o,u=this;if((u=n.call(this,e,r)||this).reqId="",u.replyToChannel=!1,u.errorCode=0,u.sender=r.user?new lu(u._iid,r.user):r.sender_id,u.reqId=(s=(i=r.req_id)!==null&&i!==void 0?i:r.request_id)!==null&&s!==void 0?s:"",u.replyToChannel=(a=r.is_reply_to_channel)!==null&&a!==void 0&&a,r.request_state&&yt(St,r.request_state)&&(u.sendingStatus=r.request_state),!u.sendingStatus)if(u.messageId>0)u.sendingStatus=St.SUCCEEDED;else if(u.scheduledInfo)switch(r.scheduled_status&&(u._scheduledStatus=r.scheduled_status),r.scheduled_status){case ea.SENT:case ea.IN_QUEUE:u.sendingStatus=St.SUCCEEDED;break;case ea.PENDING:u.sendingStatus=St.SCHEDULED;break;case ea.FAILED:case ea.REMOVED:u.sendingStatus=St.FAILED;break;case ea.CANCELED:u.sendingStatus=St.CANCELED}else u.sendingStatus=St.PENDING;return u.errorCode=(o=r.error_code)!==null&&o!==void 0?o:0,u}return D(t,n),t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{user:lu.payloadify(e.sender),req_id:e.reqId,is_reply_to_channel:e.replyToChannel,request_state:e.sendingStatus,error_code:e.errorCode})))},Object.defineProperty(t.prototype,"isResendable",{get:function(){return this.sendingStatus===St.FAILED&&vk(this.errorCode)},enumerable:!1,configurable:!0}),t.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},t}(vs),il=function(){function n(t){var e,r;this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=t.url,this.width=t.width,this.height=t.height,this.realWidth=(e=t.real_width)!==null&&e!==void 0?e:t.width,this.realHeight=(r=t.real_height)!==null&&r!==void 0?r:t.height}return n.payloadify=function(t){return me(Te({url:"",width:t.maxWidth,height:t.maxHeight,real_width:0,real_height:0}))},Object.defineProperty(n.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),n}(),sl={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Sr.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1},bh=function(n){return $("number",n.prevResultSize)&&$("number",n.nextResultSize)&&$("boolean",n.isInclusive)&&$("boolean",n.reverse)&&$("string",n.messageTypeFilter)&&yt(Sr,n.messageTypeFilter)&&We("string",n.customTypesFilter,!0)&&We("string",n.senderUserIdsFilter,!0)&&$("boolean",n.includeMetaArray)&&$("boolean",n.includeReactions)&&$("boolean",n.includeParentMessageInfo)},t_=function(n){function t(e,r){var i,s,a,o,u=this;if((u=n.call(this,e,r)||this).translations={},u.message=(i=r.message)!==null&&i!==void 0?i:"",u.messageType=Ot.ADMIN,u.translations=(s=r.translations)!==null&&s!==void 0?s:{},r.parent_message_info){var c=r.parent_message_info;u.parentMessage=Ps(e,me(Te(P(P({},c),{message_id:u.parentMessageId,channel_url:u.channelUrl,channel_type:u.channelType,file:c.file,url:(a=c.file)===null||a===void 0?void 0:a.url,require_auth:(o=c.file)===null||o===void 0?void 0:o.require_auth}))))}return u}return D(t,n),t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{message:e.message,translations:e.translations,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},t.prototype.getThreadedMessagesByTimestamp=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=P(P({},sl),r),ne(this.messageId>0&&$("number",e)&&bh(i)).throw(H.invalidParameters),[4,xn.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t}(vs),Lg=function(){function n(t){var e,r;this.detail={},this.type=(e=t.type)!==null&&e!==void 0?e:"",this.vendor=(r=t.vendor)!==null&&r!==void 0?r:"",t.detail&&$("object",t.detail)&&!Array.isArray(t.detail)&&(this.detail=t.detail)}return n.payloadify=function(t){return me(Te({type:t.type,vendor:t.vendor,detail:t.detail}))},n}(),Qn=function(n){function t(e,r){var i,s,a,o,u,c,l,d=this;if((d=n.call(this,e,r)||this).message="",d.messageParams=null,d.translations={},d.translationTargetLanguages=[],d.messageSurvivalSeconds=-1,d.plugins=[],d._poll=null,d.message=r.message,d.messageType=Ot.USER,d.translations=(a=r.translations)!==null&&a!==void 0?a:{},d.translationTargetLanguages=(o=r.target_langs)!==null&&o!==void 0?o:[],Object.keys(d.translations).length===0&&d.translationTargetLanguages.length>0)try{for(var h=ke(d.translationTargetLanguages),f=h.next();!f.done;f=h.next()){var p=f.value;d.translations[p]=""}}catch(m){i={error:m}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}}if(d.messageSurvivalSeconds=(u=r.message_survival_seconds)!==null&&u!==void 0?u:-1,d.plugins=r.plugins?r.plugins.map(function(m){return new Lg(m)}):[],d._poll=r.poll?new Qr(d._iid,r.poll):null,r.parent_message_info){var _=r.parent_message_info;d.parentMessage=Ps(e,me(Te(P(P({},_),{created_at:_.ts,message_id:d.parentMessageId,channel_url:d.channelUrl,channel_type:d.channelType,file:_.file,url:(c=_.file)===null||c===void 0?void 0:c.url,require_auth:(l=_.file)===null||l===void 0?void 0:l.require_auth}))))}return d}return D(t,n),t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{message:e.message,translations:e.translations,message_survival_seconds:e.messageSurvivalSeconds,plugins:e.plugins.map(function(r){return Lg.payloadify(r)}),poll:e._poll?Qr.payloadify(e._poll):null,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},t.prototype.getThreadedMessagesByTimestamp=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=P(P({},sl),r),ne(this.messageId>0&&$("number",e)&&bh(i)).throw(H.invalidParameters),[4,xn.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.applyPoll=function(e){return!(this._poll&&this._poll.id===e.id&&this._poll.updatedAt>e.updatedAt)&&(this._poll=e,!0)},Object.defineProperty(t.prototype,"poll",{get:function(){return this._poll},enumerable:!1,configurable:!0}),t}(yo),Pg=function(n){function t(e,r){var i,s,a,o,u,c=this;(c=n.call(this,e)||this).plainUrl="",c.fileName=null,c.mimeType=null,c.fileSize=0,c.thumbnails=[],c._requireAuth=!1,c.plainUrl=(i=r.url)!==null&&i!==void 0?i:"",c.fileName=(s=r.file_name)!==null&&s!==void 0?s:null,c.mimeType=(a=r.file_type)!==null&&a!==void 0?a:null,c.fileSize=(o=r.file_size)!==null&&o!==void 0?o:0,c._requireAuth=(u=r.require_auth)!==null&&u!==void 0&&u;var l=G.of(c._iid).sessionManager;return c.thumbnails=r.thumbnails?r.thumbnails.map(function(d){return new il(P(P({},d),{url:"".concat(d.url.split("?auth=")[0]).concat(c._requireAuth?"?auth=".concat(l.ekey):"")}))}):[],c}return D(t,n),t.payloadify=function(e){var r;return me(Te({url:e.plainUrl,file_name:e.fileName,file_type:e.mimeType,file_size:e.fileSize,thumbnails:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{url:i.url,width:i.width,height:i.height,real_width:i.realWidth,real_height:i.realHeight}}),require_auth:e._requireAuth}))},Object.defineProperty(t.prototype,"url",{get:function(){var e=G.of(this._iid).sessionManager;return this._requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t}(gi),Vr=function(n){function t(e,r){var i,s,a,o,u,c=this;if((c=n.call(this,e,r)||this).messageParams=null,c.fileInfoList=[],c.messageSurvivalSeconds=-1,c.messageType=Ot.FILE,c.fileInfoList=(s=(i=r.files)===null||i===void 0?void 0:i.map(function(d){return new Pg(e,d)}))!==null&&s!==void 0?s:[],c.messageSurvivalSeconds=(a=r.message_survival_seconds)!==null&&a!==void 0?a:-1,r.parent_message_info){var l=r.parent_message_info;c.parentMessage=Ps(e,me(Te(P(P({},l),{created_at:l.ts,message_id:c.parentMessageId,channel_url:c.channelUrl,channel_type:c.channelType,file:l.file,url:(o=l.file)===null||o===void 0?void 0:o.url,require_auth:(u=l.file)===null||u===void 0?void 0:u.require_auth}))))}return c}return D(t,n),t.prototype.getThreadedMessagesByTimestamp=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=P(P({},sl),r),ne(this.messageId>0&&$("number",e)&&bh(i)).throw(H.invalidParameters),[4,xn.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{files:e.fileInfoList&&e.fileInfoList&&Array.isArray(e.fileInfoList)?e.fileInfoList.map(function(r){return Pg.payloadify(r)}):null,message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},t._isMultipleFilesMessagePayload=function(e){var r=e.files;return Array.isArray(r)&&r.length>=2},t._isMultipleFilesMessageSerializedData=function(e){var r=e.fileInfoList;return Array.isArray(r)},t}(yo),Ps=function(n,t){switch(t.type){case"MESG":return new Qn(n,t);case"FILE":return Vr._isMultipleFilesMessagePayload(t)?new Vr(n,t):new Jt(n,t);case"ADMM":case"BRDM":return new t_(n,t)}throw H.unknown},Jt=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f,p,_,m,b,y=this;(y=n.call(this,e,r)||this).messageParams=null,y.plainUrl="",y.requireAuth=!1,y.thumbnails=[],y.messageSurvivalSeconds=-1,y.messageType=Ot.FILE;var E=r.file;y.plainUrl=((s=(i=E==null?void 0:E.url)!==null&&i!==void 0?i:r.url)!==null&&s!==void 0?s:"").split("?auth=")[0],y.name=(o=(a=E==null?void 0:E.name)!==null&&a!==void 0?a:r.name)!==null&&o!==void 0?o:"File",y.size=(c=(u=E==null?void 0:E.size)!==null&&u!==void 0?u:r.size)!==null&&c!==void 0?c:0,y.data=(d=(l=E==null?void 0:E.data)!==null&&l!==void 0?l:r.custom)!==null&&d!==void 0?d:"",y.type=E?(h=E.type)!==null&&h!==void 0?h:"":(f=r.type)!==null&&f!==void 0?f:"";var T=G.of(y._iid).sessionManager;if(y.requireAuth=(p=r.require_auth)!==null&&p!==void 0&&p,y.thumbnails=r.thumbnails?r.thumbnails.map(function(C){return new il(P(P({},C),{url:"".concat(C.url.split("?auth=")[0]).concat(y.requireAuth?"?auth=".concat(T.ekey):"")}))}):[],y.messageSurvivalSeconds=(_=r.message_survival_seconds)!==null&&_!==void 0?_:-1,r.parent_message_info){var N=r.parent_message_info;y.parentMessage=Ps(e,me(Te(P(P({},N),{created_at:N.ts,message_id:y.parentMessageId,channel_url:y.channelUrl,channel_type:y.channelType,file:N.file,url:(m=N.file)===null||m===void 0?void 0:m.url,require_auth:(b=N.file)===null||b===void 0?void 0:b.require_auth}))))}return y}return D(t,n),t.payloadify=function(e){var r;return me(Te(P(P({},n.payloadify.call(this,e)),{url:e.plainUrl,require_auth:e.requireAuth,file:{name:e.name,size:e.size,type:e.type,data:e.data},thumbnails:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{url:i.url,width:i.width,height:i.height,real_width:i.realWidth,real_height:i.realHeight}}),message_survival_seconds:e.messageSurvivalSeconds,parent_message_info:e.parentMessage?n._getParentMessageInfoPayload.call(this,e.parentMessage):null})))},Object.defineProperty(t.prototype,"url",{get:function(){var e=G.of(this._iid).sessionManager;return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(e.ekey):this.plainUrl},enumerable:!1,configurable:!0}),t.prototype.getThreadedMessagesByTimestamp=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=P(P({},sl),r),ne(this.messageId>0&&$("number",e)&&bh(i)).throw(H.invalidParameters),[4,xn.of(this._iid).getThreadedMessagesByTimestamp(this,e,i)];case 1:return[2,s.sent()]}})})},t}(yo),vM=function(n){function t(e){var r,i,s,a=[];return e.mentionType===Hn.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map(function(o){return o.userId}))),n.call(this,{code:"FILE",ackRequired:!0,payload:me(Te({channel_url:e.channelUrl,files:e.files?ob(e.files):null,url:e.url,name:(r=e.fileName)!==null&&r!==void 0?r:"",type:(i=e.mimeType)!==null&&i!==void 0?i:"",size:(s=e.fileSize)!==null&&s!==void 0?s:0,custom:e.data,custom_type:e.customType,thumbnails:e.thumbnailSizes,require_auth:e.requireAuth,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:a,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==ba.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions?ji.payloadify(e.appleCriticalAlertOptions):null,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,pin_message:e.isPinnedMessage}))})||this}return D(t,n),t}(Bi),gM=function(n){function t(e){var r,i,s=this;s=n.call(this)||this;var a=[];return e.mentionType===Hn.USERS&&(e.mentionedUserIds?a=e.mentionedUserIds:e.mentionedUsers&&(a=e.mentionedUsers.map(function(o){return o.userId}))),s.method=J.POST,s.path="".concat(st(e.channelType),"/").concat(encodeURIComponent(e.channelUrl),"/messages"),s.params=me(Te({message_type:Ot.FILE,user_id:e.userId,files:e.files?ob(e.files):null,url:e.fileUrl,mention_type:e.mentionType,mentioned_user_ids:a,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,data:e.data,custom_type:e.customType,thumbnails:(r=e.thumbnailSizes)===null||r===void 0?void 0:r.map(function(o){return il.payloadify(o)}),require_auth:e.requireAuth,sorted_metaarray:(i=e.metaArrays)===null||i===void 0?void 0:i.map(function(o){return wr.payloadify(o)}),push_option:e.pushNotificationDeliveryOption,parent_message_id:e.parentMessageId?e.parentMessageId:null,apple_critical_alert_options:e.appleCriticalAlertOptions?ji.payloadify(e.appleCriticalAlertOptions):null,reply_to_channel:e.isReplyToChannel,req_id:e.reqId,pin_message:e.isPinnedMessage})),s}return D(t,n),t}(X),yM=function(n){function t(e,r,i){var s,a,o,u,c=this;(c=n.call(this,e,"FILE",i)||this).message=i.files&&i.files.length>=2?new Vr(e,i):new Jt(e,i);var l=G.of(e).sdkState;return c.isMentioned=Hc(c.message.mentionType,(o=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(a=c.message.mentionedUsers)===null||a===void 0?void 0:a.map(function(d){return d.userId}))!==null&&o!==void 0?o:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return D(t,n),t}(En),EM=function(n){function t(e,r){var i,s,a,o,u=this;(u=n.call(this,e,r)||this).message=r.files&&r.files.length>=2?new Vr(e,r):new Jt(e,r);var c=G.of(e).sdkState;return u.isMentioned=Hc(u.message.mentionType,(a=(i=u.message.mentionedUserIds)!==null&&i!==void 0?i:(s=u.message.mentionedUsers)===null||s===void 0?void 0:s.map(function(l){return l.userId}))!==null&&a!==void 0?a:[],c.userId),u.forceUpdateLastMessage=(o=r.force_update_last_message)!==null&&o!==void 0&&o,u}return D(t,n),t}(se);function ob(n){return n.map(function(t){var e,r;return me(Te({url:t.fileUrl,file_name:t.fileName,file_type:t.mimeType,file_size:t.fileSize,thumbnails:(e=t.thumbnailSizes)===null||e===void 0?void 0:e.map(function(i){return il.payloadify(i)}),require_auth:(r=t._uploadedMetaData)===null||r===void 0?void 0:r.requireAuth}))})}var jt;(function(n){n[n.PENDING=0]="PENDING",n[n.UPLOADING=1]="UPLOADING",n[n.UPLOADED=2]="UPLOADED",n[n.SENDING=3]="SENDING",n[n.FAILED=4]="FAILED"})(jt||(jt={}));var bM=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.requestQueue,a=e.onlineDetector,o=e.cacheContext,u=this;this._queueMap=new Map,this._iid=t,this._sdkState=r,this._requestQueue=s,this._cacheContext=o,this._dispatcher=i,this._dispatcher.on(function(c){c instanceof mu&&(u._connectionState=c.stateType)}),this._onlineDetector=a}return Object.defineProperty(n.prototype,"_shouldSendThroughWebSocket",{get:function(){return this._connectionState===dt.CONNECTED||this._connectionState===dt.CONNECTING||this._connectionState===dt.RECONNECTING},enumerable:!1,configurable:!0}),n.prototype._sendFileMessage=function(t,e){return S(this,void 0,void 0,function(){var r,i,s;return I(this,function(a){switch(a.label){case 0:return r=this._createSendFileMessageRequestParams(t,e),this._shouldSendThroughWebSocket?(i=new vM(r),[4,this._requestQueue.send(i)]):[3,2];case 1:return s=a.sent(),[2,s.as(yM).message];case 2:return i=new gM(P(P({},r),{userId:this._sdkState.userId})),[4,this._requestQueue.send(i)];case 3:return s=a.sent(),[2,s.as(EM).message]}})})},n.prototype._createSendFileMessageRequestParams=function(t,e){var r=P(P({},e.params),{channelUrl:t.url,channelType:t.channelType,reqId:e.requestId,url:""});if(e.multipleFileUploadInfo){var i=e.params;r.files=i.fileInfoList}else i=e.params,r.url=i.fileUrl,r.requireAuth=i.requireAuth;return r},n.prototype._resolveMessageQueue=function(t){var e;return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h,f,p,_;return I(this,function(m){switch(m.label){case 0:if(!(r=this._queueMap.get(t.url)))return[3,21];if(r.isResolving)return[3,20];r.isResolving=!0,i=[],s=!0,m.label=1;case 1:m.trys.push([1,15,16,17]),a=ke(r.messageQueue),o=a.next(),m.label=2;case 2:if(o.done)return[3,14];switch(u=o.value,u.state){case jt.PENDING:case jt.UPLOADING:return[3,3];case jt.UPLOADED:return[3,4];case jt.FAILED:return[3,12]}return[3,13];case 3:return s=!1,i.push(u),[3,13];case 4:if(!s)return[3,10];m.label=5;case 5:return m.trys.push([5,8,,9]),u.state=jt.SENDING,[4,this._sendFileMessage(t,u)];case 6:return c=m.sent(),u.deferred.resolve(c),[4,Lr(100)];case 7:return m.sent(),[3,9];case 8:return l=m.sent(),u.deferred.reject(l),[3,9];case 9:return[3,11];case 10:i.push(u),m.label=11;case 11:return[3,13];case 12:return d=(e=u.error)!==null&&e!==void 0?e:H.unknown,u.deferred.reject(d.code===ve.REQUEST_CANCELED?H.fileUploadCanceled:d),[3,13];case 13:return o=a.next(),[3,2];case 14:return[3,17];case 15:return h=m.sent(),p={error:h},[3,17];case 16:try{o&&!o.done&&(_=a.return)&&_.call(a)}finally{if(p)throw p.error}return[7];case 17:return f=r.isResolveRequestPending,r.messageQueue=i,r.isResolving=!1,r.isResolveRequestPending=!1,f?[4,this._resolveMessageQueue(t)]:[3,19];case 18:m.sent(),m.label=19;case 19:return[3,21];case 20:r.isResolveRequestPending=!0,m.label=21;case 21:return[2]}})})},n.prototype._uploadNextPendingItem=function(t){var e;return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d;return I(this,function(h){switch(h.label){case 0:return(r=this._queueMap.get(t.url))&&(i=r.messageQueue.find(function(f){return f.state===jt.PENDING}))?i.multipleFileUploadInfo?(s=i.multipleFileUploadInfo,a=s.uploadIndex,o=s.uploadCount,u=s.requestHandler,d=i.params,c=d.fileInfoList[a],!Gi(c.file)||!((e=c._uploadedMetaData)===null||e===void 0)&&e.isUploaded?[3,2]:[4,this._tryUploadNextItemAndUpdateItemState(t,r,i)]):[3,4]:[3,9];case 1:return h.sent(),[3,3];case 2:i.state=a<o-1?jt.PENDING:jt.UPLOADED,h.label=3;case 3:return l=a,u==null||u._triggerOnFileUploaded(i.requestId,l,c,i.error),i.multipleFileUploadInfo.uploadIndex++,[3,7];case 4:return d=i.params,Gi(d.file)?[4,this._tryUploadNextItemAndUpdateItemState(t,r,i)]:[3,6];case 5:return h.sent(),[3,7];case 6:d.thumbnailSizes=[],i.state=jt.UPLOADED,h.label=7;case 7:return this._uploadNextPendingItem(t),[4,this._resolveMessageQueue(t)];case 8:h.sent(),h.label=9;case 9:return[2]}})})},n.prototype._tryUploadNextItemAndUpdateItemState=function(t,e,r){return S(this,void 0,void 0,function(){var i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:return[4,this._onlineDetector.isOnline()];case 1:if(i=l.sent(),!G.of(this._iid).sessionManager.currentUser||!i)return r.error=H.connectionRequired,r.state=jt.FAILED,[2];if(!(e.uploadQueue.length<6))return[3,9];r.state=jt.UPLOADING,e.uploadQueue.push(r),l.label=2;case 2:return l.trys.push([2,7,,8]),r.multipleFileUploadInfo?(s=r.multipleFileUploadInfo,a=s.uploadIndex,o=s.uploadCount,u=r.params,[4,this._uploadNextFileForMultipleFilesItemAndUpdateParams(t,r,u)]):[3,4];case 3:return l.sent(),r.state=a<o-1?jt.PENDING:jt.UPLOADED,[3,6];case 4:return u=r.params,[4,this._uploadNextFileForSingleFileItemAndUpdateParams(t,r,u)];case 5:l.sent(),r.state=jt.UPLOADED,l.label=6;case 6:return[3,8];case 7:return c=l.sent(),r.error=c.code===ve.REQUEST_FAILED?new H({code:ve.NETWORK_ERROR,message:"Failed to upload a file."}):c,r.state=jt.FAILED,[3,8];case 8:this._dequeueUploadItem(e,r),l.label=9;case 9:return[2]}})})},n.prototype._dequeueUploadItem=function(t,e){var r=t.uploadQueue.findIndex(function(i){return i.requestId===e.requestId});r>=0&&t.uploadQueue.splice(r,1)},n.prototype._uploadNextFileForSingleFileItemAndUpdateParams=function(t,e,r){var i,s,a;return S(this,void 0,void 0,function(){var o,u,c,l,d,h,f,p,_,m;return I(this,function(b){switch(b.label){case 0:return o=new kg({file:r.file,channelUrl:t.url,thumbnailSizes:r.thumbnailSizes,requestId:e.requestId}),[4,this._requestQueue.send(o)];case 1:return u=b.sent(),c=u.as(Og),l=c.url,d=c.fileSize,h=d===void 0?r.fileSize:d,f=c.thumbnailSizes,p=f===void 0?r.thumbnailSizes:f,_=c.requireAuth,m=_!==void 0&&_,r.fileName=(i=r.fileName)!==null&&i!==void 0?i:r.file.name,r.mimeType=(s=r.mimeType)!==null&&s!==void 0?s:r.file.type,r.fileSize=(a=r.fileSize)!==null&&a!==void 0?a:r.file.size,r.fileUrl=l,r.fileSize=h,r.thumbnailSizes=p,r.requireAuth=m,[2]}})})},n.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams=function(t,e,r){var i,s,a;return S(this,void 0,void 0,function(){var o,u,c,l,d,h,f,p,_,m,b,y;return I(this,function(E){switch(E.label){case 0:return o=e.multipleFileUploadInfo.uploadIndex,u=r.fileInfoList[o],c=new kg({file:u.file,channelUrl:t.url,thumbnailSizes:u.thumbnailSizes,requestId:e.requestId}),[4,this._requestQueue.send(c)];case 1:return l=E.sent(),d=l.as(Og),h=d.url,f=d.fileSize,p=f===void 0?u.fileSize:f,_=d.thumbnailSizes,m=_===void 0?u.thumbnailSizes:_,b=d.requireAuth,y=b!==void 0&&b,u.fileName=(i=u.fileName)!==null&&i!==void 0?i:u.file.name,u.mimeType=(s=u.mimeType)!==null&&s!==void 0?s:u.file.type,u.fileSize=(a=u.fileSize)!==null&&a!==void 0?a:u.file.size,u.file=void 0,u.fileUrl=h,u.fileSize=p,u.thumbnailSizes=m,u._uploadedMetaData=P(P({},u._uploadedMetaData),{requireAuth:y,isUploaded:!0}),[2]}})})},n.prototype.request=function(t,e,r,i){return S(this,void 0,void 0,function(){var s,a,o,u,c;return I(this,function(l){return this._queueMap.has(t.url)||(s={messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1},this._queueMap.set(t.url,s)),a=this._queueMap.get(t.url),o=new Wn,u={requestId:e,params:r,state:jt.PENDING,deferred:o},function(d){return"fileInfoList"in d}(r)&&(c={uploadIndex:0,uploadCount:r.fileInfoList.length,requestHandler:i},u.multipleFileUploadInfo=c),a.messageQueue.push(u),this._uploadNextPendingItem(t),[2,o.promise]})})},n.prototype.cancel=function(t,e){var r,i,s=this._queueMap.get(t.url);if(s){var a=e?[s.messageQueue.find(function(l){return l.requestId===e})]:Ve([],Re(s.messageQueue),!1);try{for(var o=ke(a),u=o.next();!u.done;u=o.next()){var c=u.value;if(c)switch(c.state){case jt.PENDING:c.state=jt.FAILED,c.error=H.requestCanceled,this._resolveMessageQueue(t);break;case jt.UPLOADING:this._requestQueue.cancel(c.requestId)}}}catch(l){r={error:l}}finally{try{u&&!u.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}}},n}(),n_,Ac={prevResultSize:0,nextResultSize:0,isInclusive:!1,reverse:!1,messageTypeFilter:Sr.ALL,customTypesFilter:void 0,senderUserIdsFilter:void 0,replyType:Cr.NONE,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1,showSubchannelMessagesOnly:!1},xg=function(n){return $("number",n.prevResultSize)&&$("number",n.nextResultSize)&&$("boolean",n.isInclusive)&&$("boolean",n.reverse)&&$("string",n.messageTypeFilter)&&yt(Sr,n.messageTypeFilter)&&We("string",n.customTypesFilter,!0)&&We("string",n.senderUserIdsFilter,!0)&&yt(Cr,n.replyType)&&$("boolean",n.includeMetaArray)&&$("boolean",n.includeReactions)&&$("boolean",n.includeParentMessageInfo)&&$("boolean",n.includeThreadInfo)&&$("boolean",n.showSubchannelMessagesOnly)},r_={replyType:Cr.NONE,includeReactions:!1,includeThreadInfo:!1,includeMetaArray:!1,includeParentMessageInfo:!1},Fg=function(n){return yt(Cr,n.replyType)&&$("boolean",n.includeReactions)&&$("boolean",n.includeMetaArray)&&$("boolean",n.includeParentMessageInfo)&&$("boolean",n.includeThreadInfo)},TM=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.includeMetaArray,o=e.includeReactions,u=e.includeThreadInfo,c=e.includeParentMessageInfo,l=n.call(this)||this;return l.method=J.GET,l.path="".concat(st(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s)),l.params={is_sdk:!0,with_sorted_meta_array:a,include_reactions:o,include_thread_info:u,include_parent_message_info:c,include_poll_details:!0},l}return D(t,n),t}(X),wM=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=r?Ps(e,P({},r)):null,i}return D(t,n),t}(se),Yl=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,a=e.token,o=e.prevResultSize,u=e.nextResultSize,c=e.isInclusive,l=e.reverse,d=e.messageTypeFilter,h=e.customTypesFilter,f=e.senderUserIdsFilter,p=e.replyType,_=e.includeMetaArray,m=e.includeReactions,b=e.parentMessageId,y=e.includeThreadInfo,E=e.includeParentMessageInfo,T=e.showSubchannelMessagesOnly,N=e.checkingContinuousMessages,C=n.call(this)||this;return C.method=J.GET,C.path="".concat(st(r),"/").concat(encodeURIComponent(i),"/messages"),C.params=me(Te({is_sdk:!0,prev_limit:o,next_limit:u,include:c,reverse:l,message_ts:s,message_id:a,message_type:d??null,custom_types:h,sender_ids:f,include_reply_type:p,with_sorted_meta_array:_,include_reactions:m,parent_message_id:b,include_thread_info:y,include_parent_message_info:E,show_subchannel_message_only:T,include_poll_details:!0,checking_continuous_messages:N})),C}return D(t,n),t}(X),Zl=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.messages=r.messages.map(function(s){return Ps(e,s)}),i}return D(t,n),t}(se),IM=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.timestamp,a=e.token,o=e.replyType,u=e.includeMetaArray,c=e.includeReactions,l=e.includeThreadInfo,d=e.includeParentMessageInfo,h=n.call(this)||this;return h.method=J.GET,h.path="".concat(st(r),"/").concat(encodeURIComponent(i),"/messages/changelogs"),h.params={change_ts:s,token:a,with_sorted_meta_array:u,include_reactions:c,include_thread_info:l,include_reply_type:o,include_parent_message_info:d,include_poll_details:!0},h}return D(t,n),t}(X),SM=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.updatedMessages=r.updated.map(function(s){return Ps(e,s)}),i.deletedMessagesInfo=r.deleted.map(function(s){return{messageId:s.message_id,deletedAt:s.deleted_at}}),i.hasMore=r.has_more,i.nextToken=r.next,i}return D(t,n),t}(se),CM=function(n){function t(e){var r=e.channelUrl,i=e.scheduledMessageId,s=n.call(this)||this;return s.method=J.GET,s.path="".concat(bE,"/").concat(encodeURIComponent(r),"/scheduled_messages/").concat(encodeURIComponent(i)),s.params={},s}return D(t,n),t}(X),NM=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=r?Ps(e,P({},r)):null,i}return D(t,n),t}(se);(function(n){n.MUTED="muted",n.BANNED="banned"})(n_||(n_={}));var co,qg=function(){function n(t){var e,r,i,s;this.restrictionType=null,yt(n_,t.restriction_type)&&(this.restrictionType=t.restriction_type),this.description=(e=t.description)!==null&&e!==void 0?e:null,this.endAt=(i=(r=t.end_at)!==null&&r!==void 0?r:t.muted_end_at)!==null&&i!==void 0?i:-1,this.remainingDuration=(s=t.remaining_duration)!==null&&s!==void 0?s:-1}return n.payloadify=function(t){return me(Te({restriction_type:t.restrictionType,description:t.description,end_at:t.endAt,remaining_duration:t.remainingDuration}))},n}(),gu=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.restrictionInfo=new qg(r),i}return D(t,n),t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),qg.payloadify(e.restrictionInfo))))},t}($e);(function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).isMuted=!1,s.isMuted=(i=r.is_muted)!==null&&i!==void 0&&i,s}return D(t,n),t})($e);var Ed=function(){function n(){this._onPending=on,this._onFailed=on,this._onSucceeded=on}return n.prototype._trigger=function(t){switch(t==null?void 0:t.sendingStatus){case St.PENDING:t.errorCode===0&&this._onPending(t);break;case St.SCHEDULED:case St.SUCCEEDED:this._onSucceeded(t)}},n.prototype._triggerFailed=function(t,e){switch(e==null?void 0:e.sendingStatus){case St.FAILED:case St.CANCELED:this._onFailed(t,e.scheduledInfo?null:e)}},n.prototype.onPending=function(t){return this._onPending=t,this},n.prototype.onFailed=function(t){return this._onFailed=t,this},n.prototype.onSucceeded=function(t){return this._onSucceeded=t,this},n}(),Th={data:void 0,customType:void 0,mentionType:Hn.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,parentMessageId:void 0,isReplyToChannel:!1,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0,isPinnedMessage:!1},q_=function(n){return $("string",n.data,!0)&&$("string",n.customType,!0)&&yt(Hn,n.mentionType)&&We("string",n.mentionedUserIds,!0)&&We($e,n.mentionedUsers,!0)&&$("string",n.mentionedMessageTemplate,!0)&&We(wr,n.metaArrays,!0)&&$("number",n.parentMessageId,!0)&&$("boolean",n.isReplyToChannel)&&yt(ba,n.pushNotificationDeliveryOption,!0)&&$(ji,n.appleCriticalAlertOptions,!0)&&$("boolean",n.isPinnedMessage,!0)},$g=function(n){return{isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption,pollId:n.pollId}},ub=P(P({},Th),{message:"",translationTargetLanguages:void 0,pollId:void 0}),AM=function(n){return q_(n)&&$("string",n.message)&&We("string",n.translationTargetLanguages,!0)&&$("number",n.pollId,!0)};(function(n){n.FILE="file",n.BLOB="blob",n.BLOB_LIKE_OBJECT="blobLikeObject",n.URL="url"})(co||(co={}));var kc,bd=function(n){return typeof window<"u"&&"Blob"in window&&typeof Blob<"u"&&n instanceof Blob},Vf=function(n){return n===co.BLOB||n===co.FILE},Hg=function(n){return{file:n.file,fileKey:n.fileKey,fileType:n.fileType,isReplyToChannel:n.isReplyToChannel,pushNotificationDeliveryOption:n.pushNotificationDeliveryOption}},zg=P(P({},Th),{file:void 0,fileKey:void 0,fileUrl:void 0,fileName:void 0,fileType:void 0,fileSize:void 0,mimeType:void 0,thumbnailSizes:void 0,requireAuth:!1}),Gg=function(n){return q_(n)&&(Gi(n.file)||$("string",n.fileUrl))&&$("string",n.fileName,!0)&&$("string",n.mimeType,!0)&&$("number",n.fileSize,!0)&&(n.thumbnailSizes===null||n.thumbnailSizes===void 0||Array.isArray(n.thumbnailSizes)&&n.thumbnailSizes.every(function(t){return $("object",t)&&t.maxWidth>0&&t.maxHeight>0}))},cb={data:void 0,customType:void 0,mentionType:Hn.USERS,mentionedUserIds:void 0,mentionedUsers:void 0,mentionedMessageTemplate:void 0,metaArrays:void 0,pushNotificationDeliveryOption:void 0,appleCriticalAlertOptions:void 0},lb=function(n){return $("string",n.data,!0)&&$("string",n.customType,!0)&&yt(Hn,n.mentionType)&&We("string",n.mentionedUserIds,!0)&&We($e,n.mentionedUsers,!0)&&$("string",n.mentionedMessageTemplate,!0)&&We(wr,n.metaArrays,!0)&&yt(ba,n.pushNotificationDeliveryOption,!0)&&$(ji,n.appleCriticalAlertOptions,!0)},kM=P(P({},cb),{message:void 0,translationTargetLanguages:void 0,pollId:void 0}),OM=function(n){return lb(n)&&$("string",n.message,!0)&&We("string",n.translationTargetLanguages,!0)&&$("number",n.pollId,!0)},MM=P({},cb),DM=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.token,a=e.limit,o=n.call(this)||this;return o.method=J.GET,o.path="".concat(st(i),"/").concat(encodeURIComponent(r),"/operators"),o.params={token:s,limit:a},o}return D(t,n),t}(X),RM=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.operators=r.operators.map(function(s){return new $e(e,s)}),i.token=r.next,i}return D(t,n),t}(se),UM=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,r=G.of(this._iid).requestQueue,i=new DM(P(P({},this),{channelUrl:this.channelUrl,token:this._token})),[4,r.send(i)]):[3,2]):[3,5];case 1:return s=c.sent(),a=s.as(RM),o=a.operators,u=a.token,this._token=u,this._hasNext=!!u,this._isLoading=!1,[2,o];case 2:return[2,e];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(vu),LM=function(n){function t(e,r,i,s){var a,o,u,c,l,d,h,f,p,_,m=this;return(m=n.call(this,e,r,i,s)||this).reverse=!1,m.messageTypeFilter=Sr.ALL,m.customTypesFilter=null,m.senderUserIdsFilter=null,m.replyType=Cr.NONE,m.includeMetaArray=!1,m.includeReactions=!1,m.includeParentMessageInfo=!1,m.includeThreadInfo=!1,m.showSubchannelMessagesOnly=!1,m._edge=Number.MAX_SAFE_INTEGER,m.reverse=(a=s.reverse)!==null&&a!==void 0&&a,m.messageTypeFilter=(o=s.messageTypeFilter)!==null&&o!==void 0?o:Sr.ALL,m.customTypesFilter=(u=s.customTypesFilter)!==null&&u!==void 0?u:null,m.senderUserIdsFilter=(c=s.senderUserIdsFilter)!==null&&c!==void 0?c:null,m.replyType=(l=s.replyType)!==null&&l!==void 0?l:Cr.NONE,m.includeMetaArray=(d=s.includeMetaArray)!==null&&d!==void 0&&d,m.includeReactions=(h=s.includeReactions)!==null&&h!==void 0&&h,m.includeParentMessageInfo=(f=s.includeParentMessageInfo)!==null&&f!==void 0&&f,m.includeThreadInfo=(p=s.includeThreadInfo)!==null&&p!==void 0&&p,m.showSubchannelMessagesOnly=(_=s.showSubchannelMessagesOnly)!==null&&_!==void 0&&_,m}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&$("boolean",this.reverse)&&yt(Sr,this.messageTypeFilter)&&yt(Cr,this.replyType)&&We("string",this.customTypesFilter,!0)&&We("string",this.senderUserIdsFilter,!0)&&$("boolean",this.includeMetaArray)&&$("boolean",this.includeReactions)&&$("boolean",this.includeParentMessageInfo)&&$("boolean",this.includeThreadInfo)&&$("boolean",this.showSubchannelMessagesOnly)},t.prototype.load=function(){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,xn.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,Te({prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly}))]):[3,2]:[3,5];case 1:return e=r.sent(),this._edge=Math.min.apply(Math,Ve([Number.MAX_SAFE_INTEGER],Re(e.map(function(i){return i.createdAt})),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(vu),PM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.limit,o=e.token;return(r=n.call(this)||this).method=J.GET,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={limit:a,token:o},r}return D(t,n),t}(X),xM=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.mutedUsers=[];var s=r.next,a=r.muted_list;return i.token=s,a&&a.length>0&&(i.mutedUsers=a.map(function(o){return new gu(e,o)})),i}return D(t,n),t}(se),FM=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return D(t,n),t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=G.of(this._iid).requestQueue,r=new PM(P(P({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(xM),a=s.mutedUsers,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(vu),qM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.limit,o=e.token;return(r=n.call(this)||this).method=J.GET,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=me({limit:a,token:o}),r}return D(t,n),t}(X),$M=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.bannedUsers=[];var s=r.next,a=r.banned_list;return i.token=s,a&&a.length>0&&(i.bannedUsers=a.map(function(o){return new gu(e,o.user)})),i}return D(t,n),t}(se),HM=function(n){function t(e,r,i,s){return n.call(this,e,r,i,s)||this}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=G.of(this._iid).requestQueue,r=new qM(P(P({},this),{token:this._token})),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as($M),a=s.bannedUsers,o=s.token,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(vu);(function(n){n.SPAM="spam",n.HARASSING="harassing",n.SUSPICIOUS="suspicious",n.INAPPROPRIATE="inappropriate"})(kc||(kc={}));var zM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.operatorUserIds;return(r=n.call(this)||this).method=J.POST,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:a},r}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var GM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.operatorUserIds;return(r=n.call(this)||this).method=J.DELETE,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/operators"),r.params={operator_ids:a},r}return D(t,n),t}(X);(function(n){function t(e,r){return n.call(this,e,r)||this}D(t,n)})(se);var VM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=J.GET,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/mute/").concat(a),r}return D(t,n),t}(X),BM=function(n){function t(e,r){var i=n.call(this,e,r)||this;i.isMuted=!1,i.startAt=0,i.endAt=0;var s=r.is_muted,a=r.start_at,o=r.end_at,u=r.remaining_duration,c=r.description;return i.isMuted=s,i.startAt=a,i.endAt=o,i.remainingDuration=u,i.description=c,i}return D(t,n),t}(se),Vg=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.keys;return(r=n.call(this)||this).method=J.GET,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={keys:a,include_ts:!0},r}return D(t,n),t}(X),Bg=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.metadata,a=r.ts;return i.metadata=s,i.ts=a,i}return D(t,n),t}(se),jM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metadata;return(r=n.call(this)||this).method=J.POST,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:a,include_ts:!0},r}return D(t,n),t}(X),KM=function(n){function t(e,r){var i,s,a=this;return(a=n.call(this,e,r)||this).metaData=(i=r.metadata)!==null&&i!==void 0?i:{},a.ts=(s=r.ts)!==null&&s!==void 0?s:null,a}return D(t,n),t}(se),QM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metadata,o=e.upsert;return(r=n.call(this)||this).method=J.PUT,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={metadata:a,include_ts:!0,upsert:o!=null&&o},r}return D(t,n),t}(X),WM=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.metadata,a=r.ts;return i.metadata=s,i.ts=a,i}return D(t,n),t}(se);(function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return D(t,n),t})(En);var YM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.key;return(r=n.call(this)||this).method=J.DELETE,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metadata/").concat(a),r.params={include_ts:!0},r}return D(t,n),t}(X),ZM=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.ts;return i.ts=s,i}return D(t,n),t}(se),JM=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=J.DELETE,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metadata"),r.params={include_ts:!0},r}return D(t,n),t}(X),XM=function(n){function t(e,r){var i=n.call(this,e,r)||this,s=r.ts;return i.ts=s,i}return D(t,n),t}(se),jg=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.keys;return(r=n.call(this)||this).method=J.GET,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={keys:a},r}return D(t,n),t}(X),Kg=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return D(t,n),t}(se),e2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metaCounter;return(r=n.call(this)||this).method=J.POST,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:a},r}return D(t,n),t}(X),t2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return D(t,n),t}(se),Bf=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.metaCounter,o=e.upsert,u=o!==void 0&&o,c=e.mode,l=c===void 0?"set":c;return(r=n.call(this)||this).method=J.PUT,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={metacounter:a,upsert:u,mode:l},r}return D(t,n),t}(X),jf=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.metaCounter=r,i}return D(t,n),t}(se);(function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return i.data&&(s.created=i.data.created,s.updated=i.data.updated,s.deleted=i.data.deleted),s}return D(t,n),t})(En);var n2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.key;return(r=n.call(this)||this).method=J.DELETE,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metacounter/").concat(a),r.params={},r}return D(t,n),t}(X);(function(n){function t(e,r){return n.call(this,e,r)||this}D(t,n)})(se);var r2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType;return(r=n.call(this)||this).method=J.DELETE,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/metacounter"),r.params={},r}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var i2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId,o=e.seconds,u=e.description;return(r=n.call(this)||this).method=J.POST,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/mute"),r.params={user_id:a,seconds:o,description:u},r}return D(t,n),t}(X);(function(n){function t(e,r){return n.call(this,e,r)||this}D(t,n)})(se);(function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new gu(e,i.data),s}return D(t,n),t})(En);var s2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=J.DELETE,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/mute/").concat(encodeURIComponent(a)),r}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);(function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new gu(e,i.data),s}return D(t,n),t})(En);var a2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId,o=e.seconds,u=e.description;return(r=n.call(this)||this).method=J.POST,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/ban"),r.params=me({user_id:a,seconds:o,description:u}),r}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);(function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new gu(e,i.data),i.data.member_count&&(s.memberCount=i.data.member_count),i.data.joined_member_count&&(s.joinedMemberCount=i.data.joined_member_count),s}return D(t,n),t})(En);var o2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.userId;return(r=n.call(this)||this).method=J.DELETE,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/ban/").concat(encodeURIComponent(a)),r}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);(function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.user=new gu(e,i.data),s}return D(t,n),t})(En);var Qg=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.freezing;return(r=n.call(this)||this).method=J.PUT,r.path="".concat(st(s),"/").concat(encodeURIComponent(i),"/freeze"),r.params={freeze:a},r}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);(function(n){function t(e,r,i){var s=n.call(this,e,"SYEV",i)||this;return s.freeze=i.data.freeze,s}return D(t,n),t})(En);var u2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.description;return(r=n.call(this)||this).method=J.POST,r.path="".concat(wE(s),"/").concat(encodeURIComponent(i)),r.params={report_category:a,reporting_user_id:o,report_description:u},r}return D(t,n),t}(X),c2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.offendingUserId,c=e.description;return(r=n.call(this)||this).method=J.POST,r.path="".concat(Bp,"/users/").concat(u),r.params={channel_url:i,channel_type:s===zt.OPEN?"open_channels":"group_channels",report_category:a,reporting_user_id:o,report_description:c},r}return D(t,n),t}(X),l2=function(n){function t(e){var r=this,i=e.channelUrl,s=e.channelType,a=e.category,o=e.userId,u=e.offendingUserId,c=e.messageId,l=e.description;return(r=n.call(this)||this).method=J.POST,r.path="".concat(wE(s),"/").concat(encodeURIComponent(i),"/messages/").concat(c),r.params={report_category:a,reporting_user_id:o,report_description:l,offending_user_id:u},r}return D(t,n),t}(X),d2=function(n){function t(e){var r=[];return e.mentionType===Hn.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"MESG",ackRequired:!0,payload:me(Te({channel_url:e.channelUrl,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrays,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption&&e.pushNotificationDeliveryOption!==ba.DEFAULT?e.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:e.appleCriticalAlertOptions,silent:e.silent,reply_to_channel:e.isReplyToChannel,parent_message_id:e.parentMessageId?e.parentMessageId:null,req_id:e.reqId,poll_id:e.pollId,pin_message:e.isPinnedMessage}))})||this}return D(t,n),t}(Bi),h2=function(n){function t(e,r,i){var s,a,o,u,c=this;(c=n.call(this,e,"MESG",i)||this).message=new Qn(e,i);var l=G.of(e).sdkState;return c.isMentioned=Hc(c.message.mentionType,(o=(s=c.message.mentionedUserIds)!==null&&s!==void 0?s:(a=c.message.mentionedUsers)===null||a===void 0?void 0:a.map(function(d){return d.userId}))!==null&&o!==void 0?o:[],l.userId),c.forceUpdateLastMessage=(u=i.force_update_last_message)!==null&&u!==void 0&&u,c}return D(t,n),t}(En),Wg=function(n){function t(e){var r=null;return e.mentionType===Hn.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"MEDI",ackRequired:!0,payload:me(Te({channel_url:e.channelUrl,msg_id:e.messageId,message:e.message,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,mentioned_message_template:e.mentionedMessageTemplate,apple_critical_alert_options:e.appleCriticalAlertOptions?ji.payloadify(e.appleCriticalAlertOptions):null,poll_id:e.pollId}))})||this}return D(t,n),t}(Bi),Yg=function(n){function t(e,r,i){var s,a,o,u,c,l=this;(l=n.call(this,e,"MEDI",i)||this).message=new Qn(e,i);var d=G.of(e).sdkState;return l.mentionCountChange=IE({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(o=(a=i.old_values)===null||a===void 0?void 0:a.mentioned_user_ids)!==null&&o!==void 0?o:[]},Te({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(h){return h.userId})}),d.userId),l}return D(t,n),t}(En),Zg=function(n){function t(e){var r=null;return e.mentionType===Hn.USERS&&(e.mentionedUserIds?r=e.mentionedUserIds:e.mentionedUsers&&(r=e.mentionedUsers.map(function(i){return i.userId}))),n.call(this,{code:"FEDI",ackRequired:!0,payload:me(Te({channel_url:e.channelUrl,msg_id:e.messageId,data:e.data,custom_type:e.customType,metaarray:e.metaArrayParams,mention_type:e.mentionType,mentioned_user_ids:r,apple_critical_alert_options:e.appleCriticalAlertOptions}))})||this}return D(t,n),t}(Bi),Jg=function(n){function t(e,r,i){var s,a,o,u,c,l=this;(l=n.call(this,e,"FEDI",i)||this).message=new Jt(e,i);var d=G.of(e).sdkState;return l.mentionCountChange=IE({mentionType:(s=i.old_values)===null||s===void 0?void 0:s.mention_type,mentionedUserIds:(o=(a=i.old_values)===null||a===void 0?void 0:a.mentioned_user_ids)!==null&&o!==void 0?o:[]},Te({mentionType:l.message.mentionType,mentionedUserIds:(u=l.message.mentionedUserIds)!==null&&u!==void 0?u:(c=l.message.mentionedUsers)===null||c===void 0?void 0:c.map(function(h){return h.userId})}),d.userId),l}return D(t,n),t}(En),f2=function(n){function t(e){var r=n.call(this)||this;return r.method=J.DELETE,r.path="".concat(st(e.channelType),"/").concat(e.channelUrl,"/messages/").concat(e.messageId),r}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);(function(n){function t(e,r,i){var s=n.call(this,e,"DELM",i)||this;return s.channelUrl=i.channel_url,s.channelType=i.channel_type,s.messageId=Number(i.msg_id),s}return D(t,n),t})(En);var p2=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.reactionKey,o=n.call(this)||this;return o.method=J.POST,o.path="".concat(st(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return D(t,n),t}(X),_2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.reactionEvent=new ab(r),i}return D(t,n),t}(se),m2=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.reactionKey,o=n.call(this)||this;return o.method=J.DELETE,o.path="".concat(st(r),"/").concat(encodeURIComponent(i),"/messages/").concat(s,"/reactions"),o.params={reaction:a},o}return D(t,n),t}(X),v2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.reactionEvent=new ab(P({},r)),i}return D(t,n),t}(se),g2=function(n){function t(e){var r=e.channelType,i=e.channelUrl,s=e.messageId,a=e.translationTargetLanguages,o=n.call(this)||this;return o.method=J.POST,o.path="".concat(st(r),"/").concat(encodeURIComponent(i),"/messages/").concat(encodeURIComponent(s),"/translation"),o.params={target_langs:a},o}return D(t,n),t}(X),y2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new Qn(e,r),i}return D(t,n),t}(se),E2=function(n){function t(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===Hn.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map(function(u){return u.userId})));var a=e.channelType,o=e.channelUrl;return i.method=J.POST,i.path="".concat(st(a),"/").concat(encodeURIComponent(o),"/scheduled_messages"),i.params=me(Te({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:Kd.USER,message:e.message,custom_type:e.customType,data:e.data,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:(r=e.metaArrays)===null||r===void 0?void 0:r.map(function(u){return wr.payloadify(u)}),apple_critical_alert_options:e.appleCriticalAlertOptions?ji.payloadify(e.appleCriticalAlertOptions):null,target_langs:e.translationTargetLanguages,push_option:e.pushNotificationDeliveryOption})),i}return D(t,n),t}(X),b2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new Qn(e,r),i}return D(t,n),t}(se),T2=function(n){function t(e){var r,i=this;i=n.call(this)||this;var s=[];e.mentionType===Hn.USERS&&(e.mentionedUserIds?s=e.mentionedUserIds:e.mentionedUsers&&(s=e.mentionedUsers.map(function(u){return u.userId})));var a=e.channelType,o=e.channelUrl;return i.method=J.POST,i.path="".concat(st(a),"/").concat(encodeURIComponent(o),"/scheduled_messages"),i.params=Te({req_id:e.reqId,scheduled_at:e.scheduledAt,message_type:Kd.FILE,url:e.fileUrl,file_name:e.fileName,file_size:e.fileSize,file_type:e.mimeType,thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(u){return il.payloadify(u)}):[],custom_type:e.customType,data:e.data,require_auth:e.requireAuth,mention_type:e.mentionType,mentioned_user_ids:s,sorted_metaarray:(r=e.metaArrays)===null||r===void 0?void 0:r.map(function(u){return wr.payloadify(u)}),apple_critical_alert_options:e.appleCriticalAlertOptions?ji.payloadify(e.appleCriticalAlertOptions):null,push_option:e.pushNotificationDeliveryOption}),i}return D(t,n),t}(X),w2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.message=new Jt(e,r),i}return D(t,n),t}(se),I2=function(n){function t(e){var r=e.pollId,i=e.title,s=e.data,a=e.allowUserSuggestion,o=e.allowMultipleVotes,u=e.closeAt,c=n.call(this)||this;return c.method=J.PUT,c.path="".concat(vi,"/").concat(encodeURIComponent(r)),c.params={title:i,data:s,allow_user_suggestion:a,allow_multiple_votes:o,close_at:u},c}return D(t,n),t}(X),S2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new Qr(e,r),i}return D(t,n),t}(se),C2=function(n){function t(e){var r=e.pollId,i=n.call(this)||this;return i.method=J.DELETE,i.path="".concat(vi,"/").concat(encodeURIComponent(r)),i}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var N2=function(n){function t(e){var r=e.pollId,i=n.call(this)||this;return i.method=J.PUT,i.path="".concat(vi,"/").concat(encodeURIComponent(r),"/close"),i}return D(t,n),t}(X),A2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new Qr(e,r),i}return D(t,n),t}(se),k2=function(n){function t(e){var r=e.channelUrl,i=e.channelType,s=e.pollId,a=e.optionText,o=n.call(this)||this;return o.method=J.POST,o.path="".concat(vi,"/").concat(encodeURIComponent(s),"/options"),o.params={channel_url:r,channel_type:i,text:a},o}return D(t,n),t}(X),O2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new Qr(e,r),i}return D(t,n),t}(se),M2=function(n){function t(e){var r=e.pollId,i=e.pollOptionId,s=e.optionText,a=n.call(this)||this;return a.method=J.PUT,a.path="".concat(vi,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),a.params={text:s},a}return D(t,n),t}(X),D2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.poll=new Qr(e,r),i}return D(t,n),t}(se),R2=function(n){function t(e){var r=e.pollId,i=e.pollOptionId,s=n.call(this)||this;return s.method=J.DELETE,s.path="".concat(vi,"/").concat(encodeURIComponent(r),"/options/").concat(encodeURIComponent(i)),s}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var pt,U2=function(n){function t(e){var r=e.reqId,i=e.channelType,s=e.channelUrl,a=e.pollId,o=e.pollOptionIds;return n.call(this,{code:"VOTE",ackRequired:!0,payload:me({req_id:r,channel_type:i===zt.OPEN?"open_channels":"group_channels",channel_url:s,poll_id:a,option_ids:o})})||this}return D(t,n),t}(Bi),L2=function(n){function t(e,r,i){var s=n.call(this,e,"VOTE",i)||this;return s.event=new tM(i),s.channelUrl=i.channel_url,s.channelType=i.channel_type,s}return D(t,n),t}(En),P2="GroupChannel",x2="url",db="Message",F2="messageId",q2="Poll",$2="pollId",H2="FeedChannel",z2="url",G2=P(P({},Th),{fileInfoList:[]}),V2=function(n){return(Gi(n.file)||$("string",n.fileUrl))&&$("string",n.fileName,!0)&&$("string",n.mimeType,!0)&&$("number",n.fileSize,!0)&&(n.thumbnailSizes===void 0||Array.isArray(n.thumbnailSizes)&&n.thumbnailSizes.every(function(t){return t.maxWidth>0&&t.maxHeight>0}))},B2=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e._onFileUploaded=on,e}return D(t,n),t.prototype._triggerOnFileUploaded=function(e,r,i,s){this._onFileUploaded(e,r,i,s)},t.prototype.onFileUploaded=function(e){return this._onFileUploaded=e,this},t.prototype.onPending=function(e){return n.prototype.onPending.call(this,e),this},t.prototype.onFailed=function(e){return n.prototype.onFailed.call(this,e),this},t.prototype.onSucceeded=function(e){return n.prototype.onSucceeded.call(this,e),this},t}(Ed);(function(n){function t(e,r){var i,s,a,o,u,c,l=this;return(l=n.call(this,e)||this)._name="",l._createdAt=0,l.channelType=zt.BASE,l.coverUrl="",l.customType="",l.data="",l.isFrozen=!1,l.isEphemeral=!1,l.creator=null,l._messageCollectionLastAccessedAt=0,l._url=r.channel_url,l._name=(i=r.name)!==null&&i!==void 0?i:"",l._createdAt=1e3*r.created_at,l.coverUrl=(s=r.cover_url)!==null&&s!==void 0?s:"",l.customType=(a=r.custom_type)!==null&&a!==void 0?a:"",l.data=(o=r.data)!==null&&o!==void 0?o:"",l.isFrozen=(u=r.freeze)!==null&&u!==void 0&&u,l.isEphemeral=(c=r.is_ephemeral)!==null&&c!==void 0&&c,l.creator=r.created_by?new $e(l._iid,r.created_by):null,r.metadata&&Object.keys(r.metadata).length>0&&r.ts&&(l._cachedMetaData=new Map,Object.keys(r.metadata).forEach(function(d){l._cachedMetaData.set(d,{value:r.metadata[d],isRemoved:!1,updatedAt:r.ts})})),l}return D(t,n),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"createdAt",{get:function(){return this._createdAt},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return P(P({},this),{url:this._url,name:this._name,createdAt:this._createdAt})},t.payloadify=function(e){return me(Te(P(P({},n.payloadify.call(this,e)),{channel_url:e.url,name:e.name,cover_url:e.coverUrl,custom_type:e.customType,data:e.data,freeze:e.isFrozen,is_ephemeral:e.isEphemeral,created_by:e.creator?$e.payloadify(e.creator):null,created_at:e.createdAt/1e3})))},t.prototype.isGroupChannel=function(){return this.channelType===zt.GROUP},t.prototype.isOpenChannel=function(){return this.channelType===zt.OPEN},t.prototype.isFeedChannel=function(){return this.channelType===zt.FEED},Object.defineProperty(t.prototype,"cachedMetaData",{get:function(){var e={};return this._cachedMetaData&&this._cachedMetaData.forEach(function(r,i){r.isRemoved||(e[i]=r.value)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"messageCollectionLastAccessedAt",{get:function(){return this._messageCollectionLastAccessedAt},enumerable:!1,configurable:!0}),t.prototype._updateMessageCollectionLastAccessedAt=function(){this._messageCollectionLastAccessedAt=Date.now()},t.prototype._update=function(e){var r=me(e);Object.assign(this,r)},t.prototype._upsertCachedMetaData=function(e,r){var i=this;Object.keys(e).forEach(function(s){i._cachedMetaData||(i._cachedMetaData=new Map);var a=i._cachedMetaData.get(s);(!a||a.updatedAt<=r)&&i._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:r})})},t.prototype._updateCachedMetaData=function(e,r){var i=this;this._cachedMetaData?this._cachedMetaData.forEach(function(s,a){var o;s.updatedAt<=r&&i._cachedMetaData.set(a,{value:(o=e[a])!==null&&o!==void 0?o:s.value,isRemoved:!e[a],updatedAt:r})}):(this._cachedMetaData=new Map,Object.keys(e).forEach(function(s){i._cachedMetaData.set(s,{value:e[s],isRemoved:!1,updatedAt:r})}))},t.prototype._removeFromCachedMetaData=function(e,r){var i=this;this._cachedMetaData&&e.forEach(function(s){var a=i._cachedMetaData.get(s);a&&a.updatedAt<r&&(a.isRemoved=!0,a.updatedAt=r)})},t.prototype._runIfHandleableWithGroupChannel=function(e){this.isGroupChannel()?e(this):this.isFeedChannel()&&e(this.groupChannel)},t.prototype._generateRequestId=function(){return"rq-".concat(fu())},t.prototype.isIdentical=function(e){return e&&this.url===e.url},t.prototype.isEqual=function(e){return vE(this,e)},t.prototype.createOperatorListQuery=function(e){return e===void 0&&(e={}),new UM(this._iid,this.url,this.channelType,e)},t.prototype.createMutedUserListQuery=function(e){return e===void 0&&(e={}),new FM(this._iid,this.url,this.channelType,e)},t.prototype.createBannedUserListQuery=function(e){return e===void 0&&(e={}),new HM(this._iid,this.url,this.channelType,e)},t.prototype.createPreviousMessageListQuery=function(e){return e===void 0&&(e={}),new LM(this._iid,this.url,this.channelType,e)},t.prototype.addOperators=function(e){return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){switch(s.label){case 0:return ne(We("string",e)).throw(H.invalidParameters),r=G.of(this._iid).requestQueue,i=new zM({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.removeOperators=function(e){return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){switch(s.label){case 0:return ne(We("string",e)).throw(H.invalidParameters),r=G.of(this._iid).requestQueue,i=new GM({channelUrl:this.url,channelType:this.channelType,operatorUserIds:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.getMyMutedInfo=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h;return I(this,function(f){switch(f.label){case 0:return e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new VM({channelUrl:this.url,channelType:this.channelType,userId:r.userId}),[4,i.send(s)];case 1:return a=f.sent(),o=a.as(BM),u=o.isMuted,c=o.startAt,l=o.endAt,d=o.remainingDuration,h=o.description,[2,{isMuted:u,startAt:c,endAt:l,remainingDuration:d,description:h}]}})})},t.prototype.getMetaData=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:return ne(We("string",e)).throw(H.invalidParameters),r=G.of(this._iid).requestQueue,i=new Vg({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,r.send(i)];case 1:return s=c.sent(),a=s.as(Bg),o=a.metadata,u=a.ts,this._upsertCachedMetaData(o,u),[2,o]}})})},t.prototype.getAllMetaData=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return e=G.of(this._iid).requestQueue,r=new Vg({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(r)];case 1:return i=u.sent(),s=i.as(Bg),a=s.metadata,o=s.ts,this._updateCachedMetaData(a,o),[2,a]}})})},t.prototype.createMetaData=function(e){return S(this,void 0,void 0,function(){var r,i,s,a;return I(this,function(o){switch(o.label){case 0:return r=G.of(this._iid).requestQueue,i=new jM({channelUrl:this.url,channelType:this.channelType,metadata:e}),[4,r.send(i)];case 1:return s=o.sent(),a=s.as(KM).metaData,this._upsertCachedMetaData(a,0),[2,a]}})})},t.prototype.updateMetaData=function(e,r){return r===void 0&&(r=!1),S(this,void 0,void 0,function(){var i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:return i=G.of(this._iid).requestQueue,s=new QM({channelUrl:this.url,channelType:this.channelType,metadata:e,upsert:r}),[4,i.send(s)];case 1:return a=l.sent(),o=a.as(WM),u=o.metadata,c=o.ts,this._upsertCachedMetaData(u,c),[2,u]}})})},t.prototype.deleteMetaData=function(e){return S(this,void 0,void 0,function(){var r,i,s,a;return I(this,function(o){switch(o.label){case 0:return ne($("string",e)).throw(H.invalidParameters),r=G.of(this._iid).requestQueue,i=new YM({channelUrl:this.url,channelType:this.channelType,key:e}),[4,r.send(i)];case 1:return s=o.sent(),a=s.as(ZM).ts,this._removeFromCachedMetaData([e],a),[2]}})})},t.prototype.deleteAllMetaData=function(){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return e=G.of(this._iid).requestQueue,r=new JM({channelUrl:this.url,channelType:this.channelType}),[4,e.send(r)];case 1:return i=a.sent(),s=i.as(XM).ts,this._removeFromCachedMetaData(Ve([],Re(this._cachedMetaData.keys()),!1),s),[2]}})})},t.prototype.getMetaCounters=function(e){return S(this,void 0,void 0,function(){var r,i,s;return I(this,function(a){switch(a.label){case 0:return ne(We("string",e)).throw(H.invalidParameters),r=G.of(this._iid).requestQueue,i=new jg({channelUrl:this.url,channelType:this.channelType,keys:e}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(Kg).metaCounter]}})})},t.prototype.getAllMetaCounters=function(){return S(this,void 0,void 0,function(){var e,r,i;return I(this,function(s){switch(s.label){case 0:return e=G.of(this._iid).requestQueue,r=new jg({channelUrl:this.url,channelType:this.channelType,keys:[]}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(Kg).metaCounter]}})})},t.prototype.createMetaCounters=function(e){return S(this,void 0,void 0,function(){var r,i,s;return I(this,function(a){switch(a.label){case 0:return r=G.of(this._iid).requestQueue,i=new e2({channelUrl:this.url,channelType:this.channelType,metaCounter:e}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(t2).metaCounter]}})})},t.prototype.updateMetaCounters=function(e,r){return r===void 0&&(r=!1),S(this,void 0,void 0,function(){var i,s,a;return I(this,function(o){switch(o.label){case 0:return i=G.of(this._iid).requestQueue,s=new Bf({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:r}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(jf).metaCounter]}})})},t.prototype.increaseMetaCounters=function(e){return S(this,void 0,void 0,function(){var r,i,s;return I(this,function(a){switch(a.label){case 0:return r=G.of(this._iid).requestQueue,i=new Bf({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"increase"}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(jf).metaCounter]}})})},t.prototype.decreaseMetaCounters=function(e){return S(this,void 0,void 0,function(){var r,i,s;return I(this,function(a){switch(a.label){case 0:return r=G.of(this._iid).requestQueue,i=new Bf({channelUrl:this.url,channelType:this.channelType,metaCounter:e,upsert:!1,mode:"decrease"}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(jf).metaCounter]}})})},t.prototype.deleteMetaCounter=function(e){return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){switch(s.label){case 0:return ne($("string",e)).throw(H.invalidParameters),r=G.of(this._iid).requestQueue,i=new n2({channelUrl:this.url,channelType:this.channelType,key:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.deleteAllMetaCounters=function(){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return e=G.of(this._iid).requestQueue,r=new r2({channelUrl:this.url,channelType:this.channelType}),[4,e.send(r)];case 1:return i.sent(),[2]}})})},t.prototype.muteUser=function(e,r,i){return S(this,void 0,void 0,function(){return I(this,function(s){return[2,this.muteUserWithUserId(e.userId,r,i)]})})},t.prototype.muteUserWithUserId=function(e,r,i){return S(this,void 0,void 0,function(){var s,a;return I(this,function(o){switch(o.label){case 0:return ne($("string",e)&&$("number",r,!0)&&$("string",i,!0)).throw(H.invalidParameters),s=G.of(this._iid).requestQueue,a=new i2({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:r,description:i}),[4,s.send(a)];case 1:return o.sent(),[2]}})})},t.prototype.unmuteUser=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){return[2,this.unmuteUserWithUserId(e.userId)]})})},t.prototype.unmuteUserWithUserId=function(e){return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){switch(s.label){case 0:return ne($("string",e)).throw(H.invalidParameters),r=G.of(this._iid).requestQueue,i=new s2({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.banUser=function(e,r,i){return S(this,void 0,void 0,function(){return I(this,function(s){return[2,this.banUserWithUserId(e.userId,r,i)]})})},t.prototype.banUserWithUserId=function(e,r,i){return S(this,void 0,void 0,function(){var s,a;return I(this,function(o){switch(o.label){case 0:return ne($("string",e)&&$("number",r,!0)&&$("string",i,!0)).throw(H.invalidParameters),s=G.of(this._iid).requestQueue,a=new a2({channelUrl:this.url,channelType:this.channelType,userId:e,seconds:r,description:i}),[4,s.send(a)];case 1:return o.sent(),[2]}})})},t.prototype.unbanUser=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){return[2,this.unbanUserWithUserId(e.userId)]})})},t.prototype.unbanUserWithUserId=function(e){return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){switch(s.label){case 0:return ne($("string",e)).throw(H.invalidParameters),r=G.of(this._iid).requestQueue,i=new o2({channelUrl:this.url,channelType:this.channelType,userId:e}),[4,r.send(i)];case 1:return s.sent(),[2]}})})},t.prototype.freeze=function(){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return e=G.of(this._iid).requestQueue,r=new Qg({channelUrl:this.url,channelType:this.channelType,freezing:!0}),[4,e.send(r)];case 1:return i.sent(),this.isFrozen=!0,[2]}})})},t.prototype.unfreeze=function(){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return e=G.of(this._iid).requestQueue,r=new Qg({channelUrl:this.url,channelType:this.channelType,freezing:!1}),[4,e.send(r)];case 1:return i.sent(),this.isFrozen=!1,[2]}})})},t.prototype.getMessagesByMessageId=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=P(P({},Ac),r),ne($("number",e)&&xg(i)).throw(H.invalidParameters),[4,xn.of(this._iid).getMessagesByMessageId(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessagesByTimestamp=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=P(P({},Ac),r),ne($("number",e)&&xg(i)).throw(H.invalidParameters),[4,xn.of(this._iid).getMessagesByTimestamp(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessageChangeLogsSinceTimestamp=function(e,r){return r===void 0&&(r={}),S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=P(P({},r_),r),ne($("number",e)&&Fg(i)).throw(H.invalidParameters),[4,xn.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype.getMessageChangeLogsSinceToken=function(e,r){return r===void 0&&(r={}),S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=P(P({},r_),r),ne($("string",e)&&Fg(i)).throw(H.invalidParameters),[4,xn.of(this._iid).getMessageChangelogs(this.url,this.channelType,e,i)];case 1:return[2,s.sent()]}})})},t.prototype._createPendingSendableMessagePayload=function(e,r,i){var s,a=G.of(this._iid).sessionManager;return me(Te({channel_url:this.url,channel_type:this.channelType,msg_id:0,parent_message_id:e.parentMessageId,data:e.data,custom_type:e.customType,mention_type:e.mentionType,sorted_metaarray:e.metaArrays?e.metaArrays.map(function(o){return wr.payloadify(o)}):null,apple_critical_alert_options:e.appleCriticalAlertOptions?ji.payloadify(e.appleCriticalAlertOptions):null,created_at:i,user:a.currentUser?lu.payloadify(a.currentUser):null,req_id:r,request_state:St.PENDING,mentioned_user_ids:e.mentionedUserIds,mentioned_users:(s=e.mentionedUsers)===null||s===void 0?void 0:s.map(function(o){return $e.payloadify(o)})}))},t.prototype._createPendingUserMessage=function(e,r,i){var s,a,o={};if(e.translationTargetLanguages)try{for(var u=ke(e.translationTargetLanguages),c=u.next();!c.done;c=u.next())o[c.value]=""}catch(h){s={error:h}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(s)throw s.error}}var l=me(P(P({},this._createPendingSendableMessagePayload(e,r,i)),{type:Ot.USER,message:e.message,translations:o})),d=new Qn(this._iid,l);return d.messageParams=e,d},t.prototype._createPendingScheduledUserMessage=function(e,r,i){var s=this._createPendingUserMessage(e,r,i);return s.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},s},t.prototype._createPendingFileMessage=function(e,r,i){var s,a,o,u,c,l,d=me(P(P({},this._createPendingSendableMessagePayload(e,r,i)),{type:Ot.FILE,url:e.fileUrl,file:{name:(s=e.fileName)!==null&&s!==void 0?s:(a=e.file)===null||a===void 0?void 0:a.name,size:(o=e.fileSize)!==null&&o!==void 0?o:(u=e.file)===null||u===void 0?void 0:u.size,type:(c=e.mimeType)!==null&&c!==void 0?c:(l=e.file)===null||l===void 0?void 0:l.type,data:e.data},thumbnails:e.thumbnailSizes?e.thumbnailSizes.map(function(f){return{url:"",width:f.maxWidth,height:f.maxHeight}}):[]})),h=new Jt(this._iid,d);return h.messageParams=e,h},t.prototype._createPendingMultipleFilesMessage=function(e,r,i){var s=me(P(P({},this._createPendingSendableMessagePayload(e,r,i)),{type:Ot.FILE})),a=new Vr(this._iid,s);return a.messageParams=e,a},t.prototype._createPendingScheduledFileMessage=function(e,r,i){var s=this._createPendingFileMessage(e,r,i);return s.scheduledInfo={scheduledMessageId:0,scheduledAt:e.scheduledAt,scheduledMessageParams:e},s},t.prototype._markMessageAsFailed=function(e,r,i){i===void 0&&(i=!1),e.errorCode=r.code,r.code===ve.REQUEST_CANCELED||r.code===ve.FILE_UPLOAD_CANCEL_FAILED?e.sendingStatus=St.CANCELED:i||(e.sendingStatus=St.FAILED)},t.prototype.sendUserMessage=function(e){var r=P(P({},ub),e);return ne(AM(r)).throw(H.invalidParameters),this._sendUserMessage(r)},t.prototype._sendUserMessage=function(e,r,i){var s=this;i===void 0&&(i=!1);var a=G.of(this._iid),o=a.dispatcher,u=a.requestQueue,c=r??this._generateRequestId(),l=Date.now(),d=new Ed;return c||(c=this._generateRequestId()),Lr(2).then(function(){var h=s._createPendingUserMessage(e,c,l);o.dispatch(new sn({messages:[h],source:i?bt.LOCAL_MESSAGE_RESEND_STARTED:bt.EVENT_MESSAGE_SENT_PENDING})),Ct(function(){return S(s,void 0,void 0,function(){return I(this,function(p){return[2,d._trigger(h)]})})});var f=new d2(P(P({},e),{channelUrl:s.url,channelType:s.channelType,reqId:c}));u.send(f).then(function(p){var _=p.as(h2).message;o.dispatch(new sn({messages:[_],source:bt.EVENT_MESSAGE_SENT_SUCCESS})),Ct(function(){return S(s,void 0,void 0,function(){return I(this,function(m){return[2,d._trigger(_)]})})})}).catch(function(p){if(za(p))throw p;Lr(2).then(function(){var _=s._createPendingUserMessage(e,c,l),m=G.of(s._iid).cacheContext.localCacheEnabled&&Bd(p.code);s._markMessageAsFailed(_,p,m),o.dispatch(new sn({messages:[_],source:_.sendingStatus===St.PENDING?bt.REQUEST_RESEND_MESSAGE:bt.EVENT_MESSAGE_SENT_FAILED})),Ct(function(){return S(s,void 0,void 0,function(){return I(this,function(b){return[2,d._triggerFailed(p,_)]})})})})})}),d},t.prototype._autoResendUserMessage=function(e){return ne(e instanceof Qn&&!!e.messageParams).throw(H.invalidParameters),this._sendUserMessage(e.messageParams,e.reqId)},t.prototype.resendUserMessage=function(e){var r;return S(this,void 0,void 0,function(){var i,s;return I(this,function(a){return ne(e instanceof Qn&&!e.scheduledInfo).throw(H.invalidParameters),i=new Wn,s=(r=e.messageParams)!==null&&r!==void 0?r:function(o){var u;return me(Te({data:o.data,customType:o.customType,mentionType:o.mentionType,mentionedUsers:o.mentionedUsers,mentionedUserIds:o.mentionedUserIds,mentionedMessageTemplate:o.mentionedMessageTemplate,metaArrays:o.metaArrays,pollId:(u=o.poll)===null||u===void 0?void 0:u.id,parentMessageId:o.parentMessageId,appleCriticalAlertOptions:o.appleCriticalAlertOptions,message:o.message,translationTargetLanguages:Object.keys(o.translations)}))}(e),this._sendUserMessage(s,e.reqId,!0).onFailed(function(o){return i.reject(o)}).onSucceeded(function(o){return i.resolve(o)}),[2,i.promise]})})},t.prototype.updateUserMessage=function(e,r){return S(this,void 0,void 0,function(){var i,s,a,o;return I(this,function(u){switch(u.label){case 0:return i=P(P({},kM),r),ne($("number",e)&&OM(i)).throw(H.invalidParameters),s=G.of(this._iid).requestQueue,a=new Wg(P({channelType:this.channelType,channelUrl:this.url,messageId:e},i)),[4,s.send(a)];case 1:return o=u.sent(),[2,o.as(Yg).message]}})})},t.prototype.copyUserMessage=function(e,r){var i,s,a;return S(this,void 0,void 0,function(){var o,u;return I(this,function(c){return ne(e instanceof t&&r instanceof Qn&&r.sendingStatus===St.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(H.invalidParameters),ne(!r.poll).throw(H.notSupportedError),o=new Wn,u=(i=r.messageParams)!==null&&i!==void 0?i:Te(P(P({},r),{mentionType:r.mentionType,mentionedUserIds:(s=r.mentionedUserIds)!==null&&s!==void 0?s:(a=r.mentionedUsers)===null||a===void 0?void 0:a.map(function(l){return l.userId}),translationTargetLanguages:Object.keys(r.translations),pushNotificationDeliveryOption:ba.DEFAULT,parentMessageId:null,isReplyToChannel:!1,isPinnedMessage:!1})),e._sendUserMessage(u).onSucceeded(function(l){o.resolve(l)}).onFailed(function(l){return o.reject(l)}),[2,o.promise]})})},t.prototype.translateUserMessage=function(e,r){return S(this,void 0,void 0,function(){var i,s,a;return I(this,function(o){switch(o.label){case 0:return ne(e instanceof Qn&&e.messageId>0&&We("string",r)).throw(H.invalidParameters),i=G.of(this._iid).requestQueue,s=new g2({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,translationTargetLanguages:r}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(y2).message]}})})},t.prototype._createScheduledUserMessage=function(e,r){var i=this,s=G.of(this._iid).requestQueue,a=Date.now(),o=this._generateRequestId();Lr(2).then(function(){var c=i._createPendingScheduledUserMessage(e,o,a);Ct(function(){return S(i,void 0,void 0,function(){return I(this,function(l){return[2,r._trigger(c)]})})})});var u=new E2(P({reqId:o,channelType:this.channelType,channelUrl:this.url},e));s.send(u).then(function(c){var l=c.as(b2).message;Ct(function(){return S(i,void 0,void 0,function(){return I(this,function(d){return[2,r._trigger(l)]})})})}).catch(function(c){if(za(c))throw c;Lr(2).then(function(){var l=i._createPendingScheduledUserMessage(e,o,a);i._markMessageAsFailed(l,c),Ct(function(){return S(i,void 0,void 0,function(){return I(this,function(d){return[2,r._trigger(l)]})})})})})},t.prototype.sendFileMessage=function(e){var r=P(P({},zg),e);return ne(Gg(r)).throw(H.invalidParameters),this._sendFileMessage(r)},t.prototype.sendMultipleFilesMessage=function(e){var r,i=P(P({},G2),e),s=G.of(this._iid);ne(function(o,u){return u===void 0&&(u=HO),q_(o)&&Array.isArray(o.fileInfoList)&&o.fileInfoList.length>=2&&o.fileInfoList.length<=u&&o.fileInfoList.every(function(c){return V2(c)})}(i,(r=s.appInfo)===null||r===void 0?void 0:r.multipleFilesMessageFileCountLimit)).throw(H.invalidParameters);var a=!!e.fileInfoList.find(function(o){var u=s.appInfo.uploadSizeLimit;return o.file instanceof Blob&&o.file.size>u||o.fileSize>u});return ne(!a).throw(H.fileSizeLimitExceededError),this._sendMultipleFilesMessage(i)},t.prototype._sendFileMessage=function(e,r,i){var s=this;i===void 0&&(i=!1);var a=G.of(this._iid).dispatcher,o=xn.of(this._iid).fileMessageQueue,u=r??this._generateRequestId(),c=Date.now(),l=new Ed;return u||(u=this._generateRequestId()),Lr(2).then(function(){var d=s._createPendingFileMessage(e,u,c);a.dispatch(new sn({messages:[d],source:i?bt.LOCAL_MESSAGE_RESEND_STARTED:bt.EVENT_MESSAGE_SENT_PENDING})),Ct(function(){return S(s,void 0,void 0,function(){return I(this,function(h){return[2,l._trigger(d)]})})}),o.request(s,u,e).then(function(h){a.dispatch(new sn({messages:[h],source:bt.EVENT_MESSAGE_SENT_SUCCESS})),Ct(function(){return S(s,void 0,void 0,function(){return I(this,function(f){return[2,l._trigger(h)]})})})}).catch(function(h){if(za(h))throw h;Lr(2).then(function(){var f=s._createPendingFileMessage(e,u,c),p=G.of(s._iid).cacheContext.localCacheEnabled&&Bd(h.code);s._markMessageAsFailed(f,h,p),a.dispatch(new sn({messages:[f],source:f.sendingStatus===St.PENDING?bt.REQUEST_RESEND_MESSAGE:h.code===ve.FILE_UPLOAD_CANCEL_FAILED?bt.LOCAL_MESSAGE_CANCELED:bt.EVENT_MESSAGE_SENT_FAILED})),Ct(function(){return S(s,void 0,void 0,function(){return I(this,function(_){return[2,l._triggerFailed(h,f)]})})})})})}),l},t.prototype._autoResendFileMessage=function(e){ne(e instanceof Jt&&!!e.messageParams).throw(H.invalidParameters);var r=G.of(this._iid).logger;return r.debug("autoResendFileMessage pending",e),this._sendFileMessage(e.messageParams,e.reqId).onFailed(function(i){r.debug("autoResendFileMessage failed",i)}).onSucceeded(function(i){r.debug("autoResendFileMessage success",i)})},t.prototype._sendMultipleFilesMessage=function(e,r){var i=this,s=G.of(this._iid).dispatcher,a=xn.of(this._iid).fileMessageQueue,o=r??this._generateRequestId(),u=Date.now(),c=new B2;return o||(o=this._generateRequestId()),Lr(2).then(function(){var l=i._createPendingMultipleFilesMessage(e,o,u);s.dispatch(new sn({messages:[l],source:bt.EVENT_MESSAGE_SENT_PENDING})),Ct(function(){return S(i,void 0,void 0,function(){return I(this,function(d){return[2,c._trigger(l)]})})}),a.request(i,o,e,c).then(function(d){s.dispatch(new sn({messages:[d],source:bt.EVENT_MESSAGE_SENT_SUCCESS})),Ct(function(){return S(i,void 0,void 0,function(){return I(this,function(h){return[2,c._trigger(d)]})})})}).catch(function(d){if(za(d))throw d;Lr(2).then(function(){var h=i._createPendingMultipleFilesMessage(e,o,u);i._markMessageAsFailed(h,d),s.dispatch(new sn({messages:[h],source:bt.EVENT_MESSAGE_SENT_FAILED})),Ct(function(){return S(i,void 0,void 0,function(){return I(this,function(f){return[2,c._triggerFailed(d,h)]})})})})})}),c},t.prototype._createScheduledFileMessage=function(e,r,i,s){var a=this,o=G.of(this._iid).requestQueue,u=new T2(P(P({reqId:i,channelType:this.channelType,channelUrl:this.url},e),{fileUrl:e.fileUrl,requireAuth:e.requireAuth}));o.send(u).then(function(c){var l=c.as(w2).message;Ct(function(){return S(a,void 0,void 0,function(){return I(this,function(d){return[2,r._trigger(l)]})})})}).catch(function(c){if(za(c))throw c;Lr(2).then(function(){var l=a._createPendingScheduledFileMessage(e,i,s);a._markMessageAsFailed(l,c),Ct(function(){return S(a,void 0,void 0,function(){return I(this,function(d){return[2,r._triggerFailed(c,l)]})})})})})},t.prototype.sendFileMessages=function(e){var r,i;ne(e.every(function(c){return Gg(P(P({},zg),c))})).throw(H.invalidParameters);var s=new Ed;try{for(var a=ke(e),o=a.next();!o.done;o=a.next()){var u=o.value;this.sendFileMessage(u).onPending(function(c){return s._trigger(c)}).onFailed(function(c,l){return s._triggerFailed(c,l)}).onSucceeded(function(c){return s._trigger(c)})}}catch(c){r={error:c}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return s},t.prototype.resendFileMessage=function(e,r){var i;return S(this,void 0,void 0,function(){var s,a,o;return I(this,function(u){return s=!!e.url||Gi(r)||Gi((i=e.messageParams)===null||i===void 0?void 0:i.file),ne(e instanceof Jt&&s&&!e.scheduledInfo).throw(H.invalidParameters),a=new Wn,o=function(c,l){var d;return c.messageParams?(!c.url&&Gi(l)&&(c.messageParams.file=l),c.messageParams):me(Te({data:c.data,customType:c.customType,mentionType:c.mentionType,mentionedUsers:c.mentionedUsers,mentionedUserIds:c.mentionedUserIds,metaArrays:c.metaArrays,parentMessageId:c.parentMessageId,appleCriticalAlertOptions:c.appleCriticalAlertOptions,file:l,fileUrl:c.url,fileName:c.name,fileSize:c.size,mimeType:c.type,thumbnailSizes:(d=c.thumbnails)===null||d===void 0?void 0:d.map(function(h){return{maxWidth:h.width,maxHeight:h.height}})}))}(e,r),this._sendFileMessage(o,e.reqId,!0).onFailed(function(c){return a.reject(c)}).onSucceeded(function(c){return a.resolve(c)}),[2,a.promise]})})},t.prototype.updateFileMessage=function(e,r){return S(this,void 0,void 0,function(){var i,s,a,o;return I(this,function(u){switch(u.label){case 0:return i=P(P({},MM),r),ne($("number",e)&&function(c){return lb(c)}(i)).throw(H.invalidParameters),s=G.of(this._iid).requestQueue,a=new Zg(P({channelType:this.channelType,channelUrl:this.url,messageId:e},i)),[4,s.send(a)];case 1:return o=u.sent(),[2,o.as(Jg).message]}})})},t.prototype.cancelUploadingFileMessage=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){return ne($("string",e)).throw(H.invalidParameters),xn.of(this._iid).fileMessageQueue.cancel(this,e),[2,!0]})})},t.prototype.copyFileMessage=function(e,r){var i,s,a;return S(this,void 0,void 0,function(){var o,u;return I(this,function(c){return ne(e instanceof t&&r instanceof Jt&&r.sendingStatus===St.SUCCEEDED&&this.url===r.channelUrl&&!r.scheduledInfo).throw(H.invalidParameters),o=new Wn,u=Te(P(P({},r),{fileUrl:r.url,fileName:r.name,fileSize:r.size,mimeType:r.type,mentionType:r.mentionType,mentionedUserIds:(i=r.mentionedUserIds)!==null&&i!==void 0?i:(s=r.mentionedUsers)===null||s===void 0?void 0:s.map(function(l){return l.userId}),pushNotificationDeliveryOption:ba.DEFAULT,parentMessageId:null,isReplyToChannel:!1,thumbnailSizes:(a=r.thumbnails)===null||a===void 0?void 0:a.map(function(l){return{maxWidth:l.width,maxHeight:l.height}}),requireAuth:r.requireAuth,isPinnedMessage:!1})),e._sendFileMessage(u).onSucceeded(function(l){return o.resolve(l)}).onFailed(function(l){return o.reject(l)}),[2,o.promise]})})},t.prototype.deleteMessage=function(e){return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){switch(s.label){case 0:return ne(e instanceof vs).throw(H.invalidParameters),e.messageId>0?(r=G.of(this._iid).requestQueue,i=new f2({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId}),[4,r.send(i)]):[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},t.prototype.addReaction=function(e,r){return S(this,void 0,void 0,function(){var i,s,a;return I(this,function(o){switch(o.label){case 0:return ne(e instanceof vs&&e.messageId>0&&$("string",r)).throw(H.invalidParameters),i=G.of(this._iid).requestQueue,s=new p2({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:r}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(_2).reactionEvent]}})})},t.prototype.deleteReaction=function(e,r){return S(this,void 0,void 0,function(){var i,s,a;return I(this,function(o){switch(o.label){case 0:return ne(e instanceof vs&&e.messageId>0&&$("string",r)).throw(H.invalidParameters),i=G.of(this._iid).requestQueue,s=new m2({channelType:this.channelType,channelUrl:this.url,messageId:e.messageId,reactionKey:r}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(v2).reactionEvent]}})})},t.prototype._updateUserMessageMetaArray=function(e,r,i,s){return S(this,void 0,void 0,function(){var a,o,u,c,l,d;return I(this,function(h){switch(h.label){case 0:return a=G.of(this._iid),o=a.dispatcher,u=a.requestQueue,c=new Wg({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:r,mode:i,upsert:s}}),[4,u.send(c)];case 1:return l=h.sent(),d=l.as(Yg).message,o.dispatch(new sn({messages:[d],source:bt.EVENT_MESSAGE_UPDATED})),[2,d]}})})},t.prototype._updateFileMessageMetaArray=function(e,r,i,s){return S(this,void 0,void 0,function(){var a,o,u,c,l,d;return I(this,function(h){switch(h.label){case 0:return a=G.of(this._iid),o=a.dispatcher,u=a.requestQueue,c=new Zg({channelType:this.channelType,channelUrl:this.url,messageId:e,metaArrayParams:{array:r,mode:i,upsert:s}}),[4,u.send(c)];case 1:return l=h.sent(),d=l.as(Jg).message,o.dispatch(new sn({messages:[d],source:bt.EVENT_MESSAGE_UPDATED})),[2,d]}})})},t.prototype.createMessageMetaArrayKeys=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){return ne(e instanceof vs&&e.messageId>0&&We("string",r)).throw(H.invalidParameters),i=r.map(function(a){return new wr({key:a})}),e instanceof Jt?[2,this._updateFileMessageMetaArray(e.messageId,i,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,i,"add",!0)]})})},t.prototype.deleteMessageMetaArrayKeys=function(e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){return ne(e instanceof vs&&e.messageId>0&&We("string",r)).throw(H.invalidParameters),i=r.map(function(a){return new wr({key:a})}),e instanceof Jt?[2,this._updateFileMessageMetaArray(e.messageId,i,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,i,"remove",!0)]})})},t.prototype.addMessageMetaArrayValues=function(e,r){return S(this,void 0,void 0,function(){return I(this,function(i){return ne(e instanceof vs&&e.messageId>0&&r.every(function(s){return s instanceof wr})).throw(H.invalidParameters),e instanceof Jt?[2,this._updateFileMessageMetaArray(e.messageId,r,"add",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,r,"add",!0)]})})},t.prototype.removeMessageMetaArrayValues=function(e,r){return S(this,void 0,void 0,function(){return I(this,function(i){return ne(e instanceof vs&&e.messageId>0&&r.every(function(s){return s instanceof wr})).throw(H.invalidParameters),e instanceof Jt?[2,this._updateFileMessageMetaArray(e.messageId,r,"remove",!0)]:[2,this._updateUserMessageMetaArray(e.messageId,r,"remove",!0)]})})},t.prototype.report=function(e,r){return S(this,void 0,void 0,function(){var i,s,a,o;return I(this,function(u){switch(u.label){case 0:return ne(yt(kc,e)&&$("string",r)).throw(H.invalidParameters),i=G.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new u2({channelUrl:this.url,channelType:this.channelType,userId:s.userId,category:e,description:r}),[4,a.send(o)];case 1:return u.sent(),[2]}})})},t.prototype.reportUser=function(e,r,i){return S(this,void 0,void 0,function(){var s,a,o,u;return I(this,function(c){switch(c.label){case 0:return ne(e instanceof $e&&yt(kc,r)&&$("string",i)).throw(H.invalidParameters),s=G.of(this._iid),a=s.sdkState,o=s.requestQueue,u=new c2({channelUrl:this.url,channelType:this.channelType,userId:a.userId,offendingUserId:e.userId,category:r,description:i}),[4,o.send(u)];case 1:return c.sent(),[2]}})})},t.prototype.reportMessage=function(e,r,i){return S(this,void 0,void 0,function(){var s,a,o,u;return I(this,function(c){switch(c.label){case 0:return ne(e instanceof yo&&yt(kc,r)&&$("string",i)).throw(H.invalidParameters),s=G.of(this._iid),a=s.sdkState,o=s.requestQueue,u=new l2({channelUrl:this.url,channelType:this.channelType,userId:a.userId,offendingUserId:e.sender.userId,messageId:e.messageId,category:r,description:i}),[4,o.send(u)];case 1:return c.sent(),[2]}})})},t.prototype.updatePoll=function(e,r){return S(this,void 0,void 0,function(){var i,s,a;return I(this,function(o){switch(o.label){case 0:return ne($("number",e)&&function(u){return $("string",u.title,!0)&&ZE(u.data)&&$("boolean",u.allowUserSuggestion,!0)&&$("boolean",u.allowMultipleVotes,!0)&&$("number",u.closeAt,!0)}(r)).throw(H.invalidParameters),i=G.of(this._iid).requestQueue,s=new I2(P({pollId:e},r)),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(S2).poll]}})})},t.prototype.deletePoll=function(e){return S(this,void 0,void 0,function(){var r,i,s;return I(this,function(a){switch(a.label){case 0:return r=$("number",e),ne(r).throw(H.invalidParameters),i=G.of(this._iid).requestQueue,s=new C2({pollId:e}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},t.prototype.closePoll=function(e){return S(this,void 0,void 0,function(){var r,i,s,a;return I(this,function(o){switch(o.label){case 0:return r=$("number",e),ne(r).throw(H.invalidParameters),i=G.of(this._iid).requestQueue,s=new N2({pollId:e}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(A2).poll]}})})},t.prototype.addPollOption=function(e,r){return S(this,void 0,void 0,function(){var i,s,a,o;return I(this,function(u){switch(u.label){case 0:return i=$("number",e)&&$("string",r)&&r.trim()!=="",ne(i).throw(H.invalidParameters),s=G.of(this._iid).requestQueue,a=new k2({channelUrl:this.url,channelType:this.channelType,pollId:e,optionText:r}),[4,s.send(a)];case 1:return o=u.sent(),[2,o.as(O2).poll]}})})},t.prototype.updatePollOption=function(e,r,i){return S(this,void 0,void 0,function(){var s,a,o,u;return I(this,function(c){switch(c.label){case 0:return s=$("number",e)&&$("number",r)&&$("string",i)&&i.trim()!=="",ne(s).throw(H.invalidParameters),a=G.of(this._iid).requestQueue,o=new M2({pollId:e,pollOptionId:r,optionText:i}),[4,a.send(o)];case 1:return u=c.sent(),[2,u.as(D2).poll]}})})},t.prototype.deletePollOption=function(e,r){return S(this,void 0,void 0,function(){var i,s,a;return I(this,function(o){switch(o.label){case 0:return i=$("number",e)&&$("number",r),ne(i).throw(H.invalidParameters),s=G.of(this._iid).requestQueue,a=new R2({pollId:e,pollOptionId:r}),[4,s.send(a)];case 1:return o.sent(),[2]}})})},t.prototype.votePoll=function(e,r){return S(this,void 0,void 0,function(){var i,s,a,o,u,c,l;return I(this,function(d){switch(d.label){case 0:return i=$("number",e)&&We("number",r),ne(i).throw(H.invalidParameters),s=G.of(this._iid),a=s.requestQueue,o=s.dispatcher,u=new U2({reqId:this._generateRequestId(),channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionIds:r}),[4,a.send(u)];case 1:return c=d.sent(),l=c.as(L2).event,o.dispatch(new eb({event:l,source:bt.EVENT_POLL_VOTED})),[2,l]}})})},t.prototype.getPollChangeLogsSinceTimestamp=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return ne($("number",e)).throw(H.invalidParameters),[4,Xp.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,r.sent()]}})})},t.prototype.getPollChangeLogsSinceToken=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return ne($("string",e,!0)),[4,Xp.of(this._iid).getPollChangeLogs(this.url,this.channelType,e)];case 1:return[2,r.sent()]}})})},t.prototype.createPollListQuery=function(e){return e===void 0&&(e=10),new ib(this._iid,{channelUrl:this.url,channelType:this.channelType,limit:e})},t.prototype.createPollVoterListQuery=function(e,r,i){return i===void 0&&(i=20),new sb(this._iid,{channelUrl:this.url,channelType:this.channelType,pollId:e,pollOptionId:r,limit:i})},t})(gi);var j2=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return D(t,n),t}(function(){this.onConnected=on,this.onReconnectStarted=on,this.onReconnectSucceeded=on,this.onReconnectFailed=on,this.onDisconnected=on}),K2=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return D(t,n),t}(function(){this.onSessionExpired=on,this.onSessionTokenRequired=function(n){return n(null)},this.onSessionError=on,this.onSessionRefreshed=on,this.onSessionClosed=on}),Q2=function(n){function t(e){e===void 0&&(e={});var r=n.call(this)||this;return Object.keys(e).forEach(function(i){r.hasOwnProperty(i)&&(r[i]=e[i])}),r}return D(t,n),t}(function(){this.onFriendsDiscovered=on,this.onTotalUnreadMessageCountChanged=on,this.onTotalUnreadMessageCountUpdated=on}),W2=function(n){function t(e){var r=e.limit,i=e.token,s=e.userIdsFilter,a=e.metaDataKeyFilter,o=e.metaDataValuesFilter,u=e.nicknameStartsWithFilter,c=n.call(this)||this;return c.method=J.GET,c.path=Ye,c.params=me({limit:r,token:i,user_ids:s,metadatakey:a,metadatavalues_in:o,nickname_startswith:u}),c}return D(t,n),t}(X),Y2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new $e(e,s)}),i.next=r.next,i}return D(t,n),t}(se),Z2=function(n){function t(e,r){var i,s,a,o=this;return(o=n.call(this,e,r)||this).userIdsFilter=null,o.metaDataKeyFilter=null,o.metaDataValuesFilter=null,o.nicknameStartsWithFilter=null,o.userIdsFilter=(i=r.userIdsFilter)!==null&&i!==void 0?i:null,o.metaDataKeyFilter=(s=r.metaDataKeyFilter)!==null&&s!==void 0?s:null,o.metaDataValuesFilter=(a=r.metaDataValuesFilter)!==null&&a!==void 0?a:null,o.nicknameStartsWithFilter=r.nicknameStartsWithFilter||null,o}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&We("string",this.userIdsFilter,!0)&&$("string",this.metaDataKeyFilter,!0)&&We("string",this.metaDataValuesFilter,!0)&&$("string",this.metaDataKeyFilter,!0)},t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=G.of(this._iid).requestQueue,r=new W2(Te(P(P({},this),{token:this._token}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=u.sent(),s=i.as(Y2),a=s.users,o=s.next,this._token=o,this._hasNext=!!o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(rl),J2=function(n){function t(e){var r=e.userId,i=e.limit,s=e.token,a=e.userIdsFilter,o=n.call(this)||this;return o.method=J.GET,o.path="".concat(Ye,"/").concat(r,"/block"),o.params=me({limit:i,token:s,user_ids:a}),o}return D(t,n),t}(X),X2=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new $e(e,s)}),i.next=r.next,i}return D(t,n),t}(se),eD=function(n){function t(e,r){var i,s=this;return(s=n.call(this,e,r)||this).userIdsFilter=null,s.userIdsFilter=(i=r.userIdsFilter)!==null&&i!==void 0?i:null,s}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&We("string",this.userIdsFilter,!0)},t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new J2(Te(P(P({},this),{userId:r.userId,token:this._token}))),[4,i.send(s)]):[3,2]:[3,5];case 1:return a=l.sent(),o=a.as(X2),u=o.users,c=o.next,this._token=c,this._hasNext=!!c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(rl),tD=function(n){function t(e){var r=e.userId,i=e.limit,s=e.token,a=n.call(this)||this;return a.method=J.GET,a.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/friends"),a.params={limit:i,token:s},a}return D(t,n),t}(X),nD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.hasMore=r.has_more,i.users=r.users.map(function(s){return new $e(e,s)}),i.next=r.next,i}return D(t,n),t}(se),rD=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)},t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l;return I(this,function(d){switch(d.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new tD(P(P({},this),{userId:r.userId,token:this._token})),[4,i.send(s)]):[3,2]:[3,5];case 1:return a=d.sent(),o=a.as(nD),u=o.users,c=o.hasMore,l=o.next,this._token=l,this._hasNext=c,this._isLoading=!1,[2,u];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(rl),Jl={},wh=function(){function n(t){var e=t.dbname,r=t.itemSizeLimit,i=r===void 0?1048576:r,s=t.cacheLimit,a=s===void 0?256:s,o=t.blockHashBase,u=o===void 0?2:o,c=t.blockHashMultiplier,l=c===void 0?10:c,d=t.blockHashConstant,h=d===void 0?11:d,f=t.transactionApplyDelay,p=f===void 0?200:f,_=t.disableLogger,m=_!==void 0&&_;return Jl[e]||(this.itemSizeLimit=i,this.cacheLimit=a,this.blockHashBase=u,this.blockHashMultiplier=l,this.blockHashConstant=h,this.transactionApplyDelay=p,this.disableLogger=m,Jl[e]=this),Jl[e]}return n.get=function(t){return Jl[t]},n}();(function(n){n[n.UNKNOWN_ERROR=6e7]="UNKNOWN_ERROR",n[n.STORE_NOT_DEFINED=61001e3]="STORE_NOT_DEFINED",n[n.STORE_NOT_AVAILABLE=61001001]="STORE_NOT_AVAILABLE",n[n.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING=61001002]="STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING",n[n.STORE_IS_FULL=61001003]="STORE_IS_FULL",n[n.STORE_NOT_INITIALIZED=61001004]="STORE_NOT_INITIALIZED",n[n.STORE_INVALID_KEY_TYPE=61002e3]="STORE_INVALID_KEY_TYPE",n[n.STORE_BROKEN_INTEGRITY=61002001]="STORE_BROKEN_INTEGRITY",n[n.STORE_BROKEN_BLOB=61002002]="STORE_BROKEN_BLOB",n[n.STORE_ENCRYPTION_INVALID=61002003]="STORE_ENCRYPTION_INVALID",n[n.STORE_ITEM_SIZE_LIMIT_EXCEEDED=61017e3]="STORE_ITEM_SIZE_LIMIT_EXCEEDED",n[n.STORE_READ_FAILED=61017001]="STORE_READ_FAILED",n[n.STORE_WRITE_FAILED=61017002]="STORE_WRITE_FAILED",n[n.DATABASE_SCHEMA_NOT_ON_UPGRADE=62002e3]="DATABASE_SCHEMA_NOT_ON_UPGRADE",n[n.COLLECTION_NOT_READY=63001e3]="COLLECTION_NOT_READY",n[n.COLLECTION_KEY_NOT_MATCH=63002e3]="COLLECTION_KEY_NOT_MATCH",n[n.COLLECTION_QUERY_NOT_VALID=63002001]="COLLECTION_QUERY_NOT_VALID",n[n.COLLECTION_KEY_NOT_FOUND=63004e3]="COLLECTION_KEY_NOT_FOUND",n[n.COLLECTION_KEY_NOT_GIVEN=63004001]="COLLECTION_KEY_NOT_GIVEN",n[n.COLLECTION_INSERT_DUPLICATE=63009e3]="COLLECTION_INSERT_DUPLICATE",n[n.COLLECTION_WRITE_FAILED=63017e3]="COLLECTION_WRITE_FAILED",n[n.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED=63017001]="COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED",n[n.INDEX_TABLE_IS_REQUIRED=65001e3]="INDEX_TABLE_IS_REQUIRED",n[n.INDEX_TYPE_NOT_MATCH=65002e3]="INDEX_TYPE_NOT_MATCH",n[n.COMPARE_TYPE_NOT_MATCH=69002001]="COMPARE_TYPE_NOT_MATCH",n[n.CIRCULAR_REFERENCE_FOUND=69002002]="CIRCULAR_REFERENCE_FOUND"})(pt||(pt={}));var to,He=function(n){function t(e){var r=e.code,i=r===void 0?pt.UNKNOWN_ERROR:r,s=e.message,a=s===void 0?"Unknown error occurred.":s,o=n.call(this,a)||this;return o.code=i,Object.setPrototypeOf(o,t.prototype),o}return D(t,n),Object.defineProperty(t,"storeNotDefined",{get:function(){return new t({code:pt.STORE_NOT_DEFINED,message:"Store is not defined. Specify the store on NestDB()"})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailable",{get:function(){return new t({code:pt.STORE_NOT_AVAILABLE,message:"Store is not available. Check your environment settings."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotAvailableInPrivateBrowsing",{get:function(){return new t({code:pt.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING,message:"Store is not available because it is in private browsing."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeIsFull",{get:function(){return new t({code:pt.STORE_IS_FULL,message:"Store is full."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeNotInitialized",{get:function(){return new t({code:pt.STORE_NOT_INITIALIZED,message:"Store is not initialized."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeKeyTypeIsInvalid",{get:function(){return new t({code:pt.STORE_INVALID_KEY_TYPE,message:"Store key should be string type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenIntegrity",{get:function(){return new t({code:pt.STORE_BROKEN_INTEGRITY,message:"Data should be in a store but it does not. Integrity is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeBrokenBlob",{get:function(){return new t({code:pt.STORE_BROKEN_BLOB,message:"Data should be in a store but it does not. Blob data is broken."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeEncryptionInvalid",{get:function(){return new t({code:pt.STORE_ENCRYPTION_INVALID,message:"Encryption algorithm has changed. All the store should reset."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeItemSizeExceeded",{get:function(){return new t({code:pt.STORE_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that the store allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeReadFailed",{get:function(){return new t({code:pt.STORE_READ_FAILED,message:"Failed to read from store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"storeWriteFailed",{get:function(){return new t({code:pt.STORE_WRITE_FAILED,message:"Failed to write to store."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"databaseSchemaNotOnUpgrade",{get:function(){return new t({code:pt.DATABASE_SCHEMA_NOT_ON_UPGRADE,message:"Committing schema is not allowed when upgrade is not running."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionNotReady",{get:function(){return new t({code:pt.COLLECTION_NOT_READY,message:"Collection is not ready due to an error during initialization."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotMatch",{get:function(){return new t({code:pt.COLLECTION_KEY_NOT_MATCH,message:"keyName of collection could not change."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionQueryNotValid",{get:function(){return new t({code:pt.COLLECTION_QUERY_NOT_VALID,message:"Query parameter is not a valid format."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionInsertDuplicate",{get:function(){return new t({code:pt.COLLECTION_INSERT_DUPLICATE,message:"The key already exists."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotFound",{get:function(){return new t({code:pt.COLLECTION_KEY_NOT_FOUND,message:"The key is not found."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionKeyNotGiven",{get:function(){return new t({code:pt.COLLECTION_KEY_NOT_GIVEN,message:"The item should contain [keyName] property."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionWriteFailed",{get:function(){return new t({code:pt.COLLECTION_WRITE_FAILED,message:"Failed to write an item."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"collectionItemSizeExceeded",{get:function(){return new t({code:pt.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED,message:"The size of the item exceeds the limit that a collection allows."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTableIsRequired",{get:function(){return new t({code:pt.INDEX_TABLE_IS_REQUIRED,message:"Index table is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"indexTypesNotMatch",{get:function(){return new t({code:pt.INDEX_TYPE_NOT_MATCH,message:"Indexed column should have primitive type."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"compareTypesNotMatch",{get:function(){return new t({code:pt.COMPARE_TYPE_NOT_MATCH,message:"Values to compare have different types."})},enumerable:!1,configurable:!0}),Object.defineProperty(t,"circularReferenceFound",{get:function(){return new t({code:pt.CIRCULAR_REFERENCE_FOUND,message:"Cannot handle circular referenced object."})},enumerable:!1,configurable:!0}),t}(Error);(function(n){n.INIT="init",n.READY="ready",n.CLOSED="closed"})(to||(to={}));var Xg,jn=function(n,t){if(t===void 0&&(t=new WeakMap),typeof n=="object"&&n!==null){if(t.has(n))throw He.circularReferenceFound;t.set(n,!0);var e=void 0;if(Array.isArray(n))e=n.map(function(i){return jn(i,t)});else if(n instanceof RegExp)e=n;else if(n instanceof Date)e=n;else for(var r in e={},n)e[r]=jn(n[r],t);return t.delete(n),e}return n},Ss=function(n,t){if(t==null)return 1;if(n==null)return-1;if(typeof n!=typeof t)throw He.compareTypesNotMatch;var e=0;switch(typeof n){case"boolean":case"number":e=n-t;break;case"string":e=n.localeCompare(t)}return e},e0=function(n,t){for(var e=0,r=0;r<n.length;r++)e=n.charCodeAt(r)+(e<<6)+(e<<16)-e;return(e>>>0)%t},Xl=function(n){return new Promise(function(t){setTimeout(function(){return t()},n)})},lo=function(n,t){if(!t)return!1;if(typeof n!="function"){for(var e in n)if(["/and","&&"].includes(e)){if(n[e].some(function(u){return!lo(u,t)}))return!1}else if(["/or","||"].includes(e)){if(n[e].every(function(u){return!lo(u,t)}))return!1}else if(e==="/where"){if(!(0,n[e])(t))return!1}else{var r=e;if(typeof n[r]=="object"){var i=n[r];for(var s in i)switch(s){case"/eq":case"=":if((a=t[r])!==(o=i[s]))return!1;break;case"/neq":case"!=":if((a=t[r])===(o=i[s]))return!1;break;case"/gt":case">":var a=t[r],o=i[s];if(!(Ss(a,o)>0))return!1;break;case"/gte":case">=":if(a=t[r],o=i[s],!(Ss(a,o)>=0))return!1;break;case"/lt":case"<":if(a=t[r],o=i[s],!(Ss(a,o)<0))return!1;break;case"/lte":case"<=":if(a=t[r],o=i[s],!(Ss(a,o)<=0))return!1;break;case"/in":if(a=t[r],!(o=i[s]).includes(a))return!1;break;case"/nin":if(a=t[r],(o=i[s]).includes(a))return!1;break;case"/contain":if(a=t[r],o=i[s],!a.includes(o))return!1;break;case"/regex":if(a=t[r],!(o=i[s]).test(a))return!1;break;case"/where":if(a=t[r],!(0,i[s])(a))return!1}}else if(typeof n[r]=="function"){if(!n[r](t[r]))return!1}else if(n[r]!==t[r])return!1}return!0}return n(t)},Wu=function(){},t0=function(){return Promise.resolve()},iD=function(n){return n},n0=function(n,t){t()};(function(n){n[n.FORWARD=0]="FORWARD",n[n.BACKWARD=1]="BACKWARD"})(Xg||(Xg={}));var ho,kn,Di,sD=function(){function n(t){var e=t.initialPrevValue,r=e===void 0?null:e,i=t.initialNextValue,s=i===void 0?null:i,a=t.iterator,o=t.map,u=o===void 0?iD:o,c=t.backward,l=c===void 0?t0:c,d=t.forward,h=d===void 0?t0:d,f=t.complete,p=f===void 0?Wu:f;this._prevValue=r,this._nextValue=s,this._error=null,this._map=u,this._backward=l,this._forward=h,this._iterator=a,this._complete=p}return Object.defineProperty(n.prototype,"prevValue",{get:function(){return this._map(this._prevValue)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextValue",{get:function(){return this._map(this._nextValue)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasPrevious",{get:function(){return!!this._prevValue},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasNext",{get:function(){return!!this._nextValue},enumerable:!1,configurable:!0}),n.prototype.prev=function(){return S(this,void 0,void 0,function(){var t,e,r;return I(this,function(i){switch(i.label){case 0:if(!this.hasPrevious)return[3,6];i.label=1;case 1:return i.trys.push([1,3,,4]),t=this._prevValue,e=this,[4,this._backward()];case 2:return e._prevValue=i.sent()||null,this._nextValue=t,[3,4];case 3:return r=i.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,i.sent()];case 6:this._complete(),i.label=7;case 7:return[2]}})})},n.prototype.next=function(){return S(this,void 0,void 0,function(){var t,e,r;return I(this,function(i){switch(i.label){case 0:if(!this.hasNext)return[3,6];i.label=1;case 1:return i.trys.push([1,3,,4]),t=this._nextValue,e=this,[4,this._forward()];case 2:return e._nextValue=i.sent()||null,this._prevValue=t,[3,4];case 3:return r=i.sent(),this._error=r,[3,4];case 4:return[4,this._iterator(this)];case 5:return[2,i.sent()];case 6:this._complete(),i.label=7;case 7:return[2]}})})},n.prototype.stop=function(){this._prevValue=null,this._nextValue=null,this._complete()},n}(),i_=function(){function n(t){var e=t.condition,r=e===void 0?{}:e,i=t.backward,s=i!==void 0&&i,a=t.blockManager,o=t.indexer;this.condition=r,this.backward=s,this._blockManager=a,this._indexer=o}return n.prototype.findOptimizedStartPosition=function(){var t=this,e=["=","/eq",">",">=","/gt","/gte"],r=["=","/eq","<","<=","/lt","/lte"];if(this.backward){var i=this._indexer.origin.length-1;if(typeof this.condition!="function")for(var s in this._indexer.fields){var a=this._indexer.fields[s],o=1;if(a[0]==="-"&&(a=a.slice(1),o=-1),this.condition[a]){if(typeof this.condition[a]=="object"){var u=o>0?r:e;for(var c in this.condition[a])if(u.includes(c)){for(var l=i;l>=0;l--)if(o*Ss(this._indexer.origin[l].columnValues[s],this.condition[a][c])<=0){i=l;break}}}else for(l=i;l>=0;l--)if(o*Ss(this._indexer.origin[l].columnValues[s],this.condition[a])<=0){i=l;break}}}return Math.min(i+1,this._indexer.origin.length-1)}var d=0;if(typeof this.condition!="function")for(var h=function(_){var m=f._indexer.fields[_],b=1;if(m[0]==="-"&&(m=m.slice(1),b=-1),f.condition[m]){if(typeof f.condition[m]=="object")Object.keys(f.condition[m]).forEach(function(E){if((b>0?e:r).includes(E)){for(var T=d;T<t._indexer.origin.length;T++)if(b*Ss(t._indexer.origin[T].columnValues[_],t.condition[m][E])>=0){d=T;break}}});else for(var y=d;y<f._indexer.origin.length;y++)if(b*Ss(f._indexer.origin[y].columnValues[_],f.condition[m])>=0){d=y;break}}},f=this,s=0;s<this._indexer.fields.length;s++)h(s);return Math.max(d-1,0)},n.prototype.each=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c=this;return I(this,function(l){switch(l.label){case 0:if(e=this.findOptimizedStartPosition(),r=0,this.backward&&this._indexer.origin[e]&&(r=this._indexer.origin[e].keys.length-1),i=function(){if(c._indexer.origin[e]){if(!c._indexer.origin[e].keys[++r]){if(!c._indexer.origin[++e])return!1;r=0}return!0}return!1},s=function(){if(c._indexer.origin[e]){if(!c._indexer.origin[e].keys[--r]){if(!c._indexer.origin[--e])return!1;r=c._indexer.origin[e].keys.length-1}return!0}return!1},a=null,!this._indexer.origin[e])return[3,4];o=this.backward?s:i,l.label=1;case 1:return[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])];case 2:if((u=l.sent())&&lo(this.condition,u))return a=u,[3,4];l.label=3;case 3:if(o())return[3,1];l.label=4;case 4:return[4,new Promise(function(d){var h=new sD({initialNextValue:jn(a),iterator:t,forward:function(){return S(c,void 0,void 0,function(){var f,p;return I(this,function(_){switch(_.label){case 0:f=this.backward?s:i,_.label=1;case 1:return f()?[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])]:[3,3];case 2:return(p=_.sent())&&lo(this.condition,p)?[2,jn(p)]:[3,1];case 3:return[2,null]}})})},backward:function(){return S(c,void 0,void 0,function(){var f,p;return I(this,function(_){switch(_.label){case 0:f=this.backward?i:s,_.label=1;case 1:return f()?[4,this._blockManager.getFromBlock(this._indexer.origin[e].keys[r])]:[3,3];case 2:return(p=_.sent())&&lo(this.condition,p)?[2,jn(p)]:[3,1];case 3:return[2,null]}})})},complete:d});t(h)})];case 5:return[2,l.sent()]}})})},n}(),aD=function(){function n(t){var e=t.condition,r=e===void 0?{}:e,i=t.backward,s=i!==void 0&&i,a=t.mutex,o=t.blockManager,u=t.indexer;this._mutex=a,this._iterator=new i_({condition:r,backward:s,blockManager:o,indexer:u})}return n.prototype.fetch=function(t){return t===void 0&&(t={}),S(this,void 0,void 0,function(){var e,r,i,s,a=this;return I(this,function(o){switch(o.label){case 0:if(e=Math.max(t.offset||0,0),(r=typeof t.limit=="number"?t.limit:Number.MAX_SAFE_INTEGER)===0)return[2,[]];if(r<0)throw He.collectionQueryNotValid;o.label=1;case 1:return o.trys.push([1,4,,5]),i=[],[4,this._mutex.lock()];case 2:return o.sent(),[4,this._iterator.each(function(u){return S(a,void 0,void 0,function(){return I(this,function(c){return u.error?u.stop():u.hasNext?e===0?(i.push(u.nextValue),0<r&&r<=i.length?u.stop():u.next()):(e--,u.next()):u.stop(),[2]})})})];case 3:return o.sent(),this._mutex.unlock(),[2,i];case 4:throw s=o.sent(),this._mutex.unlock(),s;case 5:return[2]}})})},n.prototype.count=function(){return S(this,void 0,void 0,function(){var t,e,r=this;return I(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=0,[4,this._mutex.lock()];case 1:return i.sent(),[4,this._iterator.each(function(s){return S(r,void 0,void 0,function(){return I(this,function(a){return s.error?s.stop():s.hasNext?(t++,s.next()):s.stop(),[2]})})})];case 2:return i.sent(),this._mutex.unlock(),[2,t];case 3:throw e=i.sent(),this._mutex.unlock(),e;case 4:return[2]}})})},n}(),s_=function(n){return"".concat("nest","@").concat(n)},Eo=function(n,t){return"".concat(s_(n),"/").concat(t)},Kf=function(n,t){return"".concat(Eo(n,t),".metadata")},a_=function(n,t){return"".concat(Eo(n,t),"/block.")},r0=function(n,t){return"".concat(Eo(n,t),"/blob.")},oD=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.store;this.dbname=e,this.collectionName=r,this.store=i}return n.prototype.get=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l;return I(this,function(d){switch(d.label){case 0:return[4,this.store.get(t)];case 1:return(e=d.sent())?(r=e.data,i=e.type,typeof fetch>"u"?[3,4]:[4,fetch(r)]):[3,5];case 2:return[4,d.sent().blob()];case 3:return[2,d.sent()];case 4:for(s=[],a=atob(r.split(",")[1]),o=0;o<a.length;o+=512){for(u=a.slice(o,o+512),c=new Array(u.length),l=0;l<u.length;l++)c[l]=u.charCodeAt(l);s.push(new Uint8Array(c))}return[2,new Blob(s,{type:i})];case 5:return[2,null]}})})},n.prototype.save=function(t,e){return e===void 0&&(e="".concat(Date.now())),S(this,void 0,void 0,function(){var r,i,s,a,o=this;return I(this,function(u){switch(u.label){case 0:return[4,new Promise(function(c){var l=function(h,f,p,_){return _===void 0&&(_=0),"".concat(r0(h,f)).concat(p,".").concat(_)}(o.dbname,o.collectionName,e),d=new FileReader;d.onload=function(){c({blobId:l,data:d.result,type:t.type})},d.readAsDataURL(t)})];case 1:return r=u.sent(),i=r.blobId,s=r.data,a=r.type,[4,this.store.set({key:i,value:{data:s,type:a}})];case 2:return u.sent(),[2,i]}})})},n.prototype.remove=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this.store.remove(t)];case 1:return e.sent(),[2]}})})},n.prototype.clear=function(){return S(this,void 0,void 0,function(){var t,e,r=this;return I(this,function(i){switch(i.label){case 0:return t=r0(this.dbname,this.collectionName),[4,this.store.getAllKeys()];case 1:return e=i.sent(),[4,Promise.all(e.filter(function(s){return s.startsWith(t)}).map(function(s){return S(r,void 0,void 0,function(){return I(this,function(a){switch(a.label){case 0:return[4,this.store.remove(s)];case 1:return[2,a.sent()]}})})}))];case 2:return i.sent(),[2]}})})},n}();(function(n){n[n.COMMIT=0]="COMMIT",n[n.WRITE=1]="WRITE",n[n.ERROR=2]="ERROR"})(ho||(ho={})),function(n){n.PENDING="pending",n.PERSISTENT="persistent",n.VOLATILE="volatile"}(kn||(kn={})),function(n){n[n.NO_CACHE=0]="NO_CACHE",n[n.DEFAULT=1]="DEFAULT",n[n.PERSISTENT=2]="PERSISTENT"}(Di||(Di={}));var Oc,Sn,i0=[kn.PENDING,kn.VOLATILE],ed={},zr=function(){function n(t){var e=t.dbname,r=t.limit,i=r===void 0?256:r;return ed[e]||(this.dbname=e,this._items=[],this._limit=i,ed[e]=this),ed[e]}return n.get=function(t){return ed[t]},Object.defineProperty(n.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),n.prototype.find=function(t,e,r){return r===void 0&&(r=Di.DEFAULT),S(this,void 0,void 0,function(){var i,s;return I(this,function(a){switch(a.label){case 0:return(i=this.get(e))?[3,2]:[4,t.get(e)];case 1:return(s=a.sent())&&(i={key:e,value:s,state:r===Di.PERSISTENT?kn.PERSISTENT:kn.VOLATILE},this.put(i)),[3,3];case 2:r===Di.PERSISTENT&&(i.state=kn.PERSISTENT),a.label=3;case 3:return[2,i]}})})},n.prototype.get=function(t,e){e===void 0&&(e=Di.DEFAULT);var r=this._items.map(function(s){return s.key}).indexOf(t);if(r>-1){var i=this._items[r];return e===Di.PERSISTENT&&(i.state=kn.PERSISTENT),e!==Di.NO_CACHE&&this.put(i),i}return null},n.prototype.put=function(t){var e,r;if(this._limit>0){var i=this._items.map(function(d){return d.key}).indexOf(t.key);if(i>-1)i0.includes(this._items[i].state)&&i0.includes(t.state)?(this._items.splice(i,1),this._items.push(t)):(this._items[i].state=t.state,this._items[i].value=t.value);else{this._items.push(t);var s=this._items.filter(function(d){return d.state===kn.VOLATILE}),a=s.length-this._limit;if(a>0){var o=[];try{for(var u=ke(this._items),c=u.next();!c.done;c=u.next()){var l=c.value;l.state===kn.VOLATILE&&a>0?a--:o.push(l)}}catch(d){e={error:d}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}this._items=o}}}},n.prototype.remove=function(t){var e=this._items.map(function(r){return r.key}).indexOf(t);e>-1&&this._items.splice(e,1)},n.prototype.clearByCondition=function(t){this._items=this._items.filter(function(e){return!t(e)})},n.prototype.clear=function(t){t===void 0&&(t=!1),this._items=t?[]:this._items.filter(function(e){return e.state!==kn.VOLATILE})},n}(),uD=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.store;this._requests=[],this._onCommit=new Map,this._onWrite=new Map,this._onError=new Map,this.dbname=e,this.collectionName=r,this.metadataKey=function(s,a){return"".concat(Eo(s,a),"/trans.metadata")}(e,r),this.recordsetKey=function(s,a){return"".concat(Eo(s,a),"/trans.recordset")}(e,r),this._store=i}return Object.defineProperty(n.prototype,"generation",{get:function(){return this._metadata?this._metadata.generation:0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"requestCount",{get:function(){return this._requests.length},enumerable:!1,configurable:!0}),n.prototype._getReducedRecordset=function(t){return t===void 0&&(t=[]),S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return[4,this._store.get(this.recordsetKey)];case 1:return(e=r.sent()||[]).push.apply(e,Ve([],Re(t),!1)),[2,this._reduceRecordSet(e)]}})})},n.prototype._reduceRecordSet=function(t){for(var e=[],r={},i=t.length-1;i>=0;i--){for(var s=t[i],a=[],o=s.requests.length-1;o>=0;o--){var u=s.requests[o],c=u.data;r[c.key]||(a.unshift(u),r[c.key]=!0)}a.length>0&&(s.requests=a,e.unshift(s))}return e},n.prototype._applyRecord=function(t,e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d;return I(this,function(h){switch(h.label){case 0:r=zr.get(this.dbname),i=e.generation,s=e.requests,a=null,h.label=1;case 1:return h.trys.push([1,3,,4]),[4,this._store.setMany(s.map(function(f){return P(P({},f.data),{generation:i})}))];case 2:for(o=h.sent(),u=0;u<s.length;u++)o[u]instanceof Error&&(a||(a=o[u]),c=s[u].data,r.put(P(P({},c),{state:kn.PERSISTENT})));return[3,4];case 3:return l=h.sent(),a=l,[3,4];case 4:return a?[3,6]:(d=t.filter(function(f){return f.generation!==i}),[4,this._store.set({key:this.recordsetKey,value:d})]);case 5:return h.sent(),this._onWrite.forEach(function(f){f(s.map(function(p){return p.data}))}),[3,7];case 6:this._onError.forEach(function(f){a&&f(a)}),h.label=7;case 7:return[2]}})})},n.prototype.init=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:return t=this,[4,this._store.get(this.metadataKey)];case 1:return t._metadata=c.sent()||{generation:1},[4,this._getReducedRecordset()];case 2:e=c.sent(),c.label=3;case 3:c.trys.push([3,8,9,10]),r=ke(e),i=r.next(),c.label=4;case 4:return i.done?[3,7]:(s=i.value,[4,this._applyRecord(e,s)]);case 5:c.sent(),c.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return a=c.sent(),o={error:a},[3,10];case 9:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 10:return[2]}})})},n.prototype.on=function(t,e,r){switch(t){case ho.COMMIT:this._onCommit.set(e,r);break;case ho.WRITE:this._onWrite.set(e,r);break;case ho.ERROR:this._onError.set(e,r)}},n.prototype.requestWrite=function(t,e){this._requests.push({data:t,options:e}),zr.get(this.dbname).put(P({state:kn.PENDING},t))},n.prototype.requestMultipleWrite=function(t,e){var r,i,s=zr.get(this.dbname);try{for(var a=ke(t),o=a.next();!o.done;o=a.next()){var u=o.value;this._requests.push({data:u,options:e}),s.put(P({state:kn.PENDING},u))}}catch(c){r={error:c}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},n.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(t){return zr.get(this.dbname).clearByCondition(function(e){return e.state===kn.PENDING}),this._requests=[],[2]})})},n.prototype.commit=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c,l,d,h,f=this;return I(this,function(p){switch(p.label){case 0:if(!((t=this._requests).length>0))return[3,4];for(e=[],r={},u=t.length-1;u>=0;u--)i=t[u],l=i.data,r[l.key]||(r[l.key]=!0,e.unshift(i));return s={generation:this.generation,requests:e},[4,this._getReducedRecordset([s])];case 1:return a=p.sent(),[4,this._store.set({key:this.recordsetKey,value:a})];case 2:return p.sent(),this._metadata.generation++,[4,this._store.set({key:this.metadataKey,value:this._metadata})];case 3:for(p.sent(),o=zr.get(this.dbname),u=0;u<e.length;u++)c=e[u],l=c.data,d=c.options,o.put(P(P({},l),{state:d&&d.persistent?kn.PERSISTENT:kn.VOLATILE}));this._requests=[],this._onCommit.forEach(function(_){_(t.map(function(m){return m.data}))}),h=wh.get(this.dbname),setTimeout(function(){try{f._applyRecord(a,s)}catch(_){f._onError.forEach(function(m){return m(_)})}},h.transactionApplyDelay),p.label=4;case 4:return[2]}})})},n}(),Td=function(){function n(t){var e=t.blockId,r=t.keyName,i=t.items,s=i===void 0?[]:i,a=t.limit;this.blockId=e,this.keyName=r,this.limit=a,this._items=Ve([],Re(s),!1)}return n.createFromCacheItem=function(t){return t?new n(t.value):null},Object.defineProperty(n.prototype,"isEmpty",{get:function(){return this._items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"items",{get:function(){return this._items},enumerable:!1,configurable:!0}),n.prototype.serialize=function(){return{blockId:this.blockId,keyName:this.keyName,limit:this.limit,items:this._items}},n.prototype.getItemByKey=function(t){var e=this,r=this._items.find(function(i){var s=i[e.keyName];return t===s});return r??null},n.prototype.has=function(t){var e=this;return this._items.map(function(r){return r[e.keyName]}).includes(t)},n.prototype.add=function(t){var e=this,r=this._items.map(function(i){return i[e.keyName]}).indexOf(t[this.keyName]);return r<0?this._items.length<this.limit&&(this._items.push(t),!0):(this._items[r]=t,!0)},n.prototype.remove=function(t){for(var e in this._items)if(this._items[e][this.keyName]===t)return this._items.splice(parseInt(e),1),!0;return!1},n.prototype.clear=function(){this._items=[]},n}(),cD=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.metadata,s=t.hashFunction,a=s===void 0?e0:s,o=t.transaction,u=t.store;this.dbname=e,this.collectionName=r,this.hashFunction=a,this.metadata=i,this._transaction=o,this._store=u}return Object.defineProperty(n.prototype,"keyName",{get:function(){return this.metadata.keyName},enumerable:!1,configurable:!0}),n.prototype.createBlockId=function(t,e){return e===void 0&&(e=this.metadata.blockLevel),r=this.dbname,i=this.collectionName,s=e,a="".concat(function(o,u,c){var l=c.base*Math.pow(c.multiplier,u)+c.constant;return(c.hashFunction||e0)(o,l)}(t,e,{hashFunction:this.hashFunction,base:this.metadata.blockHashBase,multiplier:this.metadata.blockHashMultiplier,constant:this.metadata.blockHashConstant})),"".concat(a_(r,i)).concat(s,".").concat(a);var r,i,s,a},n.prototype._findBlock=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a;return I(this,function(o){switch(o.label){case 0:e=zr.get(this.dbname),r=this.metadata.blockLevel,o.label=1;case 1:return r>0?(i=this.createBlockId(t,r),[4,e.find(this._store,i)]):[3,4];case 2:if((s=o.sent())&&(a=Td.createFromCacheItem(s),a==null?void 0:a.getItemByKey(t)))return[2,a];o.label=3;case 3:return r--,[3,1];case 4:return[2,null]}})})},n.prototype.getFromBlock=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return[4,this._findBlock(t)];case 1:return[2,(e=r.sent())?e.getItemByKey(t):null]}})})},n.prototype.putToBlock=function(t,e){return S(this,void 0,void 0,function(){var r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return r=wh.get(this.dbname),i=this.createBlockId(t),s=Math.floor(this._store.itemSizeLimit/r.itemSizeLimit),[4,zr.get(this.dbname).find(this._store,i)];case 1:return a=u.sent(),(o=a?Td.createFromCacheItem(a):new Td({blockId:i,keyName:this.keyName,items:[],limit:s}))!=null&&o.add(e)?(this._transaction.requestWrite({key:o.blockId,value:o.serialize()}),[2,!0]):[2,!1]}})})},n.prototype.removeFromBlock=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return[4,this._findBlock(t)];case 1:return(e=r.sent())&&e.remove(t)?(this._transaction.requestWrite({key:e.blockId,value:e.serialize()}),[2,!0]):[2,!1]}})})},n.prototype.clearAllBlocks=function(){return S(this,void 0,void 0,function(){var t,e,r;return I(this,function(i){switch(i.label){case 0:return t=a_(this.dbname,this.collectionName),[4,this._store.getAllKeys()];case 1:return e=i.sent(),r=e.filter(function(s){return s.startsWith(t)}),[4,this._store.removeMany(r)];case 2:return i.sent(),[4,this._transaction.clear()];case 3:return i.sent(),zr.get(this.dbname).clearByCondition(function(s){return s.key.startsWith(t)}),[2]}})})},n}(),qo={},Zs=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.keyName,s=t.fields,a=t.transaction,o=t.store,u=this;this._origin=[],this._table=[];var c=function(l,d,h){return"".concat(Eo(l,d),"/index.").concat(h)}(e,r,s.join(">"));return qo[c]||(this.dbname=e,this.collectionName=r,this.keyName=i,this.fields=s,this.indexerKey=c,this._transaction=a,this._store=o,this._transaction.on(ho.COMMIT,this.indexerKey,function(){return u.commit()}),this._transaction.on(ho.ERROR,this.indexerKey,function(){return u.abort()})),qo[c]}return n.createKey=function(t){return t.join(">")},n.parseKey=function(t){return t.split(">")},n.clearIndexerMap=function(){for(var t in qo)delete qo[t]},n.prototype._addItem=function(t){var e=t[this.keyName],r=this.getColumnValues(t),i=Re(this.indexOf(r),2),s=i[0];return i[1]?!this._table[s].keys.includes(e)&&(this._table[s].keys.push(e),!0):(this._table.splice(s,0,{columnValues:r,keys:[e]}),!0)},n.prototype._removeItem=function(t){var e=t[this.keyName],r=this.getColumnValues(t),i=Re(this.indexOf(r),2),s=i[0];if(i[1]){var a=this._table[s].keys.indexOf(e);if(a>-1)return this._table[s].keys.splice(a,1),this._table[s].keys.length===0&&this._table.splice(s,1),!0}return!1},Object.defineProperty(n.prototype,"origin",{get:function(){return this._origin},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"table",{get:function(){return this._table},enumerable:!1,configurable:!0}),n.prototype.getColumnValues=function(t){var e,r,i,s,a=[];try{for(var o=ke(this.fields),u=o.next();!u.done;u=o.next()){var c=u.value;if(c[0]==="-"&&(c=c.slice(1)),i=t[c],s=void 0,s=typeof i,i!==null&&s!=="undefined"&&s!=="boolean"&&s!=="number"&&s!=="string")throw He.indexTypesNotMatch;a.push(t[c])}}catch(l){e={error:l}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return a},n.prototype.diff=function(t,e){for(var r in this.fields){var i=this.fields[r][0]==="-"?-1:1,s=Ss(t[r],e[r]);if(s!==0)return i*s}return 0},n.prototype.indexOf=function(t){if(this._table.length>0){for(var e=0,r=this._table.length-1;e<=r;){var i=Math.floor((e+r)/2),s=this.diff(t,this._table[i].columnValues);if(s>0)e=i+1;else{if(!(s<0))return[i,!0];r=i-1}}return[e,!1]}return[0,!1]},n.prototype.ensure=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c,l,d,h,f,p,_,m,b;return I(this,function(y){switch(y.label){case 0:return[4,(t=zr.get(this.dbname)).find(this._store,this.indexerKey,Di.PERSISTENT)];case 1:return(e=y.sent())?[3,11]:(r=a_(this.dbname,this.collectionName),[4,this._store.getAllKeys()]);case 2:i=y.sent(),y.label=3;case 3:y.trys.push([3,8,9,10]),s=ke(i),a=s.next(),y.label=4;case 4:return a.done?[3,7]:(o=a.value).startsWith(r)?[4,t.find(this._store,o,Di.NO_CACHE)]:[3,6];case 5:if(u=y.sent(),c=Td.createFromCacheItem(u))try{for(m=void 0,l=ke(c.items),d=l.next();!d.done;d=l.next())h=d.value,this._addItem(h)}catch(E){m={error:E}}finally{try{d&&!d.done&&(b=l.return)&&b.call(l)}finally{if(m)throw m.error}}y.label=6;case 6:return a=s.next(),[3,4];case 7:return[3,10];case 8:return f=y.sent(),p={error:f},[3,10];case 9:try{a&&!a.done&&(_=s.return)&&_.call(s)}finally{if(p)throw p.error}return[7];case 10:return this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[3,12];case 11:this._origin=e.value,this._table=jn(this._origin),y.label=12;case 12:return qo[this.indexerKey]=this,[2]}})})},n.prototype.drop=function(){return S(this,void 0,void 0,function(){return I(this,function(t){switch(t.label){case 0:return zr.get(this.dbname).remove(this.indexerKey),[4,this._store.remove(this.indexerKey)];case 1:return t.sent(),delete qo[this.indexerKey],[2]}})})},n.prototype.addItem=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return this._addItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.removeItem=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return this._removeItem(t)&&this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(t){return this._table=[],this._transaction.requestWrite({key:this.indexerKey,value:this._table},{persistent:!0}),[2]})})},n.prototype.commit=function(){this._origin=this._table,this._table=jn(this._origin)},n.prototype.abort=function(){this._table=jn(this._origin)},n}(),th=function(){return typeof document<"u"&&typeof navigator<"u"&&navigator.product!=="ReactNative"},s0=function(){var n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(t==="x"?e:3&e|8).toString(16)})};(function(n){n[n.PROCESSING=0]="PROCESSING",n[n.DONE=1]="DONE"})(Oc||(Oc={})),function(n){n.NEWNODE="newnode",n.REMOVENODE="removenode",n.CLAIM_HOST="claimhost",n.SYNC_HOST="synchost",n.REQUEST_LOCK="requestlock",n.ACQUIRE_LOCK="acquirelock",n.RELEASE_LOCK="releaselock"}(Sn||(Sn={}));var oi,Qf={},$_=function(){function n(t,e){e===void 0&&(e={});var r=this;return this._state=Oc.PROCESSING,this._queue=[],this._activationQueue=[],Qf[t]&&!e.forceCreate||(this.nodeId=s0(),this.key=t,th()&&(e.startAsInvisible?this.registerNode():document.visibilityState==="visible"?this.claimHost():this.registerNode(),document.addEventListener("visibilitychange",function(){document.visibilityState==="visible"&&r.claimHost()}),window.addEventListener("message",function(i){var s,a,o=i.data,u=o.nodeId,c=o.requestId,l=o.key,d=o.op,h=o.data;if(u!==r.nodeId&&l===r.key)switch(d){case Sn.NEWNODE:r._sendSync();break;case Sn.CLAIM_HOST:r._sendSync(),r._hostId=u;break;case Sn.SYNC_HOST:if(!r.isInSync){r._activationTimeout&&clearTimeout(r._activationTimeout);var f=h,p=f.currentItemRequestId,_=f.queue,m=function(T){var N=r._queue.findIndex(function(C){return C.requestId===T.requestId});N<0&&r._requestLock({nodeId:T.nodeId,requestId:T.requestId,key:r.key,op:Sn.REQUEST_LOCK,ts:T.ts})};try{for(var b=ke(_),y=b.next();!y.done;y=b.next())m(y.value)}catch(T){s={error:T}}finally{try{y&&!y.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}r._currentItem=r._queue.find(function(T){return T.requestId===p}),r._completeSync()}break;case Sn.REMOVENODE:r._queue=r._queue.filter(function(T){return T.nodeId!==o.nodeId}),r._currentItem&&r._currentItem.nodeId===o.nodeId&&(r._currentItem=void 0,r._acquire(r._queue[0]));break;case Sn.REQUEST_LOCK:r._requestLock(o);break;case Sn.ACQUIRE_LOCK:var E=r._queue.find(function(T){return T.requestId===c});r._acquire(E);break;case Sn.RELEASE_LOCK:r._release(c)}}),window.addEventListener("beforeunload",function(){r._send(Sn.REMOVENODE)})),Qf[t]=this),Qf[t]}return Object.defineProperty(n.prototype,"locked",{get:function(){return!!this._currentItem},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isHost",{get:function(){return this._hostId===this.nodeId},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isInSync",{get:function(){return this._state==Oc.DONE},enumerable:!1,configurable:!0}),n.prototype._send=function(t,e){var r;e===void 0&&(e={});var i={nodeId:this.nodeId,requestId:(r=e==null?void 0:e.requestId)!==null&&r!==void 0?r:s0(),key:this.key,op:t,data:e.data,ts:Date.now()};return th()&&window.postMessage(i,"*"),i},n.prototype._acquire=function(t){t?(this._currentItem=t,this._currentItem.onAcquired&&this._currentItem.onAcquired(t.requestId)):this._currentItem=void 0},n.prototype._release=function(t){if(this._currentItem&&this._currentItem.requestId===t){var e=this._currentItem;this._currentItem=void 0,e.nodeId===this.nodeId&&this._send(Sn.RELEASE_LOCK,{requestId:e.requestId});var r=this._queue.findIndex(function(i){return i.requestId===t});r>-1&&this._queue.splice(r,1),e.onReleased&&e.onReleased(t)}},n.prototype._requestLock=function(t){var e=this;return new Promise(function(r){var i={nodeId:t.nodeId,requestId:t.requestId,ts:t.ts,onAcquired:function(o){e.isHost&&e._send(Sn.ACQUIRE_LOCK,{requestId:o}),r()},onReleased:function(){e._acquire(e._queue[0])}},s=!1;for(var a in e._queue)if(e._queue[a].ts>i.ts){e._queue.splice(parseInt(a),0,i),s=!0;break}s||e._queue.push(i),e._currentItem||e._acquire(e._queue[0])})},n.prototype._sendSync=function(){var t;this.isHost&&this._send(Sn.SYNC_HOST,{data:{currentItemRequestId:(t=this._currentItem)===null||t===void 0?void 0:t.requestId,queue:this._queue.map(function(e){return{nodeId:e.nodeId,requestId:e.requestId,ts:e.ts}})}})},n.prototype._waitUntilSyncCompleted=function(){return S(this,void 0,void 0,function(){var t=this;return I(this,function(e){return this.isHost&&!this.isInSync?[2,new Promise(function(r){t._activationQueue.push(r)})]:[2]})})},n.prototype._waitSync=function(){var t=this;this.isInSync||(this._activationTimeout=setTimeout(function(){t._completeSync()},8))},n.prototype._completeSync=function(){this.isInSync||(this._state=Oc.DONE,this._activationQueue.forEach(function(t){return t()}),this._activationQueue=[])},n.prototype.registerNode=function(){this._send(Sn.NEWNODE),this._waitSync()},n.prototype.claimHost=function(){this._hostId=this.nodeId,this._send(Sn.CLAIM_HOST),this._waitSync()},n.prototype.lock=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return[4,this._waitUntilSyncCompleted()];case 1:return e.sent(),t=this._send(Sn.REQUEST_LOCK),[4,this._requestLock(t)];case 2:return e.sent(),[2]}})})},n.prototype.unlock=function(){var t;!((t=this._currentItem)===null||t===void 0)&&t.requestId&&this._release(this._currentItem.requestId)},n}(),Wf=function(){function n(t){var e=t.dbname,r=t.collectionName,i=t.keyName,s=t.keyHash,a=t.indexes,o=t.store,u=this;this._state=to.INIT,this._indexers=[],this.dbname=e,this.name=r,this.keyName=i,this.indexes=Ve([[i]],Re(a.filter(function(c){return Zs.createKey(c)!==u.keyName})),!1),this._keyHash=s,this._store=o,this._mutex=new $_(function(c,l){return"".concat(Eo(c,l),".lock")}(e,r)),this._blobContainer=new oD({dbname:e,collectionName:r,store:o}),this._transaction=new uD({dbname:e,collectionName:r,store:o})}return n.metadataOf=function(t,e,r){return S(this,void 0,void 0,function(){var i;return I(this,function(s){switch(s.label){case 0:return i=Kf(t,e),[4,r.get(i)];case 1:return[2,s.sent()]}})})},Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isReady",{get:function(){return this._state===to.READY},enumerable:!1,configurable:!0}),n.prototype.init=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c,l,d,h,f,p,_=this;return I(this,function(m){switch(m.label){case 0:return[4,this._mutex.lock()];case 1:m.sent(),m.label=2;case 2:return m.trys.push([2,9,,10]),t=wh.get(this.dbname),[4,n.metadataOf(this.dbname,this.name,this._store)];case 3:return e=m.sent(),this._metadata=e||{keyName:this.keyName,blockLevel:1,blockHashBase:t.blockHashBase,blockHashMultiplier:t.blockHashMultiplier,blockHashConstant:t.blockHashConstant,indexes:this.indexes},[4,this._transaction.init()];case 4:m.sent(),this._blockManager=new cD({dbname:this.dbname,collectionName:this.name,hashFunction:this._keyHash,metadata:this._metadata,transaction:this._transaction,store:this._store}),r=Ve([],Re(this.indexes),!1),i=[],s=r.map(function(b){return Zs.createKey(b)}),a=e?e.indexes.map(function(b){return Zs.createKey(b)}):[];try{for(o=ke(a),u=o.next();!u.done;u=o.next())c=u.value,s.includes(c)||i.push(Zs.parseKey(c))}catch(b){f={error:b}}finally{try{u&&!u.done&&(p=o.return)&&p.call(o)}finally{if(f)throw f.error}}return(l=[]).push.apply(l,Ve([],Re(r.map(function(b){var y=new Zs({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:b,transaction:_._transaction,store:_._store});return _._indexers.push(y),y.ensure()})),!1)),l.push.apply(l,Ve([],Re(i.map(function(b){return new Zs({dbname:_.dbname,collectionName:_.name,keyName:_.keyName,fields:b,transaction:_._transaction,store:_._store}).drop()})),!1)),[4,Promise.all(l)];case 5:return m.sent(),[4,this._transaction.commit()];case 6:return m.sent(),s.sort().join(",")===a.sort().join(",")?[3,8]:(d=Kf(this.dbname,this.name),this._metadata.indexes=r,[4,this._store.set({key:d,value:this._metadata})]);case 7:m.sent(),m.label=8;case 8:return this._state=to.READY,this._mutex.unlock(),[3,10];case 9:throw h=m.sent(),this._mutex.unlock(),h;case 10:return[2]}})})},n.prototype.close=function(){this._state=to.CLOSED},n.prototype._hasPropertyOfKeyName=function(t){var e=t[this.keyName];return typeof e=="string"&&!!e},n.prototype._getIndexerBy=function(t){var e,r;t===void 0&&(t=null),t||(t=[this.keyName]);var i=Zs.createKey(t);try{for(var s=ke(this._indexers),a=s.next();!a.done;a=s.next()){var o=a.value;if(i===Zs.createKey(o.fields))return o}}catch(u){e={error:u}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}throw He.indexTableIsRequired},n.prototype._upgradeBlockLevel=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return t=Kf(this.dbname,this.name),this._metadata.blockLevel++,[4,this._store.set({key:t,value:this._metadata})];case 1:return e.sent(),[2]}})})},n.prototype._requestInsert=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return u.sent()?[3,13]:[4,this._blockManager.putToBlock(e,t)];case 2:return u.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return u.sent(),[4,this._blockManager.putToBlock(e,t)];case 4:u.sent(),u.label=5;case 5:u.trys.push([5,10,11,12]),r=ke(this._indexers),i=r.next(),u.label=6;case 6:return i.done?[3,9]:[4,i.value.addItem(t)];case 7:u.sent(),u.label=8;case 8:return i=r.next(),[3,6];case 9:return[3,12];case 10:return s=u.sent(),a={error:s},[3,12];case 11:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 12:return[3,14];case 13:throw He.collectionInsertDuplicate;case 14:return[2]}})})},n.prototype._requestUpsert=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h,f,p;return I(this,function(_){switch(_.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return(r=_.sent())?[3,13]:[4,this._blockManager.putToBlock(e,t)];case 2:return _.sent()?[3,5]:[4,this._upgradeBlockLevel()];case 3:return _.sent(),[4,this._blockManager.putToBlock(e,t)];case 4:_.sent(),_.label=5;case 5:_.trys.push([5,10,11,12]),i=ke(this._indexers),s=i.next(),_.label=6;case 6:return s.done?[3,9]:[4,(c=s.value).addItem(t)];case 7:_.sent(),_.label=8;case 8:return s=i.next(),[3,6];case 9:return[3,12];case 10:return a=_.sent(),d={error:a},[3,12];case 11:try{s&&!s.done&&(h=i.return)&&h.call(i)}finally{if(d)throw d.error}return[7];case 12:return[3,23];case 13:return[4,this._blockManager.putToBlock(e,t)];case 14:_.sent(),_.label=15;case 15:_.trys.push([15,21,22,23]),o=ke(this._indexers),u=o.next(),_.label=16;case 16:return u.done?[3,20]:(c=u.value).diff(c.getColumnValues(r),c.getColumnValues(t))===0?[3,19]:[4,c.removeItem(r)];case 17:return _.sent(),[4,c.addItem(t)];case 18:_.sent(),_.label=19;case 19:return u=o.next(),[3,16];case 20:return[3,23];case 21:return l=_.sent(),f={error:l},[3,23];case 22:try{u&&!u.done&&(p=o.return)&&p.call(o)}finally{if(f)throw f.error}return[7];case 23:return[2]}})})},n.prototype._requestUpdate=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:return e=t[this.keyName],[4,this._blockManager.getFromBlock(e)];case 1:return(r=l.sent())?[4,this._blockManager.putToBlock(e,t)]:[3,11];case 2:l.sent(),l.label=3;case 3:l.trys.push([3,9,10,11]),i=ke(this._indexers),s=i.next(),l.label=4;case 4:return s.done?[3,8]:(a=s.value).diff(a.getColumnValues(r),a.getColumnValues(t))===0?[3,7]:[4,a.removeItem(r)];case 5:return l.sent(),[4,a.addItem(t)];case 6:l.sent(),l.label=7;case 7:return s=i.next(),[3,4];case 8:return[3,11];case 9:return o=l.sent(),u={error:o},[3,11];case 10:try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 11:return[2]}})})},n.prototype._requestRemove=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return[4,this._blockManager.getFromBlock(t)];case 1:return(e=u.sent())?[4,this._blockManager.removeFromBlock(t)]:[3,10];case 2:u.sent(),u.label=3;case 3:u.trys.push([3,8,9,10]),r=ke(this._indexers),i=r.next(),u.label=4;case 4:return i.done?[3,7]:[4,i.value.removeItem(e)];case 5:u.sent(),u.label=6;case 6:return i=r.next(),[3,4];case 7:return[3,10];case 8:return s=u.sent(),a={error:s},[3,10];case 9:try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}return[7];case 10:return[2]}})})},n.prototype._requestClear=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s;return I(this,function(a){switch(a.label){case 0:return[4,this._blockManager.clearAllBlocks()];case 1:a.sent(),a.label=2;case 2:a.trys.push([2,7,8,9]),t=ke(this._indexers),e=t.next(),a.label=3;case 3:return e.done?[3,6]:[4,e.value.clear()];case 4:a.sent(),a.label=5;case 5:return e=t.next(),[3,3];case 6:return[3,9];case 7:return r=a.sent(),i={error:r},[3,9];case 8:try{e&&!e.done&&(s=t.return)&&s.call(t)}finally{if(i)throw i.error}return[7];case 9:return[2]}})})},n.prototype.getByKey=function(t){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,6];case 1:i.sent(),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this._blockManager.getFromBlock(t)];case 3:return e=i.sent(),this._mutex.unlock(),[2,jn(e)];case 4:throw r=i.sent(),this._mutex.unlock(),r;case 5:return[3,7];case 6:throw He.collectionNotReady;case 7:return[2]}})})},n.prototype.query=function(t){if(t===void 0&&(t={}),this.isReady)return new aD({condition:t.where,mutex:this._mutex,blockManager:this._blockManager,indexer:this._getIndexerBy(t.index),backward:!!t.backward});throw He.collectionNotReady},n.prototype.insertOne=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw He.collectionKeyNotGiven;return[4,this._requestInsert(jn(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw He.collectionNotReady;case 9:return[2]}})})},n.prototype.insertMany=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c=this;return I(this,function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),t.some(function(d){return!c._hasPropertyOfKeyName(d)}))throw He.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),e=ke(t),r=e.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._requestInsert(jn(i))]);case 5:l.sent(),l.label=6;case 6:return r=e.next(),[3,4];case 7:return[3,10];case 8:return s=l.sent(),o={error:s},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(o)throw o.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,t];case 12:return a=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),a;case 14:return[3,16];case 15:throw He.collectionNotReady;case 16:return[2]}})})},n.prototype.upsertOne=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw He.collectionKeyNotGiven;return[4,this._requestUpsert(jn(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw He.collectionNotReady;case 9:return[2]}})})},n.prototype.upsertMany=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c=this;return I(this,function(l){switch(l.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:l.sent(),l.label=2;case 2:if(l.trys.push([2,12,,14]),t.some(function(d){return!c._hasPropertyOfKeyName(d)}))throw He.collectionKeyNotGiven;l.label=3;case 3:l.trys.push([3,8,9,10]),e=ke(t),r=e.next(),l.label=4;case 4:return r.done?[3,7]:(i=r.value,[4,this._requestUpsert(jn(i))]);case 5:l.sent(),l.label=6;case 6:return r=e.next(),[3,4];case 7:return[3,10];case 8:return s=l.sent(),o={error:s},[3,10];case 9:try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(o)throw o.error}return[7];case 10:return[4,this._transaction.commit()];case 11:return l.sent(),this._mutex.unlock(),[2,t];case 12:return a=l.sent(),[4,this._transaction.clear()];case 13:throw l.sent(),this._mutex.unlock(),a;case 14:return[3,16];case 15:throw He.collectionNotReady;case 16:return[2]}})})},n.prototype.update=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:if(r.trys.push([2,5,,7]),!this._hasPropertyOfKeyName(t))throw He.collectionKeyNotGiven;return[4,this._requestUpdate(jn(t))];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[2,t];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw He.collectionNotReady;case 9:return[2]}})})},n.prototype.updateIf=function(t,e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h,f,p,_,m,b=this;return I(this,function(y){switch(y.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,16];case 1:y.sent(),y.label=2;case 2:return y.trys.push([2,13,,15]),r=t.where,i=r===void 0?{}:r,s=t.index,a=s===void 0?null:s,o=t.backward,u=o!==void 0&&o,c=[],[4,new i_({condition:i,blockManager:this._blockManager,backward:u,indexer:this._getIndexerBy(a)}).each(function(E){return S(b,void 0,void 0,function(){var T,N;return I(this,function(C){if(E.error)throw E.stop(),E.error;if(E.hasNext){if(T=E.nextValue,lo(i,T)&&e.set){if(typeof e.set!="function")for(N in e.set)T[N]=e.set[N];else e.set(T);c.push(T)}E.next()}else E.stop();return[2]})})})];case 3:y.sent(),y.label=4;case 4:y.trys.push([4,9,10,11]),l=ke(c),d=l.next(),y.label=5;case 5:return d.done?[3,8]:(h=d.value,[4,this._requestUpdate(jn(h))]);case 6:y.sent(),y.label=7;case 7:return d=l.next(),[3,5];case 8:return[3,11];case 9:return f=y.sent(),_={error:f},[3,11];case 10:try{d&&!d.done&&(m=l.return)&&m.call(l)}finally{if(_)throw _.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return y.sent(),this._mutex.unlock(),[2,c];case 13:return p=y.sent(),[4,this._transaction.clear()];case 14:throw y.sent(),this._mutex.unlock(),p;case 15:return[3,17];case 16:throw this._transaction.clear(),He.collectionNotReady;case 17:return[2]}})})},n.prototype.remove=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,5,,7]),[4,this._requestRemove(t)];case 3:return r.sent(),[4,this._transaction.commit()];case 4:return r.sent(),this._mutex.unlock(),[3,7];case 5:return e=r.sent(),[4,this._transaction.clear()];case 6:throw r.sent(),this._mutex.unlock(),e;case 7:return[3,9];case 8:throw He.collectionNotReady;case 9:return[2]}})})},n.prototype.removeIf=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d,h,f,p,_,m=this;return I(this,function(b){switch(b.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,15];case 1:b.sent(),b.label=2;case 2:return b.trys.push([2,13,,14]),e=t.where,r=e===void 0?{}:e,i=t.index,s=i===void 0?null:i,a=t.backward,o=a!==void 0&&a,u=[],[4,new i_({condition:r,blockManager:this._blockManager,backward:o,indexer:this._getIndexerBy(s)}).each(function(y){return S(m,void 0,void 0,function(){var E,T;return I(this,function(N){if(y.error)throw y.stop(),y.error;return y.hasNext?(E=y.nextValue,lo(r,E)&&(T=E[this.keyName],u.push(T)),y.next()):y.stop(),[2]})})})];case 3:b.sent(),b.label=4;case 4:b.trys.push([4,9,10,11]),c=ke(u),l=c.next(),b.label=5;case 5:return l.done?[3,8]:(d=l.value,[4,this._requestRemove(d)]);case 6:b.sent(),b.label=7;case 7:return l=c.next(),[3,5];case 8:return[3,11];case 9:return h=b.sent(),p={error:h},[3,11];case 10:try{l&&!l.done&&(_=c.return)&&_.call(c)}finally{if(p)throw p.error}return[7];case 11:return[4,this._transaction.commit()];case 12:return b.sent(),this._mutex.unlock(),[2,u];case 13:throw f=b.sent(),this._mutex.unlock(),f;case 14:return[3,16];case 15:throw this._transaction.clear(),He.collectionNotReady;case 16:return[2]}})})},n.prototype.clear=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return this.isReady?[4,this._mutex.lock()]:[3,8];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,5,,7]),[4,this._requestClear()];case 3:return e.sent(),[4,this._transaction.commit()];case 4:return e.sent(),this._mutex.unlock(),[3,7];case 5:return t=e.sent(),[4,this._transaction.clear()];case 6:throw e.sent(),this._mutex.unlock(),t;case 7:return[3,9];case 8:throw He.collectionNotReady;case 9:return[2]}})})},n.prototype.getBlob=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.get(t)];case 1:return[2,e.sent()]}})})},n.prototype.saveBlob=function(t,e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return[4,this._blobContainer.save(t,e)];case 1:return[2,r.sent()]}})})},n.prototype.removeBlob=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,this._blobContainer.remove(t)];case 1:return e.sent(),[2]}})})},n.prototype.removeAllBlobs=function(){return S(this,void 0,void 0,function(){return I(this,function(t){switch(t.label){case 0:return[4,this._blobContainer.clear()];case 1:return t.sent(),[2]}})})},n}(),Yf="[NESTDB]",td=!0,Fa=function(){function n(){}return n.off=function(){td=!1},n.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];td&&console.log.apply(console,Ve(["".concat(Yf,"[LOG]")],Re(t),!1))},n.warning=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];td&&console.warn.apply(console,Ve(["".concat(Yf,"[WARNING]")],Re(t),!1))},n.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];td&&console.error.apply(console,Ve(["".concat(Yf,"[ERROR]")],Re(t),!1))},n}(),lD=[{},{a:700400,n:"error"}],Ih=function(){function n(t){var e,r,i;this.encryption=(e=t.encryption)!==null&&e!==void 0?e:yE,this.itemSizeLimit=(r=t.itemSizeLimit)!==null&&r!==void 0?r:4194304,this.metadataBuffer=(i=t.metadataBuffer)!==null&&i!==void 0?i:256}return Object.defineProperty(n.prototype,"_encryptionCheckKey",{get:function(){return"".concat(this.dbname,".encrypt")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_reservedKeys",{get:function(){return[this._encryptionCheckKey]},enumerable:!1,configurable:!0}),n.prototype._getRawKey=function(t,e){return e===void 0&&(e=""),"".concat(t).concat(e)},n.prototype._generateShardPostfixArray=function(t){return t===void 0&&(t=1),Ve([],Re(Array(t).keys()),!1)},n.prototype._shardify=function(t){var e=this,r=t.key,i=t.value,s=JSON.stringify(this.encryption.encrypt(i)),a=Math.ceil(s.length/this.adjustedItemSizeLimit);return this._generateShardPostfixArray(a).map(function(o){var u={key:e._getRawKey(r,".".concat(o)),data:s.substring(o*e.adjustedItemSizeLimit,(o+1)*e.adjustedItemSizeLimit)};return o===0&&(u.metadata={shards:a}),u})},n.prototype._resetIfEncryptionChanged=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c,l=this;return I(this,function(d){switch(d.label){case 0:return[4,this.get(this._encryptionCheckKey)];case 1:if(t=d.sent(),e={encrypted:lD.map(function(h){var f;return(f=l.encryption)===null||f===void 0?void 0:f.encrypt(h)})},!(t&&t.encrypted&&Array.isArray(t.encrypted)))return[3,5];for(s in r=t.encrypted,i=[],r)i.push(s);a=0,d.label=2;case 2:return a<i.length?(s=i[a])in r?(o=s,u=JSON.stringify(t.encrypted[o]),c=JSON.stringify(e.encrypted[o]),u===c?[3,4]:(Fa.warning("Encryption algorithm has changed. Stored data would be cleared."),[4,this.clear()])):[3,4]:[3,5];case 3:return d.sent(),[3,5];case 4:return a++,[3,2];case 5:return[4,this.set({key:this._encryptionCheckKey,value:e})];case 6:return d.sent(),[2]}})})},Object.defineProperty(n.prototype,"adjustedItemSizeLimit",{get:function(){return Math.max(this.itemSizeLimit-this.metadataBuffer,4)},enumerable:!1,configurable:!0}),n.prototype.usage=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:return t=0,[4,this._getAllRawKeys()];case 1:e=l.sent(),l.label=2;case 2:l.trys.push([2,7,8,9]),r=ke(e),i=r.next(),l.label=3;case 3:return i.done?[3,6]:(s=i.value,[4,this._getRaw(s)]);case 4:(a=l.sent())&&(t+=JSON.stringify(a).length),l.label=5;case 5:return i=r.next(),[3,3];case 6:return[3,9];case 7:return o=l.sent(),u={error:o},[3,9];case 8:try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}return[7];case 9:return[2,t]}})})},n.prototype.getAllKeys=function(){return S(this,void 0,void 0,function(){var t=this;return I(this,function(e){switch(e.label){case 0:return[4,this._getAllRawKeys()];case 1:return[2,e.sent().filter(function(r){return r.endsWith(".0")}).map(function(r){return r.replace(/\.0$/,"")}).filter(function(r){return!t._reservedKeys.includes(r)})]}})})},n.prototype.get=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u=this;return I(this,function(c){switch(c.label){case 0:return e=this._getRawKey(t,".0"),[4,this._getRaw(e)];case 1:if(!(r=c.sent()))return[3,7];c.label=2;case 2:return c.trys.push([2,6,,7]),i=r.data,(s=r.metadata)!=null&&s.shards&&s.shards>1?[4,Promise.all(this._generateShardPostfixArray(s==null?void 0:s.shards).map(function(l){return S(u,void 0,void 0,function(){var d,h;return I(this,function(f){switch(f.label){case 0:return l>0?(d=this._getRawKey(t,".".concat(l)),[4,this._getRaw(d)]):[3,2];case 1:if(!(h=f.sent()))throw He.storeBrokenIntegrity;return[2,h.data];case 2:return[2,i]}})})}))]:[3,4];case 3:return o=c.sent(),[3,5];case 4:o=[i],c.label=5;case 5:return a=o,[2,this.encryption.decrypt(JSON.parse(a.join("")))];case 6:return c.sent(),[2,null];case 7:return[2,null]}})})},n.prototype.set=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return e=this._shardify(t),[4,this._setRaw(e)];case 1:return r.sent(),[2,P({},t.value)]}})})},n.prototype.setMany=function(t){return S(this,void 0,void 0,function(){var e,r=this;return I(this,function(i){switch(i.label){case 0:return e=[],[4,this._setRaw(e.concat.apply(e,Ve([],Re(t.map(function(s){return r._shardify(s)})),!1)))];case 1:return i.sent(),[2,t.map(function(s){return s.value})]}})})},n.prototype.remove=function(t){return S(this,void 0,void 0,function(){var e,r,i,s=this;return I(this,function(a){switch(a.label){case 0:return e=this._getRawKey(t,".0"),[4,this._getRaw(e)];case 1:return(r=a.sent())?(i=r.metadata,[4,this._removeRaw(this._generateShardPostfixArray(i==null?void 0:i.shards).map(function(o){return s._getRawKey(t,".".concat(o))}))]):[3,3];case 2:return a.sent(),[2,!0];case 3:return[2,!1]}})})},n.prototype.removeMany=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l,d=this;return I(this,function(h){switch(h.label){case 0:e=[],r=function(f){var p,_,m;return I(this,function(b){switch(b.label){case 0:return p=i._getRawKey(f,".0"),[4,i._getRaw(p)];case 1:return(_=b.sent())&&(m=_.metadata,e.push.apply(e,Ve([],Re(i._generateShardPostfixArray(m==null?void 0:m.shards).map(function(y){return d._getRawKey(f,".".concat(y))})),!1))),[2]}})},i=this,h.label=1;case 1:h.trys.push([1,6,7,8]),s=ke(t),a=s.next(),h.label=2;case 2:return a.done?[3,5]:(o=a.value,[5,r(o)]);case 3:h.sent(),h.label=4;case 4:return a=s.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),c={error:u},[3,8];case 7:try{a&&!a.done&&(l=s.return)&&l.call(s)}finally{if(c)throw c.error}return[7];case 8:return e.length>0?[4,this._removeRaw(e)]:[3,10];case 9:h.sent(),h.label=10;case 10:return[2,t]}})})},n}(),Vn={},jo=function(n){function t(e){e===void 0&&(e={});var r,i=this;i=n.call(this,P(P({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:4194304}))||this;var s=e.delay,a=s===void 0?1:s;return i.delay=a,i.observer={},i}return D(t,n),Object.defineProperty(t.prototype,"rawData",{get:function(){return Vn[this.dbname]},set:function(e){Vn[this.dbname]=e},enumerable:!1,configurable:!0}),t.prototype._getAllRawKeys=function(){return S(this,void 0,void 0,function(){return I(this,function(e){if(Vn[this.dbname])return[2,Object.keys(Vn[this.dbname])];throw He.storeNotAvailable})})},t.prototype._getRaw=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return Vn[this.dbname]?[4,Xl(this.delay)]:[3,2];case 1:return r.sent(),[2,Vn[this.dbname][e]?P({key:e},Vn[this.dbname][e]):null];case 2:throw He.storeNotAvailable}})})},t.prototype._setRaw=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l;return I(this,function(d){switch(d.label){case 0:return Vn[this.dbname]?[4,Xl(this.delay)]:[3,2];case 1:d.sent();try{for(r=ke(e),i=r.next();!i.done;i=r.next())s=i.value,a=s.key,o=s.data,u=s.metadata,Vn[this.dbname][a]=Object.freeze({data:o,metadata:u})}catch(h){c={error:h}}finally{try{i&&!i.done&&(l=r.return)&&l.call(r)}finally{if(c)throw c.error}}return[3,3];case 2:throw He.storeNotAvailable;case 3:return[2]}})})},t.prototype._removeRaw=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return Vn[this.dbname]?[4,Xl(this.delay)]:[3,2];case 1:u.sent();try{for(r=ke(e),i=r.next();!i.done;i=r.next())s=i.value,Vn[this.dbname][s]&&delete Vn[this.dbname][s]}catch(c){a={error:c}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}}return[3,3];case 2:throw He.storeNotAvailable;case 3:return[2]}})})},t.prototype.observe=function(e,r,i){var s=this;this.observer[e]||(this.observer[e]={}),r.forEach(function(a){return s.observer[e][a]=i})},t.prototype.checkAvailability=function(){return S(this,void 0,void 0,function(){return I(this,function(e){return[2]})})},t.prototype.init=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return this.dbname=e,Vn[this.dbname]||(Vn[this.dbname]={}),[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.set=function(e){return S(this,void 0,void 0,function(){var r,i;return I(this,function(s){if((r=this.observer[e.key])&&typeof r.set=="function"&&(i=r.set()))throw i;return[2,n.prototype.set.call(this,e)]})})},t.prototype.setMany=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return I(this,function(l){try{for(r=ke(e),i=r.next();!i.done;i=r.next())if(s=i.value,(a=this.observer[s.key])&&typeof a.set=="function"&&(o=a.set()))throw o}catch(d){u={error:d}}finally{try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(u)throw u.error}}return[2,n.prototype.setMany.call(this,e)]})})},t.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return[4,Xl(this.delay)];case 1:return e.sent(),Vn[this.dbname]={},[2]}})})},t}(Ih),a0="NestDBStore";(function(n){n[n.UNINITIALIZED=0]="UNINITIALIZED",n[n.OPENING=1]="OPENING",n[n.OPEN=2]="OPEN",n[n.CLOSED=3]="CLOSED"})(oi||(oi={}));var dD=function(n){function t(e){e===void 0&&(e={});var r,i=this;return(i=n.call(this,P(P({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:104857600}))||this)._storeName=a0,i._state=oi.UNINITIALIZED,i._openJobQueue=[],i._window=typeof window<"u"?window:void 0,i._indexedDb=i._window?i._window.indexedDB||i._window.mozIndexedDB||i._window.webkitIndexedDB||i._window.msIndexedDB:void 0,i}return D(t,n),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype._openDatabase=function(e){var r=this;return new Promise(function(i,s){if(r._indexedDb){r._state=oi.OPENING;var a=r._indexedDb.open(e);a.addEventListener("upgradeneeded",function(o){o.target.result.createObjectStore(a0,{keyPath:"key"})}),a.addEventListener("success",function(o){r._state=oi.OPEN,r._database=o.target.result,r._openJobQueue.forEach(function(u){return u()}),r._openJobQueue=[],r._database.onclose=function(){r._database=void 0,r._state=oi.OPENING,setTimeout(function(){r._openDatabase(e)},5)},i(r._database)}),a.addEventListener("error",function(o){r._state=oi.UNINITIALIZED,s(o.target.error)})}else s(He.storeNotAvailable)})},t.prototype._getObjectStore=function(e){return S(this,void 0,void 0,function(){var r=this;return I(this,function(i){switch(i.label){case 0:return this._database?[2,this._database.transaction(this._storeName,e).objectStore(this._storeName)]:[3,1];case 1:switch(this._state){case oi.UNINITIALIZED:case oi.OPEN:return[3,2];case oi.OPENING:case oi.CLOSED:return[3,3]}return[3,4];case 2:throw He.storeNotInitialized;case 3:return[2,new Promise(function(s){r._openJobQueue.push(function(){return s(r._getObjectStore(e))})})];case 4:return[4,this._getObjectStore(e)];case 5:return[2,i.sent()]}})})},t.prototype._getAllRawKeys=function(){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return e=r.sent(),[4,new Promise(function(i,s){var a=e.getAllKeys();a.addEventListener("success",function(o){i(o.target.result)}),a.addEventListener("error",function(o){return s(o.target.error)})})];case 2:return[2,r.sent()]}})})},t.prototype._getRaw=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return[4,this._getObjectStore("readonly")];case 1:return r=i.sent(),[4,new Promise(function(s,a){var o=r.get(e);o.addEventListener("success",function(u){var c;s((c=u==null?void 0:u.target)===null||c===void 0?void 0:c.result)}),o.addEventListener("error",function(u){return a(u.target.error)})})];case 2:return[2,i.sent()]}})})},t.prototype._setRaw=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return r=i.sent(),[4,Promise.all(e.map(function(s){return new Promise(function(a,o){var u=r.put(s);u.addEventListener("success",function(c){a(c.target.result)}),u.addEventListener("error",function(){o("Failed to write.")})})}))];case 2:return i.sent(),[2]}})})},t.prototype._removeRaw=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return r=i.sent(),[4,Promise.all(e.map(function(s){return new Promise(function(a,o){var u=r.delete(s);u.addEventListener("success",function(){return a(s)}),u.addEventListener("error",function(c){return o(c.target.error)})})}))];case 2:return i.sent(),[2]}})})},t.prototype._triggerDatabaseClose=function(){this._database&&this._database.onclose&&this._database.onclose(new Event("dummy"))},t.prototype.checkAvailability=function(){return S(this,void 0,void 0,function(){var e,r=this;return I(this,function(i){switch(i.label){case 0:if(!((e=typeof window<"u"?window:null)!=null&&e.indexedDB||e!=null&&e.mozIndexedDB||e!=null&&e.webkitIndexedDB||e!=null&&e.msIndexedDB))return[3,6];if(this._indexedDb=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,!this._window||!th())return[3,4];if(!(th()&&navigator.userAgent&&navigator.userAgent.includes("Edge/")))return[3,1];if(!this._window.indexedDB&&(e.PointerEvent||e.MSPointerEvent))throw He.storeNotAvailableInPrivateBrowsing;return[3,3];case 1:return[4,new Promise(function(s,a){if(r._indexedDb)try{var o=r._indexedDb.open("_testMozilla");o.onerror=function(){return a(He.storeNotAvailableInPrivateBrowsing)},o.onsuccess=function(){return s()}}catch{a(He.storeNotAvailableInPrivateBrowsing)}else a(He.storeNotAvailable)})];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:throw He.storeNotAvailable;case 5:return[3,7];case 6:throw He.storeNotAvailable;case 7:return[2]}})})},t.prototype.init=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this.checkAvailability()];case 1:return r.sent(),[4,this._openDatabase(e)];case 2:return r.sent(),[4,this._resetIfEncryptionChanged()];case 3:return r.sent(),[2]}})})},t.prototype.clear=function(){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return[4,this._getObjectStore("readwrite")];case 1:return e=r.sent(),[4,new Promise(function(i,s){var a=e.clear();a.addEventListener("success",function(){return i()}),a.addEventListener("error",function(o){return s(o.target.error)})})];case 2:return[2,r.sent()]}})})},t}(Ih),hD=function(n){function t(e){var r=this,i=e.AsyncStorage,s=e.itemSizeLimit,a=s===void 0?6291456:s,o=fk(e,["AsyncStorage","itemSizeLimit"]);return(r=n.call(this,P(P({},o),{itemSizeLimit:a}))||this)._asyncStorage=i,r}return D(t,n),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return S(this,void 0,void 0,function(){var e,r=this;return I(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.getAllKeys()];case 1:return e=i.sent(),[2,e.filter(function(s){return r._isBelonging(s)}).map(function(s){return s.substring("".concat(r.dbname,"/").length)})]}})})},t.prototype._getRaw=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.getItem(this._getActualKey(e))];case 1:return[2,(r=i.sent())?JSON.parse(r):null]}})})},t.prototype._setRaw=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:r=[];try{for(i=ke(e),s=i.next();!s.done;s=i.next())a=s.value,o=a.key,a.data.length<=this.adjustedItemSizeLimit&&r.push([this._getActualKey(o),JSON.stringify(a)])}catch(d){u={error:d}}finally{try{s&&!s.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}}return[4,this._asyncStorage.multiSet(r)];case 1:return l.sent(),[2]}})})},t.prototype._removeRaw=function(e){return S(this,void 0,void 0,function(){var r=this;return I(this,function(i){switch(i.label){case 0:return[4,this._asyncStorage.multiRemove(e.map(function(s){return r._getActualKey(s)}))];case 1:return i.sent(),[2]}})})},t.prototype.checkAvailability=function(){return S(this,void 0,void 0,function(){return I(this,function(e){if(!this._asyncStorage)throw He.storeNotAvailable;return[2]})})},t.prototype.init=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.clear=function(){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return[4,this.getAllKeys()];case 1:return e=r.sent(),[4,this.removeMany(e)];case 2:return r.sent(),[2]}})})},t}(Ih);(function(n){function t(e){var r,i=this;return(i=n.call(this,P(P({},e),{itemSizeLimit:(r=e.itemSizeLimit)!==null&&r!==void 0?r:6291456}))||this)._mmkv=e.MMKV,i}D(t,n),t.prototype._isBelonging=function(e){return e.startsWith("".concat(this.dbname,"/"))},t.prototype._getActualKey=function(e){return"".concat(this.dbname,"/").concat(e)},t.prototype._getAllRawKeys=function(){return S(this,void 0,void 0,function(){var e,r=this;return I(this,function(i){switch(i.label){case 0:return[4,this._mmkv.getAllKeys()];case 1:return e=i.sent(),[2,e.filter(function(s){return r._isBelonging(s)}).map(function(s){return s.substring("".concat(r.dbname,"/").length)})]}})})},t.prototype._getRaw=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return[4,this._mmkv.getString(this._getActualKey(e))];case 1:return[2,(r=i.sent())?JSON.parse(r):null]}})})},t.prototype._setRaw=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u;return I(this,function(c){try{for(r=ke(e),i=r.next();!i.done;i=r.next())s=i.value,a=s.key,s.data.length<=this.adjustedItemSizeLimit&&this._mmkv.set(this._getActualKey(a),JSON.stringify(s))}catch(l){o={error:l}}finally{try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}}return[2]})})},t.prototype._removeRaw=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o;return I(this,function(u){try{for(r=ke(e),i=r.next();!i.done;i=r.next())s=i.value,this._mmkv.delete(this._getActualKey(s))}catch(c){a={error:c}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(a)throw a.error}}return[2]})})},t.prototype.checkAvailability=function(){return S(this,void 0,void 0,function(){return I(this,function(e){if(!this._mmkv)throw He.storeNotAvailable;return[2]})})},t.prototype.init=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return this.dbname=e,[4,this._resetIfEncryptionChanged()];case 1:return r.sent(),[2]}})})},t.prototype.clear=function(){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:return[4,this.getAllKeys()];case 1:return e=r.sent(),[4,this.removeMany(e)];case 2:return r.sent(),[2]}})})}})(Ih);var ws;(function(n){n.INIT="INIT",n.OPENING="OPENING",n.OPENED="OPENED",n.CLOSED="CLOSED"})(ws||(ws={}));var pn,fD=function(){function n(t){var e=t.name,r=t.version,i=t.store,s=t.config;this.name=e,this._version=r,this._state=ws.INIT,this._config=s||new wh({dbname:e}),this._store=i,this._event={success:Wu,error:Wu,storeReplaced:Wu,upgrade:n0},this._collections=new Map,this._globalMutex=new $_("".concat(this.name,".lock")),this._config.disableLogger&&Fa.off(),new zr({dbname:e,limit:this._config.cacheLimit})}return Object.defineProperty(n.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"store",{get:function(){return this._store},enumerable:!1,configurable:!0}),n.prototype.estimateUsage=function(){return S(this,void 0,void 0,function(){return I(this,function(t){switch(t.label){case 0:return[4,(e=this._store,S(void 0,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return[4,e.usage()];case 1:return[2,r.sent()]}})}))];case 1:return[2,t.sent()]}var e})})},n.prototype.commitSchema=function(t){return S(this,void 0,void 0,function(){var e=this;return I(this,function(r){switch(r.label){case 0:return this._state!==ws.OPENING?[3,2]:[4,Promise.all(t.map(function(i){return S(e,void 0,void 0,function(){var s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:return s=i.collectionName,a=i.keyName,o=i.index,u=o===void 0?[]:o,this._collections.has(s)||this._collections.set(s,new Wf({dbname:this.name,collectionName:s,keyName:a,indexes:u,store:this._store})),(c=this._collections.get(s))?[4,c.init()]:[3,2];case 1:l.sent(),l.label=2;case 2:return[2]}})})}))];case 1:return r.sent(),[3,3];case 2:throw He.databaseSchemaNotOnUpgrade;case 3:return[2]}})})},n.prototype.open=function(){var t;return S(this,void 0,void 0,function(){var e,r,i,s,a=this;return I(this,function(o){switch(o.label){case 0:return[4,this._globalMutex.lock()];case 1:if(o.sent(),this._state===ws.OPENED)return[3,12];this._state=ws.OPENING,o.label=2;case 2:return o.trys.push([2,5,,12]),[4,this._store.init(this.name)];case 3:return o.sent(),u=this.name,e="".concat(s_(u),".metadata"),r={version:0,collectionNames:[]},[4,this._store.get(e)];case 4:return i=(t=o.sent())!==null&&t!==void 0?t:r,[2,new Promise(function(c,l){var d=function(f){i.version<a._version?a._event.upgrade(i.version,function(p){return S(a,void 0,void 0,function(){var _;return I(this,function(m){switch(m.label){case 0:if(p)return[3,5];i.version++,i.collectionNames=Array.from(this._collections.keys()),m.label=1;case 1:return m.trys.push([1,3,,4]),[4,this._store.set({key:e,value:i})];case 2:return m.sent(),f({continued:!0}),[3,4];case 3:return _=m.sent(),f({continued:!1,err:_}),[3,4];case 4:return[3,6];case 5:f({continued:!1,err:p}),m.label=6;case 6:return[2]}})})}):f({continued:!1})},h=function(f){var p=f.continued,_=p!==void 0&&p,m=f.err,b=m===void 0?null:m;if(_)setTimeout(function(){return d(h)},10);else if(b)Fa.error(b.message),a._globalMutex.unlock(),a._event.error(b),l(b);else{var y=[];i.collectionNames.forEach(function(E){var T=a._collections.get(E);T&&T.state===to.READY||y.push(S(a,void 0,void 0,function(){var N,C;return I(this,function(L){switch(L.label){case 0:return[4,Wf.metadataOf(this.name,E,this._store)];case 1:return(N=L.sent())?(C=new Wf({dbname:this.name,collectionName:E,keyName:N.keyName,indexes:N.indexes,store:this._store}),this._collections.set(E,C),[4,C.init()]):[3,3];case 2:L.sent(),L.label=3;case 3:return[2]}})}))}),Promise.all(y).then(function(){a._state=ws.OPENED,a._globalMutex.unlock(),a._event.success(),c()}).catch(function(E){Fa.error(E.message),a._globalMutex.unlock(),a._event.error(E),l(E)})}};d(h)})];case 5:switch(s=o.sent(),s.code){case pt.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:return[3,6];case pt.STORE_NOT_AVAILABLE:return[3,8]}return[3,10];case 6:return Fa.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."),this._store=new jo({}),this._globalMutex.unlock(),this._event.error(s),this._event.storeReplaced(this._store),[4,this.open()];case 7:return o.sent(),[3,11];case 8:return Fa.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."),this._store=new jo({}),this._globalMutex.unlock(),this._event.error(s),this._event.storeReplaced(this._store),[4,this.open()];case 9:return o.sent(),[3,11];case 10:throw Fa.error(s.message),this._globalMutex.unlock(),this._event.error(s),s;case 11:return[3,12];case 12:return[2]}var u})})},n.prototype.close=function(){this._collections.forEach(function(t){return t.close()}),this._state=ws.CLOSED},n.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(t){switch(t.label){case 0:return[4,Promise.all(Array.from(this._collections.values()).map(function(e){return e.clear()}))];case 1:return t.sent(),[2]}})})},n.prototype.reset=function(){return S(this,void 0,void 0,function(){var t,e=this;return I(this,function(r){switch(r.label){case 0:return this.close(),(t=zr.get(this.name))&&t.clearByCondition(function(i){return i.key.startsWith(s_(e.name))}),[4,this._store.clear()];case 1:return r.sent(),[2]}})})},n.prototype.on=function(t,e){this._event[t]=e},n.prototype.off=function(t){typeof this._event[t]=="function"&&(t==="upgrade"?this._event[t]=n0:this._event[t]=Wu)},n.prototype.collection=function(t){var e=this._collections.get(t);if(e)return e;throw He.collectionNotReady},n}(),nh=function(){function n(){this.messageTypeFilter=Sr.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=Cr.NONE}return n.prototype.clone=function(){var t=new n,e=JSON.parse(JSON.stringify(this));return Object.keys(e).forEach(function(r){t[r]=e[r]}),t},n.prototype.match=function(t){switch(this.messageTypeFilter){case Sr.USER:if(t.messageType!==Ot.USER)return!1;break;case Sr.FILE:if(t.messageType!==Ot.FILE)return!1;break;case Sr.ADMIN:if(t.messageType!==Ot.ADMIN)return!1}if(this.customTypesFilter&&this.customTypesFilter.length>0&&!this.customTypesFilter.includes(t.customType)||this.senderUserIdsFilter&&this.senderUserIdsFilter.length>0&&(!(t instanceof yo)||!this.senderUserIdsFilter.includes(t.sender.userId)))return!1;switch(this.replyType){case Cr.NONE:if(t.parentMessageId>0)return!1;break;case Cr.ONLY_REPLY_TO_CHANNEL:if(t instanceof yo&&t.parentMessageId>0&&!t.replyToChannel)return!1}return!0},n}();(function(n){n.CHANNEL_LATEST="channel_latest",n.NEWEST_CHILD_MESSAGE="newest_child_message"})(pn||(pn={}));var Mc,Cs=function(n){switch(n){case pn.CHANNEL_LATEST:return["channelUrl","-createdAt","-messageId"];case pn.NEWEST_CHILD_MESSAGE:return["channelUrl","-parentMessageId","-createdAt","-messageId"]}};P(P({},ub),{scheduledAt:void 0});P(P({},Th),{scheduledAt:0,file:void 0,fileUrl:void 0,fileName:void 0,mimeType:void 0,fileSize:void 0,thumbnailSizes:void 0,requireAuth:!1});var hb="UnsentMessage",pD="reqId",nd={},al=function(n){function t(e){var r=n.call(this,e)||this;return r._mutex=new $_("unsendmessagecache.lock"),nd[e]=r,r}return D(t,n),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return G.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),t.of=function(e,r){return r===void 0&&(r=!1),nd[e]&&!r||(nd[e]=new t(e)),nd[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb,r=e==null?void 0:e.collection(hb);if(!r)throw H.databaseError;return r},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){if(e.messageId>0)throw H.invalidParameters;var r,i=P({},e.serialize());return e instanceof Qn?(e.messageParams&&(i.messageParams=$g(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(i.scheduledInfo.scheduledMessageParams=(r=e.scheduledInfo.scheduledMessageParams,P(P({},$g(r)),{scheduledAt:r.scheduledAt})))):e instanceof Jt?(e.messageParams&&(i.messageParams=Hg(e.messageParams)),e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(i.scheduledInfo.scheduledMessageParams=function(s){return P(P({},Hg(s)),{scheduledAt:s.scheduledAt})}(e.scheduledInfo.scheduledMessageParams))):e instanceof Vr&&e.messageParams&&(i.messageParams=function(s){return me({fileInfoList:s.fileInfoList,isReplyToChannel:s.isReplyToChannel,pushNotificationDeliveryOption:s.pushNotificationDeliveryOption})}(e.messageParams)),i},t.prototype._deserialize=function(e){return e=P(P({},e),{messageId:parseInt(e.messageId)}),xn.of(this._iid).buildMessageFromSerializedData(e)},t.prototype._deserializeWithMessageCreateParams=function(e){var r,i,s;return S(this,void 0,void 0,function(){var a,o,u,c,l,d,h=this;return I(this,function(f){switch(f.label){case 0:return a=xn.of(this._iid),o=this._deserialize(e),e.messageParams?o instanceof Qn?(c=e.messageParams,o.messageParams=a.buildUserMessageCreateParamsFromSerializedData(c,o),[3,6]):[3,1]:[3,6];case 1:return o instanceof Jt?(c=e.messageParams).fileKey&&typeof c.fileKey=="string"&&Vf((r=c.fileType)!==null&&r!==void 0?r:"")?(u=c,[4,this.collection.getBlob(c.fileKey)]):[3,3]:[3,4];case 2:u.file=(i=f.sent())!==null&&i!==void 0?i:void 0,f.label=3;case 3:return o.messageParams=a.buildFileMessageCreateParamsFromSerializedData(c,o),[3,6];case 4:return o instanceof Vr&&(c=e.messageParams)&&c.fileInfoList?(o.messageParams=a.buildMultipleFilesMessageCreateParamsFromSerializedData(c,o),[4,Promise.all(o.messageParams.fileInfoList.map(function(p){return S(h,void 0,void 0,function(){var _,m,b,y,E;return I(this,function(T){switch(T.label){case 0:return typeof((m=p._uploadedMetaData)===null||m===void 0?void 0:m.fileKey)=="string"&&Vf((y=(b=p._uploadedMetaData)===null||b===void 0?void 0:b.fileType)!==null&&y!==void 0?y:"")?(_=p,[4,this.collection.getBlob(p._uploadedMetaData.fileKey)]):[3,2];case 1:_.file=(E=T.sent())!==null&&E!==void 0?E:void 0,T.label=2;case 2:return[2]}})})}))]):[3,6];case 5:f.sent(),f.label=6;case 6:return o.scheduledInfo&&e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams?o instanceof Qn?(l=e.scheduledInfo.scheduledMessageParams,o.scheduledInfo.scheduledMessageParams=a.buildScheduledUserMessageCreateParamsFromSerializedData(l,o),[3,10]):[3,7]:[3,10];case 7:return o instanceof Jt?(l=e.scheduledInfo.scheduledMessageParams).fileKey&&typeof l.fileKey=="string"&&typeof l.fileType=="string"&&Vf(l.fileType)?(d=l,[4,this.collection.getBlob(l.fileKey)]):[3,9]:[3,10];case 8:d.file=(s=f.sent())!==null&&s!==void 0?s:void 0,f.label=9;case 9:o.scheduledInfo.scheduledMessageParams=a.buildScheduledFileMessageCreateParamsFromSerializedData(l,o),f.label=10;case 10:return[2,o]}})})},t.prototype._getFileInfoBlobKey=function(e,r){return"".concat(e,".").concat(r)},t.prototype.get=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(r=i.sent())return[2,this._deserializeWithMessageCreateParams(r)];i.label=2;case 2:return[2,void 0]}})})},t.prototype.fetch=function(e){var r=e.channelUrl,i=e.filter,s=i===void 0?new nh:i,a=e.order,o=a===void 0?pn.CHANNEL_LATEST:a,u=e.sendingStatus,c=e.backward,l=c!==void 0&&c,d=e.parentMessageId;return S(this,void 0,void 0,function(){var h,f,p,_,m=this;return I(this,function(b){switch(b.label){case 0:return this.localCacheEnabled?(h=Cs(o),f={"/where":function(y){return!!(o!==pn.NEWEST_CHILD_MESSAGE||d&&y.parentMessageId!==0&&y.parentMessageId===d)&&s.match(m._deserialize(y))}},r&&(f.channelUrl=r),u&&(f.sendingStatus=u),p={where:f,index:h,backward:l},[4,this.collection.query(p)]):[3,3];case 1:return[4,b.sent().fetch({})];case 2:return _=b.sent(),[2,Promise.all(_.map(function(y){return S(m,void 0,void 0,function(){return I(this,function(E){switch(E.label){case 0:return[4,this._deserializeWithMessageCreateParams(y)];case 1:return[2,E.sent()]}})})}))];case 3:return[2,[]]}})})},t.prototype.getAllChildMessages=function(e,r){return r===void 0&&(r=new nh),S(this,void 0,void 0,function(){return I(this,function(i){switch(i.label){case 0:return[4,this.fetch({filter:r,order:pn.NEWEST_CHILD_MESSAGE,channelUrl:e.channelUrl,backward:!1,parentMessageId:e.messageId})];case 1:return[2,i.sent()]}})})},t.prototype.upsert=function(e){return S(this,void 0,void 0,function(){var r=this;return I(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return S(r,void 0,void 0,function(){var a;return I(this,function(o){switch(o.label){case 0:return s instanceof Jt||s instanceof Vr?[4,this._mutex.lock()]:[3,4];case 1:return o.sent(),[4,this.saveBlob(s)];case 2:return o.sent(),[4,this._mutex.unlock()];case 3:o.sent(),o.label=4;case 4:return a=this._serialize(s),[4,this.collection.upsertOne(a)];case 5:return o.sent(),[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.upsertChildMessages=function(e){return S(this,void 0,void 0,function(){var r=this;return I(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return S(r,void 0,void 0,function(){var a;return I(this,function(o){switch(o.label){case 0:return a=[],s.threadInfo&&s.threadInfo.replyCount>0?[4,this.getAllChildMessages(s)]:[3,2];case 1:a=o.sent(),o.label=2;case 2:return a.length>0?(a.forEach(function(u){return u.applyParentMessage(s)}),[4,this.upsert(a)]):[3,4];case 3:o.sent(),o.label=4;case 4:return[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=ke(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove(s)]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return a=c.sent(),o={error:a},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},t.prototype.removeMessagesOfChannel=function(e){return S(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e}})]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.saveBlob=function(e){return S(this,void 0,void 0,function(){var r,i,s,a=this;return I(this,function(o){switch(o.label){case 0:return e instanceof Jt?e.messageParams&&(s=e.messageParams).file&&bd(s.file)?[4,this.collection.saveBlob(s.file,e.reqId)]:[3,2]:[3,5];case 1:i=o.sent(),s.fileKey=i,s.fileType=co.BLOB,o.label=2;case 2:return e.scheduledInfo&&e.scheduledInfo.scheduledMessageParams&&(r=e.scheduledInfo.scheduledMessageParams).file&&bd(r.file)?[4,this.collection.saveBlob(r.file,e.reqId)]:[3,4];case 3:i=o.sent(),r.fileKey=i,r.fileType=co.BLOB,o.label=4;case 4:return[3,7];case 5:return e instanceof Vr&&(s=e.messageParams)&&s.fileInfoList&&Array.isArray(s.fileInfoList)?[4,Promise.all(s.fileInfoList.map(function(u,c){return S(a,void 0,void 0,function(){var l;return I(this,function(d){switch(d.label){case 0:return u.file&&bd(u.file)?[4,this.collection.saveBlob(u.file,this._getFileInfoBlobKey(e.reqId,c))]:[3,2];case 1:l=d.sent(),u._uploadedMetaData||(u._uploadedMetaData={}),u._uploadedMetaData.fileKey=l,u._uploadedMetaData.fileType=co.BLOB,d.label=2;case 2:return[2]}})})}))]:[3,7];case 6:o.sent(),o.label=7;case 7:return[2]}})})},t}(gi),rd={},H_=function(n){function t(e){var r=n.call(this,e)||this;return rd[e]=r,r}return D(t,n),Object.defineProperty(t.prototype,"_sdkState",{get:function(){return G.of(this._iid).sdkState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return G.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return al.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,r){return r===void 0&&(r=!1),rd[e]&&!r||(rd[e]=new t(e)),rd[e]},Object.defineProperty(t.prototype,"collection",{get:function(){var e=this._cacheContext.nestdb;return ne(!!e).throw(H.databaseError),e.collection(db)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localCacheEnabled",{get:function(){return this._cacheContext.localCacheEnabled&&!!this.collection},enumerable:!1,configurable:!0}),t.prototype._serialize=function(e){return P(P({},e.serialize()),{messageId:"".concat(e.messageId)})},t.prototype._deserialize=function(e){return e=P(P({},e),{messageId:parseInt(e.messageId)}),xn.of(this._iid).buildMessageFromSerializedData(e)},t.prototype.get=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.getByKey("".concat(e))]:[3,2];case 1:if(r=i.sent())return[2,this._deserialize(r)];i.label=2;case 2:return[2,void 0]}})})},t.prototype.fetch=function(e){var r=e.channelUrl,i=e.token,s=e.limit,a=s===void 0?100:s,o=e.filter,u=o===void 0?new nh:o,c=e.order,l=c===void 0?pn.CHANNEL_LATEST:c,d=e.backward,h=d!==void 0&&d,f=e.parentMessageId,p=e.isPollOnly,_=p!==void 0&&p,m=e.exactMatch,b=m!==void 0&&m,y=e.inclusive,E=y===void 0||y;return S(this,void 0,void 0,function(){var T,N,C,L=this;return I(this,function(k){switch(k.label){case 0:return this.localCacheEnabled?(T=Cs(l),N={where:{channelUrl:r,"/where":function(O){if(i)switch(l){case pn.CHANNEL_LATEST:if(b&&O.createdAt!==i)return!1;if(h){if(E&&O.createdAt<i||!E&&O.createdAt<=i)return!1}else if(E&&O.createdAt>i||!E&&O.createdAt>=i)return!1;break;case pn.NEWEST_CHILD_MESSAGE:if(!f||O.parentMessageId===0||O.parentMessageId!==f)return!1}return!(_&&!O._poll)&&u.match(L._deserialize(O))}},index:T,backward:h},[4,this.collection.query(N)]):[3,3];case 1:return[4,k.sent().fetch({limit:a??void 0})];case 2:return C=k.sent(),[2,Promise.all(C.map(function(O){return S(L,void 0,void 0,function(){return I(this,function(x){return[2,this._deserialize(O)]})})}))];case 3:return[2,[]]}})})},t.prototype.getAllChildMessages=function(e,r){return r===void 0&&(r=new nh),S(this,void 0,void 0,function(){return I(this,function(i){switch(i.label){case 0:return[4,this.fetch({channelUrl:e.channelUrl,token:Date.now(),limit:null,backward:!1,filter:r,order:pn.NEWEST_CHILD_MESSAGE,parentMessageId:e.messageId})];case 1:return[2,i.sent()]}})})},t.prototype.upsert=function(e){return S(this,void 0,void 0,function(){var r,i=this;return I(this,function(s){switch(s.label){case 0:return this.localCacheEnabled?[4,this.saveBlobs(e)]:[3,5];case 1:return s.sent(),r=e.map(function(a){return i._serialize(a)}),[4,this.collection.upsertMany(r)];case 2:return s.sent(),[4,this.upsertChildMessages(e)];case 3:return s.sent(),[4,this._unsentMessageCache.upsertChildMessages(e)];case 4:s.sent(),s.label=5;case 5:return[2]}})})},t.prototype.upsertChildMessages=function(e){return S(this,void 0,void 0,function(){var r=this;return I(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,Promise.all(e.map(function(s){return S(r,void 0,void 0,function(){var a,o;return I(this,function(u){switch(u.label){case 0:return a=[],!((o=s.threadInfo)===null||o===void 0)&&o.replyCount&&s.threadInfo.replyCount>0?[4,this.getAllChildMessages(s)]:[3,2];case 1:a=u.sent(),u.label=2;case 2:return a.length>0?(a.forEach(function(c){return c.applyParentMessage(s)}),[4,this.upsert(a)]):[3,4];case 3:u.sent(),u.label=4;case 4:return[2]}})})}))]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.remove=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:if(!this.localCacheEnabled)return[3,8];c.label=1;case 1:c.trys.push([1,6,7,8]),r=ke(e),i=r.next(),c.label=2;case 2:return i.done?[3,5]:(s=i.value,[4,this.collection.remove("".concat(s))]);case 3:c.sent(),c.label=4;case 4:return i=r.next(),[3,2];case 5:return[3,8];case 6:return a=c.sent(),o={error:a},[3,8];case 7:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},t.prototype.removeMessagesOfChannel=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e},index:Cs(pn.CHANNEL_LATEST)})]:[3,6];case 1:return i.sent(),[4,(r=this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 2:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 3:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 4:return i.sent(),[4,r.remove("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 5:i.sent(),i.label=6;case 6:return[2]}})})},t.prototype.removeUnderOffset=function(e,r){return S(this,void 0,void 0,function(){return I(this,function(i){switch(i.label){case 0:return this.localCacheEnabled?[4,this.collection.removeIf({where:{channelUrl:e,createdAt:{"<":r}},index:Cs(pn.CHANNEL_LATEST)})]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.clear=function(){return S(this,void 0,void 0,function(){return I(this,function(e){switch(e.label){case 0:return this.localCacheEnabled?[4,this.collection.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.countBetween=function(e,r,i){return S(this,void 0,void 0,function(){var s,a=this;return I(this,function(o){switch(o.label){case 0:return this.localCacheEnabled?(s=Cs(pn.CHANNEL_LATEST),[4,this.collection.query({where:{channelUrl:e,"/where":function(u){var c=a._deserialize(u);return i.includes(c.createdAt)&&r.match(c)}},index:s}).count()]):[3,2];case 1:return[2,o.sent()];case 2:return[2,0]}})})},t.prototype.saveBlobs=function(e){return S(this,void 0,void 0,function(){var r=this;return I(this,function(i){switch(i.label){case 0:return[4,Promise.all(e.map(function(s){return S(r,void 0,void 0,function(){var a,o;return I(this,function(u){switch(u.label){case 0:return s instanceof Jt&&s.messageParams&&(a=s.messageParams).file&&bd(a.file)?[4,this.collection.saveBlob(a.file,s.reqId)]:[3,2];case 1:o=u.sent(),a.fileKey=o,u.label=2;case 2:return[2]}})})}))];case 1:return i.sent(),[2]}})})},t.prototype._getGroupChannelPreferenceSize=function(e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:return r=0,[4,(i=this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync"))];case 1:return s=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/sync.meta"))];case 2:return a=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs"))];case 3:return o=c.sent(),[4,i.get("sendbird:".concat(this._sdkState.userId,"@groupchannel/").concat(e,"/message/changelogs.meta"))];case 4:return u=c.sent(),s&&(r+=JSON.stringify(s).length),a&&(r+=JSON.stringify(a).length),o&&(r+=JSON.stringify(o).length),u&&(r+=JSON.stringify(u).length),[2,r]}})})},t}(gi),xu={},_D=function(n){function t(e){var r=n.call(this,e)||this;return r._observers=new Map,r._dispatcherContext=r._dispatcher.on(function(i){return S(r,void 0,void 0,function(){var s,a,o,u,c,l,d,h,f,p,_,m,b,y,E=this;return I(this,function(T){switch(T.label){case 0:return i instanceof sn?(s=i.messages,b=i.source,c=i.isWebSocketEventComing,a=s.filter(function(N){return N.messageId>0}),o=s.filter(function(N){return N.messageId===0}),a.length>0?[4,gr(function(){return S(E,void 0,void 0,function(){return I(this,function(N){switch(N.label){case 0:return[4,this._messageCache.upsert(a)];case 1:return N.sent(),[4,this._unsentMessageCache.remove(a.map(function(C){return C instanceof yo?C.reqId:null}).filter(function(C){return C!==null}))];case 2:return N.sent(),[2]}})})})]:[3,2]):[3,5];case 1:T.sent(),c||this._broadcastUpdateEvent(a,b),T.label=2;case 2:return o.length>0?[4,gr(function(){return S(E,void 0,void 0,function(){return I(this,function(N){switch(N.label){case 0:return[4,this._unsentMessageCache.upsert(o)];case 1:return N.sent(),[2]}})})})]:[3,4];case 3:T.sent(),c||this._broadcastUpdateEvent(o,b),T.label=4;case 4:return[3,21];case 5:return i instanceof JE?(u=i.messageIds,b=i.source,c=i.isWebSocketEventComing,[4,gr(function(){return S(E,void 0,void 0,function(){return I(this,function(N){switch(N.label){case 0:return[4,this._messageCache.remove(u)];case 1:return N.sent(),[2]}})})})]):[3,7];case 6:return T.sent(),c||this._broadcastRemoveEvent(u,b),[3,21];case 7:return i instanceof XO?(l=i.reqId,b=i.source,[4,gr(function(){return S(E,void 0,void 0,function(){return I(this,function(N){switch(N.label){case 0:return[4,this._unsentMessageCache.remove([l])];case 1:return N.sent(),[2]}})})})]):[3,9];case 8:return T.sent(),this._broadcastRemoveUnsentEvent(l,b),[3,21];case 9:return i instanceof XE?(d=i.polls,b=i.source,this._cacheContext.localCacheEnabled?(h=d.map(function(N){return N.messageId}),[4,Promise.all(h.map(function(N){return E._messageCache.get(N)}))]):[3,12]):[3,13];case 10:return(f=T.sent().filter(function(N){return N})).length>0&&d.forEach(function(N){var C=f.find(function(L){return L.messageId===N.messageId});C&&C.applyPoll(N)}),[4,gr(function(){return S(E,void 0,void 0,function(){return I(this,function(N){switch(N.label){case 0:return[4,this._messageCache.upsert(f)];case 1:return[2,N.sent()]}})})})];case 11:T.sent(),T.label=12;case 12:return this._broadcastPollChangeLogEvent(d,b),[3,21];case 13:return i instanceof eM?(p=i.event,b=i.source,[4,this._messageCache.get(p.messageId)]):[3,17];case 14:return(_=T.sent())&&_.isUserMessage()&&_.poll&&_.poll.applyPollUpdateEvent(p)?[4,gr(function(){return S(E,void 0,void 0,function(){return I(this,function(N){switch(N.label){case 0:return[4,this._messageCache.upsert([_])];case 1:return[2,N.sent()]}})})})]:[3,16];case 15:T.sent(),T.label=16;case 16:return this._broadcastPollUpdateEvent(p,b),[3,21];case 17:return i instanceof eb?(m=i.event,b=i.source,[4,this._messageCache.get(m.messageId)]):[3,21];case 18:return(y=T.sent())&&y.isUserMessage()&&y.poll&&y.poll.applyPollVoteEvent(m)?[4,gr(function(){return S(E,void 0,void 0,function(){return I(this,function(N){switch(N.label){case 0:return[4,this._messageCache.upsert([y])];case 1:return[2,N.sent()]}})})})]:[3,20];case 19:T.sent(),T.label=20;case 20:this._broadcastPollVoteEvent(m,b),T.label=21;case 21:return[2]}})})}),r}return D(t,n),Object.defineProperty(t.prototype,"_cacheContext",{get:function(){return G.of(this._iid).cacheContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_dispatcher",{get:function(){return G.of(this._iid).dispatcher},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_messageCache",{get:function(){return H_.of(this._iid)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_unsentMessageCache",{get:function(){return al.of(this._iid)},enumerable:!1,configurable:!0}),t.of=function(e,r){var i;return r===void 0&&(r=!1),xu[e]&&!r||(xu[e]&&((i=xu[e]._dispatcherContext)===null||i===void 0||i.close()),xu[e]=new t(e)),xu[e]},t.prototype._broadcastUpdateEvent=function(e,r){var i,s;try{for(var a=ke(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onUpdate&&u.onUpdate(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastPollChangeLogEvent=function(e,r){var i,s;try{for(var a=ke(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onPollChangeLogUpdate&&u.onPollChangeLogUpdate(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastPollUpdateEvent=function(e,r){var i,s;try{for(var a=ke(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onPollUpdate&&u.onPollUpdate(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastPollVoteEvent=function(e,r){var i,s;try{for(var a=ke(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onPollVote&&u.onPollVote(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastRemoveEvent=function(e,r){var i,s;try{for(var a=ke(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onRemove&&u.onRemove(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype._broadcastRemoveUnsentEvent=function(e,r){var i,s;try{for(var a=ke(this._observers.values()),o=a.next();!o.done;o=a.next()){var u=o.value;u.onRemoveUnsent&&u.onRemoveUnsent(e,r)}}catch(c){i={error:c}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},t.prototype.subscribe=function(e,r){this._observers.set(e,r)},t.prototype.unsubscribe=function(e){this._observers.delete(e)},t.prototype.unsubscribeAll=function(){this._observers.clear()},t}(gi),o0={},xn=function(){function n(t,e){var r=e.sdkState,i=e.dispatcher,s=e.requestQueue,a=e.onlineDetector,o=e.cacheContext;this._iid=t,this._sdkState=r,this._requestQueue=s,this._dispatcher=i,this._cacheContext=o,H_.of(t),al.of(t),_D.of(t),this.fileMessageQueue=new bM(t,{sdkState:r,dispatcher:i,requestQueue:s,onlineDetector:a,cacheContext:o}),o0[t]=this}return n.of=function(t){return o0[t]},n.prototype.buildMessageFromSerializedData=function(t){var e=eh(t);switch(e.messageType){case Ot.USER:return new Qn(this._iid,Qn.payloadify(e));case Ot.FILE:return Vr._isMultipleFilesMessageSerializedData(e)?new Vr(this._iid,Vr.payloadify(e)):new Jt(this._iid,Jt.payloadify(e));case Ot.ADMIN:return new t_(this._iid,t_.payloadify(e))}throw H.invalidParameters},n.prototype.buildUserMessageCreateParamsFromSerializedData=function(t,e){return me(Te({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,message:e.message,translationTargetLanguages:Object.keys(e.translations),pollId:t.pollId}))},n.prototype.buildFileMessageCreateParamsFromSerializedData=function(t,e){var r;return me(Te({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,file:t.file,fileKey:t.fileKey,fileUrl:e.plainUrl,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:(r=e.thumbnails)===null||r===void 0?void 0:r.map(function(i){return{maxWidth:i.width,maxHeight:i.height}}),fileType:t.fileType,requireAuth:e.requireAuth}))},n.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData=function(t,e){return me({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.mentionedUserIds,mentionedUsers:e.mentionedUsers,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,isReplyToChannel:t.isReplyToChannel,pushNotificationDeliveryOption:t.pushNotificationDeliveryOption,appleCriticalAlertOptions:e.appleCriticalAlertOptions,reqId:e.reqId,fileInfoList:t.fileInfoList})},n.prototype.buildScheduledUserMessageCreateParamsFromSerializedData=function(t,e){return P(P({},this.buildUserMessageCreateParamsFromSerializedData(t,e)),{scheduledAt:t.scheduledAt})},n.prototype.buildScheduledFileMessageCreateParamsFromSerializedData=function(t,e){return P(P({},this.buildFileMessageCreateParamsFromSerializedData(t,e)),{scheduledAt:t.scheduledAt})},n.prototype.buildSenderFromSerializedData=function(t){var e=eh(t);return new lu(this._iid,lu.payloadify(e))},n.prototype.getMessage=function(t){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return e=new TM(t),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(wM).message]}})})},n.prototype.getScheduledMessage=function(t){return S(this,void 0,void 0,function(){var e,r;return I(this,function(i){switch(i.label){case 0:return e=new CM(t),[4,this._requestQueue.send(e)];case 1:return r=i.sent(),[2,r.as(NM).message]}})})},n.prototype.getMessagesByMessageId=function(t,e,r,i,s){return s===void 0&&(s=bt.REQUEST_MESSAGE),S(this,void 0,void 0,function(){var a,o,u;return I(this,function(c){switch(c.label){case 0:return a=new Yl(P(P({channelType:e,channelUrl:t,token:String(r)},Ac),i)),[4,this._requestQueue.send(a)];case 1:return o=c.sent(),u=o.as(Zl).messages,this._dispatcher.dispatch(new sn({messages:u,source:s})),[2,u]}})})},n.prototype.getMessagesByTimestamp=function(t,e,r,i,s){return s===void 0&&(s=bt.REQUEST_MESSAGE),S(this,void 0,void 0,function(){var a,o,u;return I(this,function(c){switch(c.label){case 0:return a=new Yl(P(P({channelType:e,channelUrl:t,timestamp:r},Ac),i)),[4,this._requestQueue.send(a)];case 1:return o=c.sent(),u=o.as(Zl).messages,this._dispatcher.dispatch(new sn({messages:u,source:s})),[2,u]}})})},n.prototype._getMessagesByTimestampForCollection=function(t,e,r,i,s,a){return s===void 0&&(s=bt.REQUEST_MESSAGE),S(this,void 0,void 0,function(){var o,u,c,l;return I(this,function(d){switch(d.label){case 0:return o=new Yl(P(P(P({channelType:e,channelUrl:t,timestamp:r},Ac),i),{checkingContinuousMessages:a})),[4,this._requestQueue.send(o)];case 1:return u=d.sent(),c=u.payload,l=u.as(Zl).messages,this._dispatcher.dispatch(new sn({messages:l,source:s})),[2,{messages:l,isContinuousMessages:c}]}})})},n.prototype.getThreadedMessagesByTimestamp=function(t,e,r,i){return i===void 0&&(i=bt.REQUEST_THREADED_MESSAGE),S(this,void 0,void 0,function(){var s,a,o,u;return I(this,function(c){switch(c.label){case 0:return s=new Yl(P(P(P({channelUrl:t.channelUrl,channelType:t.channelType,timestamp:e},sl),r),{replyType:Cr.ALL,parentMessageId:t.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(s)];case 1:return a=c.sent(),o=a.as(Zl).messages,(u=o.slice(1)).forEach(function(l){l.parentMessage=t}),this._dispatcher.dispatch(new sn({messages:u,source:i})),[2,{parentMessage:o[0],threadedMessages:u}]}})})},n.prototype.getMessageChangelogs=function(t,e,r,i,s){return s===void 0&&(s=bt.REQUEST_MESSAGE_CHANGELOGS),S(this,void 0,void 0,function(){var a,o,u,c,l,d,h,f;return I(this,function(p){switch(p.label){case 0:return a=new IM(me(Te(P(P({channelType:e,channelUrl:t,timestamp:typeof r=="number"?r:null,token:typeof r=="string"?r:null},r_),i)))),[4,this._requestQueue.send(a)];case 1:return o=p.sent(),u=o.as(SM),c=u.updatedMessages,l=u.deletedMessagesInfo,d=u.hasMore,h=u.nextToken,f=l.map(function(_){return _.messageId}),c.length>0&&this._dispatcher.dispatch(new sn({messages:c,source:s})),f.length>0&&this._dispatcher.dispatch(new JE({messageIds:f,source:s})),[2,{updatedMessages:c,deletedMessageIds:f,hasMore:d,token:h}]}})})},n}();(function(n){function t(e,r){var i=n.call(this,e)||this;i.targetMessageId=0;var s=r.thread_info,a=r.parent_message_id,o=r.channel_url,u=r.channel_type;return s&&$("object",s)&&$("number",a)&&$("string",o)&&$("string",u)&&(i.threadInfo=new e_(e,s),i.targetMessageId=a,i.channelUrl=o,i.channelType=u),i}return D(t,n),t})(gi);var mD={channelUrl:"",channelType:zt.BASE,messageId:0,includeReactions:!1,includeMetaArray:!1,includeParentMessageInfo:!1,includeThreadInfo:!1},vD=function(n){function t(e){var r=e.channelCustomType,i=e.keyword,s=e.limit,a=e.reverse,o=e.exactMatch,u=e.channelUrl,c=e.order,l=e.messageTimestampFrom,d=e.messageTimestampTo,h=e.advancedQuery,f=e.targetFields,p=e.nextToken,_=n.call(this)||this;return _.method=J.GET,_.path="".concat(wk,"/messages"),_.params={custom_type:r,query:i,limit:s,reverse:a,exact_match:o,channel_url:u,message_ts_from:l,message_ts_to:d,sort_field:c,advanced_query:h,target_fields:f,after:p},_}return D(t,n),t}(X),gD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.messages=r.results.map(function(s){return Ps(e,s)}),i.hasNext=r.has_next,i.nextToken=r.end_cursor,i.totalCount=r.total_count,i}return D(t,n),t}(se);(function(n){n.SCORE="score",n.TIMESTAMP="ts"})(Mc||(Mc={}));var yD=function(n){function t(e,r){var i,s,a,o,u,c,l,d,h,f=this;return(f=n.call(this,e,r)||this).keyword="",f.reverse=!1,f.exactMatch=!1,f.channelUrl="",f.channelCustomType="",f.messageTimestampFrom=null,f.messageTimestampTo=null,f.order=Mc.SCORE,f.advancedQuery=!1,f.targetFields=null,f._nextToken="",f.totalCount=-1,f.keyword=r.keyword,f.reverse=(i=r.reverse)!==null&&i!==void 0&&i,f.exactMatch=(s=r.exactMatch)!==null&&s!==void 0&&s,f.channelUrl=(a=r.channelUrl)!==null&&a!==void 0?a:"",f.channelCustomType=(o=r.channelCustomType)!==null&&o!==void 0?o:"",f.messageTimestampFrom=(u=r.messageTimestampFrom)!==null&&u!==void 0?u:null,f.messageTimestampTo=(c=r.messageTimestampTo)!==null&&c!==void 0?c:null,f.order=(l=r.order)!==null&&l!==void 0?l:Mc.SCORE,f.advancedQuery=(d=r.advancedQuery)!==null&&d!==void 0&&d,f.targetFields=(h=r.targetFields)!==null&&h!==void 0?h:null,f}return D(t,n),t.prototype._validate=function(){return n.prototype._validate.call(this)&&$("string",this.keyword)&&this.keyword.length>0&&$("boolean",this.reverse)&&$("boolean",this.exactMatch)&&$("string",this.channelUrl)&&$("string",this.channelCustomType)&&($("number",this.messageTimestampFrom)||this.messageTimestampFrom===null)&&($("number",this.messageTimestampTo)||this.messageTimestampTo===null)&&yt(Mc,this.order)&&$("boolean",this.advancedQuery)&&We("string",this.targetFields,!0)},t.prototype.next=function(){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=G.of(this._iid).requestQueue,r=new vD(Te(P(P({},this),{nextToken:this._nextToken?this._nextToken:null}))),[4,e.send(r)]):[3,2]:[3,5];case 1:return i=l.sent(),s=i.as(gD),a=s.messages,o=s.hasNext,u=s.nextToken,c=s.totalCount,this._nextToken=u,this._hasNext=o,this._isLoading=!1,this.totalCount=c,[2,a];case 2:return[2,[]];case 3:throw H.queryInProgress;case 4:return[3,6];case 5:throw H.invalidParameters;case 6:return[2]}})})},t}(rl),ED={channelUrl:"",scheduledMessageId:0},bD=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.name="message",e}return D(t,n),t.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,a=r.sessionManager,o=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;n.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:a,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new xn(e,{sdkState:i,dispatcher:s,requestQueue:o,onlineDetector:c,cacheContext:l})},t.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},t.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},t.prototype.getMessage=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){return r=P(P({},mD),e),ne(function(s){return $("string",s.channelUrl)&&yt(zt,s.channelType)&&$("number",s.messageId)&&$("boolean",s.includeReactions,!0)&&$("boolean",s.includeMetaArray,!0)&&$("boolean",s.includeParentMessageInfo,!0)&&$("boolean",s.includeThreadInfo,!0)}(r)).throw(H.invalidParameters),[2,this._manager.getMessage(r)]})})},t.prototype.getScheduledMessage=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){return r=P(P({},ED),e),ne(function(s){return $("string",s.channelUrl)&&s.channelUrl!==""&&$("number",s.scheduledMessageId)&&s.scheduledMessageId>0}(r)).throw(H.invalidParameters),[2,this._manager.getScheduledMessage(r)]})})},t}(YE),TD=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.name="poll",e}return D(t,n),t.prototype.init=function(e,r){var i=r.sdkState,s=r.dispatcher,a=r.sessionManager,o=r.requestQueue,u=r.logger,c=r.onlineDetector,l=r.cacheContext;n.prototype.init.call(this,e,{sdkState:i,dispatcher:s,sessionManager:a,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l}),this._manager=new Xp(e,{sdkState:i,dispatcher:s,sessionManager:a,requestQueue:o,logger:u,onlineDetector:c,cacheContext:l})},t.prototype.create=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){return r=P(P({},lM),e),ne(tb(r)).throw(H.invalidParameters),[2,this._manager.create(r)]})})},t.prototype.get=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){return r=P(P({},hM),e),ne(rb(r)).throw(H.invalidParameters),[2,this._manager.get(r)]})})},t.prototype.getOption=function(e){return S(this,void 0,void 0,function(){var r;return I(this,function(i){return r=P(P({},dM),e),ne(nb(r)).throw(H.invalidParameters),[2,this._manager.getOption(r)]})})},t.prototype.buildPollFromSerializedData=function(e){return this._manager.buildPollFromSerializedData(e)},t}(YE),va,u0,c0;(function(n){n.LATEST_LAST_MESSAGE="latest_last_message",n.CHRONOLOGICAL="chronological",n.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",n.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"})(va||(va={})),function(n){n.CHRONOLOGICAL="chronological",n.CHANNEL_NAME_ALPHABETICAL="channel_name_alphabetical",n.METADATA_VALUE_ALPHABETICAL="metadata_value_alphabetical"}(u0||(u0={})),function(n){n.CREATED_AT="created_at",n.SCHEDULED_AT="scheduled_at"}(c0||(c0={}));var o_,Zf=function(n){switch(n){case va.LATEST_LAST_MESSAGE:return["-lastMessageUpdatedAt","-createdAt","syncIndex"];case va.CHRONOLOGICAL:return["-createdAt","syncIndex"];case va.CHANNEL_NAME_ALPHABETICAL:return["name"];default:return["-lastMessageUpdatedAt","-createdAt","syncIndex"]}},wD=function(n){function t(e){var r=e.message,i=n.call(this)||this;return i.message=r,i}return D(t,n),t}(en),l0={},ID=function(){function n(t,e){var r=e.localCacheEnabled,i=e.dispatcher,s=e.sdkState,a=e.logger,o=this;this._iid=t,l0[t]=this,this._localCacheEnabled=r,this._isProcessingAutoResend=!1,this._autoResendQueue=[],this._dispatcher=i,this._logger=a,this._sdkState=s,this._localCacheEnabled&&i.on(function(u){if(u instanceof mu)switch(u.stateType){case dt.CONNECTED:o._isProcessingAutoResend||o.processAutoResendRegisteredPendingMessages().then(function(){return o._processNextAutoResend()});break;case dt.INTERNAL_DISCONNECTED:case dt.EXTERNAL_DISCONNECTED:o._isProcessingAutoResend=!1}})}return n.of=function(t){return l0[t]},n.prototype.processNonAutoResendRegisteredPendingMessages=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a;return I(this,function(o){switch(o.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=o.sent();try{for(e=ke(t),r=e.next();!r.done;r=e.next())(i=r.value).errorCode===0&&(this._logger.debug("cached pending message is not auto-resend registered. changing its sending status to failed: ",i.reqId),i.sendingStatus=St.FAILED,i.errorCode=ve.ACK_TIMEOUT,this._dispatcher.dispatch(new sn({messages:[i],source:bt.LOCAL_MESSAGE_FAILED})))}catch(u){s={error:u}}finally{try{r&&!r.done&&(a=e.return)&&a.call(e)}finally{if(s)throw s.error}}return[2]}})})},n.prototype.processAutoResendRegisteredPendingMessages=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:return[4,this._fetchAllCachedPendingMessages()];case 1:t=c.sent();try{for(e=ke(t),r=e.next();!r.done;r=e.next())(i=r.value).errorCode&&Bd(i.errorCode)&&(s=new Date().getTime(),a=i.createdAt+2592e5,s<=a?this._autoResendQueue.map(function(l){return l.reqId}).indexOf(i.reqId)<0&&this._autoResendQueue.push(i):(this._logger.debug("auto-resend registered pending messaged expired. expiration date: ",new Date(a).toLocaleString()),i.sendingStatus=St.FAILED,this._dispatcher.dispatch(new sn({messages:[i],source:bt.LOCAL_MESSAGE_FAILED}))))}catch(l){o={error:l}}finally{try{r&&!r.done&&(u=e.return)&&u.call(e)}finally{if(o)throw o.error}}return[2]}})})},n.prototype.completeCurrentAndProcessNextAutoResend=function(t){if(this._localCacheEnabled&&(t.sendingStatus===St.SUCCEEDED||t.sendingStatus===St.FAILED&&!Bd(t.errorCode))){var e=this.indexOf(t);e>=0&&this._autoResendQueue.splice(e,1),e===0&&this._processNextAutoResend()}},n.prototype._fetchAllCachedPendingMessages=function(){return S(this,void 0,void 0,function(){var t,e;return I(this,function(r){switch(r.label){case 0:return(t=al.of(this._iid))?[4,t.fetch({sendingStatus:St.PENDING,backward:!0})]:[3,2];case 1:return e=r.sent(),[3,3];case 2:e=[],r.label=3;case 3:return[2,e]}})})},n.prototype.indexOf=function(t){return this._autoResendQueue.length>0?this._autoResendQueue.map(function(e){return e.reqId}).indexOf(t.reqId):-1},n.prototype._isNotInQueue=function(t){return this._autoResendQueue.map(function(e){return e.reqId}).indexOf(t.reqId)===-1},n.prototype._processNextAutoResend=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){if(this._localCacheEnabled&&this._sdkState.appState==="foreground")try{this._autoResendQueue.length>0?(this._isProcessingAutoResend||(this._logger.debug("auto-resend queue started."),this._isProcessingAutoResend=!0),t=this._autoResendQueue[0],this._dispatcher.dispatch(new wD({message:t})),this._logger.debug("processing auto-resend for message request id: ",t.reqId)):(this._logger.debug("auto-resend queue finished."),this._isProcessingAutoResend=!1)}catch(r){this._logger.warn("process auto-resend error: ",r),this._isProcessingAutoResend=!1}return[2]})})},n}();(function(n){n[n.USER_BLOCK=20001]="USER_BLOCK",n[n.USER_UNBLOCK=2e4]="USER_UNBLOCK",n[n.FRIEND_DISCOVERED=20900]="FRIEND_DISCOVERED"})(o_||(o_={}));var fb=function(){function n(t){this.category=t.cat,this.data=t.data}return n.getDataAsUserBlockEvent=function(t,e){var r=e.data,i=r.blocker,s=r.blockee;return{blocker:new $e(t,i),blockee:new $e(t,s)}},n.getDataAsFriendDiscoveredEvent=function(t,e){var r=e.data.friend_discoveries;return{friendDiscoveries:Array.isArray(r)?r.map(function(i){return new $e(t,i)}):[]}},n}(),SD=function(n){function t(e,r){var i=r.userId,s=n.call(this)||this;return s._iid=e,s.userId=i,s}return D(t,n),t}(en),CD=function(n){function t(){return n.call(this)||this}return D(t,n),t}(en),ND=function(n){function t(e,r,i){var s=n.call(this,e,"USEV",i)||this;return s.event=new fb(i),s}return D(t,n),t}(En),AD=function(n){return["-lastMessageUpdatedAt","-createdAt","syncIndex"]},pb=function(n){this.key=n.key,this.url=n.url},_b=function(n){this.id=n.id,this.name=n.name,this.url=n.url,this.emojis=n.emojis?n.emojis.map(function(t){return new pb(t)}):[]},kD=function(n){this.emojiHash=n.emoji_hash||"",this.emojiCategories=n.emoji_categories?n.emoji_categories.map(function(t){return new _b(t)}):[]},OD={profileImage:void 0,profileUrl:void 0,nickname:void 0},d0=function(n){return{v2:n.commitSchema([{collectionName:P2,keyName:x2,index:[Zf(va.LATEST_LAST_MESSAGE),Zf(va.CHRONOLOGICAL),Zf(va.CHANNEL_NAME_ALPHABETICAL)]},{collectionName:db,keyName:F2,index:[Cs(pn.CHANNEL_LATEST),Cs(pn.NEWEST_CHILD_MESSAGE)]},{collectionName:hb,keyName:pD,index:[Cs(pn.CHANNEL_LATEST),Cs(pn.NEWEST_CHILD_MESSAGE)]},{collectionName:q2,keyName:$2}]),v3:n.commitSchema([{collectionName:H2,keyName:z2,index:[AD()]}])}},h0=function(n,t){return function(e,r){switch(e){case 1:n.clear().then(function(){t.clear().then(function(){d0(n).v2.then(function(){return r()}).catch(function(i){return r(i)})}).catch(function(i){return r(i)})}).catch(function(i){return r(i)});break;case 2:d0(n).v3.then(function(){return r()}).catch(function(i){return r(i)});break;default:r()}}},MD=function(){return typeof document<"u"?document.visibilityState:"visible"},DD=function(n){function t(e){var r=e.getVisibilityState,i=r===void 0?MD:r,s=e.initialState,a=s===void 0?"visible":s,o=e.isEnabled,u=o===void 0||o,c=e.pauseCheckDelay,l=c===void 0?3e4:c,d=n.call(this)||this;return d._pauseCheckDelay=3e4,d._currentState="visible",d._getVisibilityState=i,d._pauseCheckDelay=l,d._currentState=a,d._isEnabled=u,d._boundToggleState=d._toggleState.bind(d),d}return D(t,n),Object.defineProperty(t.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAvailable",{get:function(){return typeof window<"u"&&!!window.addEventListener&&!!window.removeEventListener},enumerable:!1,configurable:!0}),t.prototype._toggleState=function(){var e=this,r=this._getVisibilityState();r!=="hidden"?this._currentState==="hidden"&&(this._pauseDelayTimer&&(clearTimeout(this._pauseDelayTimer),this._pauseDelayTimer=void 0),this.dispatch("resume")):this._currentState!=="hidden"&&(this._pauseDelayTimer=setTimeout(function(){e._pauseDelayTimer=void 0,e.dispatch("pause")},this._pauseCheckDelay)),this._currentState=r},t.prototype.start=function(){this._isEnabled&&this.isAvailable&&(this._boundToggleState=this._toggleState.bind(this),window.addEventListener("visibilitychange",this._boundToggleState,{capture:!0}))},t.prototype.stop=function(){this._isEnabled&&this.isAvailable&&this._boundToggleState&&window.removeEventListener("visibilitychange",this._boundToggleState,{capture:!0})},t}(pu),RD=function(){function n(t){var e=t.logger,r=t.connectionDelegate,i=r===void 0?null:r,s=this;this._onlineWorker=function(){var a;return(a=s.connectionDelegate)===null||a===void 0?void 0:a.reconnect()},this._offlineWorker=function(){var a;return(a=s.connectionDelegate)===null||a===void 0?void 0:a.disconnect()},this.unsubscribes=[],this._onlineListener=function(a){if(s.isAvailableOnWeb)return window.addEventListener("online",a),function(){return window.removeEventListener("online",a,!1)}},this._offlineListener=function(a){if(s.isAvailableOnWeb)return window.addEventListener("offline",a),function(){return window.removeEventListener("offline",a,!1)}},this.logger=e,i&&(this.connectionDelegate=i)}return Object.defineProperty(n.prototype,"isAvailableOnWeb",{get:function(){return typeof window<"u"&&!!window.addEventListener&&"ononline"in window&&"onoffline"in window&&typeof navigator<"u"&&navigator.onLine!==void 0},enumerable:!1,configurable:!0}),n.prototype.setOnlineListener=function(t){t&&typeof t=="function"&&(this._onlineListener=t)},n.prototype.setOfflineListener=function(t){t&&typeof t=="function"&&(this._offlineListener=t)},n.prototype.start=function(){this.unsubscribes=[this._onlineListener(this._onlineWorker),this._offlineListener(this._offlineWorker)]},n.prototype.stop=function(){var t=this;this.unsubscribes.forEach(function(e){try{e==null||e()}catch(r){t.logger.warn(r.message)}}),this.unsubscribes=[]},n.prototype.isOnline=function(){return S(this,void 0,void 0,function(){return I(this,function(t){return this.isAvailableOnWeb?[2,navigator.onLine]:[2,new Promise(function(e){fetch("https://www.google.com",{method:J.GET,mode:"no-cors"}).then(function(){return e(!0)}).catch(function(){return e(!1)})})]})})},n}(),f0=function(n){function t(e){var r=e.userId,i=e.nickname,s=e.profileUrl,a=e.profileImage,o=e.preferredLanguages,u=n.call(this)||this;return u.method=J.PUT,u.path="".concat(Ye,"/").concat(encodeURIComponent(r)),u.params=me(Te({nickname:i,profile_url:s,profile_file:a,preferred_languages:o})),u}return D(t,n),t}(X),p0=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.user=new $e(e,P({},r)),i}return D(t,n),t}(se),UD=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=J.POST,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/apns"),s.params={apns_device_token:i,always_push:!0},s}return D(t,n),t}(X);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.type=r.type?Zt[r.type.toLowerCase()]:Zt.UNKNOWN,i.user=new $e(e,r.user),i}D(t,n)})(se);var LD=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=J.POST,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/gcm"),s.params={gcm_reg_token:i,always_push:!0},s}return D(t,n),t}(X);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.type=r.type?Zt[r.type.toLowerCase()]:Zt.UNKNOWN,i.user=new $e(e,r.user),i}D(t,n)})(se);var PD=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=J.DELETE,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/apns/").concat(encodeURIComponent(i)),s}return D(t,n),t}(X);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.user=new $e(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}D(t,n)})(se);var xD=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=J.DELETE,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/gcm/").concat(encodeURIComponent(i)),s}return D(t,n),t}(X);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.token=r.token,i.user=new $e(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}D(t,n)})(se);var FD=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.DELETE,i.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/apns"),i}return D(t,n),t}(X);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.type=r.type?Zt[r.type.toLowerCase()]:Zt.UNKNOWN,i.user=new $e(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}D(t,n)})(se);var qD=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.DELETE,i.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/gcm"),i}return D(t,n),t}(X);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.type=r.type?Zt[r.type.toLowerCase()]:Zt.UNKNOWN,i.user=new $e(e,r.user),i.lastDeletedAt=r.device_token_last_deleted_at,i}D(t,n)})(se);var $D=function(n){function t(e){var r=e.userId,i=e.type,s=e.token,a=e.ts,o=n.call(this)||this;return o.method=J.GET,o.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/").concat(encodeURIComponent(i),"/device_tokens"),o.params={created_ts:a,token:s},o}return D(t,n),t}(X),HD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTokens={type:r.type?Zt[r.type.toLowerCase()]:Zt.UNKNOWN,deviceTokens:r.device_tokens,hasMore:r.has_more,token:r.token},i}return D(t,n),t}(se),zD=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.GET,i.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),i}return D(t,n),t}(X),GD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.autoAccept=r.auto_accept,i}return D(t,n),t}(se),VD=function(n){function t(e){var r=e.userId,i=e.willAutoAccept,s=n.call(this)||this;return s.method=J.PUT,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/channel_invitation_preference"),s.params={auto_accept:i},s}return D(t,n),t}(X),BD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.autoAccept=r.auto_accept,i}return D(t,n),t}(se),jD=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.GET,i.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push_preference"),i}return D(t,n),t}(X),KD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.preference={doNotDisturbOn:r.do_not_disturb,startHour:r.start_hour,startMin:r.start_min,endHour:r.end_hour,endMin:r.end_min,timezone:r.timezone},i}return D(t,n),t}(se),QD=function(n){function t(e){var r=e.userId,i=e.doNotDisturbOn,s=e.startHour,a=e.startMin,o=e.endHour,u=e.endMin,c=e.timezone,l=n.call(this)||this;return l.method=J.PUT,l.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push_preference"),l.params={do_not_disturb:i,start_hour:s,start_min:a,end_hour:o,end_min:u,timezone:c},l}return D(t,n),t}(X),WD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.preference={doNotDisturbOn:r.do_not_disturb,startHour:r.start_hour,startMin:r.start_min,endHour:r.end_hour,endMin:r.end_min,timezone:r.timezone},i}return D(t,n),t}(se),YD=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.GET,i.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push_preference"),i}return D(t,n),t}(X),ZD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.snoozePeriod={isSnoozeOn:r.snooze_enabled},typeof r.snooze_start_ts=="number"&&(i.snoozePeriod.startTs=r.snooze_start_ts),typeof r.snooze_end_ts=="number"&&(i.snoozePeriod.endTs=r.snooze_end_ts),i}return D(t,n),t}(se),JD=function(n){function t(e){var r=e.userId,i=e.snoozeOn,s=e.startTs,a=e.endTs,o=n.call(this)||this;return o.method=J.PUT,o.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push_preference"),o.params={snooze_enabled:i,snooze_start_ts:s,snooze_end_ts:a},o}return D(t,n),t}(X),XD=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.snoozePeriod={isSnoozeOn:r.snooze_enabled},typeof r.snooze_start_ts=="number"&&(i.snoozePeriod.startTs=r.snooze_start_ts),typeof r.snooze_end_ts=="number"&&(i.snoozePeriod.endTs=r.snooze_end_ts),i}return D(t,n),t}(se),eR=function(n){function t(e){var r=e.userId,i=e.blockedUserId,s=n.call(this)||this;return s.method=J.POST,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/block"),s.params={target_id:i},s}return D(t,n),t}(X);(function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.user=new $e(e,r),i}D(t,n)})(se);var tR=function(n){function t(e){var r=e.userId,i=e.unblockedUserId,s=n.call(this)||this;return s.method=J.DELETE,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/block/").concat(encodeURIComponent(i)),s}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var nR=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.GET,i.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push_preference"),i}return D(t,n),t}(X),rR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i}return D(t,n),t}(se),iR=function(n){function t(e){var r=e.userId,i=e.pushTriggerOption,s=n.call(this)||this;return s.method=J.PUT,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push_preference"),s.params={push_trigger_option:i},s}return D(t,n),t}(X),sR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.pushTriggerOption=r.push_trigger_option,i}return D(t,n),t}(se),aR=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.GET,i.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/template"),i}return D(t,n),t}(X),oR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.name=r.name,i}return D(t,n),t}(se),uR=function(n){function t(e){var r=e.userId,i=e.templateName,s=n.call(this)||this;return s.method=J.PUT,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/push/template"),s.params={name:i},s}return D(t,n),t}(X),cR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.name=r.name,i}return D(t,n),t}(se),lR=function(n){function t(e){var r=e.userId,i=e.token,s=n.call(this)||this;return s.method=J.GET,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/friends/changelogs"),s.params={token:i},s}return D(t,n),t}(X),dR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.changelogs={addedUsers:r.added.map(function(s){return new $e(e,s)}),updatedUsers:r.updated.map(function(s){return new $e(e,s)}),deletedUserIds:r.deleted,hasMore:r.has_more,token:r.next},i}return D(t,n),t}(se),hR=function(n){function t(e){var r=e.userId,i=e.discoveries,s=n.call(this)||this;return s.method=J.PUT,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discoveries:i.map(function(a){return{friend_discovery_key:a.friendDiscoveryKey,friend_name:a.friendName}})},s}return D(t,n),t}(X),fR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.friendDiscoveryRequestId=r.friend_discovery_request_id,i}return D(t,n),t}(se),pR=function(n){function t(e){var r=e.userId,i=e.discoveryKeys,s=n.call(this)||this;return s.method=J.DELETE,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/friend_discoveries"),s.params={friend_discovery_keys:i},s}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var _R=function(n){function t(e){var r=e.userId,i=e.userIds,s=n.call(this)||this;return s.method=J.POST,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return D(t,n),t}(X),mR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.users=r.users.map(function(s){return new $e(e,s)}),i}return D(t,n),t}(se),vR=function(n){function t(e){var r=e.userId,i=e.userIds,s=n.call(this)||this;return s.method=J.DELETE,s.path="".concat(Ye,"/").concat(encodeURIComponent(r),"/friends"),s.params={user_ids:i},s}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var gR=function(n){function t(e){var r=e.userId,i=n.call(this)||this;return i.method=J.GET,i.path="".concat(Ye,"/").concat(r,"/allow_friend_discovery"),i.params={},i}return D(t,n),t}(X),yR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.allowFriendDiscovery=r.allow_friend_discovery,i}return D(t,n),t}(se),ER=function(n){function t(e){var r=e.userId,i=e.allowFriendDiscovery,s=n.call(this)||this;return s.method=J.PUT,s.path="".concat(Ye,"/").concat(r,"/allow_friend_discovery"),s.params={allow_friend_discovery:i},s}return D(t,n),t}(X);(function(n){function t(){return n!==null&&n.apply(this,arguments)||this}D(t,n)})(se);var Fu,bR=function(n){function t(){var e=n.call(this)||this;return e.method=J.GET,e.path=TE,e}return D(t,n),t}(X),TR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emojiContainer=new kD(r),i}return D(t,n),t}(se),wR=function(n){function t(e){var r=e.categoryId,i=n.call(this)||this;return i.method=J.GET,i.path="".concat(TE,"/").concat(r),i}return D(t,n),t}(X),IR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emojiCategory=new _b(r),i}return D(t,n),t}(se),SR=function(n){function t(e){var r=e.key,i=n.call(this)||this;return i.method=J.GET,i.path="".concat(Ik,"/").concat(r),i}return D(t,n),t}(X),CR=function(n){function t(e,r){var i=n.call(this,e,r)||this;return i.emoji=new pb(r),i}return D(t,n),t}(se),NR=function(n){function t(){var e=n.call(this)||this;return e.method=J.GET,e.path="".concat(Sk),e}return D(t,n),t}(X),AR=function(n){function t(e,r){var i,s=this,a=r??{};return(s=n.call(this,e,r)||this).uikitConfiguration={string:JSON.stringify(a),json:a},s.updatedAt=(i=r==null?void 0:r.updated_at)!==null&&i!==void 0?i:0,s}return D(t,n),t}(se);(function(){function n(t,e,r){var i=this;this._storeInitialized=!1,this._iid=t,this.options=e;var s=G.of(t),a=s.sdkState,o=s.cacheContext,u=s.dispatcher,c=s.sessionManager,l=s.requestQueue,d=s.logger,h=s.userEventHandlers,f=s.appStateToggleEnabled;this._onlineDetector=new RD({logger:d,connectionDelegate:{reconnect:function(){var _=G.of(t),m=_.sdkState,b=_.connectionManager,y=_.sessionManager;y.auth.hasSession?m.appState==="foreground"&&b.resetAndReconnect():b.connect(y.auth.authToken)},disconnect:function(){G.of(t).connectionManager.disconnect()}}});var p=new ID(t,{localCacheEnabled:o.localCacheEnabled,dispatcher:u,sdkState:a,logger:d});r.forEach(function(_){_.init(t,{sdkState:a,cacheContext:o,dispatcher:u,sessionManager:c,requestQueue:l,logger:d,onlineDetector:i._onlineDetector}),i[_.name]=_}),this._appStateChangeDetector=new DD({isEnabled:f}),this._appStateChangeDetector.on("resume",function(){d.debug("the page resumes from freeze"),i.setForegroundState()}).on("pause",function(){d.debug("the page freezes"),i.setBackgroundState()}),u.on(function(_){var m;if(_ instanceof mu)_.stateType===dt.CONNECTED&&p.processNonAutoResendRegisteredPendingMessages();else if(_ instanceof En){if(_.code==="USEV"){var b=_.as(ND).event;if(b.category===o_.FRIEND_DISCOVERED){var y=fb.getDataAsFriendDiscoveredEvent(t,b).friendDiscoveries;Ct(function(){return S(i,void 0,void 0,function(){return I(this,function(L){return[2,h.forEach(function(k){k.onFriendsDiscovered&&k.onFriendsDiscovered(y)})]})})})}}}else if(_ instanceof VE){var E=G.of(i._iid).subscribedUnreadMessageCount,T=!1,N=_.ts;if(typeof N=="number"&&N>E.ts){if(E.all!==_.all&&(T=!0),E.all=_.all>=0?_.all:0,_.customTypes)for(var C in _.customTypes)E.customTypes[C]!==_.customTypes[C]&&(T=!0),E.customTypes[C]=_.customTypes[C];T=T&&E.ts>0,E.ts=N}T&&Ct(function(){return S(i,void 0,void 0,function(){return I(this,function(L){return[2,h.forEach(function(k){k.onTotalUnreadMessageCountChanged&&k.onTotalUnreadMessageCountChanged({groupChannelCount:E.all,feedChannelCount:E.feed,customTypeUnreadCount:E.customTypes}),k.onTotalUnreadMessageCountUpdated&&k.onTotalUnreadMessageCountUpdated(E.all,E.customTypes)})]})})})}else _ instanceof KE?(o.preference.set(i._getUserProfileCacheKey(a.userId),Jp.payloadify(_.userProfile)),!((m=_.userProfile.appInfo.notificationInfo)===null||m===void 0)&&m.isEnabled&&o.preference.set($O(i.appId),{value:!0})):_ instanceof nl&&_.error&&(_.error.isSessionRevokedError||_.error.isUserAuthDeactivedError||_.error.isUserAuthDeletedOrNotFoundError)&&(d.debug("session revoked."),i.disconnect())})}return n.init=function(t){var e=t.appId,r=t.appVersion,i=t.modules,s=i===void 0?[]:i,a=t.options,o=a===void 0?new gE:a,u=t.debugMode,c=u!==void 0&&u,l=t.customApiHost,d=t.customWebSocketHost,h=t.newInstance,f=h!==void 0&&h,p=t.logLevel,_=t.localCacheEnabled,m=_!==void 0&&_,b=t.localCacheConfig,y=b===void 0?new EE:b,E=t.localCacheEncryption,T=t.useAsyncStorageStore,N=T===void 0?null:T,C=t.appStateToggleEnabled,L=C===void 0||C;if(!Fu||f){var k="su-".concat(fu()),O=E??{encrypt:function(Ie){return Ie},decrypt:function(Ie){return Ie}},x=new jo({encryption:O});c||(x=Qp()?N?new hD({AsyncStorage:N,encryption:O}):new jo({encryption:O}):new dD({encryption:O})),new G(k,{appId:e,appVersion:r,options:o,apiHost:l??"https://api-".concat(e,".sendbird.com"),websocketHost:d??"wss://ws-".concat(e,".sendbird.com"),store:x,encryption:O,logLevel:p,localCacheEnabled:m,localCacheConfig:y,debugMode:c,appStateToggleEnabled:L});var Q=[new bD,new TD],we=new n(k,o,Ve(Ve([],Re(s),!1),Re(Q),!1));return Fu||(Fu=we),we}return Fu},Object.defineProperty(n,"instance",{get:function(){return Fu},enumerable:!1,configurable:!0}),Object.defineProperty(n,"version",{get:function(){return mE},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appId",{get:function(){return G.of(this._iid).sdkState.appId},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appInfo",{get:function(){var t=G.of(this._iid).appInfo;return t??null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"appVersion",{get:function(){var t;return(t=G.of(this._iid).sdkState.appVersion)!==null&&t!==void 0?t:""},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"debugMode",{get:function(){return!!G.of(this._iid).debugMode},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"logLevel",{get:function(){return G.of(this._iid).logger.level},set:function(t){G.of(this._iid).logger.level=t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isCacheEnabled",{get:function(){return G.of(this._iid).cacheContext.localCacheEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"localCacheConfig",{get:function(){var t=G.of(this._iid).cacheContext;return t.localCacheEnabled?t.localCacheConfig:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ekey",{get:function(){return G.of(this._iid).sessionManager.ekey},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentUser",{get:function(){var t;return(t=G.of(this._iid).sessionManager.currentUser)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"connectionState",{get:function(){var t=G.of(this._iid).connectionManager;return t.isConnected?Fi.OPEN:t.isConnecting?Fi.CONNECTING:Fi.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastConnectedAt",{get:function(){var t=G.of(this._iid),e=t.connectedAt;return t.connectionManager.isConnected?e:0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"fcmPushToken",{get:function(){var t;return(t=this._fcmPushToken)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"apnsPushToken",{get:function(){var t;return(t=this._apnsPushToken)!==null&&t!==void 0?t:null},enumerable:!1,configurable:!0}),n.prototype._getNestDBVersion=function(){return 3},n.prototype._getCurrentPreferenceVersion=function(){return 1},n.prototype._getPreferenceCacheKey=function(t){return"sendbird@".concat(this.appId,"/").concat(t,".pref")},n.prototype._getUserProfileCacheKey=function(t){return"sendbird@".concat(this.appId,"/").concat(t,".profile")},n.prototype.getMemoryStoreForDebugging=function(){var t=G.of(this._iid),e=t.debugMode,r=t.cacheContext;if(e)return r.store instanceof jo?r.store:null;throw H.debugModeRequired},n.prototype.addExtension=function(t,e){var r=G.of(this._iid).sdkState;["sb_uikit","sb_syncmanager","device-os-platform"].indexOf(t)>-1&&r.extensions&&(r.extensions[t]=e)},n.prototype.addSendbirdExtensions=function(t,e,r){var i,s,a=G.of(this._iid),o=a.logger,u=a.sdkState,c=new RegExp(Ak);if(t.length===0)return o.debug("sb.addSendbirdExtensions() has failed because the given sendbirdExtensions is empty."),!1;if(t.find(function(_){return!c.test(_.version)}))return o.debug("sb.addSendbirdExtensions() has failed because the given version did not satisfy the SemVer specification."),!1;if(r)try{for(var l=ke(Object.entries(r)),d=l.next();!d.done;d=l.next()){var h=Re(d.value,2),f=h[0],p=h[1];if(/&|=/.test(f)||/&|=/.test(p))return o.debug("sb.addSendbirdExtensions() has failed because the given customData includes at least one invalid character: = or &."),!1}}catch(_){i={error:_}}finally{try{d&&!d.done&&(s=l.return)&&s.call(l)}finally{if(i)throw i.error}}return u.sendbirdRuntimeEnvironment={sendbirdExtensions:t,deviceOS:e,customData:r},!0},n.prototype.setOnlineListener=function(t){this._onlineDetector.setOnlineListener(t)},n.prototype.setOfflineListener=function(t){this._onlineDetector.setOfflineListener(t)},n.prototype._safeInitializeStore=function(t){return S(this,void 0,void 0,function(){var e;return I(this,function(r){switch(r.label){case 0:e=G.of(this._iid).cacheContext,r.label=1;case 1:return r.trys.push([1,3,,5]),[4,e.store.init(t)];case 2:return r.sent(),this._storeInitialized=!0,[3,5];case 3:return r.sent(),e.replaceStore(new jo),[4,this._safeInitializeStore(t)];case 4:return r.sent(),[3,5];case 5:return[2]}})})},n.prototype.initializeCache=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c,l;return I(this,function(d){switch(d.label){case 0:return e=G.of(this._iid),r=e.sdkState,i=e.cacheContext,s=e.connectionManager,a=e.dispatcher,o=e.logger,r.userId&&r.userId===t?[3,10]:[4,s.logout()];case 1:if(d.sent(),u="sendbird@".concat(r.appId,"/").concat(t,".db"),!i.localCacheEnabled)return[3,8];d.label=2;case 2:return d.trys.push([2,5,,7]),i.nestdb&&i.nestdb.state!==ws.CLOSED&&i.nestdb.name===u?[3,4]:((c=i.nestdb=new fD({name:"sendbird@".concat(r.appId,"/").concat(t,".db"),version:this._getNestDBVersion(),store:i.store})).on("upgrade",h0(c,i.store)),c.on("storeReplaced",function(h){i.replaceStore(h),i.localCacheEnabled=!1,c.on("upgrade",h0(c,i.store))}),[4,c.open()]);case 3:d.sent(),this._storeInitialized=!0,a.dispatch(new SD(this._iid,{userId:t})),d.label=4;case 4:return r.userId=t,[3,7];case 5:return l=d.sent(),o.warn("Nest DB Open Failed. ",l),[4,this._safeInitializeStore(u)];case 6:throw d.sent(),r.userId=t,H.databaseError;case 7:return[3,10];case 8:return[4,this._safeInitializeStore(u)];case 9:d.sent(),r.userId=t,d.label=10;case 10:return[2]}})})},n.prototype.getCacheDataSize=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return(t=G.of(this._iid).cacheContext).localCacheEnabled&&t.nestdb?[4,t.nestdb.estimateUsage()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,0]}})})},n.prototype.clearCachedData=function(){return S(this,void 0,void 0,function(){var t;return I(this,function(e){switch(e.label){case 0:return(t=G.of(this._iid).cacheContext).localCacheEnabled&&t.nestdb?[4,t.nestdb.clear()]:[3,2];case 1:e.sent(),e.label=2;case 2:return this._storeInitialized?[4,t.preference.clear()]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2]}})})},n.prototype.clearCachedMessages=function(t){return S(this,void 0,void 0,function(){var e,r,i=this;return I(this,function(s){switch(s.label){case 0:return ne(We("string",t)).throw(H.invalidParameters),e=H_.of(this._iid),r=al.of(this._iid),e&&r?[4,Promise.all(t.map(function(a){return S(i,void 0,void 0,function(){return I(this,function(o){switch(o.label){case 0:return[4,e.removeMessagesOfChannel(a)];case 1:return o.sent(),[4,r.removeMessagesOfChannel(a)];case 2:return o.sent(),[2]}})})}))]:[3,2];case 1:s.sent(),s.label=2;case 2:return[2]}})})},n.prototype.connect=function(t,e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c;return I(this,function(l){switch(l.label){case 0:ne($("string",t)&&$("string",e,!0)).throw(H.invalidParameters),r=G.of(this._iid),i=r.sdkState,s=r.cacheContext,a=r.connectionManager,o=r.statLogCollector,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,this.initializeCache(t)];case 2:return l.sent(),G.of(this._iid).dispatcher.dispatch(new CD),[3,4];case 3:return l.sent(),u=G.of(this._iid).logger,s.localCacheEnabled=!1,u.warn("Cache initialization failed - cache is not available."),[3,4];case 4:return[4,s.preference.init(this._getPreferenceCacheKey(t),this._getCurrentPreferenceVersion())];case 5:return l.sent(),[4,s.preference.get(this._getUserProfileCacheKey(t))];case 6:return(c=l.sent())&&new Jp(this._iid,c).apply(),[4,o.init("sendbird@".concat(i.appId,"/").concat(t,".statlog"))];case 7:l.sent(),l.label=8;case 8:return l.trys.push([8,,10,11]),[4,a.connect(e)];case 9:return l.sent(),[3,11];case 10:return this._onlineDetector.start(),this._appStateChangeDetector.start(),[7];case 11:return[2,this.currentUser]}})})},n.prototype.reconnect=function(){var t=G.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.sessionManager.auth.hasSession;return i&&(this._appStateChangeDetector.start(),this._onlineDetector.start(),e.resetAndReconnect().then(function(){r.appState="foreground"}).catch(function(){})),i},n.prototype.disconnect=function(){return S(this,void 0,void 0,function(){var t,e,r;return I(this,function(i){switch(i.label){case 0:return t=G.of(this._iid),e=t.connectionManager,r=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,e.logout()];case 1:return i.sent(),[4,this.clearCachedData()];case 2:return i.sent(),[2]}})})},n.prototype.disconnectWebSocket=function(){return S(this,void 0,void 0,function(){var t,e,r;return I(this,function(i){switch(i.label){case 0:return t=G.of(this._iid),e=t.connectionManager,r=t.requestQueue,this._appStateChangeDetector.stop(),this._onlineDetector.stop(),r.cancelAll(),[4,e.disconnectWebSocket()];case 1:return i.sent(),[2]}})})},n.prototype.setBackgroundState=function(){var t=G.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.logger;r.appState==="foreground"&&(r.appState="background",i.debug("going background state"),e.background())},n.prototype.setForegroundState=function(){var t=G.of(this._iid),e=t.connectionManager,r=t.sdkState,i=t.logger;r.appState==="background"&&(r.appState="foreground",i.debug("going foreground state"),e.resetAndReconnect())},n.prototype.setSessionHandler=function(t){ne(t instanceof K2).throw(H.invalidParameters),G.of(this._iid).sessionManager.handler=t},n.prototype.addUserEventHandler=function(t,e){ne($("string",t)&&e instanceof Q2).throw(H.invalidParameters),G.of(this._iid).userEventHandlers.set(t,e)},n.prototype.removeUserEventHandler=function(t){G.of(this._iid).userEventHandlers.delete(t)},n.prototype.removeAllUserEventHandler=function(){G.of(this._iid).userEventHandlers.clear()},n.prototype.addConnectionHandler=function(t,e){ne($("string",t)&&e instanceof j2).throw(H.invalidParameters),G.of(this._iid).connectionHandlers.set(t,e)},n.prototype.removeConnectionHandler=function(t){G.of(this._iid).connectionHandlers.delete(t)},n.prototype.removeAllConnectionHandler=function(){G.of(this._iid).connectionHandlers.clear()},n.prototype.createApplicationUserListQuery=function(t){return t===void 0&&(t={}),new Z2(this._iid,t)},n.prototype.createBlockedUserListQuery=function(t){return t===void 0&&(t={}),new eD(this._iid,t)},n.prototype.createFriendListQuery=function(t){return t===void 0&&(t={}),new rD(this._iid,t)},n.prototype.createMessageSearchQuery=function(t){return new yD(this._iid,t)},n.prototype.createPollListQuery=function(t){return new ib(this._iid,P({},t))},n.prototype.createPollVoterListQuery=function(t){return new sb(this._iid,P({},t))},n.prototype.buildUserFromSerializedData=function(t){var e=eh(t);return new $e(this._iid,$e.payloadify(e))},n.prototype.updateCurrentUserInfo=function(t){return t===void 0&&(t={}),S(this,void 0,void 0,function(){var e,r,i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:return e=P(P({},OD),t),ne(function(l){return Gi(l.profileImage,!0)&&$("string",l.profileUrl,!0)&&$("string",l.nickname,!0)}(e)).throw(H.invalidParameters),this.currentUser?(r=G.of(this._iid),i=r.sdkState,s=r.requestQueue,a=new f0(P({userId:i.userId},e)),[4,s.send(a)]):[3,2];case 1:return o=c.sent(),u=o.as(p0).user,this.currentUser&&(e.nickname&&(this.currentUser.nickname=u.nickname),(e.profileUrl||e.profileImage)&&(this.currentUser.plainProfileUrl=u.profileUrl)),[2,u];case 2:throw H.connectionRequired}})})},n.prototype.updateCurrentUserInfoWithPreferredLanguages=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o;return I(this,function(u){switch(u.label){case 0:return ne(We("string",t)).throw(H.invalidParameters),this.currentUser?(e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new f0({userId:r.userId,preferredLanguages:t}),[4,i.send(s)]):[3,2];case 1:return a=u.sent(),o=a.as(p0).user,this.currentUser&&(this.currentUser.preferredLanguages=o.preferredLanguages),[2,o];case 2:throw H.connectionRequired}})})},n.prototype.registerFCMPushTokenForCurrentUser=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o=this;return I(this,function(u){switch(u.label){case 0:if(ne($("string",t)).throw(H.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),e=G.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,r.hasDeviceToken(Zt.FCM,t)?[2,Pn.SUCCESS]:(a=new LD({userId:i.userId,token:t}),[4,s.send(a)]);case 2:return u.sent(),[4,gr(function(){return S(o,void 0,void 0,function(){return I(this,function(c){switch(c.label){case 0:return r.setDeviceToken(Zt.FCM,t),[4,r.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 3:return u.sent(),this._fcmPushToken="",[2,Pn.SUCCESS];case 4:return u.sent(),[2,Pn.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=t,[2,Pn.PENDING];case 7:return[2]}})})},n.prototype.unregisterFCMPushTokenForCurrentUser=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u=this;return I(this,function(c){switch(c.label){case 0:if(ne($("string",t)).throw(H.invalidParameters),!this.currentUser)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),e=G.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,a=new xD({userId:i.userId,token:t}),[4,s.send(a)];case 2:return o=c.sent().lastDeletedAt,[4,gr(function(){return S(u,void 0,void 0,function(){return I(this,function(l){switch(l.label){case 0:return r.unsetDeviceToken(Zt.FCM,t),r.setDeviceTokenDeletedAt(o),[4,r.saveDeviceToken()];case 1:return l.sent(),[2]}})})})];case 3:return c.sent(),this._fcmPushToken="",[2,Pn.SUCCESS];case 4:return c.sent(),[2,Pn.ERROR];case 5:return[3,7];case 6:return this._fcmPushToken=t,[2,Pn.PENDING];case 7:return[2]}})})},n.prototype.unregisterFCMPushTokenAllForCurrentUser=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o=this;return I(this,function(u){switch(u.label){case 0:return this.currentUser?(t=G.of(this._iid),e=t.sessionManager,r=t.sdkState,i=t.requestQueue,s=new qD({userId:r.userId}),[4,i.send(s)]):[3,3];case 1:return a=u.sent().lastDeletedAt,[4,gr(function(){return S(o,void 0,void 0,function(){return I(this,function(c){switch(c.label){case 0:return e.unsetDeviceTokens(Zt.FCM),e.setDeviceTokenDeletedAt(a),[4,e.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 2:u.sent(),u.label=3;case 3:return[2]}})})},n.prototype.registerAPNSPushTokenForCurrentUser=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o=this;return I(this,function(u){switch(u.label){case 0:if(ne($("string",t)).throw(H.invalidParameters),!this.currentUser)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),e=G.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,r.hasDeviceToken(Zt.APNS,t)?[2,Pn.SUCCESS]:(a=new UD({userId:i.userId,token:t}),[4,s.send(a)]);case 2:return u.sent(),[4,gr(function(){return S(o,void 0,void 0,function(){return I(this,function(c){switch(c.label){case 0:return r.setDeviceToken(Zt.APNS,t),[4,r.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 3:return u.sent(),this._apnsPushToken="",[2,Pn.SUCCESS];case 4:return u.sent(),[2,Pn.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=t,[2,Pn.PENDING];case 7:return[2]}})})},n.prototype.unregisterAPNSPushTokenForCurrentUser=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a,o,u=this;return I(this,function(c){switch(c.label){case 0:if(ne($("string",t)).throw(H.invalidParameters),!this.currentUser)return[3,6];c.label=1;case 1:return c.trys.push([1,4,,5]),e=G.of(this._iid),r=e.sessionManager,i=e.sdkState,s=e.requestQueue,a=new PD({userId:i.userId,token:t}),[4,s.send(a)];case 2:return o=c.sent().lastDeletedAt,[4,gr(function(){return S(u,void 0,void 0,function(){return I(this,function(l){switch(l.label){case 0:return r.unsetDeviceToken(Zt.APNS,t),r.setDeviceTokenDeletedAt(o),[4,r.saveDeviceToken()];case 1:return l.sent(),[2]}})})})];case 3:return c.sent(),this._apnsPushToken="",[2,Pn.SUCCESS];case 4:return c.sent(),[2,Pn.ERROR];case 5:return[3,7];case 6:return this._apnsPushToken=t,[2,Pn.PENDING];case 7:return[2]}})})},n.prototype.unregisterAPNSPushTokenAllForCurrentUser=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s,a,o=this;return I(this,function(u){switch(u.label){case 0:return this.currentUser?(t=G.of(this._iid),e=t.sessionManager,r=t.sdkState,i=t.requestQueue,s=new FD({userId:r.userId}),[4,i.send(s)]):[3,3];case 1:return a=u.sent().lastDeletedAt,[4,gr(function(){return S(o,void 0,void 0,function(){return I(this,function(c){switch(c.label){case 0:return e.unsetDeviceTokens(Zt.APNS),e.setDeviceTokenDeletedAt(a),[4,e.saveDeviceToken()];case 1:return c.sent(),[2]}})})})];case 2:u.sent(),u.label=3;case 3:return[2]}})})},n.prototype.getChannelInvitationPreference=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s;return I(this,function(a){switch(a.label){case 0:return t=G.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new zD({userId:e.userId}),[4,r.send(i)];case 1:return s=a.sent(),[2,{autoAccept:s.as(GD).autoAccept}]}})})},n.prototype.setChannelInvitationPreference=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a;return I(this,function(o){switch(o.label){case 0:return ne($("boolean",t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new VD({userId:r.userId,willAutoAccept:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,{autoAccept:a.as(BD).autoAccept}]}})})},n.prototype.getDoNotDisturb=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s;return I(this,function(a){switch(a.label){case 0:return t=G.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new jD({userId:e.userId}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(KD).preference]}})})},n.prototype.setDoNotDisturb=function(t,e,r,i,s,a){return e===void 0&&(e=0),r===void 0&&(r=0),i===void 0&&(i=0),s===void 0&&(s=0),a===void 0&&(a=""),S(this,void 0,void 0,function(){var o,u,c,l,d;return I(this,function(h){switch(h.label){case 0:return ne($("boolean",t)&&$("number",e)&&$("number",r)&&$("number",i)&&$("number",s)&&$("string",a)).throw(H.invalidParameters),o=G.of(this._iid),u=o.sdkState,c=o.requestQueue,l=new QD({userId:u.userId,doNotDisturbOn:t,startHour:e,startMin:r,endHour:i,endMin:s,timezone:a}),[4,c.send(l)];case 1:return d=h.sent(),[2,d.as(WD).preference]}})})},n.prototype.getSnoozePeriod=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s;return I(this,function(a){switch(a.label){case 0:return t=G.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new YD({userId:e.userId}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(ZD).snoozePeriod]}})})},n.prototype.setSnoozePeriod=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=0),S(this,void 0,void 0,function(){var i,s,a,o,u;return I(this,function(c){switch(c.label){case 0:return ne($("boolean",t)&&$("number",e)&&$("number",r)).throw(H.invalidParameters),i=G.of(this._iid),s=i.sdkState,a=i.requestQueue,o=new JD({userId:s.userId,snoozeOn:t,startTs:e,endTs:r}),[4,a.send(o)];case 1:return u=c.sent(),[2,u.as(XD).snoozePeriod]}})})},n.prototype.getMyPushTokensByToken=function(t,e){return S(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,d,h,f,p;return I(this,function(_){switch(_.label){case 0:return ne($("string",t)&&yt(Zt,e)).throw(H.invalidParameters),r=G.of(this._iid),i=r.sdkState,s=r.requestQueue,a=r.sessionManager,o=new $D({userId:i.userId,type:e,token:t}),[4,s.send(o)];case 1:u=_.sent(),c=u.as(HD).pushTokens;try{for(l=ke(c.deviceTokens),d=l.next();!d.done;d=l.next())h=d.value,a.setDeviceToken(c.type,h)}catch(m){f={error:m}}finally{try{d&&!d.done&&(p=l.return)&&p.call(l)}finally{if(f)throw f.error}}return[4,a.saveDeviceToken()];case 2:return _.sent(),[2,c]}})})},n.prototype.getPushTriggerOption=function(){return S(this,void 0,void 0,function(){var t,e,r,i;return I(this,function(s){switch(s.label){case 0:return t=G.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new nR({userId:e.userId}),[4,r.send(i)];case 1:return[2,s.sent().as(rR).pushTriggerOption]}})})},n.prototype.setPushTriggerOption=function(t){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return ne(yt(Gp,t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new iR({userId:r.userId,pushTriggerOption:t}),[4,i.send(s)];case 1:return[2,a.sent().as(sR).pushTriggerOption]}})})},n.prototype.getPushTemplate=function(){return S(this,void 0,void 0,function(){var t,e,r,i;return I(this,function(s){switch(s.label){case 0:return t=G.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new aR({userId:e.userId}),[4,r.send(i)];case 1:return[2,s.sent().as(oR).name]}})})},n.prototype.setPushTemplate=function(t){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return ne(yt(Vp,t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new uR({userId:r.userId,templateName:t}),[4,i.send(s)];case 1:return[2,a.sent().as(cR).name]}})})},n.prototype.blockUser=function(t){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return ne(t instanceof $e||$("string",t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new eR({userId:r.userId,blockedUserId:t instanceof $e?t.userId:t}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},n.prototype.blockUserWithUserId=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return[2,this.blockUser(t)]})})},n.prototype.unblockUser=function(t){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return ne(t instanceof $e||$("string",t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new tR({userId:r.userId,unblockedUserId:t instanceof $e?t.userId:t}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},n.prototype.unblockUserWithUserId=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return[2,this.unblockUser(t)]})})},n.prototype.getFriendChangeLogsByToken=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a;return I(this,function(o){switch(o.label){case 0:return ne($("string",t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new lR({userId:r.userId,token:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(dR).changelogs]}})})},n.prototype.getAllowFriendDiscovery=function(){return S(this,void 0,void 0,function(){var t,e,r,i,s;return I(this,function(a){switch(a.label){case 0:return t=G.of(this._iid),e=t.sdkState,r=t.requestQueue,i=new gR({userId:e.userId}),[4,r.send(i)];case 1:return s=a.sent(),[2,s.as(yR).allowFriendDiscovery]}})})},n.prototype.setAllowFriendDiscovery=function(t){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return ne($("boolean",t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new ER({userId:r.userId,allowFriendDiscovery:t}),[4,i.send(s)];case 1:return a.sent(),[2,t]}})})},n.prototype.uploadFriendDiscoveries=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a;return I(this,function(o){switch(o.label){case 0:return e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new hR({userId:r.userId,discoveries:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(fR).friendDiscoveryRequestId]}})})},n.prototype.deleteFriendDiscovery=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return[2,this.deleteFriendDiscoveries([t])]})})},n.prototype.deleteFriendDiscoveries=function(t){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return ne(We("string",t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new pR({userId:r.userId,discoveryKeys:t}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},n.prototype.addFriends=function(t){return S(this,void 0,void 0,function(){var e,r,i,s,a;return I(this,function(o){switch(o.label){case 0:return ne(We("string",t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new _R({userId:r.userId,userIds:t}),[4,i.send(s)];case 1:return a=o.sent(),[2,a.as(mR).users]}})})},n.prototype.deleteFriend=function(t){return S(this,void 0,void 0,function(){return I(this,function(e){return[2,this.deleteFriends([t])]})})},n.prototype.deleteFriends=function(t){return S(this,void 0,void 0,function(){var e,r,i,s;return I(this,function(a){switch(a.label){case 0:return ne(We("string",t)).throw(H.invalidParameters),e=G.of(this._iid),r=e.sdkState,i=e.requestQueue,s=new vR({userId:r.userId,userIds:t}),[4,i.send(s)];case 1:return a.sent(),[2]}})})},n.prototype.getAllEmoji=function(){return S(this,void 0,void 0,function(){var t,e,r;return I(this,function(i){switch(i.label){case 0:return t=G.of(this._iid).requestQueue,e=new bR,[4,t.send(e)];case 1:return r=i.sent(),[2,r.as(TR).emojiContainer]}})})},n.prototype.getEmojiCategory=function(t){return S(this,void 0,void 0,function(){var e,r,i;return I(this,function(s){switch(s.label){case 0:return e=G.of(this._iid).requestQueue,r=new wR({categoryId:t}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(IR).emojiCategory]}})})},n.prototype.getEmoji=function(t){return S(this,void 0,void 0,function(){var e,r,i;return I(this,function(s){switch(s.label){case 0:return e=G.of(this._iid).requestQueue,r=new SR({key:t}),[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(CR).emoji]}})})},n.prototype.getUIKitConfiguration=function(){return S(this,void 0,void 0,function(){var t,e,r,i;return I(this,function(s){switch(s.label){case 0:return t=G.of(this._iid),ne(t.hasExtension("sb_uikit")).throw(H.notSupportedError),e=t.requestQueue,r=new NR,[4,e.send(r)];case 1:return i=s.sent(),[2,i.as(AR).uikitConfiguration]}})})},n})();var u_="1.1.2",Jf=!1,Xf,_0=Kp.WEB,id,kR=u_,m0="4.9.6",_t=function(){function n(){}return Object.defineProperty(n,"sendbird",{get:function(){return Xf},set:function(t){Xf=t},enumerable:!1,configurable:!0}),Object.defineProperty(n,"platform",{get:function(){return _0},set:function(t){_0=t},enumerable:!1,configurable:!0}),Object.defineProperty(n,"isDebugMode",{get:function(){return Jf},enumerable:!1,configurable:!0}),n.setDebugMode=function(){Jf=!0},n.unsetDebugMode=function(){Jf=!1},Object.defineProperty(n,"apiHost",{get:function(){if(!id){var t=Xf;id="https://desk-api-".concat(t.appId,".sendbird.com/sapi")}return id},set:function(t){id=t},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sdkVersion",{get:function(){return kR},enumerable:!1,configurable:!0}),Object.defineProperty(n,"minSendbirdVersion",{get:function(){return m0},enumerable:!1,configurable:!0}),n.isSendbirdSdkCompatible=function(t){var e=m0.split("."),r=t.split(".");if(e.length===r.length){for(var i in e){if(parseInt(e[i])<parseInt(r[i]))return!0;if(parseInt(e[i])>parseInt(r[i]))return!1}return!0}return!1},n}(),OR={ERROR_SENDBIRD_SDK_MISSING:{code:100,message:"Sendbird SDK is missing."},ERROR_SENDBIRD_SDK_VERSION_NOT_SUPPORTED:{code:101,message:"This Sendbird SDK version is not supported."},ERROR_SENDBIRD_DESK_INIT_MISSING:{code:102,message:"Sendbird Desk SDK is not initialized. It should be done before authentication."},ERROR_SENDBIRD_DESK_AUTH_FAILED:{code:103,message:"Sendbird Desk authentication failed."},ERROR_SENDBIRD_SDK_MESSAGE_LIST_FAILED:{code:200,message:"Cannot load messages in SDK client."},ERROR_INVALID_PARAMETER:{code:403,message:"Invalid parameter."},ERROR_DATA_NOT_FOUND:{code:404,message:"Data not found."},ERROR_REQUEST_TIMEOUT:{code:409,message:"Request timed-out."},ERROR_REQUEST:{code:500,message:"Request failed."},ERROR_REQUEST_CANCELED:{code:501,message:"Request canceled."}},Y=function(n){dk(t,n);function t(e,r){var i=n.call(this,e)||this;return typeof Error.captureStackTrace=="function"?Error.captureStackTrace(i,i.constructor):i.stack=new Error(e).stack,i.name="SendbirdDeskError",i.code=r,i}return Object.defineProperty(t,"Type",{get:function(){return OR},enumerable:!1,configurable:!0}),t.create=function(e){return e?new t(e.message,e.code):new Error("SendbirdDeskError type missing.")},t.throw=function(e){throw new t(e.message,e.code)},t}(Error),_e=function(){function n(){}return n.write=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];_t.isDebugMode&&console.log.apply(console,Wv([],ui(t),!1))},n.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];_t.isDebugMode&&console.error.apply(console,Wv([],ui(t),!1))},n}(),ep={},Xe=function(){function n(){}return n.connect=function(t,e){return tn(this,void 0,void 0,function(){var r,i,s;return nn(this,function(a){switch(a.label){case 0:return r=_t.sendbird,r.addSendbirdExtensions([{product:jp.DESK,version:u_,platform:zc.JS}],{platform:_t.platform}),r?[4,fetch("".concat(_t.apiHost,"/customers/auth/"),{method:"POST",headers:{sendbirdAccessToken:e||"","content-type":"application/json"},body:JSON.stringify({sendbirdAppId:r.appId,sendbirdId:t})})]:[3,3];case 1:return i=a.sent(),[4,i.json()];case 2:return s=a.sent(),ep.deskToken=s.token,_e.write("[REQ] connection established"),[3,4];case 3:throw Y.create(Y.Type.ERROR_SENDBIRD_SDK_MISSING);case 4:return[2]}})})},Object.defineProperty(n,"header",{get:function(){if(ep.deskToken)return{sendbirdDeskToken:ep.deskToken,"content-type":"application/json","user-agent":"desk-js@".concat(u_)};throw Y.create(Y.Type.ERROR_SENDBIRD_DESK_INIT_MISSING)},enumerable:!1,configurable:!0}),Object.defineProperty(n,"getParam",{get:function(){var t=_t.sendbird;return t?"sendbirdAppId=".concat(t.appId):""},enumerable:!1,configurable:!0}),Object.defineProperty(n,"postParam",{get:function(){var t=_t.sendbird;return t?{sendbirdAppId:t.appId}:{}},enumerable:!1,configurable:!0}),n}(),c_=function(){function n(t){this.fetchFromJSON(t)}return n.prototype.fetchFromJSON=function(t){var e,r,i,s,a;if("id"in t){this.userId=t.id,this.name=(e=t.displayName)!==null&&e!==void 0?e:"",this.profileUrl=(r=t.photoThumbnailUrl)!==null&&r!==void 0?r:"",this.sendbirdId=t.sendbirdId;return}this.userId=(i=t.user)!==null&&i!==void 0?i:0,this.name=(s=t.displayName)!==null&&s!==void 0?s:"",this.profileUrl=(a=t.photoThumbnailUrl)!==null&&a!==void 0?a:""},n}(),mb=function(){function n(t){this.fetchFromJSON(t)}return n.prototype.fetchFromJSON=function(t){var e,r;this.channelUrl=(e=t.channel_url)!==null&&e!==void 0?e:"",this.name=(r=t.name)!==null&&r!==void 0?r:""},n}(),wd={URGENT:"URGENT",HIGH:"HIGH",MEDIUM:"MEDIUM",LOW:"LOW"},l_={INITIALIZED:"INITIALIZED",PROACTIVE:"PROACTIVE",UNASSIGNED:"UNASSIGNED",ASSIGNED:"ASSIGNED",OPEN:"OPEN",CLOSED:"CLOSED"};function MR(n){if((n==null?void 0:n.length)<3||(n==null?void 0:n.length)>8)throw _e.error("[REQ] Close ticket should have at least 1 param."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(n.length===3){var t=ui(n,3),e=t[0],r=t[1],i=t[2];return{title:e,name:r,cb:i}}if(n.length===4){var s=ui(n,4),e=s[0],a=s[1],o=s[2],i=s[3];return{title:e,name:a,groupKey:o,cb:i}}if(n.length===5){var u=ui(n,5),e=u[0],c=u[1],o=u[2],l=u[3],i=u[4];return{title:e,name:c,groupKey:o,customFields:l,cb:i}}if(n.length===6){var d=ui(n,6),e=d[0],h=d[1],o=d[2],l=d[3],f=d[4],i=d[5];return{title:e,name:h,groupKey:o,customFields:l,priority:f,cb:i}}if(n.length===7){var p=ui(n,7),e=p[0],_=p[1],o=p[2],l=p[3],f=p[4],m=p[5],i=p[6];return{title:e,name:_,groupKey:o,customFields:l,priority:f,relatedChannelUrls:m,cb:i}}if(n.length===8){var b=ui(n,8),e=b[0],y=b[1],o=b[2],l=b[3],f=b[4],m=b[5],E=b[6],i=b[7];return{title:e,name:y,groupKey:o,customFields:l,priority:f,relatedChannelUrls:m,botKey:E,cb:i}}throw _e.error("[REQ] Create ticket should have between 3 to 8 paramters."),Y.create(Y.Type.ERROR_INVALID_PARAMETER)}function DR(n){var t=n.title,e=n.name,r=n.groupKey,i=n.customFields,s=n.relatedChannelUrls,a=n.botKey,o=n.priority;if(typeof t!="string")throw _e.error("[REQ] Create ticket title should be a string."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(typeof e!="string")throw _e.error("[REQ] Create ticket name should be a string."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(r&&typeof r!="string")throw _e.error("[REQ] Create ticket groupKey should be a string."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(o&&wd[o]===void 0)throw _e.error("[REQ] Create ticket priority should be a string."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(i&&typeof i!="object")throw _e.error("[REQ] Create ticket customFields should be an object."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(Array.isArray(i))throw _e.error("[REQ] Create ticket customFields cannot be an array."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(s&&(!Array.isArray(s)||s.some(function(u){return typeof u!="string"})))throw _e.error("[REQ] Create ticket relatedChannelUrls should be an array."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(a&&typeof a!="string")throw _e.error("[REQ] Create ticket botKey should be a string."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(typeof n.cb!="function")throw _e.error("[REQ] Create ticket callback should be a function."),Y.create(Y.Type.ERROR_INVALID_PARAMETER)}function ol(){}function RR(n){if(n.length>2)throw _e.error("[REQ] Close ticket should have only 2 params."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);var t="",e=ol;return n.length===1&&(typeof n[0]=="string"?t=n[0]:typeof n[0]=="function"&&(e=n[0])),n.length===2&&(t=n[0],e=n[1]),{comment:t,cb:e}}function UR(n){var t=n.comment,e=n.cb;if(typeof t!="string")throw _e.error("[REQ] first param must be string."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(typeof e!="function")throw _e.error("[REQ] second param must be callback."),Y.create(Y.Type.ERROR_INVALID_PARAMETER)}var ja=function(){function n(){}return Object.defineProperty(n,"CustomType",{get:function(){return{RICH_MESSAGE:"SENDBIRD_DESK_RICH_MESSAGE",ADMIN_MESSAGE:"SENDBIRD_DESK_ADMIN_MESSAGE_CUSTOM_TYPE"}},enumerable:!1,configurable:!0}),Object.defineProperty(n,"DataType",{get:function(){return{TICKET_INQUIRE_CLOSURE:"SENDBIRD_DESK_INQUIRE_TICKET_CLOSURE",TICKET_ASSIGN:"TICKET_ASSIGN",TICKET_TRANSFER:"TICKET_TRANSFER",TICKET_CLOSE:"TICKET_CLOSE",TICKET_FEEDBACK:"SENDBIRD_DESK_CUSTOMER_SATISFACTION",URL_PREVIEW:"SENDBIRD_DESK_URL_PREVIEW"}},enumerable:!1,configurable:!0}),Object.defineProperty(n,"ClosureState",{get:function(){return{WAITING:"WAITING",CONFIRMED:"CONFIRMED",DECLINED:"DECLINED"}},enumerable:!1,configurable:!0}),Object.defineProperty(n,"FeedbackState",{get:function(){return{WAITING:"WAITING",CONFIRMED:"CONFIRMED"}},enumerable:!1,configurable:!0}),Object.defineProperty(n,"UrlRegExp",{get:function(){return/(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?/gi},enumerable:!1,configurable:!0}),n}();function LR(n){if((n==null?void 0:n.length)<1)throw _e.error("Cancel ticket should have at least 1 param."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(n.length>2)throw _e.error("Cancel ticket should have only 2 params."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);var t="",e=ol;return n.length===1&&typeof n[0]=="function"&&(e=n[0]),n.length===1&&typeof n[0]=="string"&&(t=n[0]),n.length===2&&(t=n[0],e=n[1]),{groupKeyForTransfer:t,cb:e}}function PR(n){if(typeof n.groupKeyForTransfer!="string")throw _e.error("First param must be string."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(typeof n.cb!="function")throw _e.error("Second param must be callback."),Y.create(Y.Type.ERROR_INVALID_PARAMETER)}function xR(n){if((n==null?void 0:n.length)<2||(n==null?void 0:n.length)>3)throw _e.error("[REQ] Get ticket should have 2 or 3 paramters."),Y.create(Y.Type.ERROR_INVALID_PARAMETER);var t=n[0],e=n[1],r=n[n.length-1]||ol;return{channelUrl:t,cachingEnabled:e,cb:r}}var vb="SENDBIRD_DESK_CHANNEL_CUSTOM_TYPE",gb=10,sd=function(n){return tn(void 0,void 0,void 0,function(){var t,e,r;return nn(this,function(i){switch(i.label){case 0:if(t=_t.sendbird,!t)return[3,5];e=t.groupChannel.createMyGroupChannelListQuery({customTypesFilter:[vb],channelUrlsFilter:n,includeEmpty:!0}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.next()];case 2:return[2,i.sent()];case 3:throw r=i.sent(),_e.error("[REQ] ticket get by channel urls failed:",r),Y.create(Y.Type.ERROR_REQUEST);case 4:return[3,6];case 5:throw _e.error("[REQ] ticket get by channel urls failed: chat SDK is not initialized."),Y.create(Y.Type.ERROR_SENDBIRD_SDK_MISSING);case 6:return[2]}})})};function FR(n,t,e){var r=e.offset,i=r===void 0?0:r,s=e.limit,a=s===void 0?gb:s,o=e.order,u=o===void 0?"-updated_at":o,c=e.channelUrl,l=e.customFieldFilter,d=e.group,h=e.status,f=h===void 0?"ALL":h,p=f!==l_.CLOSED?"status=ASSIGNED&status=UNASSIGNED":"status=CLOSED",_="".concat(n,"/tickets/")+"?".concat(t,"&limit=").concat(a,"&offset=").concat(i)+"".concat(f==="ALL"?"":"&".concat(p),"&order=").concat(u);return c&&(_+="&channelUrl=".concat(c)),d&&(_+="&group=".concat(d)),l&&typeof l=="object"&&(_+="&customFields="+encodeURIComponent(Object.keys(l).map(function(m){return"".concat(m,":").concat(encodeURIComponent(l[m]))}).join(","))),_}function tp(n){if((n==null?void 0:n.length)<2||(n==null?void 0:n.length)>3)throw new Error("Get ticket should have 2 or 3 paramters.");var t=0,e={},r=ol;return n.length===2&&(t=n[0],r=n[1]),n.length===3&&(t=n[0],e=n[1],r=n[2]),{offset:t,filter:e,cb:r}}function np(n){var t=n.offset,e=n.filter,r=n.cb;if(typeof t!="number")throw new Error("Get ticket offset should be a number.");if(typeof r!="function")throw new Error("Get ticket callback should be a function.");if(e&&typeof e!="object")throw new Error("Get ticket filter should be an object.")}var ls={},v0=function(){function n(t){this.fetchFromJSON(t)}return Object.defineProperty(n,"Status",{get:function(){return l_},enumerable:!1,configurable:!0}),n.prototype.fetchFromJSON=function(t){var e,r,i,s,a,o,u,c,l;if(this.id=t.id,this.title=(e=t.channelName)!==null&&e!==void 0?e:"",this.status=(r=t.status)!==null&&r!==void 0?r:l_.UNASSIGNED,this.info=t.info?JSON.parse(t.info):null,this.priority=(i=t.priority)!==null&&i!==void 0?i:wd.MEDIUM,this.agent=!((s=t.recentAssignment)===null||s===void 0)&&s.agent?new c_(t.recentAssignment.agent):null,this.proactiveChatCreatedBy=t.proactiveChatCreatedBy?new c_(t.proactiveChatCreatedBy):null,this.customer=(a=t.customer)!==null&&a!==void 0?a:null,this.customFields={},this.group=(o=t.group)!==null&&o!==void 0?o:0,this.firstResponseTime=(u=t.firstResponseTime)!==null&&u!==void 0?u:0,this.relatedChannels=[],this.channelUrl=(c=t.channelUrl)!==null&&c!==void 0?c:null,this.updatedAt=(l=t.updatedAt)!==null&&l!==void 0?l:0,t.customFields)for(var d=t.customFields,h=0;h<d.length;h++){var f=d[h].key,p=d[h].value;this.customFields[f]=p}if(t.relatedChannels)try{var _=JSON.parse(t.relatedChannels);Array.isArray(_)&&(this.relatedChannels=_.map(function(m){return new mb(m)}))}catch{}},n.prototype._fetchChannel=function(){return tn(this,void 0,void 0,function(){var t,e;return nn(this,function(r){switch(r.label){case 0:return[4,sd([this.channelUrl])];case 1:return t=ui.apply(void 0,[r.sent(),1]),e=t[0],this.channel=e,ls[this.channelUrl]=this,[2]}})})},n._getTicketList=function(t){return tn(this,void 0,void 0,function(){var e,r,i,s,a,o,u,c;return nn(this,function(l){switch(l.label){case 0:return e=FR(_t.apiHost,Xe.getParam,t),[4,fetch(e,{method:"GET",headers:Xe.header})];case 1:return r=l.sent(),[4,r.json()];case 2:if(i=l.sent(),!r.ok)throw _e.error("[REQ] ticket list failed:",i),Y.create(Y.Type.ERROR_REQUEST);if(s=[],a=[],!Array.isArray(i.results))return[3,4];for(o in i.results)u=new n(i.results[o]),ls[u.channelUrl]=u,a.push(u.channelUrl),s.push(u);return[4,sd(a)];case 3:c=l.sent(),s.forEach(function(d){for(var h in c){var f=c[h];if(d.channelUrl===f.url){d.channel=f;break}}}),_e.write("[REQ] ".concat(status," ticket list:"),s),l.label=4;case 4:return[2,s]}})})},n.prototype.refresh=function(t){this._refresh().then(function(e){return t(e,null)}).catch(function(e){return t(null,e)})},n.prototype._refresh=function(){return tn(this,void 0,void 0,function(){var t,e,r;return nn(this,function(i){switch(i.label){case 0:return[4,fetch("".concat(_t.apiHost,"/tickets/").concat(this.id,"/?").concat(Xe.getParam),{method:"GET",headers:Xe.header})];case 1:return t=i.sent(),[4,t.json()];case 2:if(e=i.sent(),!t.ok)throw _e.error("[REQ] ticket refresh failed:",t),r=Y.create(Y.Type.ERROR_REQUEST),r;return this.fetchFromJSON(e),[4,this._fetchChannel()];case 3:return i.sent(),_e.write("[REQ] ticket refresh:",this),[2,this]}})})},n.prototype.reopen=function(t){this._reopen().then(function(e){return t(e,null)}).catch(function(e){return t(null,e)})},n.prototype._reopen=function(){return tn(this,void 0,void 0,function(){var t,e,i,r,i;return nn(this,function(s){switch(s.label){case 0:return s.trys.push([0,5,,6]),[4,fetch("".concat(_t.apiHost,"/tickets/").concat(this.id,"/reopen/"),{method:"PATCH",headers:Xe.header,body:JSON.stringify(Xe.postParam)})];case 1:return t=s.sent(),[4,t.json()];case 2:if(e=s.sent(),!t.ok)throw _e.error("[REQ] ticket reopen failed:",e),i=Y.create(Y.Type.ERROR_REQUEST),i;return e.channelUrl?(this.fetchFromJSON(e),[4,this._fetchChannel()]):[3,4];case 3:s.sent(),_e.write("[REQ] ticket reopen:",this),s.label=4;case 4:return[2,this];case 5:throw r=s.sent(),_e.error("[REQ] ticket reopen failed:",r),i=Y.create(Y.Type.ERROR_REQUEST),i;case 6:return[2]}})})},n.prototype.cancel=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=LR(t),i=r.cb;this._cancel(r).then(function(s){return i(s,null)}).catch(function(s){return i(null,s)})},n.prototype._cancel=function(t){return tn(this,void 0,void 0,function(){var e,r,i,s,a;return nn(this,function(o){switch(o.label){case 0:return PR(t),e=t.groupKeyForTransfer,r=vt({},Xe.postParam),e&&(r.groupKeyForTransfer=e),[4,fetch("".concat(_t.apiHost,"/tickets/").concat(this.id,"/cancel"),{method:"PATCH",headers:Xe.header,body:JSON.stringify(r)})];case 1:return i=o.sent(),[4,i.json()];case 2:if(s=o.sent(),!i.ok)throw _e.error("[REQ] ticket cancel failed:",s),a=Y.create(Y.Type.ERROR_REQUEST),a;return s.channelUrl?(this.fetchFromJSON(s),[4,this._fetchChannel()]):[3,4];case 3:o.sent(),_e.write("[REQ] ticket cancel:",this),o.label=4;case 4:return[2,this]}})})},n.prototype.close=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=RR(t),i=r.cb;this._close(r).then(function(s){return i(s,null)}).catch(function(s){return i(null,s)})},n.prototype._close=function(t){return tn(this,void 0,void 0,function(){var e,r,i,s;return nn(this,function(a){switch(a.label){case 0:return UR(t),e=t.comment,[4,fetch("".concat(_t.apiHost,"/tickets/").concat(this.id,"/close"),{method:"PATCH",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{closeComment:e}))})];case 1:return r=a.sent(),[4,r.json()];case 2:if(i=a.sent(),!r.ok)throw _e.error("[REQ] ticket close failed:",i),s=Y.create(Y.Type.ERROR_REQUEST),s;return i.channelUrl?(this.fetchFromJSON(i),[4,this._fetchChannel()]):[3,4];case 3:a.sent(),_e.write("[REQ] ticket close:",this),a.label=4;case 4:return[2,this]}})})},n.prototype.selectQuestion=function(t,e,r){this._selectQuestion(t,e).then(function(i){return r(i,null)}).catch(function(i){return r(null,i)})},n.prototype._selectQuestion=function(t,e){return tn(this,void 0,void 0,function(){var r,i,s;return nn(this,function(a){switch(a.label){case 0:if(typeof t!="number"||typeof e!="string")throw Y.create(Y.Type.ERROR_INVALID_PARAMETER);return[4,fetch("".concat(_t.apiHost,"/tickets/").concat(this.id,"/select_question"),{method:"POST",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{faqFileId:t,question:e}))})];case 1:return r=a.sent(),[4,r.json()];case 2:if(i=a.sent(),!r.ok)throw _e.error("[REQ] ticket select question failed:",i),s=Y.create(Y.Type.ERROR_REQUEST),s;return _e.write("[REQ] ticket select option:",this),[2,this]}})})},n.prototype.setPriority=function(t,e){this._setPriority(t).then(function(r){return e(r,null)}).catch(function(r){return e(null,r)})},n.prototype._setPriority=function(t){return tn(this,void 0,void 0,function(){var e,r,i;return nn(this,function(s){switch(s.label){case 0:if(Object.keys(wd).map(function(a){return wd[a]}).indexOf(t)<0)throw Y.create(Y.Type.ERROR_INVALID_PARAMETER);return[4,fetch("".concat(_t.apiHost,"/tickets/").concat(this.id),{method:"PATCH",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{priority:t}))})];case 1:return e=s.sent(),[4,e.json()];case 2:if(r=s.sent(),!e.ok)throw _e.error("[REQ] ticket set priority failed:",r),i=Y.create(Y.Type.ERROR_REQUEST),i;return this.fetchFromJSON(r),_e.write("[REQ] ticket set priority:",this),[2,this]}})})},n.prototype.setRelatedChannelUrls=function(t,e){this._setRelatedChannelUrls(t).then(function(r){return e(r,null)}).catch(function(r){return e(null,r)})},n.prototype._setRelatedChannelUrls=function(t){return tn(this,void 0,void 0,function(){var e,r,i;return nn(this,function(s){switch(s.label){case 0:if(!Array.isArray(t)||t.some(function(a){return typeof a!="string"}))throw Y.create(Y.Type.ERROR_INVALID_PARAMETER);return[4,fetch("".concat(_t.apiHost,"/tickets/").concat(this.id),{method:"PATCH",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{relatedChannelUrls:t.join(",")}))})];case 1:return e=s.sent(),[4,e.json()];case 2:if(r=s.sent(),!e.ok)throw _e.error("[REQ] ticket set related channel URLs failed:",r),i=Y.create(Y.Type.ERROR_REQUEST),i;return this.fetchFromJSON(r),_e.write("[REQ] ticket set related channel URLs:",this),[2,this]}})})},n.prototype.setCustomFields=function(t,e){this._setCustomFields(t).then(function(r){e(r,null)}).catch(function(r){e(null,r)})},n.prototype._setCustomFields=function(t){return tn(this,void 0,void 0,function(){var e,r,i,s,a;return nn(this,function(o){switch(o.label){case 0:if(typeof t!="object"||t===null||Array.isArray(t))throw Y.create(Y.Type.ERROR_INVALID_PARAMETER);e={};for(r in t)e[r]=typeof t[r]=="string"?t[r]:JSON.stringify(t[r]);return[4,fetch("".concat(_t.apiHost,"/tickets/").concat(this.id,"/custom_fields/"),{method:"PATCH",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{customFields:JSON.stringify(e)}))})];case 1:return i=o.sent(),[4,i.json()];case 2:if(s=o.sent(),!i.ok)throw _e.error("[REQ] ticket set custom fields failed:",s),a=Y.create(Y.Type.ERROR_REQUEST),a;return this.fetchFromJSON(s),_e.write("[REQ] ticket set custom fields:",this),[2,this]}})})},n.isDeskCustomType=function(t){return t===vb},Object.defineProperty(n,"defaultLimit",{get:function(){return gb},enumerable:!1,configurable:!0}),n.clearCache=function(t){t?(delete ls[t],_e.write("[SYS] cached ticket for ".concat(t," cleared"))):(ls={},_e.write("[SYS] all cached ticket cleared"))},n.create=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=MR(t),i=r.cb;this._create(r).then(function(s){return i(s,null)}).catch(function(s){return i(null,s)})},n._create=function(t){var e;return tn(this,void 0,void 0,function(){var r,i,s,a,o,u,c,l,m,d,h,f,p,_,m,b,y,E;return nn(this,function(T){switch(T.label){case 0:if(r=t.title,i=t.name,s=t.groupKey,a=t.customFields,o=t.priority,u=t.relatedChannelUrls,c=t.botKey,l=_t.sendbird,!l)throw _e.error("[REQ] ticket create chat SDK is not initalized."),m=Y.create(Y.Type.ERROR_SENDBIRD_SDK_MISSING),m;DR(t),d={};for(h in a)d[h]=typeof a[h]=="string"?a[h]:JSON.stringify(a[h]);return f=vt(vt({},Xe.postParam),{channelName:r,channelType:"SENDBIRD_JAVASCRIPT",groupKey:s,customFields:a?JSON.stringify(d):void 0,relatedChannelUrls:u==null?void 0:u.join(","),botKey:c,info:JSON.stringify({ticket:{subject:r,requester:{name:i,email:((e=l==null?void 0:l.currentUser)===null||e===void 0?void 0:e.userId)||""}}})}),o&&(f.priority=o),[4,fetch("".concat(_t.apiHost,"/tickets/"),{method:"POST",headers:Xe.header,body:JSON.stringify(f)})];case 1:return p=T.sent(),[4,p.json()];case 2:if(_=T.sent(),!p.ok)throw _e.error("[REQ] ticket create failed:",_),m=Y.create(Y.Type.ERROR_REQUEST),m;return b=new n(_),[4,sd([b.channelUrl])];case 3:return y=ui.apply(void 0,[T.sent(),1]),E=y[0],b.channel=E,ls[E.url]=b,_e.write("[REQ] ticket create success:",b),[2,b]}})})},n.getOpenCount=function(t){this._getOpenCount().then(function(e){return t(e,null)}).catch(function(e){return t(null,e)})},n._getOpenCount=function(){return tn(this,void 0,void 0,function(){var t,e;return nn(this,function(r){switch(r.label){case 0:return[4,fetch("".concat(_t.apiHost,"/tickets/count/?").concat(Xe.getParam),{method:"GET",headers:Xe.header})];case 1:return t=r.sent(),[4,t.json()];case 2:if(e=r.sent(),!t.ok)throw _e.error("[REQ] get open ticket count failed:",e),Y.create(Y.Type.ERROR_REQUEST);return _e.write("[REQ] get open ticket count:",e),[2,e]}})})},n.getByChannelUrl=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=xR(t),i=r.cb;this._getByChannelUrl(r).then(function(s){return i==null?void 0:i(s,null)}).catch(function(s){return i==null?void 0:i(null,s)})},n._getByChannelUrl=function(t){return tn(this,void 0,void 0,function(){var e,r,i,s,a,o,u;return nn(this,function(c){switch(c.label){case 0:return e=t.channelUrl,r=t.cachingEnabled,ls[e]&&r?(_e.write("[REQ] get ticket for channel ".concat(e," from cache:"),ls[e]),[2,ls[e]]):[3,1];case 1:return i=void 0,[4,fetch("".concat(_t.apiHost,"/tickets/?").concat(Xe.getParam,"&limit=10&channelUrl=").concat(e),{method:"GET",headers:Xe.header})];case 2:return s=c.sent(),[4,s.json()];case 3:if(a=c.sent(),!s.ok)throw _e.error("[REQ] get ticket for channel failed:",a),Y.create(Y.Type.ERROR_REQUEST);return Array.isArray(a.results)&&a.results.length>0?(i=new n(a.results[0]),[4,sd([i.channelUrl])]):[3,5];case 4:return o=ui.apply(void 0,[c.sent(),1]),u=o[0],i.channel=u,ls[u.url]=i,_e.write("[REQ] get ticket for channel ".concat(e,":"),i),[2,i];case 5:throw Y.create(Y.Type.ERROR_DATA_NOT_FOUND)}})})},n.getList=function(t,e){n._getTicketList(t).then(function(r){return e(r,null)}).catch(function(r){return e(null,r)})},n.getOpenedList=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=tp(t),i=r.offset,s=r.filter,a=r.cb;np({offset:i,filter:s,cb:a}),n._getTicketList(vt(vt({},s),{offset:i,status:"OPEN"})).then(function(o){return a(o,null)}).catch(function(o){return a(null,o)})},n.getAllTickets=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=tp(t),i=r.offset,s=r.filter,a=r.cb;np({offset:i,filter:s,cb:a}),n._getTicketList(vt(vt({},s),{offset:i,status:"ALL"})).then(function(o){return a(o,null)}).catch(function(o){return a(null,o)})},n.getClosedList=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=tp(t),i=r.offset,s=r.filter,a=r.cb;np({offset:i,filter:s,cb:a}),n._getTicketList(vt(vt({},s),{offset:i,status:"CLOSED"})).then(function(o){return a(o,null)}).catch(function(o){return a(null,o)})},n.getUrlPreview=function(t,e){this._getUrlPreview(t).then(function(r){return e(r,null)}).catch(function(r){return e(null,r)})},n._getUrlPreview=function(t){return tn(this,void 0,void 0,function(){var e,r;return nn(this,function(i){switch(i.label){case 0:if(typeof t!="string")throw _e.error("[REQ] get url preview failed: url should be a string"),Y.create(Y.Type.ERROR_INVALID_PARAMETER);return[4,fetch("".concat(_t.apiHost,"/tickets/url_preview/"),{method:"POST",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{url:t}))})];case 1:return e=i.sent(),[4,e.json()];case 2:if(r=i.sent(),!e.ok)throw _e.error("[REQ] get url preview failed:",r),Y.create(Y.Type.ERROR_REQUEST);return _e.write("[REQ] get url preview:",r),[2,r]}})})},n.confirmEndOfChat=function(t,e,r){this._confirmEndOfChat(t,e).then(function(i){return r(i,null)}).catch(function(i){return r(null,i)})},n.prototype.instanceConfirmEndOfChat=function(t,e,r){n._confirmEndOfChat(t,e).then(function(i){return r(i,null)}).catch(function(i){return r(null,i)})},n._confirmEndOfChat=function(t,e){return tn(this,void 0,void 0,function(){var r,i,s,a;return nn(this,function(o){switch(o.label){case 0:if(!(typeof e=="string"&&["yes","no"].indexOf(e)>-1))throw Y.create(Y.Type.ERROR_INVALID_PARAMETER);return[4,n._getByChannelUrl({channelUrl:t.channelUrl,cachingEnabled:!0})];case 1:return r=o.sent(),[4,fetch("".concat(_t.apiHost,"/tickets/").concat(r.id,"/edit_message/"),{method:"PATCH",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{messageId:t.messageId,messageData:JSON.stringify({type:ja.DataType.TICKET_INQUIRE_CLOSURE,body:{state:e==="yes"?ja.ClosureState.CONFIRMED:ja.ClosureState.DECLINED,ticketId:r.id}})}))})];case 2:return i=o.sent(),[4,i.json()];case 3:if(s=o.sent(),!i.ok)throw _e.error("[REQ] confirm end of chat failed:",s),a=Y.create(Y.Type.ERROR_REQUEST),a;return _e.write("[REQ] confirmed end of chat:",r),[2,r]}})})},n.submitFeedback=function(t,e,r,i){r===void 0&&(r=""),this._submitFeedback(t,e,r).then(function(s){return i(s,null)}).catch(function(s){return i(null,s)})},n.prototype.instanceSubmitFeedback=function(t,e,r,i){r===void 0&&(r=""),n._submitFeedback(t,e,r).then(function(s){return i(s,null)}).catch(function(s){return i(null,s)})},n._submitFeedback=function(t,e,r){return r===void 0&&(r=""),tn(this,void 0,void 0,function(){var i,s,a,o;return nn(this,function(u){switch(u.label){case 0:if(!(t&&t.messageId>0&&t.channelUrl&&typeof e=="number"&&1<=e&&e<=5&&typeof r=="string"))throw Y.create(Y.Type.ERROR_INVALID_PARAMETER);return[4,n._getByChannelUrl({channelUrl:t.channelUrl,cachingEnabled:!0})];case 1:return i=u.sent(),[4,fetch("".concat(_t.apiHost,"/tickets/").concat(i.id,"/edit_message/"),{method:"PATCH",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{messageId:t.messageId,messageData:JSON.stringify({type:ja.DataType.TICKET_FEEDBACK,body:{state:ja.FeedbackState.CONFIRMED,customerSatisfactionScore:e,customerSatisfactionComment:r,ticketId:i.id}})}))})];case 2:return s=u.sent(),[4,s.json()];case 3:if(a=u.sent(),!s.ok)throw _e.error("[REQ] submit feedback failed:",a),o=Y.create(Y.Type.ERROR_REQUEST),o;return _e.write("[REQ] customer feedback:",i),[2,a]}})})},n}();function qR(n){var t="",e="",r=ol;if(!Array.isArray(n))throw _e.write("Arguments passed to SendbirdDesk.authenticate() must be an array"),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(n.length<1)throw _e.write("Too few arguments passed to SendbirdDesk.authenticate()"),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(n.length>3)throw _e.write("Too many arguments passed to SendbirdDesk.authenticate()"),Y.create(Y.Type.ERROR_INVALID_PARAMETER);return t=n[0],typeof n[1]=="string"&&(e=n[1]),typeof n[1]=="function"&&(r=n[1]),typeof n[2]=="function"&&(r=n[2]),{userId:t,accessToken:e,cb:r}}function $R(n){var t=n.userId,e=n.accessToken,r=n.cb;if(typeof t!="string")throw _e.write("UserId to SendbirdDesk.authenticate(userId) must be a string"),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(typeof e!="string")throw _e.write("AccessToken to SendbirdDesk.authenticate(userId, accessToken) must be a string"),Y.create(Y.Type.ERROR_INVALID_PARAMETER);if(typeof r!="function")throw _e.write("Callback to SendbirdDesk.authenticate(userId, accessToken, cb) must be a function"),Y.create(Y.Type.ERROR_INVALID_PARAMETER)}var g0=!1,De=function(){function n(){}return Object.defineProperty(n,"version",{get:function(){return _t.sdkVersion},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Error",{get:function(){return Y},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Agent",{get:function(){return c_},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Ticket",{get:function(){return v0},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Message",{get:function(){return ja},enumerable:!1,configurable:!0}),Object.defineProperty(n,"RelatedChannel",{get:function(){return mb},enumerable:!1,configurable:!0}),Object.defineProperty(n,"UrlRegExp",{get:function(){return ja.UrlRegExp},enumerable:!1,configurable:!0}),n.init=function(t,e){_t.sendbird=t,e&&(_t.platform=e),g0=!0},n.authenticate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=qR(t),i=r.userId,s=r.accessToken,a=r.cb;$R({userId:i,accessToken:s,cb:a}),this._authenticate({userId:i,accessToken:s,cb:a}).finally(function(){a()})},n._authenticate=function(t){return tn(this,void 0,void 0,function(){var e,r;return nn(this,function(i){switch(i.label){case 0:if(e=t.userId,r=t.accessToken,!g0)return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Xe.connect(e,r)];case 2:return i.sent(),[3,4];case 3:return i.sent(),Y.throw(Y.Type.ERROR_SENDBIRD_DESK_AUTH_FAILED),[3,4];case 4:return[3,6];case 5:Y.throw(Y.Type.ERROR_SENDBIRD_DESK_INIT_MISSING),i.label=6;case 6:return[2]}})})},n.isDeskChannel=function(t){return v0.isDeskCustomType(t.customType)},n.setApiHost=function(t){_t.apiHost=t},n.setDebugMode=function(){_t.setDebugMode()},n.setCustomerCustomFields=function(t,e){this._setCustomerCustomFields(t).then(function(r){e(r,null)}).catch(function(r){e(null,r)})},n._setCustomerCustomFields=function(t){return tn(this,void 0,void 0,function(){var e,r,i,s,a;return nn(this,function(o){switch(o.label){case 0:if(typeof t!="object"||t===null||Array.isArray(t))throw Y.create(Y.Type.ERROR_INVALID_PARAMETER);e={};for(r in t)i=t[r],typeof i=="string"?e[r]=i:e[r]=JSON.stringify(i);return[4,fetch("".concat(_t.apiHost,"/customers/custom_fields/"),{method:"PATCH",headers:Xe.header,body:JSON.stringify(vt(vt({},Xe.postParam),{customFields:JSON.stringify(e)}))})];case 1:return s=o.sent(),[4,s.json()];case 2:if(a=o.sent(),!s.ok)throw new Error(JSON.stringify(a));return[2,this._resToCustomFields(a.customFields)]}})})},n._resToCustomFields=function(t){var e,r,i={};try{for(var s=hk(t),a=s.next();!a.done;a=s.next()){var o=a.value;i[o.key]=o.value}}catch(u){e={error:u}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return i},n}();class yb{constructor(){this.attachCount=0,this.element=ya(`<div class='-sbd-spinner'>
            <div class='-sbd-spinner-wrapper'>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>`)}isAttached(){return!!this.element.parentNode}attachTo(t){this.attachCount++,this.isAttached()||t.appendChild(this.element)}detach(){this.attachCount--,this.isAttached()&&this.attachCount===0&&this.element.parentNode.removeChild(this.element)}}//! moment.js
//! version : 2.30.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
var Eb;function de(){return Eb.apply(null,arguments)}function HR(n){Eb=n}function fi(n){return n instanceof Array||Object.prototype.toString.call(n)==="[object Array]"}function fo(n){return n!=null&&Object.prototype.toString.call(n)==="[object Object]"}function nt(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function z_(n){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(n).length===0;var t;for(t in n)if(nt(n,t))return!1;return!0}function nr(n){return n===void 0}function Ls(n){return typeof n=="number"||Object.prototype.toString.call(n)==="[object Number]"}function ul(n){return n instanceof Date||Object.prototype.toString.call(n)==="[object Date]"}function bb(n,t){var e=[],r,i=n.length;for(r=0;r<i;++r)e.push(t(n[r],r));return e}function sa(n,t){for(var e in t)nt(t,e)&&(n[e]=t[e]);return nt(t,"toString")&&(n.toString=t.toString),nt(t,"valueOf")&&(n.valueOf=t.valueOf),n}function Qi(n,t,e,r){return Vb(n,t,e,r,!0).utc()}function zR(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function Pe(n){return n._pf==null&&(n._pf=zR()),n._pf}var d_;Array.prototype.some?d_=Array.prototype.some:d_=function(n){var t=Object(this),e=t.length>>>0,r;for(r=0;r<e;r++)if(r in t&&n.call(this,t[r],r,t))return!0;return!1};function G_(n){var t=null,e=!1,r=n._d&&!isNaN(n._d.getTime());if(r&&(t=Pe(n),e=d_.call(t.parsedDateParts,function(i){return i!=null}),r=t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&e),n._strict&&(r=r&&t.charsLeftOver===0&&t.unusedTokens.length===0&&t.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(n))n._isValid=r;else return r;return n._isValid}function Sh(n){var t=Qi(NaN);return n!=null?sa(Pe(t),n):Pe(t).userInvalidated=!0,t}var y0=de.momentProperties=[],rp=!1;function V_(n,t){var e,r,i,s=y0.length;if(nr(t._isAMomentObject)||(n._isAMomentObject=t._isAMomentObject),nr(t._i)||(n._i=t._i),nr(t._f)||(n._f=t._f),nr(t._l)||(n._l=t._l),nr(t._strict)||(n._strict=t._strict),nr(t._tzm)||(n._tzm=t._tzm),nr(t._isUTC)||(n._isUTC=t._isUTC),nr(t._offset)||(n._offset=t._offset),nr(t._pf)||(n._pf=Pe(t)),nr(t._locale)||(n._locale=t._locale),s>0)for(e=0;e<s;e++)r=y0[e],i=t[r],nr(i)||(n[r]=i);return n}function cl(n){V_(this,n),this._d=new Date(n._d!=null?n._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),rp===!1&&(rp=!0,de.updateOffset(this),rp=!1)}function pi(n){return n instanceof cl||n!=null&&n._isAMomentObject!=null}function Tb(n){de.suppressDeprecationWarnings===!1&&typeof console<"u"&&console.warn&&console.warn("Deprecation warning: "+n)}function Wr(n,t){var e=!0;return sa(function(){if(de.deprecationHandler!=null&&de.deprecationHandler(null,n),e){var r=[],i,s,a,o=arguments.length;for(s=0;s<o;s++){if(i="",typeof arguments[s]=="object"){i+=`
[`+s+"] ";for(a in arguments[0])nt(arguments[0],a)&&(i+=a+": "+arguments[0][a]+", ");i=i.slice(0,-2)}else i=arguments[s];r.push(i)}Tb(n+`
Arguments: `+Array.prototype.slice.call(r).join("")+`
`+new Error().stack),e=!1}return t.apply(this,arguments)},t)}var E0={};function wb(n,t){de.deprecationHandler!=null&&de.deprecationHandler(n,t),E0[n]||(Tb(t),E0[n]=!0)}de.suppressDeprecationWarnings=!1;de.deprecationHandler=null;function Wi(n){return typeof Function<"u"&&n instanceof Function||Object.prototype.toString.call(n)==="[object Function]"}function GR(n){var t,e;for(e in n)nt(n,e)&&(t=n[e],Wi(t)?this[e]=t:this["_"+e]=t);this._config=n,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function h_(n,t){var e=sa({},n),r;for(r in t)nt(t,r)&&(fo(n[r])&&fo(t[r])?(e[r]={},sa(e[r],n[r]),sa(e[r],t[r])):t[r]!=null?e[r]=t[r]:delete e[r]);for(r in n)nt(n,r)&&!nt(t,r)&&fo(n[r])&&(e[r]=sa({},e[r]));return e}function B_(n){n!=null&&this.set(n)}var f_;Object.keys?f_=Object.keys:f_=function(n){var t,e=[];for(t in n)nt(n,t)&&e.push(t);return e};var VR={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function BR(n,t,e){var r=this._calendar[n]||this._calendar.sameElse;return Wi(r)?r.call(t,e):r}function Ki(n,t,e){var r=""+Math.abs(n),i=t-r.length,s=n>=0;return(s?e?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+r}var j_=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,ad=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ip={},Jo={};function Ce(n,t,e,r){var i=r;typeof r=="string"&&(i=function(){return this[r]()}),n&&(Jo[n]=i),t&&(Jo[t[0]]=function(){return Ki(i.apply(this,arguments),t[1],t[2])}),e&&(Jo[e]=function(){return this.localeData().ordinal(i.apply(this,arguments),n)})}function jR(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"")}function KR(n){var t=n.match(j_),e,r;for(e=0,r=t.length;e<r;e++)Jo[t[e]]?t[e]=Jo[t[e]]:t[e]=jR(t[e]);return function(i){var s="",a;for(a=0;a<r;a++)s+=Wi(t[a])?t[a].call(i,n):t[a];return s}}function Id(n,t){return n.isValid()?(t=Ib(t,n.localeData()),ip[t]=ip[t]||KR(t),ip[t](n)):n.localeData().invalidDate()}function Ib(n,t){var e=5;function r(i){return t.longDateFormat(i)||i}for(ad.lastIndex=0;e>=0&&ad.test(n);)n=n.replace(ad,r),ad.lastIndex=0,e-=1;return n}var QR={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function WR(n){var t=this._longDateFormat[n],e=this._longDateFormat[n.toUpperCase()];return t||!e?t:(this._longDateFormat[n]=e.match(j_).map(function(r){return r==="MMMM"||r==="MM"||r==="DD"||r==="dddd"?r.slice(1):r}).join(""),this._longDateFormat[n])}var YR="Invalid date";function ZR(){return this._invalidDate}var JR="%d",XR=/\d{1,2}/;function eU(n){return this._ordinal.replace("%d",n)}var tU={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function nU(n,t,e,r){var i=this._relativeTime[e];return Wi(i)?i(n,t,e,r):i.replace(/%d/i,n)}function rU(n,t){var e=this._relativeTime[n>0?"future":"past"];return Wi(e)?e(t):e.replace(/%s/i,t)}var b0={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function Yr(n){return typeof n=="string"?b0[n]||b0[n.toLowerCase()]:void 0}function K_(n){var t={},e,r;for(r in n)nt(n,r)&&(e=Yr(r),e&&(t[e]=n[r]));return t}var iU={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function sU(n){var t=[],e;for(e in n)nt(n,e)&&t.push({unit:e,priority:iU[e]});return t.sort(function(r,i){return r.priority-i.priority}),t}var Sb=/\d/,kr=/\d\d/,Cb=/\d{3}/,Q_=/\d{4}/,Ch=/[+-]?\d{6}/,Dt=/\d\d?/,Nb=/\d\d\d\d?/,Ab=/\d\d\d\d\d\d?/,Nh=/\d{1,3}/,W_=/\d{1,4}/,Ah=/[+-]?\d{1,6}/,yu=/\d+/,kh=/[+-]?\d+/,aU=/Z|[+-]\d\d:?\d\d/gi,Oh=/Z|[+-]\d\d(?::?\d\d)?/gi,oU=/[+-]?\d+(\.\d{1,3})?/,ll=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Eu=/^[1-9]\d?/,Y_=/^([1-9]\d|\d)/,rh;rh={};function fe(n,t,e){rh[n]=Wi(t)?t:function(r,i){return r&&e?e:t}}function uU(n,t){return nt(rh,n)?rh[n](t._strict,t._locale):new RegExp(cU(n))}function cU(n){return Os(n.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,r,i,s){return e||r||i||s}))}function Os(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Fr(n){return n<0?Math.ceil(n)||0:Math.floor(n)}function Qe(n){var t=+n,e=0;return t!==0&&isFinite(t)&&(e=Fr(t)),e}var p_={};function wt(n,t){var e,r=t,i;for(typeof n=="string"&&(n=[n]),Ls(t)&&(r=function(s,a){a[t]=Qe(s)}),i=n.length,e=0;e<i;e++)p_[n[e]]=r}function dl(n,t){wt(n,function(e,r,i,s){i._w=i._w||{},t(e,i._w,i,s)})}function lU(n,t,e){t!=null&&nt(p_,n)&&p_[n](t,e._a,e,n)}function Mh(n){return n%4===0&&n%100!==0||n%400===0}var qn=0,Ns=1,qi=2,un=3,li=4,As=5,no=6,dU=7,hU=8;Ce("Y",0,0,function(){var n=this.year();return n<=9999?Ki(n,4):"+"+n});Ce(0,["YY",2],0,function(){return this.year()%100});Ce(0,["YYYY",4],0,"year");Ce(0,["YYYYY",5],0,"year");Ce(0,["YYYYYY",6,!0],0,"year");fe("Y",kh);fe("YY",Dt,kr);fe("YYYY",W_,Q_);fe("YYYYY",Ah,Ch);fe("YYYYYY",Ah,Ch);wt(["YYYYY","YYYYYY"],qn);wt("YYYY",function(n,t){t[qn]=n.length===2?de.parseTwoDigitYear(n):Qe(n)});wt("YY",function(n,t){t[qn]=de.parseTwoDigitYear(n)});wt("Y",function(n,t){t[qn]=parseInt(n,10)});function Dc(n){return Mh(n)?366:365}de.parseTwoDigitYear=function(n){return Qe(n)+(Qe(n)>68?1900:2e3)};var kb=bu("FullYear",!0);function fU(){return Mh(this.year())}function bu(n,t){return function(e){return e!=null?(Ob(this,n,e),de.updateOffset(this,t),this):Qc(this,n)}}function Qc(n,t){if(!n.isValid())return NaN;var e=n._d,r=n._isUTC;switch(t){case"Milliseconds":return r?e.getUTCMilliseconds():e.getMilliseconds();case"Seconds":return r?e.getUTCSeconds():e.getSeconds();case"Minutes":return r?e.getUTCMinutes():e.getMinutes();case"Hours":return r?e.getUTCHours():e.getHours();case"Date":return r?e.getUTCDate():e.getDate();case"Day":return r?e.getUTCDay():e.getDay();case"Month":return r?e.getUTCMonth():e.getMonth();case"FullYear":return r?e.getUTCFullYear():e.getFullYear();default:return NaN}}function Ob(n,t,e){var r,i,s,a,o;if(!(!n.isValid()||isNaN(e))){switch(r=n._d,i=n._isUTC,t){case"Milliseconds":return void(i?r.setUTCMilliseconds(e):r.setMilliseconds(e));case"Seconds":return void(i?r.setUTCSeconds(e):r.setSeconds(e));case"Minutes":return void(i?r.setUTCMinutes(e):r.setMinutes(e));case"Hours":return void(i?r.setUTCHours(e):r.setHours(e));case"Date":return void(i?r.setUTCDate(e):r.setDate(e));case"FullYear":break;default:return}s=e,a=n.month(),o=n.date(),o=o===29&&a===1&&!Mh(s)?28:o,i?r.setUTCFullYear(s,a,o):r.setFullYear(s,a,o)}}function pU(n){return n=Yr(n),Wi(this[n])?this[n]():this}function _U(n,t){if(typeof n=="object"){n=K_(n);var e=sU(n),r,i=e.length;for(r=0;r<i;r++)this[e[r].unit](n[e[r].unit])}else if(n=Yr(n),Wi(this[n]))return this[n](t);return this}function mU(n,t){return(n%t+t)%t}var Qt;Array.prototype.indexOf?Qt=Array.prototype.indexOf:Qt=function(n){var t;for(t=0;t<this.length;++t)if(this[t]===n)return t;return-1};function Z_(n,t){if(isNaN(n)||isNaN(t))return NaN;var e=mU(t,12);return n+=(t-e)/12,e===1?Mh(n)?29:28:31-e%7%2}Ce("M",["MM",2],"Mo",function(){return this.month()+1});Ce("MMM",0,0,function(n){return this.localeData().monthsShort(this,n)});Ce("MMMM",0,0,function(n){return this.localeData().months(this,n)});fe("M",Dt,Eu);fe("MM",Dt,kr);fe("MMM",function(n,t){return t.monthsShortRegex(n)});fe("MMMM",function(n,t){return t.monthsRegex(n)});wt(["M","MM"],function(n,t){t[Ns]=Qe(n)-1});wt(["MMM","MMMM"],function(n,t,e,r){var i=e._locale.monthsParse(n,r,e._strict);i!=null?t[Ns]=i:Pe(e).invalidMonth=n});var vU="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Mb="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Db=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,gU=ll,yU=ll;function EU(n,t){return n?fi(this._months)?this._months[n.month()]:this._months[(this._months.isFormat||Db).test(t)?"format":"standalone"][n.month()]:fi(this._months)?this._months:this._months.standalone}function bU(n,t){return n?fi(this._monthsShort)?this._monthsShort[n.month()]:this._monthsShort[Db.test(t)?"format":"standalone"][n.month()]:fi(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function TU(n,t,e){var r,i,s,a=n.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)s=Qi([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(s,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(s,"").toLocaleLowerCase();return e?t==="MMM"?(i=Qt.call(this._shortMonthsParse,a),i!==-1?i:null):(i=Qt.call(this._longMonthsParse,a),i!==-1?i:null):t==="MMM"?(i=Qt.call(this._shortMonthsParse,a),i!==-1?i:(i=Qt.call(this._longMonthsParse,a),i!==-1?i:null)):(i=Qt.call(this._longMonthsParse,a),i!==-1?i:(i=Qt.call(this._shortMonthsParse,a),i!==-1?i:null))}function wU(n,t,e){var r,i,s;if(this._monthsParseExact)return TU.call(this,n,t,e);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(i=Qi([2e3,r]),e&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),!e&&!this._monthsParse[r]&&(s="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[r]=new RegExp(s.replace(".",""),"i")),e&&t==="MMMM"&&this._longMonthsParse[r].test(n))return r;if(e&&t==="MMM"&&this._shortMonthsParse[r].test(n))return r;if(!e&&this._monthsParse[r].test(n))return r}}function Rb(n,t){if(!n.isValid())return n;if(typeof t=="string"){if(/^\d+$/.test(t))t=Qe(t);else if(t=n.localeData().monthsParse(t),!Ls(t))return n}var e=t,r=n.date();return r=r<29?r:Math.min(r,Z_(n.year(),e)),n._isUTC?n._d.setUTCMonth(e,r):n._d.setMonth(e,r),n}function Ub(n){return n!=null?(Rb(this,n),de.updateOffset(this,!0),this):Qc(this,"Month")}function IU(){return Z_(this.year(),this.month())}function SU(n){return this._monthsParseExact?(nt(this,"_monthsRegex")||Lb.call(this),n?this._monthsShortStrictRegex:this._monthsShortRegex):(nt(this,"_monthsShortRegex")||(this._monthsShortRegex=gU),this._monthsShortStrictRegex&&n?this._monthsShortStrictRegex:this._monthsShortRegex)}function CU(n){return this._monthsParseExact?(nt(this,"_monthsRegex")||Lb.call(this),n?this._monthsStrictRegex:this._monthsRegex):(nt(this,"_monthsRegex")||(this._monthsRegex=yU),this._monthsStrictRegex&&n?this._monthsStrictRegex:this._monthsRegex)}function Lb(){function n(u,c){return c.length-u.length}var t=[],e=[],r=[],i,s,a,o;for(i=0;i<12;i++)s=Qi([2e3,i]),a=Os(this.monthsShort(s,"")),o=Os(this.months(s,"")),t.push(a),e.push(o),r.push(o),r.push(a);t.sort(n),e.sort(n),r.sort(n),this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+e.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+t.join("|")+")","i")}function NU(n,t,e,r,i,s,a){var o;return n<100&&n>=0?(o=new Date(n+400,t,e,r,i,s,a),isFinite(o.getFullYear())&&o.setFullYear(n)):o=new Date(n,t,e,r,i,s,a),o}function Wc(n){var t,e;return n<100&&n>=0?(e=Array.prototype.slice.call(arguments),e[0]=n+400,t=new Date(Date.UTC.apply(null,e)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(n)):t=new Date(Date.UTC.apply(null,arguments)),t}function ih(n,t,e){var r=7+t-e,i=(7+Wc(n,0,r).getUTCDay()-t)%7;return-i+r-1}function Pb(n,t,e,r,i){var s=(7+e-r)%7,a=ih(n,r,i),o=1+7*(t-1)+s+a,u,c;return o<=0?(u=n-1,c=Dc(u)+o):o>Dc(n)?(u=n+1,c=o-Dc(n)):(u=n,c=o),{year:u,dayOfYear:c}}function Yc(n,t,e){var r=ih(n.year(),t,e),i=Math.floor((n.dayOfYear()-r-1)/7)+1,s,a;return i<1?(a=n.year()-1,s=i+Ms(a,t,e)):i>Ms(n.year(),t,e)?(s=i-Ms(n.year(),t,e),a=n.year()+1):(a=n.year(),s=i),{week:s,year:a}}function Ms(n,t,e){var r=ih(n,t,e),i=ih(n+1,t,e);return(Dc(n)-r+i)/7}Ce("w",["ww",2],"wo","week");Ce("W",["WW",2],"Wo","isoWeek");fe("w",Dt,Eu);fe("ww",Dt,kr);fe("W",Dt,Eu);fe("WW",Dt,kr);dl(["w","ww","W","WW"],function(n,t,e,r){t[r.substr(0,1)]=Qe(n)});function AU(n){return Yc(n,this._week.dow,this._week.doy).week}var kU={dow:0,doy:6};function OU(){return this._week.dow}function MU(){return this._week.doy}function DU(n){var t=this.localeData().week(this);return n==null?t:this.add((n-t)*7,"d")}function RU(n){var t=Yc(this,1,4).week;return n==null?t:this.add((n-t)*7,"d")}Ce("d",0,"do","day");Ce("dd",0,0,function(n){return this.localeData().weekdaysMin(this,n)});Ce("ddd",0,0,function(n){return this.localeData().weekdaysShort(this,n)});Ce("dddd",0,0,function(n){return this.localeData().weekdays(this,n)});Ce("e",0,0,"weekday");Ce("E",0,0,"isoWeekday");fe("d",Dt);fe("e",Dt);fe("E",Dt);fe("dd",function(n,t){return t.weekdaysMinRegex(n)});fe("ddd",function(n,t){return t.weekdaysShortRegex(n)});fe("dddd",function(n,t){return t.weekdaysRegex(n)});dl(["dd","ddd","dddd"],function(n,t,e,r){var i=e._locale.weekdaysParse(n,r,e._strict);i!=null?t.d=i:Pe(e).invalidWeekday=n});dl(["d","e","E"],function(n,t,e,r){t[r]=Qe(n)});function UU(n,t){return typeof n!="string"?n:isNaN(n)?(n=t.weekdaysParse(n),typeof n=="number"?n:null):parseInt(n,10)}function LU(n,t){return typeof n=="string"?t.weekdaysParse(n)%7||7:isNaN(n)?null:n}function J_(n,t){return n.slice(t,7).concat(n.slice(0,t))}var PU="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),xb="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),xU="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),FU=ll,qU=ll,$U=ll;function HU(n,t){var e=fi(this._weekdays)?this._weekdays:this._weekdays[n&&n!==!0&&this._weekdays.isFormat.test(t)?"format":"standalone"];return n===!0?J_(e,this._week.dow):n?e[n.day()]:e}function zU(n){return n===!0?J_(this._weekdaysShort,this._week.dow):n?this._weekdaysShort[n.day()]:this._weekdaysShort}function GU(n){return n===!0?J_(this._weekdaysMin,this._week.dow):n?this._weekdaysMin[n.day()]:this._weekdaysMin}function VU(n,t,e){var r,i,s,a=n.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)s=Qi([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(s,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(s,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(s,"").toLocaleLowerCase();return e?t==="dddd"?(i=Qt.call(this._weekdaysParse,a),i!==-1?i:null):t==="ddd"?(i=Qt.call(this._shortWeekdaysParse,a),i!==-1?i:null):(i=Qt.call(this._minWeekdaysParse,a),i!==-1?i:null):t==="dddd"?(i=Qt.call(this._weekdaysParse,a),i!==-1||(i=Qt.call(this._shortWeekdaysParse,a),i!==-1)?i:(i=Qt.call(this._minWeekdaysParse,a),i!==-1?i:null)):t==="ddd"?(i=Qt.call(this._shortWeekdaysParse,a),i!==-1||(i=Qt.call(this._weekdaysParse,a),i!==-1)?i:(i=Qt.call(this._minWeekdaysParse,a),i!==-1?i:null)):(i=Qt.call(this._minWeekdaysParse,a),i!==-1||(i=Qt.call(this._weekdaysParse,a),i!==-1)?i:(i=Qt.call(this._shortWeekdaysParse,a),i!==-1?i:null))}function BU(n,t,e){var r,i,s;if(this._weekdaysParseExact)return VU.call(this,n,t,e);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(i=Qi([2e3,1]).day(r),e&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(s="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[r]=new RegExp(s.replace(".",""),"i")),e&&t==="dddd"&&this._fullWeekdaysParse[r].test(n))return r;if(e&&t==="ddd"&&this._shortWeekdaysParse[r].test(n))return r;if(e&&t==="dd"&&this._minWeekdaysParse[r].test(n))return r;if(!e&&this._weekdaysParse[r].test(n))return r}}function jU(n){if(!this.isValid())return n!=null?this:NaN;var t=Qc(this,"Day");return n!=null?(n=UU(n,this.localeData()),this.add(n-t,"d")):t}function KU(n){if(!this.isValid())return n!=null?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return n==null?t:this.add(n-t,"d")}function QU(n){if(!this.isValid())return n!=null?this:NaN;if(n!=null){var t=LU(n,this.localeData());return this.day(this.day()%7?t:t-7)}else return this.day()||7}function WU(n){return this._weekdaysParseExact?(nt(this,"_weekdaysRegex")||X_.call(this),n?this._weekdaysStrictRegex:this._weekdaysRegex):(nt(this,"_weekdaysRegex")||(this._weekdaysRegex=FU),this._weekdaysStrictRegex&&n?this._weekdaysStrictRegex:this._weekdaysRegex)}function YU(n){return this._weekdaysParseExact?(nt(this,"_weekdaysRegex")||X_.call(this),n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(nt(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=qU),this._weekdaysShortStrictRegex&&n?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function ZU(n){return this._weekdaysParseExact?(nt(this,"_weekdaysRegex")||X_.call(this),n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(nt(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=$U),this._weekdaysMinStrictRegex&&n?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function X_(){function n(l,d){return d.length-l.length}var t=[],e=[],r=[],i=[],s,a,o,u,c;for(s=0;s<7;s++)a=Qi([2e3,1]).day(s),o=Os(this.weekdaysMin(a,"")),u=Os(this.weekdaysShort(a,"")),c=Os(this.weekdays(a,"")),t.push(o),e.push(u),r.push(c),i.push(o),i.push(u),i.push(c);t.sort(n),e.sort(n),r.sort(n),i.sort(n),this._weekdaysRegex=new RegExp("^("+i.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+e.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+t.join("|")+")","i")}function em(){return this.hours()%12||12}function JU(){return this.hours()||24}Ce("H",["HH",2],0,"hour");Ce("h",["hh",2],0,em);Ce("k",["kk",2],0,JU);Ce("hmm",0,0,function(){return""+em.apply(this)+Ki(this.minutes(),2)});Ce("hmmss",0,0,function(){return""+em.apply(this)+Ki(this.minutes(),2)+Ki(this.seconds(),2)});Ce("Hmm",0,0,function(){return""+this.hours()+Ki(this.minutes(),2)});Ce("Hmmss",0,0,function(){return""+this.hours()+Ki(this.minutes(),2)+Ki(this.seconds(),2)});function Fb(n,t){Ce(n,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}Fb("a",!0);Fb("A",!1);function qb(n,t){return t._meridiemParse}fe("a",qb);fe("A",qb);fe("H",Dt,Y_);fe("h",Dt,Eu);fe("k",Dt,Eu);fe("HH",Dt,kr);fe("hh",Dt,kr);fe("kk",Dt,kr);fe("hmm",Nb);fe("hmmss",Ab);fe("Hmm",Nb);fe("Hmmss",Ab);wt(["H","HH"],un);wt(["k","kk"],function(n,t,e){var r=Qe(n);t[un]=r===24?0:r});wt(["a","A"],function(n,t,e){e._isPm=e._locale.isPM(n),e._meridiem=n});wt(["h","hh"],function(n,t,e){t[un]=Qe(n),Pe(e).bigHour=!0});wt("hmm",function(n,t,e){var r=n.length-2;t[un]=Qe(n.substr(0,r)),t[li]=Qe(n.substr(r)),Pe(e).bigHour=!0});wt("hmmss",function(n,t,e){var r=n.length-4,i=n.length-2;t[un]=Qe(n.substr(0,r)),t[li]=Qe(n.substr(r,2)),t[As]=Qe(n.substr(i)),Pe(e).bigHour=!0});wt("Hmm",function(n,t,e){var r=n.length-2;t[un]=Qe(n.substr(0,r)),t[li]=Qe(n.substr(r))});wt("Hmmss",function(n,t,e){var r=n.length-4,i=n.length-2;t[un]=Qe(n.substr(0,r)),t[li]=Qe(n.substr(r,2)),t[As]=Qe(n.substr(i))});function XU(n){return(n+"").toLowerCase().charAt(0)==="p"}var eL=/[ap]\.?m?\.?/i,tL=bu("Hours",!0);function nL(n,t,e){return n>11?e?"pm":"PM":e?"am":"AM"}var $b={calendar:VR,longDateFormat:QR,invalidDate:YR,ordinal:JR,dayOfMonthOrdinalParse:XR,relativeTime:tU,months:vU,monthsShort:Mb,week:kU,weekdays:PU,weekdaysMin:xU,weekdaysShort:xb,meridiemParse:eL},Ft={},qu={},Zc;function rL(n,t){var e,r=Math.min(n.length,t.length);for(e=0;e<r;e+=1)if(n[e]!==t[e])return e;return r}function T0(n){return n&&n.toLowerCase().replace("_","-")}function iL(n){for(var t=0,e,r,i,s;t<n.length;){for(s=T0(n[t]).split("-"),e=s.length,r=T0(n[t+1]),r=r?r.split("-"):null;e>0;){if(i=Dh(s.slice(0,e).join("-")),i)return i;if(r&&r.length>=e&&rL(s,r)>=e-1)break;e--}t++}return Zc}function sL(n){return!!(n&&n.match("^[^/\\\\]*$"))}function Dh(n){var t=null,e;if(Ft[n]===void 0&&typeof module<"u"&&module&&module.exports&&sL(n))try{t=Zc._abbr,e=require,e("./locale/"+n),ga(t)}catch{Ft[n]=null}return Ft[n]}function ga(n,t){var e;return n&&(nr(t)?e=xs(n):e=tm(n,t),e?Zc=e:typeof console<"u"&&console.warn&&console.warn("Locale "+n+" not found. Did you forget to load it?")),Zc._abbr}function tm(n,t){if(t!==null){var e,r=$b;if(t.abbr=n,Ft[n]!=null)wb("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=Ft[n]._config;else if(t.parentLocale!=null)if(Ft[t.parentLocale]!=null)r=Ft[t.parentLocale]._config;else if(e=Dh(t.parentLocale),e!=null)r=e._config;else return qu[t.parentLocale]||(qu[t.parentLocale]=[]),qu[t.parentLocale].push({name:n,config:t}),null;return Ft[n]=new B_(h_(r,t)),qu[n]&&qu[n].forEach(function(i){tm(i.name,i.config)}),ga(n),Ft[n]}else return delete Ft[n],null}function aL(n,t){if(t!=null){var e,r,i=$b;Ft[n]!=null&&Ft[n].parentLocale!=null?Ft[n].set(h_(Ft[n]._config,t)):(r=Dh(n),r!=null&&(i=r._config),t=h_(i,t),r==null&&(t.abbr=n),e=new B_(t),e.parentLocale=Ft[n],Ft[n]=e),ga(n)}else Ft[n]!=null&&(Ft[n].parentLocale!=null?(Ft[n]=Ft[n].parentLocale,n===ga()&&ga(n)):Ft[n]!=null&&delete Ft[n]);return Ft[n]}function xs(n){var t;if(n&&n._locale&&n._locale._abbr&&(n=n._locale._abbr),!n)return Zc;if(!fi(n)){if(t=Dh(n),t)return t;n=[n]}return iL(n)}function oL(){return f_(Ft)}function nm(n){var t,e=n._a;return e&&Pe(n).overflow===-2&&(t=e[Ns]<0||e[Ns]>11?Ns:e[qi]<1||e[qi]>Z_(e[qn],e[Ns])?qi:e[un]<0||e[un]>24||e[un]===24&&(e[li]!==0||e[As]!==0||e[no]!==0)?un:e[li]<0||e[li]>59?li:e[As]<0||e[As]>59?As:e[no]<0||e[no]>999?no:-1,Pe(n)._overflowDayOfYear&&(t<qn||t>qi)&&(t=qi),Pe(n)._overflowWeeks&&t===-1&&(t=dU),Pe(n)._overflowWeekday&&t===-1&&(t=hU),Pe(n).overflow=t),n}var uL=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,cL=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,lL=/Z|[+-]\d\d(?::?\d\d)?/,od=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],sp=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],dL=/^\/?Date\((-?\d+)/i,hL=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,fL={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Hb(n){var t,e,r=n._i,i=uL.exec(r)||cL.exec(r),s,a,o,u,c=od.length,l=sp.length;if(i){for(Pe(n).iso=!0,t=0,e=c;t<e;t++)if(od[t][1].exec(i[1])){a=od[t][0],s=od[t][2]!==!1;break}if(a==null){n._isValid=!1;return}if(i[3]){for(t=0,e=l;t<e;t++)if(sp[t][1].exec(i[3])){o=(i[2]||" ")+sp[t][0];break}if(o==null){n._isValid=!1;return}}if(!s&&o!=null){n._isValid=!1;return}if(i[4])if(lL.exec(i[4]))u="Z";else{n._isValid=!1;return}n._f=a+(o||"")+(u||""),im(n)}else n._isValid=!1}function pL(n,t,e,r,i,s){var a=[_L(n),Mb.indexOf(t),parseInt(e,10),parseInt(r,10),parseInt(i,10)];return s&&a.push(parseInt(s,10)),a}function _L(n){var t=parseInt(n,10);return t<=49?2e3+t:t<=999?1900+t:t}function mL(n){return n.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function vL(n,t,e){if(n){var r=xb.indexOf(n),i=new Date(t[0],t[1],t[2]).getDay();if(r!==i)return Pe(e).weekdayMismatch=!0,e._isValid=!1,!1}return!0}function gL(n,t,e){if(n)return fL[n];if(t)return 0;var r=parseInt(e,10),i=r%100,s=(r-i)/100;return s*60+i}function zb(n){var t=hL.exec(mL(n._i)),e;if(t){if(e=pL(t[4],t[3],t[2],t[5],t[6],t[7]),!vL(t[1],e,n))return;n._a=e,n._tzm=gL(t[8],t[9],t[10]),n._d=Wc.apply(null,n._a),n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm),Pe(n).rfc2822=!0}else n._isValid=!1}function yL(n){var t=dL.exec(n._i);if(t!==null){n._d=new Date(+t[1]);return}if(Hb(n),n._isValid===!1)delete n._isValid;else return;if(zb(n),n._isValid===!1)delete n._isValid;else return;n._strict?n._isValid=!1:de.createFromInputFallback(n)}de.createFromInputFallback=Wr("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(n){n._d=new Date(n._i+(n._useUTC?" UTC":""))});function Ho(n,t,e){return n??t??e}function EL(n){var t=new Date(de.now());return n._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function rm(n){var t,e,r=[],i,s,a;if(!n._d){for(i=EL(n),n._w&&n._a[qi]==null&&n._a[Ns]==null&&bL(n),n._dayOfYear!=null&&(a=Ho(n._a[qn],i[qn]),(n._dayOfYear>Dc(a)||n._dayOfYear===0)&&(Pe(n)._overflowDayOfYear=!0),e=Wc(a,0,n._dayOfYear),n._a[Ns]=e.getUTCMonth(),n._a[qi]=e.getUTCDate()),t=0;t<3&&n._a[t]==null;++t)n._a[t]=r[t]=i[t];for(;t<7;t++)n._a[t]=r[t]=n._a[t]==null?t===2?1:0:n._a[t];n._a[un]===24&&n._a[li]===0&&n._a[As]===0&&n._a[no]===0&&(n._nextDay=!0,n._a[un]=0),n._d=(n._useUTC?Wc:NU).apply(null,r),s=n._useUTC?n._d.getUTCDay():n._d.getDay(),n._tzm!=null&&n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm),n._nextDay&&(n._a[un]=24),n._w&&typeof n._w.d<"u"&&n._w.d!==s&&(Pe(n).weekdayMismatch=!0)}}function bL(n){var t,e,r,i,s,a,o,u,c;t=n._w,t.GG!=null||t.W!=null||t.E!=null?(s=1,a=4,e=Ho(t.GG,n._a[qn],Yc(Mt(),1,4).year),r=Ho(t.W,1),i=Ho(t.E,1),(i<1||i>7)&&(u=!0)):(s=n._locale._week.dow,a=n._locale._week.doy,c=Yc(Mt(),s,a),e=Ho(t.gg,n._a[qn],c.year),r=Ho(t.w,c.week),t.d!=null?(i=t.d,(i<0||i>6)&&(u=!0)):t.e!=null?(i=t.e+s,(t.e<0||t.e>6)&&(u=!0)):i=s),r<1||r>Ms(e,s,a)?Pe(n)._overflowWeeks=!0:u!=null?Pe(n)._overflowWeekday=!0:(o=Pb(e,r,i,s,a),n._a[qn]=o.year,n._dayOfYear=o.dayOfYear)}de.ISO_8601=function(){};de.RFC_2822=function(){};function im(n){if(n._f===de.ISO_8601){Hb(n);return}if(n._f===de.RFC_2822){zb(n);return}n._a=[],Pe(n).empty=!0;var t=""+n._i,e,r,i,s,a,o=t.length,u=0,c,l;for(i=Ib(n._f,n._locale).match(j_)||[],l=i.length,e=0;e<l;e++)s=i[e],r=(t.match(uU(s,n))||[])[0],r&&(a=t.substr(0,t.indexOf(r)),a.length>0&&Pe(n).unusedInput.push(a),t=t.slice(t.indexOf(r)+r.length),u+=r.length),Jo[s]?(r?Pe(n).empty=!1:Pe(n).unusedTokens.push(s),lU(s,r,n)):n._strict&&!r&&Pe(n).unusedTokens.push(s);Pe(n).charsLeftOver=o-u,t.length>0&&Pe(n).unusedInput.push(t),n._a[un]<=12&&Pe(n).bigHour===!0&&n._a[un]>0&&(Pe(n).bigHour=void 0),Pe(n).parsedDateParts=n._a.slice(0),Pe(n).meridiem=n._meridiem,n._a[un]=TL(n._locale,n._a[un],n._meridiem),c=Pe(n).era,c!==null&&(n._a[qn]=n._locale.erasConvertYear(c,n._a[qn])),rm(n),nm(n)}function TL(n,t,e){var r;return e==null?t:n.meridiemHour!=null?n.meridiemHour(t,e):(n.isPM!=null&&(r=n.isPM(e),r&&t<12&&(t+=12),!r&&t===12&&(t=0)),t)}function wL(n){var t,e,r,i,s,a,o=!1,u=n._f.length;if(u===0){Pe(n).invalidFormat=!0,n._d=new Date(NaN);return}for(i=0;i<u;i++)s=0,a=!1,t=V_({},n),n._useUTC!=null&&(t._useUTC=n._useUTC),t._f=n._f[i],im(t),G_(t)&&(a=!0),s+=Pe(t).charsLeftOver,s+=Pe(t).unusedTokens.length*10,Pe(t).score=s,o?s<r&&(r=s,e=t):(r==null||s<r||a)&&(r=s,e=t,a&&(o=!0));sa(n,e||t)}function IL(n){if(!n._d){var t=K_(n._i),e=t.day===void 0?t.date:t.day;n._a=bb([t.year,t.month,e,t.hour,t.minute,t.second,t.millisecond],function(r){return r&&parseInt(r,10)}),rm(n)}}function SL(n){var t=new cl(nm(Gb(n)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function Gb(n){var t=n._i,e=n._f;return n._locale=n._locale||xs(n._l),t===null||e===void 0&&t===""?Sh({nullInput:!0}):(typeof t=="string"&&(n._i=t=n._locale.preparse(t)),pi(t)?new cl(nm(t)):(ul(t)?n._d=t:fi(e)?wL(n):e?im(n):CL(n),G_(n)||(n._d=null),n))}function CL(n){var t=n._i;nr(t)?n._d=new Date(de.now()):ul(t)?n._d=new Date(t.valueOf()):typeof t=="string"?yL(n):fi(t)?(n._a=bb(t.slice(0),function(e){return parseInt(e,10)}),rm(n)):fo(t)?IL(n):Ls(t)?n._d=new Date(t):de.createFromInputFallback(n)}function Vb(n,t,e,r,i){var s={};return(t===!0||t===!1)&&(r=t,t=void 0),(e===!0||e===!1)&&(r=e,e=void 0),(fo(n)&&z_(n)||fi(n)&&n.length===0)&&(n=void 0),s._isAMomentObject=!0,s._useUTC=s._isUTC=i,s._l=e,s._i=n,s._f=t,s._strict=r,SL(s)}function Mt(n,t,e,r){return Vb(n,t,e,r,!1)}var NL=Wr("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=Mt.apply(null,arguments);return this.isValid()&&n.isValid()?n<this?this:n:Sh()}),AL=Wr("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var n=Mt.apply(null,arguments);return this.isValid()&&n.isValid()?n>this?this:n:Sh()});function Bb(n,t){var e,r;if(t.length===1&&fi(t[0])&&(t=t[0]),!t.length)return Mt();for(e=t[0],r=1;r<t.length;++r)(!t[r].isValid()||t[r][n](e))&&(e=t[r]);return e}function kL(){var n=[].slice.call(arguments,0);return Bb("isBefore",n)}function OL(){var n=[].slice.call(arguments,0);return Bb("isAfter",n)}var ML=function(){return Date.now?Date.now():+new Date},$u=["year","quarter","month","week","day","hour","minute","second","millisecond"];function DL(n){var t,e=!1,r,i=$u.length;for(t in n)if(nt(n,t)&&!(Qt.call($u,t)!==-1&&(n[t]==null||!isNaN(n[t]))))return!1;for(r=0;r<i;++r)if(n[$u[r]]){if(e)return!1;parseFloat(n[$u[r]])!==Qe(n[$u[r]])&&(e=!0)}return!0}function RL(){return this._isValid}function UL(){return yi(NaN)}function Rh(n){var t=K_(n),e=t.year||0,r=t.quarter||0,i=t.month||0,s=t.week||t.isoWeek||0,a=t.day||0,o=t.hour||0,u=t.minute||0,c=t.second||0,l=t.millisecond||0;this._isValid=DL(t),this._milliseconds=+l+c*1e3+u*6e4+o*1e3*60*60,this._days=+a+s*7,this._months=+i+r*3+e*12,this._data={},this._locale=xs(),this._bubble()}function Sd(n){return n instanceof Rh}function __(n){return n<0?Math.round(-1*n)*-1:Math.round(n)}function LL(n,t,e){var r=Math.min(n.length,t.length),i=Math.abs(n.length-t.length),s=0,a;for(a=0;a<r;a++)(e&&n[a]!==t[a]||!e&&Qe(n[a])!==Qe(t[a]))&&s++;return s+i}function jb(n,t){Ce(n,0,0,function(){var e=this.utcOffset(),r="+";return e<0&&(e=-e,r="-"),r+Ki(~~(e/60),2)+t+Ki(~~e%60,2)})}jb("Z",":");jb("ZZ","");fe("Z",Oh);fe("ZZ",Oh);wt(["Z","ZZ"],function(n,t,e){e._useUTC=!0,e._tzm=sm(Oh,n)});var PL=/([\+\-]|\d\d)/gi;function sm(n,t){var e=(t||"").match(n),r,i,s;return e===null?null:(r=e[e.length-1]||[],i=(r+"").match(PL)||["-",0,0],s=+(i[1]*60)+Qe(i[2]),s===0?0:i[0]==="+"?s:-s)}function am(n,t){var e,r;return t._isUTC?(e=t.clone(),r=(pi(n)||ul(n)?n.valueOf():Mt(n).valueOf())-e.valueOf(),e._d.setTime(e._d.valueOf()+r),de.updateOffset(e,!1),e):Mt(n).local()}function m_(n){return-Math.round(n._d.getTimezoneOffset())}de.updateOffset=function(){};function xL(n,t,e){var r=this._offset||0,i;if(!this.isValid())return n!=null?this:NaN;if(n!=null){if(typeof n=="string"){if(n=sm(Oh,n),n===null)return this}else Math.abs(n)<16&&!e&&(n=n*60);return!this._isUTC&&t&&(i=m_(this)),this._offset=n,this._isUTC=!0,i!=null&&this.add(i,"m"),r!==n&&(!t||this._changeInProgress?Wb(this,yi(n-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,de.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?r:m_(this)}function FL(n,t){return n!=null?(typeof n!="string"&&(n=-n),this.utcOffset(n,t),this):-this.utcOffset()}function qL(n){return this.utcOffset(0,n)}function $L(n){return this._isUTC&&(this.utcOffset(0,n),this._isUTC=!1,n&&this.subtract(m_(this),"m")),this}function HL(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var n=sm(aU,this._i);n!=null?this.utcOffset(n):this.utcOffset(0,!0)}return this}function zL(n){return this.isValid()?(n=n?Mt(n).utcOffset():0,(this.utcOffset()-n)%60===0):!1}function GL(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function VL(){if(!nr(this._isDSTShifted))return this._isDSTShifted;var n={},t;return V_(n,this),n=Gb(n),n._a?(t=n._isUTC?Qi(n._a):Mt(n._a),this._isDSTShifted=this.isValid()&&LL(n._a,t.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function BL(){return this.isValid()?!this._isUTC:!1}function jL(){return this.isValid()?this._isUTC:!1}function Kb(){return this.isValid()?this._isUTC&&this._offset===0:!1}var KL=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,QL=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function yi(n,t){var e=n,r=null,i,s,a;return Sd(n)?e={ms:n._milliseconds,d:n._days,M:n._months}:Ls(n)||!isNaN(+n)?(e={},t?e[t]=+n:e.milliseconds=+n):(r=KL.exec(n))?(i=r[1]==="-"?-1:1,e={y:0,d:Qe(r[qi])*i,h:Qe(r[un])*i,m:Qe(r[li])*i,s:Qe(r[As])*i,ms:Qe(__(r[no]*1e3))*i}):(r=QL.exec(n))?(i=r[1]==="-"?-1:1,e={y:La(r[2],i),M:La(r[3],i),w:La(r[4],i),d:La(r[5],i),h:La(r[6],i),m:La(r[7],i),s:La(r[8],i)}):e==null?e={}:typeof e=="object"&&("from"in e||"to"in e)&&(a=WL(Mt(e.from),Mt(e.to)),e={},e.ms=a.milliseconds,e.M=a.months),s=new Rh(e),Sd(n)&&nt(n,"_locale")&&(s._locale=n._locale),Sd(n)&&nt(n,"_isValid")&&(s._isValid=n._isValid),s}yi.fn=Rh.prototype;yi.invalid=UL;function La(n,t){var e=n&&parseFloat(n.replace(",","."));return(isNaN(e)?0:e)*t}function w0(n,t){var e={};return e.months=t.month()-n.month()+(t.year()-n.year())*12,n.clone().add(e.months,"M").isAfter(t)&&--e.months,e.milliseconds=+t-+n.clone().add(e.months,"M"),e}function WL(n,t){var e;return n.isValid()&&t.isValid()?(t=am(t,n),n.isBefore(t)?e=w0(n,t):(e=w0(t,n),e.milliseconds=-e.milliseconds,e.months=-e.months),e):{milliseconds:0,months:0}}function Qb(n,t){return function(e,r){var i,s;return r!==null&&!isNaN(+r)&&(wb(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),s=e,e=r,r=s),i=yi(e,r),Wb(this,i,n),this}}function Wb(n,t,e,r){var i=t._milliseconds,s=__(t._days),a=__(t._months);n.isValid()&&(r=r??!0,a&&Rb(n,Qc(n,"Month")+a*e),s&&Ob(n,"Date",Qc(n,"Date")+s*e),i&&n._d.setTime(n._d.valueOf()+i*e),r&&de.updateOffset(n,s||a))}var YL=Qb(1,"add"),ZL=Qb(-1,"subtract");function Yb(n){return typeof n=="string"||n instanceof String}function JL(n){return pi(n)||ul(n)||Yb(n)||Ls(n)||eP(n)||XL(n)||n===null||n===void 0}function XL(n){var t=fo(n)&&!z_(n),e=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],i,s,a=r.length;for(i=0;i<a;i+=1)s=r[i],e=e||nt(n,s);return t&&e}function eP(n){var t=fi(n),e=!1;return t&&(e=n.filter(function(r){return!Ls(r)&&Yb(n)}).length===0),t&&e}function tP(n){var t=fo(n)&&!z_(n),e=!1,r=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],i,s;for(i=0;i<r.length;i+=1)s=r[i],e=e||nt(n,s);return t&&e}function nP(n,t){var e=n.diff(t,"days",!0);return e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse"}function rP(n,t){arguments.length===1&&(arguments[0]?JL(arguments[0])?(n=arguments[0],t=void 0):tP(arguments[0])&&(t=arguments[0],n=void 0):(n=void 0,t=void 0));var e=n||Mt(),r=am(e,this).startOf("day"),i=de.calendarFormat(this,r)||"sameElse",s=t&&(Wi(t[i])?t[i].call(this,e):t[i]);return this.format(s||this.localeData().calendar(i,this,Mt(e)))}function iP(){return new cl(this)}function sP(n,t){var e=pi(n)?n:Mt(n);return this.isValid()&&e.isValid()?(t=Yr(t)||"millisecond",t==="millisecond"?this.valueOf()>e.valueOf():e.valueOf()<this.clone().startOf(t).valueOf()):!1}function aP(n,t){var e=pi(n)?n:Mt(n);return this.isValid()&&e.isValid()?(t=Yr(t)||"millisecond",t==="millisecond"?this.valueOf()<e.valueOf():this.clone().endOf(t).valueOf()<e.valueOf()):!1}function oP(n,t,e,r){var i=pi(n)?n:Mt(n),s=pi(t)?t:Mt(t);return this.isValid()&&i.isValid()&&s.isValid()?(r=r||"()",(r[0]==="("?this.isAfter(i,e):!this.isBefore(i,e))&&(r[1]===")"?this.isBefore(s,e):!this.isAfter(s,e))):!1}function uP(n,t){var e=pi(n)?n:Mt(n),r;return this.isValid()&&e.isValid()?(t=Yr(t)||"millisecond",t==="millisecond"?this.valueOf()===e.valueOf():(r=e.valueOf(),this.clone().startOf(t).valueOf()<=r&&r<=this.clone().endOf(t).valueOf())):!1}function cP(n,t){return this.isSame(n,t)||this.isAfter(n,t)}function lP(n,t){return this.isSame(n,t)||this.isBefore(n,t)}function dP(n,t,e){var r,i,s;if(!this.isValid())return NaN;if(r=am(n,this),!r.isValid())return NaN;switch(i=(r.utcOffset()-this.utcOffset())*6e4,t=Yr(t),t){case"year":s=Cd(this,r)/12;break;case"month":s=Cd(this,r);break;case"quarter":s=Cd(this,r)/3;break;case"second":s=(this-r)/1e3;break;case"minute":s=(this-r)/6e4;break;case"hour":s=(this-r)/36e5;break;case"day":s=(this-r-i)/864e5;break;case"week":s=(this-r-i)/6048e5;break;default:s=this-r}return e?s:Fr(s)}function Cd(n,t){if(n.date()<t.date())return-Cd(t,n);var e=(t.year()-n.year())*12+(t.month()-n.month()),r=n.clone().add(e,"months"),i,s;return t-r<0?(i=n.clone().add(e-1,"months"),s=(t-r)/(r-i)):(i=n.clone().add(e+1,"months"),s=(t-r)/(i-r)),-(e+s)||0}de.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";de.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function hP(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function fP(n){if(!this.isValid())return null;var t=n!==!0,e=t?this.clone().utc():this;return e.year()<0||e.year()>9999?Id(e,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):Wi(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Id(e,"Z")):Id(e,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function pP(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var n="moment",t="",e,r,i,s;return this.isLocal()||(n=this.utcOffset()===0?"moment.utc":"moment.parseZone",t="Z"),e="["+n+'("]',r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i="-MM-DD[T]HH:mm:ss.SSS",s=t+'[")]',this.format(e+r+i+s)}function _P(n){n||(n=this.isUtc()?de.defaultFormatUtc:de.defaultFormat);var t=Id(this,n);return this.localeData().postformat(t)}function mP(n,t){return this.isValid()&&(pi(n)&&n.isValid()||Mt(n).isValid())?yi({to:this,from:n}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function vP(n){return this.from(Mt(),n)}function gP(n,t){return this.isValid()&&(pi(n)&&n.isValid()||Mt(n).isValid())?yi({from:this,to:n}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()}function yP(n){return this.to(Mt(),n)}function Zb(n){var t;return n===void 0?this._locale._abbr:(t=xs(n),t!=null&&(this._locale=t),this)}var Jb=Wr("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(n){return n===void 0?this.localeData():this.locale(n)});function Xb(){return this._locale}var sh=1e3,Xo=60*sh,ah=60*Xo,eT=(365*400+97)*24*ah;function eu(n,t){return(n%t+t)%t}function tT(n,t,e){return n<100&&n>=0?new Date(n+400,t,e)-eT:new Date(n,t,e).valueOf()}function nT(n,t,e){return n<100&&n>=0?Date.UTC(n+400,t,e)-eT:Date.UTC(n,t,e)}function EP(n){var t,e;if(n=Yr(n),n===void 0||n==="millisecond"||!this.isValid())return this;switch(e=this._isUTC?nT:tT,n){case"year":t=e(this.year(),0,1);break;case"quarter":t=e(this.year(),this.month()-this.month()%3,1);break;case"month":t=e(this.year(),this.month(),1);break;case"week":t=e(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=e(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=e(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=eu(t+(this._isUTC?0:this.utcOffset()*Xo),ah);break;case"minute":t=this._d.valueOf(),t-=eu(t,Xo);break;case"second":t=this._d.valueOf(),t-=eu(t,sh);break}return this._d.setTime(t),de.updateOffset(this,!0),this}function bP(n){var t,e;if(n=Yr(n),n===void 0||n==="millisecond"||!this.isValid())return this;switch(e=this._isUTC?nT:tT,n){case"year":t=e(this.year()+1,0,1)-1;break;case"quarter":t=e(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=e(this.year(),this.month()+1,1)-1;break;case"week":t=e(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=e(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=e(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=ah-eu(t+(this._isUTC?0:this.utcOffset()*Xo),ah)-1;break;case"minute":t=this._d.valueOf(),t+=Xo-eu(t,Xo)-1;break;case"second":t=this._d.valueOf(),t+=sh-eu(t,sh)-1;break}return this._d.setTime(t),de.updateOffset(this,!0),this}function TP(){return this._d.valueOf()-(this._offset||0)*6e4}function wP(){return Math.floor(this.valueOf()/1e3)}function IP(){return new Date(this.valueOf())}function SP(){var n=this;return[n.year(),n.month(),n.date(),n.hour(),n.minute(),n.second(),n.millisecond()]}function CP(){var n=this;return{years:n.year(),months:n.month(),date:n.date(),hours:n.hours(),minutes:n.minutes(),seconds:n.seconds(),milliseconds:n.milliseconds()}}function NP(){return this.isValid()?this.toISOString():null}function AP(){return G_(this)}function kP(){return sa({},Pe(this))}function OP(){return Pe(this).overflow}function MP(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}Ce("N",0,0,"eraAbbr");Ce("NN",0,0,"eraAbbr");Ce("NNN",0,0,"eraAbbr");Ce("NNNN",0,0,"eraName");Ce("NNNNN",0,0,"eraNarrow");Ce("y",["y",1],"yo","eraYear");Ce("y",["yy",2],0,"eraYear");Ce("y",["yyy",3],0,"eraYear");Ce("y",["yyyy",4],0,"eraYear");fe("N",om);fe("NN",om);fe("NNN",om);fe("NNNN",zP);fe("NNNNN",GP);wt(["N","NN","NNN","NNNN","NNNNN"],function(n,t,e,r){var i=e._locale.erasParse(n,r,e._strict);i?Pe(e).era=i:Pe(e).invalidEra=n});fe("y",yu);fe("yy",yu);fe("yyy",yu);fe("yyyy",yu);fe("yo",VP);wt(["y","yy","yyy","yyyy"],qn);wt(["yo"],function(n,t,e,r){var i;e._locale._eraYearOrdinalRegex&&(i=n.match(e._locale._eraYearOrdinalRegex)),e._locale.eraYearOrdinalParse?t[qn]=e._locale.eraYearOrdinalParse(n,i):t[qn]=parseInt(n,10)});function DP(n,t){var e,r,i,s=this._eras||xs("en")._eras;for(e=0,r=s.length;e<r;++e){switch(typeof s[e].since){case"string":i=de(s[e].since).startOf("day"),s[e].since=i.valueOf();break}switch(typeof s[e].until){case"undefined":s[e].until=1/0;break;case"string":i=de(s[e].until).startOf("day").valueOf(),s[e].until=i.valueOf();break}}return s}function RP(n,t,e){var r,i,s=this.eras(),a,o,u;for(n=n.toUpperCase(),r=0,i=s.length;r<i;++r)if(a=s[r].name.toUpperCase(),o=s[r].abbr.toUpperCase(),u=s[r].narrow.toUpperCase(),e)switch(t){case"N":case"NN":case"NNN":if(o===n)return s[r];break;case"NNNN":if(a===n)return s[r];break;case"NNNNN":if(u===n)return s[r];break}else if([a,o,u].indexOf(n)>=0)return s[r]}function UP(n,t){var e=n.since<=n.until?1:-1;return t===void 0?de(n.since).year():de(n.since).year()+(t-n.offset)*e}function LP(){var n,t,e,r=this.localeData().eras();for(n=0,t=r.length;n<t;++n)if(e=this.clone().startOf("day").valueOf(),r[n].since<=e&&e<=r[n].until||r[n].until<=e&&e<=r[n].since)return r[n].name;return""}function PP(){var n,t,e,r=this.localeData().eras();for(n=0,t=r.length;n<t;++n)if(e=this.clone().startOf("day").valueOf(),r[n].since<=e&&e<=r[n].until||r[n].until<=e&&e<=r[n].since)return r[n].narrow;return""}function xP(){var n,t,e,r=this.localeData().eras();for(n=0,t=r.length;n<t;++n)if(e=this.clone().startOf("day").valueOf(),r[n].since<=e&&e<=r[n].until||r[n].until<=e&&e<=r[n].since)return r[n].abbr;return""}function FP(){var n,t,e,r,i=this.localeData().eras();for(n=0,t=i.length;n<t;++n)if(e=i[n].since<=i[n].until?1:-1,r=this.clone().startOf("day").valueOf(),i[n].since<=r&&r<=i[n].until||i[n].until<=r&&r<=i[n].since)return(this.year()-de(i[n].since).year())*e+i[n].offset;return this.year()}function qP(n){return nt(this,"_erasNameRegex")||um.call(this),n?this._erasNameRegex:this._erasRegex}function $P(n){return nt(this,"_erasAbbrRegex")||um.call(this),n?this._erasAbbrRegex:this._erasRegex}function HP(n){return nt(this,"_erasNarrowRegex")||um.call(this),n?this._erasNarrowRegex:this._erasRegex}function om(n,t){return t.erasAbbrRegex(n)}function zP(n,t){return t.erasNameRegex(n)}function GP(n,t){return t.erasNarrowRegex(n)}function VP(n,t){return t._eraYearOrdinalRegex||yu}function um(){var n=[],t=[],e=[],r=[],i,s,a,o,u,c=this.eras();for(i=0,s=c.length;i<s;++i)a=Os(c[i].name),o=Os(c[i].abbr),u=Os(c[i].narrow),t.push(a),n.push(o),e.push(u),r.push(a),r.push(o),r.push(u);this._erasRegex=new RegExp("^("+r.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+t.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+n.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+e.join("|")+")","i")}Ce(0,["gg",2],0,function(){return this.weekYear()%100});Ce(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Uh(n,t){Ce(0,[n,n.length],0,t)}Uh("gggg","weekYear");Uh("ggggg","weekYear");Uh("GGGG","isoWeekYear");Uh("GGGGG","isoWeekYear");fe("G",kh);fe("g",kh);fe("GG",Dt,kr);fe("gg",Dt,kr);fe("GGGG",W_,Q_);fe("gggg",W_,Q_);fe("GGGGG",Ah,Ch);fe("ggggg",Ah,Ch);dl(["gggg","ggggg","GGGG","GGGGG"],function(n,t,e,r){t[r.substr(0,2)]=Qe(n)});dl(["gg","GG"],function(n,t,e,r){t[r]=de.parseTwoDigitYear(n)});function BP(n){return rT.call(this,n,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function jP(n){return rT.call(this,n,this.isoWeek(),this.isoWeekday(),1,4)}function KP(){return Ms(this.year(),1,4)}function QP(){return Ms(this.isoWeekYear(),1,4)}function WP(){var n=this.localeData()._week;return Ms(this.year(),n.dow,n.doy)}function YP(){var n=this.localeData()._week;return Ms(this.weekYear(),n.dow,n.doy)}function rT(n,t,e,r,i){var s;return n==null?Yc(this,r,i).year:(s=Ms(n,r,i),t>s&&(t=s),ZP.call(this,n,t,e,r,i))}function ZP(n,t,e,r,i){var s=Pb(n,t,e,r,i),a=Wc(s.year,0,s.dayOfYear);return this.year(a.getUTCFullYear()),this.month(a.getUTCMonth()),this.date(a.getUTCDate()),this}Ce("Q",0,"Qo","quarter");fe("Q",Sb);wt("Q",function(n,t){t[Ns]=(Qe(n)-1)*3});function JP(n){return n==null?Math.ceil((this.month()+1)/3):this.month((n-1)*3+this.month()%3)}Ce("D",["DD",2],"Do","date");fe("D",Dt,Eu);fe("DD",Dt,kr);fe("Do",function(n,t){return n?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient});wt(["D","DD"],qi);wt("Do",function(n,t){t[qi]=Qe(n.match(Dt)[0])});var iT=bu("Date",!0);Ce("DDD",["DDDD",3],"DDDo","dayOfYear");fe("DDD",Nh);fe("DDDD",Cb);wt(["DDD","DDDD"],function(n,t,e){e._dayOfYear=Qe(n)});function XP(n){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return n==null?t:this.add(n-t,"d")}Ce("m",["mm",2],0,"minute");fe("m",Dt,Y_);fe("mm",Dt,kr);wt(["m","mm"],li);var ex=bu("Minutes",!1);Ce("s",["ss",2],0,"second");fe("s",Dt,Y_);fe("ss",Dt,kr);wt(["s","ss"],As);var tx=bu("Seconds",!1);Ce("S",0,0,function(){return~~(this.millisecond()/100)});Ce(0,["SS",2],0,function(){return~~(this.millisecond()/10)});Ce(0,["SSS",3],0,"millisecond");Ce(0,["SSSS",4],0,function(){return this.millisecond()*10});Ce(0,["SSSSS",5],0,function(){return this.millisecond()*100});Ce(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});Ce(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});Ce(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});Ce(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});fe("S",Nh,Sb);fe("SS",Nh,kr);fe("SSS",Nh,Cb);var aa,sT;for(aa="SSSS";aa.length<=9;aa+="S")fe(aa,yu);function nx(n,t){t[no]=Qe(("0."+n)*1e3)}for(aa="S";aa.length<=9;aa+="S")wt(aa,nx);sT=bu("Milliseconds",!1);Ce("z",0,0,"zoneAbbr");Ce("zz",0,0,"zoneName");function rx(){return this._isUTC?"UTC":""}function ix(){return this._isUTC?"Coordinated Universal Time":""}var ee=cl.prototype;ee.add=YL;ee.calendar=rP;ee.clone=iP;ee.diff=dP;ee.endOf=bP;ee.format=_P;ee.from=mP;ee.fromNow=vP;ee.to=gP;ee.toNow=yP;ee.get=pU;ee.invalidAt=OP;ee.isAfter=sP;ee.isBefore=aP;ee.isBetween=oP;ee.isSame=uP;ee.isSameOrAfter=cP;ee.isSameOrBefore=lP;ee.isValid=AP;ee.lang=Jb;ee.locale=Zb;ee.localeData=Xb;ee.max=AL;ee.min=NL;ee.parsingFlags=kP;ee.set=_U;ee.startOf=EP;ee.subtract=ZL;ee.toArray=SP;ee.toObject=CP;ee.toDate=IP;ee.toISOString=fP;ee.inspect=pP;typeof Symbol<"u"&&Symbol.for!=null&&(ee[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"});ee.toJSON=NP;ee.toString=hP;ee.unix=wP;ee.valueOf=TP;ee.creationData=MP;ee.eraName=LP;ee.eraNarrow=PP;ee.eraAbbr=xP;ee.eraYear=FP;ee.year=kb;ee.isLeapYear=fU;ee.weekYear=BP;ee.isoWeekYear=jP;ee.quarter=ee.quarters=JP;ee.month=Ub;ee.daysInMonth=IU;ee.week=ee.weeks=DU;ee.isoWeek=ee.isoWeeks=RU;ee.weeksInYear=WP;ee.weeksInWeekYear=YP;ee.isoWeeksInYear=KP;ee.isoWeeksInISOWeekYear=QP;ee.date=iT;ee.day=ee.days=jU;ee.weekday=KU;ee.isoWeekday=QU;ee.dayOfYear=XP;ee.hour=ee.hours=tL;ee.minute=ee.minutes=ex;ee.second=ee.seconds=tx;ee.millisecond=ee.milliseconds=sT;ee.utcOffset=xL;ee.utc=qL;ee.local=$L;ee.parseZone=HL;ee.hasAlignedHourOffset=zL;ee.isDST=GL;ee.isLocal=BL;ee.isUtcOffset=jL;ee.isUtc=Kb;ee.isUTC=Kb;ee.zoneAbbr=rx;ee.zoneName=ix;ee.dates=Wr("dates accessor is deprecated. Use date instead.",iT);ee.months=Wr("months accessor is deprecated. Use month instead",Ub);ee.years=Wr("years accessor is deprecated. Use year instead",kb);ee.zone=Wr("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",FL);ee.isDSTShifted=Wr("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",VL);function sx(n){return Mt(n*1e3)}function ax(){return Mt.apply(null,arguments).parseZone()}function aT(n){return n}var at=B_.prototype;at.calendar=BR;at.longDateFormat=WR;at.invalidDate=ZR;at.ordinal=eU;at.preparse=aT;at.postformat=aT;at.relativeTime=nU;at.pastFuture=rU;at.set=GR;at.eras=DP;at.erasParse=RP;at.erasConvertYear=UP;at.erasAbbrRegex=$P;at.erasNameRegex=qP;at.erasNarrowRegex=HP;at.months=EU;at.monthsShort=bU;at.monthsParse=wU;at.monthsRegex=CU;at.monthsShortRegex=SU;at.week=AU;at.firstDayOfYear=MU;at.firstDayOfWeek=OU;at.weekdays=HU;at.weekdaysMin=GU;at.weekdaysShort=zU;at.weekdaysParse=BU;at.weekdaysRegex=WU;at.weekdaysShortRegex=YU;at.weekdaysMinRegex=ZU;at.isPM=XU;at.meridiem=nL;function oh(n,t,e,r){var i=xs(),s=Qi().set(r,t);return i[e](s,n)}function oT(n,t,e){if(Ls(n)&&(t=n,n=void 0),n=n||"",t!=null)return oh(n,t,e,"month");var r,i=[];for(r=0;r<12;r++)i[r]=oh(n,r,e,"month");return i}function cm(n,t,e,r){typeof n=="boolean"?(Ls(t)&&(e=t,t=void 0),t=t||""):(t=n,e=t,n=!1,Ls(t)&&(e=t,t=void 0),t=t||"");var i=xs(),s=n?i._week.dow:0,a,o=[];if(e!=null)return oh(t,(e+s)%7,r,"day");for(a=0;a<7;a++)o[a]=oh(t,(a+s)%7,r,"day");return o}function ox(n,t){return oT(n,t,"months")}function ux(n,t){return oT(n,t,"monthsShort")}function cx(n,t,e){return cm(n,t,e,"weekdays")}function lx(n,t,e){return cm(n,t,e,"weekdaysShort")}function dx(n,t,e){return cm(n,t,e,"weekdaysMin")}ga("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(n){var t=n%10,e=Qe(n%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return n+e}});de.lang=Wr("moment.lang is deprecated. Use moment.locale instead.",ga);de.langData=Wr("moment.langData is deprecated. Use moment.localeData instead.",xs);var ds=Math.abs;function hx(){var n=this._data;return this._milliseconds=ds(this._milliseconds),this._days=ds(this._days),this._months=ds(this._months),n.milliseconds=ds(n.milliseconds),n.seconds=ds(n.seconds),n.minutes=ds(n.minutes),n.hours=ds(n.hours),n.months=ds(n.months),n.years=ds(n.years),this}function uT(n,t,e,r){var i=yi(t,e);return n._milliseconds+=r*i._milliseconds,n._days+=r*i._days,n._months+=r*i._months,n._bubble()}function fx(n,t){return uT(this,n,t,1)}function px(n,t){return uT(this,n,t,-1)}function I0(n){return n<0?Math.floor(n):Math.ceil(n)}function _x(){var n=this._milliseconds,t=this._days,e=this._months,r=this._data,i,s,a,o,u;return n>=0&&t>=0&&e>=0||n<=0&&t<=0&&e<=0||(n+=I0(v_(e)+t)*864e5,t=0,e=0),r.milliseconds=n%1e3,i=Fr(n/1e3),r.seconds=i%60,s=Fr(i/60),r.minutes=s%60,a=Fr(s/60),r.hours=a%24,t+=Fr(a/24),u=Fr(cT(t)),e+=u,t-=I0(v_(u)),o=Fr(e/12),e%=12,r.days=t,r.months=e,r.years=o,this}function cT(n){return n*4800/146097}function v_(n){return n*146097/4800}function mx(n){if(!this.isValid())return NaN;var t,e,r=this._milliseconds;if(n=Yr(n),n==="month"||n==="quarter"||n==="year")switch(t=this._days+r/864e5,e=this._months+cT(t),n){case"month":return e;case"quarter":return e/3;case"year":return e/12}else switch(t=this._days+Math.round(v_(this._months)),n){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return t*24+r/36e5;case"minute":return t*1440+r/6e4;case"second":return t*86400+r/1e3;case"millisecond":return Math.floor(t*864e5)+r;default:throw new Error("Unknown unit "+n)}}function Fs(n){return function(){return this.as(n)}}var lT=Fs("ms"),vx=Fs("s"),gx=Fs("m"),yx=Fs("h"),Ex=Fs("d"),bx=Fs("w"),Tx=Fs("M"),wx=Fs("Q"),Ix=Fs("y"),Sx=lT;function Cx(){return yi(this)}function Nx(n){return n=Yr(n),this.isValid()?this[n+"s"]():NaN}function Ao(n){return function(){return this.isValid()?this._data[n]:NaN}}var Ax=Ao("milliseconds"),kx=Ao("seconds"),Ox=Ao("minutes"),Mx=Ao("hours"),Dx=Ao("days"),Rx=Ao("months"),Ux=Ao("years");function Lx(){return Fr(this.days()/7)}var gs=Math.round,Ko={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function Px(n,t,e,r,i){return i.relativeTime(t||1,!!e,n,r)}function xx(n,t,e,r){var i=yi(n).abs(),s=gs(i.as("s")),a=gs(i.as("m")),o=gs(i.as("h")),u=gs(i.as("d")),c=gs(i.as("M")),l=gs(i.as("w")),d=gs(i.as("y")),h=s<=e.ss&&["s",s]||s<e.s&&["ss",s]||a<=1&&["m"]||a<e.m&&["mm",a]||o<=1&&["h"]||o<e.h&&["hh",o]||u<=1&&["d"]||u<e.d&&["dd",u];return e.w!=null&&(h=h||l<=1&&["w"]||l<e.w&&["ww",l]),h=h||c<=1&&["M"]||c<e.M&&["MM",c]||d<=1&&["y"]||["yy",d],h[2]=t,h[3]=+n>0,h[4]=r,Px.apply(null,h)}function Fx(n){return n===void 0?gs:typeof n=="function"?(gs=n,!0):!1}function qx(n,t){return Ko[n]===void 0?!1:t===void 0?Ko[n]:(Ko[n]=t,n==="s"&&(Ko.ss=t-1),!0)}function $x(n,t){if(!this.isValid())return this.localeData().invalidDate();var e=!1,r=Ko,i,s;return typeof n=="object"&&(t=n,n=!1),typeof n=="boolean"&&(e=n),typeof t=="object"&&(r=Object.assign({},Ko,t),t.s!=null&&t.ss==null&&(r.ss=t.s-1)),i=this.localeData(),s=xx(this,!e,r,i),e&&(s=i.pastFuture(+this,s)),i.postformat(s)}var ap=Math.abs;function $o(n){return(n>0)-(n<0)||+n}function Lh(){if(!this.isValid())return this.localeData().invalidDate();var n=ap(this._milliseconds)/1e3,t=ap(this._days),e=ap(this._months),r,i,s,a,o=this.asSeconds(),u,c,l,d;return o?(r=Fr(n/60),i=Fr(r/60),n%=60,r%=60,s=Fr(e/12),e%=12,a=n?n.toFixed(3).replace(/\.?0+$/,""):"",u=o<0?"-":"",c=$o(this._months)!==$o(o)?"-":"",l=$o(this._days)!==$o(o)?"-":"",d=$o(this._milliseconds)!==$o(o)?"-":"",u+"P"+(s?c+s+"Y":"")+(e?c+e+"M":"")+(t?l+t+"D":"")+(i||r||n?"T":"")+(i?d+i+"H":"")+(r?d+r+"M":"")+(n?d+a+"S":"")):"P0D"}var Je=Rh.prototype;Je.isValid=RL;Je.abs=hx;Je.add=fx;Je.subtract=px;Je.as=mx;Je.asMilliseconds=lT;Je.asSeconds=vx;Je.asMinutes=gx;Je.asHours=yx;Je.asDays=Ex;Je.asWeeks=bx;Je.asMonths=Tx;Je.asQuarters=wx;Je.asYears=Ix;Je.valueOf=Sx;Je._bubble=_x;Je.clone=Cx;Je.get=Nx;Je.milliseconds=Ax;Je.seconds=kx;Je.minutes=Ox;Je.hours=Mx;Je.days=Dx;Je.weeks=Lx;Je.months=Rx;Je.years=Ux;Je.humanize=$x;Je.toISOString=Lh;Je.toString=Lh;Je.toJSON=Lh;Je.locale=Zb;Je.localeData=Xb;Je.toIsoString=Wr("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Lh);Je.lang=Jb;Ce("X",0,0,"unix");Ce("x",0,0,"valueOf");fe("x",kh);fe("X",oU);wt("X",function(n,t,e){e._d=new Date(parseFloat(n)*1e3)});wt("x",function(n,t,e){e._d=new Date(Qe(n))});//! moment.js
de.version="2.30.1";HR(Mt);de.fn=ee;de.min=kL;de.max=OL;de.now=ML;de.utc=Qi;de.unix=sx;de.months=ox;de.isDate=ul;de.locale=ga;de.invalid=Sh;de.duration=yi;de.isMoment=pi;de.weekdays=cx;de.parseZone=ax;de.localeData=xs;de.isDuration=Sd;de.monthsShort=ux;de.weekdaysMin=dx;de.defineLocale=tm;de.updateLocale=aL;de.locales=oL;de.weekdaysShort=lx;de.normalizeUnits=Yr;de.relativeTimeRounding=Fx;de.relativeTimeThreshold=qx;de.calendarFormat=nP;de.prototype=ee;de.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};const dT={sb:null};function Hx(n){dT.sb=n}function zx(){return dT.sb}class ra{constructor(t,e){this.message=t,this.streak=!!e,this.element=ya(`<div class='-sbd-message-item'>
            <div class='profile'>
                <img src='' alt='Profile' class='image'></img>
            </div>
            <div class='content'>
                <div class='media'>
                    <img src='' alt='Image' class='image'></img>
                    <video src='' controls='controls' width='240' height='200' class='video'></video>
                </div>
                <div class='preview'>
                    <img src='' alt='Image' class='image'></img>
                    <div class='title'></div>
                    <div class='description'></div>
                </div>
                <div class='message'>
                  <div class='file'></div>
                  <div class='text'></div>
                </div>
                <div class='rating'>
                  <div class='rating-message'></div>
                  <div class='rating-score'>
                    <div class='rating-item'></div>
                    <div class='rating-item'></div>
                    <div class='rating-item'></div>
                    <div class='rating-item'></div>
                    <div class='rating-item'></div>
                  </div>
                  <div class='rating-form'>
                    <textarea class='rating-comment' placeholder='(Optional)'></textarea>
                    <button class='rating-submit'>Submit</button>
                  </div>
                </div>
                <div class='rating-result'>
                  <div class='rating-message'>Thank you!</div>
                  <div class='rating-description'>Your submission has been received</div>
                  <div class='line'></div>
                  <div class='rating-result-score'>
                    <div class='rating-result-item'></div>
                    <div class='rating-result-item'></div>
                    <div class='rating-result-item'></div>
                    <div class='rating-result-item'></div>
                    <div class='rating-result-item'></div>
                    <div class='rating-result-number'></div>
                  </div>
                  <div class='rating-result-comment'></div>
                </div>
                <div class='created-at'></div>
            </div>
            <div class='confirm-end-of-chat'>
              <div class='message'></div>
              <div class='confirm'>
                <div class='yes button'>Yes</div>
                <div class='no button'>No</div>
              </div>
            </div>
        </div>`),this.isSatisfactionForm=!1,this.satisfaction={score:null,comment:null,sent:!1},this.content=he(this.element.querySelector(".content")),this.media=he(this.content.querySelector(".media")),this.image=he(this.media.querySelector(".image")),this.video=he(this.media.querySelector(".video")),this.preview=he(this.element.querySelector(".preview")),this.previewImage=he(this.preview.querySelector(".image")),this.previewTitle=he(this.preview.querySelector(".title")),this.previewDescription=he(this.preview.querySelector(".description")),this.profile=he(this.element.querySelector(".profile")),this.profileImage=he(this.profile.querySelector(".image")),this.messageBox=he(this.element.querySelector(".content .message")),this.messageFile=he(this.messageBox.querySelector(".file")),this.messageText=he(this.messageBox.querySelector(".text")),this.createdAt=he(this.element.querySelector(".created-at")),this.confirmEndOfChat=he(this.element.querySelector(".confirm-end-of-chat")),this.confirmMessage=he(this.confirmEndOfChat.querySelector(".message")),this.confirm=he(this.confirmEndOfChat.querySelector(".confirm")),this.yes=he(this.confirm.querySelector(".yes")),this.no=he(this.confirm.querySelector(".no")),this.yes.on("click",()=>{this.ticket.instanceConfirmEndOfChat(this.message,"yes")}),this.no.on("click",()=>{this.ticket.instanceConfirmEndOfChat(this.message,"no")}),this.rating=he(this.element.querySelector(".rating")),this.ratingMessage=he(this.rating.querySelector(".rating-message")),this.ratingItems=he(this.rating.querySelectorAll(".rating-item")),this.ratingForm=he(this.rating.querySelector(".rating-form")),this.ratingComment=he(this.rating.querySelector(".rating-comment")),this.ratingSubmit=he(this.rating.querySelector(".rating-submit")),this.ratingItems.forEach((r,i)=>{r.on("click",()=>{if(!this.satisfaction.sent){for(let s=0;s<this.ratingItems.length;s++)s<=i?this.ratingItems[s].addClass("selected"):this.ratingItems[s].removeClass("selected");this.satisfaction.score=i+1,this.ratingForm.show()}})}),this.ratingSubmit.on("click",()=>{if(!this.satisfaction.sent){const r=this.ratingComment.val();this.ticket.instanceSubmitFeedback(this.message,this.satisfaction.score,r,(i,s)=>{s||(this.satisfaction.comment=r,this.satisfaction.sent=!0)})}}),this.ratingResult=he(this.element.querySelector(".rating-result")),this.ratingResultItems=he(this.ratingResult.querySelectorAll(".rating-result-item")),this.ratingResultNumber=he(this.ratingResult.querySelector(".rating-result-number")),this.ratingResultComment=he(this.ratingResult.querySelector(".rating-result-comment")),this.render()}addTicket(t){this.ticket=t}render(){const t=zx(),e=this.message.sender||{};t.currentUser.userId===e.userId&&(this.messageFile.removeClass("file"),this.messageFile.addClass("my-file"),this.element.addClass("-sbd-my-message")),this.message.isAdminMessage()&&this.element.addClass("-sbd-admin-message");try{const r=JSON.parse(this.message.data);r.type==="SENDBIRD_DESK_CUSTOMER_SATISFACTION"&&(this.isSatisfactionForm=!0,this.satisfaction.ticketId=r.body.ticketId,r.body.status!=="WAITING"&&(this.satisfaction.score=r.body.customerSatisfactionScore,this.satisfaction.comment=r.body.customerSatisfactionComment,this.satisfaction.sent=!0))}catch{}if(e.profileUrl?(this.profileImage.attr("src",e.profileUrl),this.profileImage.show()):this.message.isAdminMessage()?this.profileImage.attr("src",""):this.profileImage.hide(),this.isSatisfactionForm)this.preview.hide(),this.media.hide(),this.messageBox.hide(),this.confirmEndOfChat.hide(),this.satisfaction.sent?(this.rating.hide(),this.ratingResult.show(),this.ratingResultItems.forEach((r,i)=>{i+1<=this.satisfaction.score&&r.addClass("selected")}),this.ratingResultNumber.html(this.satisfaction.score),this.satisfaction.comment?this.ratingResultComment.html(this.satisfaction.comment):this.ratingResultComment.hide()):(this.rating.show(),this.ratingResult.hide(),this.ratingMessage.html(this.message.message)),this.ratingForm.hide();else{if(this.preview.hide(),this.message.data)try{const s=JSON.parse(this.message.data);switch(s.type){case De.Message.DataType.URL_PREVIEW:this.message.message=this.message.message.replace(De.Message.UrlRegExp,a=>`<a href='${a}' target='_blank'>${a}</a>`),s.body.url&&s.body.title&&(this.preview.attr("href",s.body.url),this.previewTitle.html(s.body.title),s.body.image?(this.previewImage.attr("src",s.body.image),this.previewImage.show()):this.previewImage.hide(),s.body.description&&this.previewDescription.html(s.body.description),this.preview.on("click",()=>window.open(s.body.url,"_blank")),this.preview.show());break;case De.Message.DataType.TICKET_FEEDBACK:break}}catch{}this.message.isAdminMessage()?(this.messageFile.hide(),this.media.hide(),this.messageBox.show(),this.messageText.html(this.message.message)):this.message.isFileMessage()?this.message.type.indexOf("image")>=0?(this.messageBox.hide(),this.video.hide(),this.image.attr("src",this.message.url)):this.message.type.indexOf("video")>=0?(this.messageBox.hide(),this.image.hide(),this.video.attr("src",this.message.url)):(this.messageFile.show("inline-block"),this.media.hide(),this.messageBox.show(),this.messageText.html(this.message.name),this.messageText.addClass("file-name"),this.messageText.on("click",()=>{window.open(this.message.url,"_blank")})):(this.messageFile.hide(),this.media.hide(),this.messageBox.show(),this.messageText.html(this.message.message)),this.streak&&this.createdAt.hide(),this.createdAt.html(de(this.message.createdAt).fromNow());let r=null;try{r=this.message.data?JSON.parse(this.message.data):null}catch(s){throw s}if(r&&r.type===De.Message.DataType.TICKET_INQUIRE_CLOSURE)switch(r.body.state){case De.Message.ClosureState.WAITING:this.profile.hide(),this.content.hide(),this.confirmMessage.html(this.message.message),this.confirmEndOfChat.show();break;default:this.confirmEndOfChat.hide()}else this.confirmEndOfChat.hide();this.rating.hide(),this.ratingResult.hide()}}static get Script(){return{TICKET_ASSIGNED:"Ticket assigned.",TICKET_CLOSED:"Ticket closed.",TICKET_START:"Hi, what can I help you?"}}static isVisible(t){let e=null;try{e=t.data?JSON.parse(t.data):null}catch(r){throw r}return t.isSystemMessage=t.customType==="SENDBIRD_DESK_ADMIN_MESSAGE_CUSTOM_TYPE",t.isAssigned=e&&e.type===De.Message.DataType.TICKET_ASSIGN,t.isTransferred=e&&e.type===De.Message.DataType.TICKET_TRANSFER,t.isClosed=e&&e.type===De.Message.DataType.TICKET_CLOSE,!t.isSystemMessage&&!t.isAssigned&&!t.isTransferred&&!t.isClosed}}const Gx=20,Vx=60,op="Agent",S0="Write a message...",Bx="";class jx{constructor(t){this.ticket=t,this.element=ya(`<div class='-sbd-dialog'>
            <div class='-sbd-dialog-header'>
                <div class='close'></div>
                <div class='agent'>
                    <div class='profile'>
                        <img src='' alt='Profile' class='image'></img>
                    </div>
                    <div class='name'>${this.ticket.agent?this.ticket.agent.name:op}</div>
                </div>
            </div>
            <div class='-sbd-message-list'>
            </div>
            <div class='-sbd-message-form'>
                <input type='text' class='message' placeholder='${S0}'></input>
                <div class='attach'><input type='file' class='file'></input></div>
            </div>
        </div>`),this.updateAgent(t.agent),this.isOpened=!1,he(this.element.querySelector(".close")).on("click",()=>{this.close()}),this.messageList=he(this.element.querySelector(".-sbd-message-list")),this.messageElementList=[],this.collisionSet=new Set,this.spinner=new yb,this.messageRevision=0,this.isLoading=!1,this.messageList.on("scroll",r=>{if(!this.isLoading&&this.query.hasPrevious&&this.isTop()){this.isLoading=!0;const i=this.messageRevision;this.loadMessage(!0,(s,a)=>{if(!a&&this.messageRevision===i){const o=s;for(let u in o){const c=o[u];ra.isVisible(c)&&this.prependMessage(c)}}this.isLoading=!1}),r.preventDefault(),r.stopPropagation()}}),this.form=he(this.element.querySelector(".-sbd-message-form")),this.input=he(this.form.querySelector(".message")),this.attach=he(this.form.querySelector(".attach")),this.file=he(this.form.querySelector(".file")),this.editable=!0,t.status===De.Ticket.Status.CLOSED&&this.disableForm(),this.input.on("keypress",r=>{if(r.keyCode===13&&!r.shiftKey){r.preventDefault();const i=this.input.val();if(this.input.val(""),i&&this.editable){this.ticket.status===De.Ticket.Status.INITIALIZED&&(this.ticket.status=De.Ticket.Status.UNASSIGNED);const s={message:i};this.ticket.channel.sendUserMessage(s).onSucceeded(a=>{De.Message.UrlRegExp.test(a.message)&&(a.url=De.Message.UrlRegExp.exec(a.message)[0],De.Ticket.getUrlPreview(a.url,(o,u)=>{if(u)throw u;this.ticket.channel.updateUserMessage(a.messageId,a.message,JSON.stringify({type:De.Message.DataType.URL_PREVIEW,body:{url:a.url,site_name:o.data.siteName,title:o.data.title,description:o.data.description,image:o.data.image}}),a.customType,(c,l)=>{if(l)throw l;this.updateMessage(c)})})),this.appendMessage(a),this.scrollToBottom()}).onFailed((a,o)=>{this.ticket.status=De.Ticket.Status.INITIALIZED})}}}),this.attach.on("click",()=>{this.editable&&this.file.click()}),this.file.on("change",()=>{if(this.editable){const r=this.file.files[0],i={file:r,fileName:r.name,fileSize:r.size,mimeType:r.type,thumbnailSizes:[{maxWidth:220,maxHeight:220}]};this.ticket.channel.sendFileMessage(i).onPending(s=>{}).onFailed((s,a)=>{console.log(s)}).onSucceeded(s=>{ra.isVisible(s)&&(this.appendMessage(s),this.scrollToBottom())})}}),this.file.on("click",r=>r.stopPropagation())}loadMessage(t,e){if(!this.query||!t){const r=new Us,i=Gx,s=Date.now(),a=this.ticket.channel.createMessageCollection({filter:r,limit:i,startingPoint:s});a.initialize(Vd.CACHE_AND_REPLACE_BY_API).onCacheResult((o,u)=>{}).onApiResult((o,u)=>{}),this.query=a,this.clearMessage()}this.query.loadPrevious().then(r=>{e(r,!1)}).catch(r=>{e(null,r)})}open(t){if(t){this.isOpened=!0,this.widget=t,this.widget.panel.appendChild(this.element),this.element.addClass("opened"),this.ticket.channel.markAsRead(),this.spinner.attachTo(this.messageList),this.messageRevision++;const e=this.messageRevision;this.loadMessage(!1,(r,i)=>{if(!i&&this.messageRevision===e){const s=r;for(let a in s){const o=s[a];ra.isVisible(o)&&this.prependMessage(o)}this.scrollToBottom()}this.spinner.detach()})}}close(t){t?(this.element.hide(),this.element.parentNode&&this.widget.panel.removeChild(this.element)):(this.element.removeClass("opened"),setTimeout(()=>{this.element.parentNode&&this.widget.panel.removeChild(this.element)},1e3)),this.isOpened=!1}enableForm(){this.editable=!0,this.form.removeClass("disabled"),this.input.attr("readonly",""),this.input.attr("placeholder",S0),this.attach.show()}disableForm(){this.editable=!1,this.form.addClass("disabled"),this.input.attr("readonly","readonly"),this.input.attr("placeholder",Bx),this.attach.hide()}updateAgent(t){this.ticket&&(this.ticket.agent=t);let e=he(this.element.querySelector(".agent .profile .image")),r=he(this.element.querySelector(".agent .name"));t?(t.profileUrl?(e.attr("src",t.profileUrl),e.show()):e.hide(),r.html(t.name||op)):(e.hide(),r.html(op))}isMessageStreak(t,e){return(!t.sender&&!e.sender||t.sender&&e.sender&&t.sender.userId===e.sender.userId)&&Math.round((t.createdAt-e.createdAt)/1e3)<Vx}prependMessage(t){if(!this.collisionSet.has(t.messageId)){this.collisionSet.add(t.messageId);let e=!1;if(this.messageElementList.length>0){let i=null;for(let s in this.messageElementList){const a=this.messageElementList[s];if(!a.streak){i=a;break}}i&&(e=this.isMessageStreak(i.message,t))}const r=new ra(t,e);r.addTicket(this.ticket),this.messageElementList.unshift(r),this.messageList.firstChild?this.messageList.insertBefore(r.element,this.messageList.firstChild):this.messageList.appendChild(r.element)}}appendMessage(t){if(!this.collisionSet.has(t.messageId)){if(this.collisionSet.add(t.messageId),this.messageElementList.length>0){const i=this.messageElementList[this.messageElementList.length-1];this.isMessageStreak(t,i.message)&&(i.streak=!0,i.render())}const e=this.isBottom(),r=new ra(t);r.addTicket(this.ticket),this.messageElementList.push(r),this.messageList.appendChild(r.element),!this.spinner.isAttached()&&e&&this.scrollToBottom()}}updateMessage(t){for(let e in this.messageElementList){const r=this.messageElementList[e];if(r.message.messageId===t.messageId){r.message=t,r.render();break}}}clearMessage(){this.collisionSet=new Set,this.messageList.removeAll("-sbd-message-item"),this.messageElementList=[]}isTop(){return this.messageList.scrollTop===0}isBottom(){return this.messageList.scrollHeight-this.messageList.scrollTop===this.messageList.clientHeight}scrollToBottom(){this.messageList.scrollTo(0,this.messageList.scrollHeight)}}const Kx="No message",Qx=99;class C0{constructor(t,e){this.ticket=e,this.element=ya(`<div class='-sbd-ticket-item'>
            <div class='profile'>
                <img src='${e.agent?e.agent.profileUrl:""}' alt='Profile' class='image'></img>
                <div class='badge'></div>
            </div>
            <div class='content'>
                <div class='name'>${e.agent?e.agent.name:e.title}</div>
                <div class='last'>${e.channel.lastMessage.message||Kx}</div>
            </div>
            <div class='updated-at'></div>
        </div>`),this.profileImage=he(this.element.querySelector(".profile .image")),this.badge=he(this.element.querySelector(".profile .badge")),this.name=he(this.element.querySelector(".content .name")),this.last=he(this.element.querySelector(".content .last")),this.updatedAt=he(this.element.querySelector(".updated-at")),this.render(),this.element.on("click",()=>{t.startNewDialog(this.ticket)})}render(){const t=this.ticket.agent;t&&t.profileUrl?(this.profileImage.attr("src",t.profileUrl),this.profileImage.show()):this.profileImage.hide();let e=this.ticket.channel.unreadMessageCount;e>0?(e>=Qx&&(e=e+"+"),this.badge.html(e),this.badge.show()):this.badge.hide(),this.name.html(t?t.name:this.ticket.title),this.ticket.channel.lastMessage&&(this.ticket.channel.lastMessage.isFileMessage()?this.last.html(this.ticket.channel.lastMessage.name):this.last.html(this.ticket.channel.lastMessage.message)),this.updatedAt.html(de(this.ticket.channel.lastMessage?this.ticket.channel.lastMessage.createdAt:null).fromNow())}}const Wx="Agent",Yx=5e3;class Zx{constructor(t,e){this.ticket=t,this.message=e,this.element=ya(`<div class='-sbd-notification'>
            <div class='profile'>
              <img src='' alt='Profile' class='image'></img>
            </div>
            <div class='content'>
              <div class='name'>${Wx}</div>
              <div class='close'></div>
              <div class='text'></div>
            </div>
        </div>`),this.onClickHandler=null,this.element.on("click",()=>{this.onClickHandler&&this.onClickHandler(this.ticket,this.message)}),he(this.element.querySelector(".close")).on("click",i=>{i.stopPropagation(),i.preventDefault(),this.close()}),this.profile=he(this.element.querySelector(".profile")),this.profileImage=he(this.profile.querySelector(".image")),this.messageBox=he(this.element.querySelector(".content")),this.name=he(this.element.querySelector(".name")),this.messageText=he(this.messageBox.querySelector(".text")),this.render()}render(){const t=this.message.sender||{};t.profileUrl?(this.profileImage.attr("src",t.profileUrl),this.profileImage.show()):this.profileImage.hide(),t.name&&this.name.html(t.name),this.message.isAdminMessage()?this.messageText.html(this.message.message):this.message.isFileMessage()?this.messageText.html(this.message.name):this.messageText.html(this.message.message)}open(t,e=Yx){this.widget=t,this.element.addClass("fade-in"),this.widget.element.appendChild(this.element),setTimeout(()=>{this.close()},e)}close(){this.element.removeClass("fade-in"),setTimeout(()=>{this.element.parentNode&&this.widget.element.removeChild(this.element)},2e3)}onClick(t){this.onClickHandler=t}}const Jx="Cannot connect to internet.";class lm{constructor(t,e){this.element=document.getElementById("sb-desk"),this.element.className="-sbd-widget",e||(e={}),lm.panel=this.panel=ya(`<div class='-sbd-panel'>
            <div class='-sbd-header'>
                <div class='-sbd-title'>Inbox</div>
                <div class='-sbd-tabs'>
                    <div class='-sbd-tab-item' data-status='${De.Ticket.Status.OPEN}'>OPEN</div>
                    <div class='-sbd-tab-item' data-status='${De.Ticket.Status.CLOSED}'>CLOSED</div>
                    <div class='-sbd-tab-bar'></div>
                </div>
                <div class='-sbd-menu'><div class='icon'></div></div>
                <div class='-sbd-menu-list'>
                  <div class='-sbd-menu-item' data-cmd='signout'>Sign out</div>
                </div>
            </div>
            <div class='-sbd-ticket-list'>
                <div class='-sbd-ticket-new'>
                    <div class='icon'></div>
                    <div class='label'>Start a new conversation.</div>
                </div>
            </div>
            <div class='-sbd-error'>${Jx}</div>
        </div>`),this.element.appendChild(this.panel),this.error=he(this.element.querySelector(".-sbd-error"));let r=he(document.querySelectorAll(".-sbd-tabs > .-sbd-tab-item")),i=he(document.querySelector(".-sbd-tabs > .-sbd-tab-bar"));for(let p=0;p<r.length;p++)r[p].on("click",_=>{let m=_.target.getAttribute("data-status");c(m)});let s=he(document.querySelector(".-sbd-menu")),a=he(document.querySelector(".-sbd-menu-list"));s.on("click",()=>a.toggleClass("fade-in"));let o=he(document.querySelectorAll(".-sbd-menu-list > .-sbd-menu-item"));for(let p=0;p<o.length;p++)o[p].on("click",_=>{switch(_.target.getAttribute("data-cmd")){case"signout":this.signout();break}a.toggleClass("fade-in")});this.ticketList=he(document.querySelector(".-sbd-panel > .-sbd-ticket-list")),this.ticketElementList=[],this.ticketRevision=0,this.isLoading=!1,this.noMoreTicket=!1,this.ticketList.on("scroll",()=>{if(!this.isLoading&&!this.noMoreTicket&&this.isBottom()){this.isLoading=!0,this.currentPage++;const p=this.ticketRevision;this.loadTicket(this.currentTab,this.currentPage,(_,m)=>{if(!m&&this.ticketRevision===p)for(let b in _)this.appendTicket(_[b]);this.isLoading=!1})}});let u=he(document.querySelector(".-sbd-ticket-list > .-sbd-ticket-new"));u.on("click",()=>{const _=`Issue #${("000"+new Date().getTime()%1e3).slice(-3)}`;this.spinner.attachTo(this.ticketList),De.Ticket.create(_,t.nickname,(m,b)=>{if(b)throw b;this.spinner.detach(),this.startNewDialog(m)})}),this.spinner=new yb,this.currentTab="",this.currentPage=0,this.payloadTicket=null;let c=p=>{if(p!=this.currentTab){for(let m=0;m<r.length;m++)r[m].attr("data-status")===p&&(i.style.left=r[m].offsetLeft+"px");p===De.Ticket.Status.OPEN?u.show():u.hide(),this.currentTab=p,this.currentPage=0,this.ticketRevision++,this.clearTicket();const _=this.ticketRevision;this.spinner.attachTo(this.ticketList),this.loadTicket(p,this.currentPage,(m,b)=>{if(this.spinner.detach(),!b&&this.ticketRevision===_){for(let y in m)this.appendTicket(m[y]);this.payloadTicket&&(this.startNewDialog(this.payloadTicket),this.payloadTicket=null)}})}};const l=he(document.querySelector(".guide-balloon"));this.active=!1,this.action=ya("<div class='-sbd-action-button'></div>"),this.action.on("click",()=>{this.active=!this.active,this.action.toggleClass("is-active"),this.panel.toggleClass("fade-in"),this.active?c(De.Ticket.Status.OPEN):this.dialog&&setTimeout(()=>{this.currentTab="",this.dialog.close(!0)},500),this.active?l.hide():l.show()}),this.action.hide(),this.element.appendChild(this.action);const d={appId:t.appId,modules:[new lk]};e.wsHost&&(d.wsHost=e.wsHost),e.apiHost&&(d.apiHost=e.apiHost),this.sendbird=uN.init(d),Hx(this.sendbird);const h=this;async function f(){try{await h.sendbird.connect(t.userId),await h.sendbird.updateCurrentUserInfo({nickname:t.nickname})}catch(p){throw console.log("sendbird sdk init error",p),p}De.init(h.sendbird),e.deskApiHost&&De.setApiHost(e.deskApiHost),De.authenticate(t.userId,()=>{l.fadeIn(300),h.action.show();const p=new Jy;p.onReconnectStarted=()=>{h.active&&h.spinner.attachTo(h.ticketList)},p.onReconnectSucceeded=()=>{if(h.active){const m=h.currentTab;if(h.currentTab="",h.error.hide(),h.dialog&&h.dialog.isOpened){h.dialog.ticket.channel.markAsRead(),h.dialog.ticket.refresh((y,E)=>{E||(h.dialog.ticket=y,h.dialog.updateAgent(y.agent))});const b=h.dialog.messageRevision;h.dialog.loadMessage(!1,(y,E)=>{if(!E){if(h.dialog.messageRevision===b){const T=y;for(let N in T){const C=T[N];ra.isVisible(C)&&h.dialog.prependMessage(C)}h.dialog.scrollToBottom()}h.spinner.detach()}c(m)})}else h.spinner.detach(),c(m)}},p.onReconnectFailed=()=>{h.active&&(h.spinner.detach(),h.error.show())},h.sendbird.addConnectionHandler("widget",p);const _=new _E;_.onChannelChanged=m=>{De.Ticket.getByChannelUrl(m.url,(b,y)=>{if(y)throw y;const E=b;E.channel=m;let T=h.ticketElementList.findIndex(O=>O.ticket.id===E.id),N=T>=0?h.ticketElementList[T]:null;N&&(N.ticket=E,N.render());const C=E.status===De.Ticket.Status.INITIALIZED,L=E.status===De.Ticket.Status.CLOSED,k=T===0;h.currentTab!==De.Ticket.Status.CLOSED&&!k&&!L&&(N?(h.ticketElementList.splice(T,1),h.ticketList.removeChild(N.element)):C||(N=new C0(this,E)),N&&(h.ticketElementList.length>0?(h.ticketList.insertBefore(N.element,h.ticketElementList[0].element),h.ticketElementList.unshift(N)):(h.ticketElementList.push(N),h.ticketList.appendChild(N.element))))})},_.onMessageReceived=(m,b)=>{if(!h.currentTab||h.currentTab===De.Ticket.Status.OPEN){let y=null;try{y=b.data?JSON.parse(b.data):null}catch(E){throw E}De.Ticket.getByChannelUrl(m.url,(E,T)=>{if(T)throw T;const N=E;y&&y.ticket&&(N.status=y.ticket.status),b.isAssigned=y&&y.type===De.Message.DataType.TICKET_ASSIGN,b.isTransferred=y&&y.type===De.Message.DataType.TICKET_TRANSFER,b.isClosed=y&&y.type===De.Message.DataType.TICKET_CLOSE,(b.isAssigned||b.isTransferred)&&(N.agent=y.ticket.agent);const C=h.ticketElementList.findIndex(k=>k.ticket.id===N.id),L=C>=0?h.ticketElementList[C]:null;if(L&&(L.ticket=N,L.render(),b.isClosed&&(h.ticketElementList.splice(C,1),h.ticketList.removeChild(L.element))),!h.active&&De.isDeskChannel(m)&&ra.isVisible(b)){const k=new Zx(N,b);k.render(),k.onClick(O=>{k.close(),h.payloadTicket=O,h.action.click()}),k.open(this)}}),h.dialog&&h.dialog.isOpened&&h.dialog.ticket.channel.url===m.url&&(ra.isVisible(b)&&h.dialog.appendMessage(b),h.dialog.ticket.channel.markAsRead(()=>{}))}},_.onMessageUpdated=(m,b)=>{h.currentTab===De.Ticket.Status.OPEN&&De.Ticket.getByChannelUrl(m.url,(y,E)=>{if(E)throw E;const T=y;let N=null;try{N=b.data?JSON.parse(b.data):null}catch(k){throw k}N&&N.ticket&&(T.status=N.ticket.status);let C=h.ticketElementList.findIndex(k=>k.ticket.id===T.id),L=C>=0?h.ticketElementList[C]:null;if(b.isClosureInquired=N&&N.type===De.Message.DataType.TICKET_INQUIRE_CLOSURE,b.isClosureInquired)switch(N.body.state){case De.Message.ClosureState.CONFIRMED:T.status=De.Ticket.Status.CLOSED,L&&(h.ticketElementList.splice(C,1),h.ticketList.removeChild(L.element));break}h.dialog&&h.dialog.isOpened&&h.dialog.ticket.channel.url===m.url&&(h.dialog.updateMessage(b),T.status===De.Ticket.Status.CLOSED&&h.dialog.disableForm())})},h.sendbird.groupChannel.addGroupChannelHandler("widget",_)})}f()}loadTicket(t,e,r){switch(t){case De.Ticket.Status.OPEN:De.Ticket.getOpenedList(e,(i,s)=>{if(s)throw s;const a=i;this.noMoreTicket=a.length<De.Ticket.defaultLimit,r(i,s)});break;case De.Ticket.Status.CLOSED:De.Ticket.getClosedList(e,(i,s)=>{if(s)throw s;const a=i;this.noMoreTicket=a.length<De.Ticket.defaultLimit,r(i,s)});break;default:r(null,[])}}appendTicket(t){const e=new C0(this,t);this.ticketElementList.push(e),this.ticketList.appendChild(e.element)}clearTicket(){this.ticketElementList=[],this.ticketList.removeAll("-sbd-ticket-item")}signout(){this.sendbird.disconnect().then(()=>{Rc.send("signout"),this.panel.hasClass("fade-in")&&(this.panel.toggleClass("fade-in"),setTimeout(()=>{this.element.removeChild(this.panel)},250)),this.element.removeChild(this.action)})}isBottom(){return this.ticketList.scrollHeight-this.ticketList.scrollTop===this.ticketList.clientHeight}startNewDialog(t){this.dialog=new jx(t),this.dialog.open(this)}}const N0="sb-desk-appId",A0="sb-desk-userId",k0="sb-desk-nickname",O0="sb-desk-advanced",M0="sb-desk-advanced-wshost",D0="sb-desk-advanced-apihost",R0="sb-desk-advanced-deskApihost";class Xx{constructor(){const t=!!window.localStorage,e={appId:"",userId:"",nickname:""},r={active:!1,wsHost:"",apiHost:""};t&&(e.appId=localStorage.getItem(N0)||"",e.userId=localStorage.getItem(A0)||"",e.nickname=localStorage.getItem(k0)||"",r.active=localStorage.getItem(O0)==="true"||!1,r.wsHost=localStorage.getItem(M0)||"",r.apiHost=localStorage.getItem(D0)||"",r.deskApiHost=localStorage.getItem(R0)||""),this.element=ya(`<div class='-sbd-login-background'>
          <div class='-sbd-login'>
            <div class='logo'></div>
            <div class='title'><span class='bold'>Desk Widget</span> Login</div>
            <div class='panel'>
              <div class='form form-login'>
                <span class='input-label'>App ID</span>
                <input class='appId input' placeholder='App ID' value='${e.appId}'></input>
                <span class='input-label'>User ID</span>
                <input class='userId input' placeholder='User ID' value='${e.userId}'></input>
                <span class='input-label'>Name</span>
                <input class='nickname input' placeholder='Name' value='${e.nickname}'></input>
                <div class='error'></div>
              </div>
              <div class='separator'></div>
              <div class='control'>
                <div class='advanced'>
                  <div class='label'>Advanced</div>
                </div>
                <div class='login button'>Login</div>
              </div>
              <div class='form form-advanced'>
                <span class='input-label'>Custom WebSocket host</span>
                <input class='wsHost input' placeholder='Custom WebSocket host' value='${r.wsHost}'></input>
                <span class='input-label'>Custom API host</span>
                <input class='apiHost input' placeholder='Custom API host' value='${r.apiHost}'></input>
                <span class='input-label'>Custom Desk API host</span>
                <input class='deskApiHost input' placeholder='Custom Desk API host' value='${r.deskApiHost}'></input>
              </div>
            </div>
          </div>
        </div>`);const i=he(this.element.querySelector(".form-login .appId")),s=he(this.element.querySelector(".form-login .userId")),a=he(this.element.querySelector(".form-login .nickname"));let o=r.active;const u=he(this.element.querySelector(".advanced .label")),c=he(this.element.querySelector(".form-advanced"));u.on("click",()=>{u.toggleClass("open"),o=!o,o?c.show():c.hide()}),o?c.show():c.hide();const l=he(this.element.querySelector(".form-advanced .wsHost")),d=he(this.element.querySelector(".form-advanced .apiHost")),h=he(this.element.querySelector(".form-advanced .deskApiHost")),f=he(this.element.querySelector(".form-login .error"));he(this.element.querySelector(".control .login")).on("click",()=>{const _={appId:i.val(),userId:s.val(),nickname:a.val()};if(_.appId&&_.userId&&_.nickname){const m={};t&&(localStorage.setItem(N0,_.appId),localStorage.setItem(A0,_.userId),localStorage.setItem(k0,_.nickname),o&&(m.wsHost=l.val(),m.apiHost=d.val(),m.deskApiHost=h.val(),localStorage.setItem(M0,m.wsHost),localStorage.setItem(D0,m.apiHost),localStorage.setItem(R0,m.deskApiHost)),localStorage.setItem(O0,o&&m.wsHost&&m.apiHost&&m.deskApiHost?"true":"false")),new lm(_,m),this.hide()}else f.html("Insert app ID, user ID and name to login."),f.show()}),Rc.subscribe("signout",()=>this.show()),this.show()}show(){document.body.appendChild(this.element),this.element.addClass("shown")}hide(){this.element.removeClass("shown"),setTimeout(()=>{document.body.removeChild(this.element)},2e3)}}window.onload=()=>{new Xx};export{M as I,Fn as Q,ru as R,Od as Z,U as g,W as k,E_ as x,W0 as z};
